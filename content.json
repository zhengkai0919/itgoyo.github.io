[{"title":"å¸¸ç”¨çš„Markdownç¼–è¾‘å™¨æ¨è","date":"2017-10-15T03:43:47.000Z","path":"2017/10/15/å¸¸ç”¨çš„Markdownç¼–è¾‘å™¨æ¨è.html","text":"æ¬¢è¿å…³æ³¨æœ¬äººGtihub:itgoyo MarkdownPadå®˜ç½‘ Windows Cmd Markdownå®˜ç½‘ Windows Linux Web Dillingerå®˜ç½‘ Web MaHuaå®˜ç½‘ Web é©¬å…‹é£è±¡å®˜ç½‘ Web å°ä¹¦åŒ ç¼–è¾‘å™¨å®˜ç½‘ Mac Windows Linux Web SublimeTextå®˜ç½‘ Mac Windows Linux Atomå®˜ç½‘ Mac Windows Linux Smarkå®˜ç½‘ Windows Linux MdCharmå®˜ç½‘ Windows Linux Miuå®˜ç½‘ Windows GitBook Editorå®˜ç½‘ Mac Windows Linux Mouå®˜ç½‘ Mac Typoraå®˜ç½‘ Mac Bywordå®˜ç½‘ Mac Ulysseså®˜ç½‘ Mac Typedå®˜ç½‘ Mac Editor.mdå®˜ç½‘ Mac Windows Web å‘ç°æ›´å¤šæœ‰è¶£çš„å¥½ç©çš„ï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼štoolpool å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android Markdown","slug":"Android-Markdown","permalink":"https://github.com/itgoyo/tags/Android-Markdown/"}]},{"title":"SublimText3æ€ä¹ˆä¿®æ”¹ä¾§è¾¹æ çš„é¢œè‰²å’Œå†…å®¹ä¸€è‡´","date":"2017-09-03T02:04:58.000Z","path":"2017/09/03/Text3æ€ä¹ˆä¿®æ”¹ä¾§è¾¹æ çš„é¢œè‰²å’Œå†…å®¹ä¸€è‡´.html","text":"sublime text3åˆšå®‰è£…å®Œæˆä¹‹åæ‰“å¼€æ–‡ä»¶å¤¹æ˜¾ç¤ºçš„æ ·å¼å¦‚ä¸‹ è¿™æ ·å­çœ‹èµ·æ¥çœ¼ç›ä¼šå¾ˆéš¾å—,é‚£ä¹ˆæˆ‘ä»¬æ€æ ·æ‰èƒ½ä½¿å¾—å¼•å¯¼èœå•çš„é¢œè‰²å’Œç¼–è¾‘å™¨åº•è‰²ä¸€æ ·å‘¢? è§£å†³æ–¹æ³•å¦‚ä¸‹: Ctrl+Shift+P -&gt; install -&gt; æœç´¢å®‰è£…åŒ…SyncedSidebarBgï¼Œè‡ªåŠ¨åŒæ­¥ä¾§è¾¹æ åº•è‰²ä¸ºç¼–è¾‘çª—å£åº•è‰²ã€‚PSï¼šæœ‰æ—¶æ”¹å®Œåä¾§è¾¹æ é¢œè‰²æ²¡å˜åŒ–ï¼Œä¸çŸ¥ä»€ä¹ˆåŸå› ï¼Œæ‰“å¼€åŒ…æ§åˆ¶ï¼Œç„¶ååˆ—ä¸€ä¸‹å·²å®‰è£…åŒ…å°±åˆ·æ–°äº†ã€‚ å®‰è£…å®Œæˆä¹‹å,æ•ˆæœæ˜¯è¿™æ ·å­çš„: å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Program","slug":"Program","permalink":"https://github.com/itgoyo/tags/Program/"}]},{"title":"Ubuntuæ‰å¹³åŒ–ä¸»é¢˜Flatabulouså®‰è£…æ•™ç¨‹","date":"2017-09-03T01:25:48.000Z","path":"2017/09/03/Ubuntuæ‰å¹³åŒ–ä¸»é¢˜Flatabulouså®‰è£…æ•™ç¨‹.html","text":"ä¸çŸ¥é“å¤§å®¶å¯¹Ubuntuè‡ªå¸¦çš„ä¸»é¢˜æ•ˆæœæ€ä¹ˆçœ‹ï¼Œåæ­£æˆ‘è‡ªå·±è§‰å¾—è‡ªå¸¦çš„ä¸»é¢˜çœ‹èµ·æ¥æŒºéš¾å—çš„ï¼Œæ‰€ä»¥ç½‘ä¸Šæ‰¾äº†è®¸å¤šæ³•å­ï¼Œç»ˆäºæŠŠä¸»é¢˜ç¾åŒ–æˆè‡ªå·±å–œæ¬¢çš„æ ·å­ã€‚ Flatabulous: ä¸€ä¸ªè¶…å¥½çœ‹çš„æ‰å¹³åŒ– Ubuntu æ¡Œé¢ä¸»é¢˜ å®‰è£…æ­¤ä¸»é¢˜æ­¥éª¤ï¼š ä¸€ã€TweeakTool123sudo add-apt-repository ppa:tualatrix/ppa sudo apt-get updatesudo apt-get install ubuntu-tweak è¯¥å·¥å…·æ˜¯ç”¨æ¥è®¾ç½®å„ç§Ubuntuåå¥½ä½¿ç”¨çš„ äºŒã€å®‰è£…Flatabulousä¸‹è½½åœ°å€æˆ–è€…ç›´æ¥åœ¨Githubä¸Š Cloneä¸‹æ¥1https://github.com/anmoljagetia/Flatabulous æŠŠä¸‹è½½ä¸‹æ¥çš„zipåŒ…è§£å‹ï¼Œç§»åŠ¨åˆ°/usr/share/themes/ä¸‹ 1sudo mv Flatabulous-master /usr/share/themes/ ä¸‰ã€å®‰è£…æ‰å¹³åŒ–å›¾æ ‡ultra-flat-icons123sudo add-apt-repository ppa:noobslab/iconssudo apt-get updatesudo apt-get install ultra-flat-icons æˆ–è€…åˆ°http://ppa.launchpad.net/noobslab/icons/ubuntu/pool/main/u/ultra-flat-icons/è‡ªå·±ä¸‹è½½å®‰è£… æ³¨æ„ï¼Œåœ¨Ubuntu15.04ä¼šæç¤ºæ‰¾ä¸åˆ°ultra-flat-iconsè¿™ä¸ªåŒ…è§£å†³æ–¹æ³•ï¼šåœ¨è½¯ä»¶å’Œæ›´æ–°ä¸­æŠŠultra-flat-iconsæºä¸­çš„vividæ”¹æˆtrustyï¼Œå³å¯å®‰è£…æˆåŠŸï¼Œæœ€åè®°å¾—æ”¹å›æ¥è¿‡ æˆ–è€…ä½ ä¹Ÿå¯ä»¥è¿è¡Œsudo apt-get install ultra-flat-icons-orangeæˆ–è€… sudo apt-get install ultra-flat-icons-green æ ¹æ®ä½ è‡ªå·±å–œæ¬¢çš„é¢œè‰²é€‰æ‹©ã€‚ æœ€åå®Œæˆä»¥ä¸Šè®¾ç½®çš„æ•ˆæœå›¾ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Linux","slug":"Linux","permalink":"https://github.com/itgoyo/tags/Linux/"}]},{"title":"å†³ç­–","date":"2017-09-02T12:16:15.000Z","path":"2017/09/02/å†³ç­–.html","text":"ä»€ä¹ˆæ˜¯æˆ‘ä»¬ä¸€ç”Ÿä¸­è€—æ—¶æœ€å¤šã€æœ€è®©äººçº ç»“çš„äº‹?æ˜¯åšå‡ºå¤§å¤§å°å°çš„å†³ç­–ã€‚ æˆ‘ä»¬çš„ç”Ÿæ´»æ— æ—¶æ— åˆ»çš„éƒ½å……æ»¡äº†å„ç§å†³ç­–ï¼Œæ¯”å¦‚åˆé¤æˆ‘è¦åƒä»€ä¹ˆï¼Œåˆ°äº†å•†åœºæˆ‘è¦ä¹°ä»€ä¹ˆï¼Œä»Šå¤©è¡£æœç©¿ä»€ä¹ˆç­‰ç­‰ã€‚ æˆ‘ä»¬æ—¶å¸¸é™·å…¥ä¸ªäººä¸»è§‚æ„Ÿæƒ…æˆ–è€…æ˜¯éç†æ€§æ„Ÿæƒ…ä¸­åšå‡ºé”™è¯¯çš„å†³å®šï¼Œä»¥è‡´äºåšå‡ºè®©æˆ‘ä»¬åæ‚”ç»ˆç”Ÿçš„åˆ¤æ–­ã€‚ æœ‰ä¸€ä¸ªå¾ˆæœ‰è¶£çš„é—®é¢˜â€œæ‰å…‹ä¼¯æ ¼ä¸ºä»€ä¹ˆæ€»æ˜¯ç©¿åŒä¸€ä»¶è¡£æœï¼Ÿâ€ å…¶å®æ‰å…‹ä¼¯æ ¼çš„è¡£æŸœé‡Œçš„è¡£æœæ˜¯è¿™æ ·å­çš„ è€Œæ‰å…‹ä¼¯æ ¼è‡ªå·±çš„å›ç­”åˆ™æ˜¯ â€œæˆ‘æƒ³é€šè¿‡æ¸…ç©ºæˆ‘çš„ç”Ÿæ´»æ¥è®©æˆ‘åœ¨é™¤äº†å¦‚ä½•æ›´å¥½æœåŠ¡ç¤¾ä¼šè¿™ä»¶äº‹æƒ…ä»¥å¤–çš„ä»»ä½•äº‹æƒ…ä¸Šéƒ½åšå°½å¯èƒ½å°‘çš„å†³ç­–ã€‚â€ ä½œä¸ºä¸€ä¸ªå¯Œè±ªï¼Œæ‰å…‹ä¼¯æ ¼ä¸æ˜¯ä¸ºäº†æœ‰è¶£æ‰æ¯å¤©ç©¿åŒä¸€æ¬¾å¼çš„è¡£æœï¼Œä»–è¿™æ ·åšç¡®å®æ˜¯è¡Œä¹‹æœ‰æ•ˆ,æ¯ä¸€ä¸ªå†³å®šéƒ½ä¼šå‡å°‘æˆ‘ä»¬çš„æ„å¿—åŠ›â€œè¡€æ§½â€ã€‚æ¯ä¸€ä¸ªå†³å®šéƒ½ä¼šè®©æˆ‘ä»¬å°‘ä¸€ä¸åˆ›é€ åŠ›ã€æ§åˆ¶åŠ›å’Œä¸“æ³¨åŠ›ã€‚ å¼•ç”¨ä¸€ä½åäººçš„è¯ â€œæˆ‘ä»¬å¿…é¡»å°½æ—©å°†å°½å¯èƒ½å¤šä¸”æœ‰ç”¨çš„è¡ŒåŠ¨å˜æˆæˆ‘ä»¬è‡ªå‘çš„å’Œä¹ ä»¥ä¸ºå¸¸çš„å†³ç­–â€¦â€¦æˆ‘ä»¬é€šè¿‡æ¯«ä¸è´¹åŠ›çš„ä¸‹æ„è¯†è¡Œä¸ºè§£å†³çš„æ—¥å¸¸ç»†èŠ‚è¶Šå¤šï¼Œæˆ‘ä»¬å°±èƒ½è§£æ”¾è¶Šå¤šåº”è¯¥ç”¨æ¥å¤„ç†é«˜çº§äº‹åŠ¡çš„ç²¾ç¥æ„å¿—åŠ›ã€‚â€â€”â€”å¨å»‰Â·è©¹å§†æ–¯ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"ç”Ÿæ´»éšç¬”","slug":"ç”Ÿæ´»éšç¬”","permalink":"https://github.com/itgoyo/tags/ç”Ÿæ´»éšç¬”/"}]},{"title":"Androidå¼€å‘å·¥å…·å¤§å…¨","date":"2017-07-29T06:35:32.000Z","path":"2017/07/29/Androidå¼€å‘å·¥å…·å¤§å…¨.html","text":"AndroidDevTools Android Dev Toolså®˜ç½‘åœ°å€ï¼šwww.androiddevtools.cn æ”¶é›†æ•´ç†Androidå¼€å‘æ‰€éœ€çš„Android SDKã€å¼€å‘ä¸­ç”¨åˆ°çš„å·¥å…·ã€Androidå¼€å‘æ•™ç¨‹ã€Androidè®¾è®¡è§„èŒƒï¼Œå…è´¹çš„è®¾è®¡ç´ æç­‰ã€‚ æ¬¢è¿å¤§å®¶æ¨èè‡ªå·±åœ¨Androidå¼€å‘è¿‡ç¨‹ä¸­ç”¨çš„å¥½ç”¨çš„å·¥å…·ã€å­¦ä¹ å¼€å‘æ•™ç¨‹ã€ç”¨åˆ°è®¾è®¡ç´ æï¼Œæ¬¢è¿Starã€Fork ğŸ˜„ã€‚ Android Tools Android SDKåœ¨çº¿æ›´æ–°é•œåƒæœåŠ¡å™¨ ä¸­å›½ç§‘å­¦é™¢å¼€æºåä¼šé•œåƒç«™åœ°å€: IPV4/IPV6: mirrors.opencas.cn ç«¯å£ï¼š80 IPV4/IPV6: mirrors.opencas.org ç«¯å£ï¼š80 IPV4/IPV6: mirrors.opencas.ac.cn ç«¯å£ï¼š80 ä¸Šæµ·GDGé•œåƒæœåŠ¡å™¨åœ°å€: sdk.gdgshanghai.com ç«¯å£ï¼š8000 åŒ—äº¬åŒ–å·¥å¤§å­¦é•œåƒæœåŠ¡å™¨åœ°å€: IPv4: ubuntu.buct.edu.cn/ ç«¯å£ï¼š80 IPv4: ubuntu.buct.cn/ ç«¯å£ï¼š80 IPv6: ubuntu.buct6.edu.cn/ ç«¯å£ï¼š80 å¤§è¿ä¸œè½¯ä¿¡æ¯å­¦é™¢é•œåƒæœåŠ¡å™¨åœ°å€: mirrors.neusoft.edu.cn ç«¯å£ï¼š80 è…¾è®¯Bugly é•œåƒ: android-mirror.bugly.qq.com ç«¯å£ï¼š8080 è…¾è®¯é•œåƒä½¿ç”¨æ–¹æ³•: http://android-mirror.bugly.qq.com:8080/include/usage.html ä½¿ç”¨æ–¹æ³•ï¼š å¯åŠ¨ Android SDK Manager ï¼Œæ‰“å¼€ä¸»ç•Œé¢ï¼Œä¾æ¬¡é€‰æ‹©ã€Toolsã€ã€ã€Optionsâ€¦ã€ï¼Œå¼¹å‡ºã€Android SDK Manager - Settingsã€çª—å£ï¼› åœ¨ã€Android SDK Manager - Settingsã€çª—å£ä¸­ï¼Œåœ¨ã€HTTP Proxy Serverã€å’Œã€ŒHTTP Proxy Portã€è¾“å…¥æ¡†å†…å¡«å…¥ä¸Šé¢é•œåƒæœåŠ¡å™¨åœ°å€(ä¸åŒ…å«http://ï¼Œå¦‚ä¸‹å›¾)å’Œç«¯å£ï¼Œå¹¶ä¸”é€‰ä¸­ã€Force https://â€¦ sources to be fetched using http://â€¦ã€å¤é€‰æ¡†ã€‚è®¾ç½®å®Œæˆåå•å‡»ã€Closeã€æŒ‰é’®å…³é—­ã€Android SDK Manager - Settingsã€çª—å£è¿”å›åˆ°ä¸»ç•Œé¢ï¼› ä¾æ¬¡é€‰æ‹©ã€Packagesã€ã€ã€Reloadã€ã€‚ Android Studio æ³¨æ„:ä»¥ä¸‹ Android Studio ä¸‹è½½é“¾æ¥å…¨æ˜¯ dl.google.com å¼€å¤´çš„å®˜æ–¹ä¸‹è½½ï¼Œæ— éœ€tiziï¼Œå»ºè®®ç”¨æµè§ˆå™¨ç›´æ¥ä»å®˜æ–¹åŸå§‹é“¾æ¥ä¸‹è½½ï¼Œä¸è¦ç”¨è¿…é›·ä¸‹è½½ã€ä¸è¦ç”¨è¿…é›·ä¸‹è½½ã€ä¸è¦ç”¨è¿…é›·ä¸‹è½½ï¼Œé‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼Œé¿å…ç±»ä¼¼XCodeGhostçš„äº‹ä»¶ï¼ï¼ï¼ ç‰ˆæœ¬å· Windows Mac OSX Linux SHA-1æ ¡éªŒç  å®˜æ–¹SHA-1æ ¡éªŒç æˆªå›¾ 2.1.3 æ­£å¼ç‰ˆ ä¸‹è½½ (æ¨è) ä¸‹è½½ (ä¸å«SDK Tools) ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ Win: 10d319c772b80f3cb0cde952451af8429ea1b68b 43f84de7e61f37880a126c3d567b7fa6cb90c90e 8ad212c55c7f4dc7ab490e4b7e77ec48001ae224 Mac: 06166759b0e1e1ee91a147dcf5227d897a184277 Linux: 8729e6f2f1fa58f04df9f8d1caac2f5be9dfc549 æŸ¥çœ‹ 2.2 Beta ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ Win: 7d2c9861e90dc985b1e6ba78ebd8497b610a8620 Mac:050a443ffee51922eabddbcd260c845a8e06e4a9 Linux: bafb5d7029d2678e8274e24da1c7ce0a00f3a644 æŸ¥çœ‹ 2.2 Preview7 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ Win: e6ea4c9d9bf4ae46dbea82e3cc5638fd93194c33 Mac: 56327a0f97d999a6b7a15f3e9e513aa42881c989 Linux: b85c4e27401f7f18af19e39e453cca8575041dbb æŸ¥çœ‹ 2.1.2 æ­£å¼ç‰ˆ ä¸‹è½½(æ¨è) ä¸‹è½½(ä¸å«SDK Tools) ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ Win: 10d319c772b80f3cb0cde952451af8429ea1b68b 43f84de7e61f37880a126c3d567b7fa6cb90c90e 8ad212c55c7f4dc7ab490e4b7e77ec48001ae224 Mac: Linux: æŸ¥çœ‹ SDK Tools ç‰ˆæœ¬å· Windows Mac OSX Linux SHA-1æ ¡éªŒç  å®˜æ–¹SHA-1æ ¡éªŒç æˆªå›¾ 24.4.1 installer_r24.4.1-windows.exe android-sdk_r24.4.1-windows.zip android-sdk_r24.4.1-macosx.zip android-sdk_r24.4.1-linux.tgz Win:f9b59d72413649d31e633207e31f456443e7ea0b 66b6a6433053c152b22bf8cab19c0f3fef4eba49 Mac: 85a9cccb0b1f9e6f1f616335c5f07107553840cd Linux: 725bb360f0f7d04eaccff5a2d57abdd49061326d æŸ¥çœ‹ 24.3.4 installer_r24.3.4-windows.exe android-sdk_r24.3.4-windows.zip android-sdk_r24.3.4-macosx.zip android-sdk_r24.3.4-linux.tgz Win: 094dd45f98a31f839feae898b48f23704f2878dd 4a8718fb4a2bf2128d34b92f23ddd79fc65839e7 Mac: 128f10fba668ea490cc94a08e505a48a608879b9 Linux: fb293d7bca42e05580be56b1adc22055d46603dd æŸ¥çœ‹ SDK Platform-Toolsè¿™æ˜¯ adb, fastboot ç­‰å·¥å…·åŒ…ã€‚æŠŠè§£å‹å‡ºæ¥çš„ platform-tools æ–‡ä»¶å¤¹æ”¾åœ¨ android sdk æ ¹ç›®å½•ä¸‹ï¼Œå¹¶æŠŠ adbæ‰€åœ¨çš„ç›®å½•æ·»åŠ åˆ°ç³»ç»Ÿ PATH è·¯å¾„é‡Œï¼Œå³å¯åœ¨å‘½ä»¤è¡Œé‡Œç›´æ¥è®¿é—®äº† adb, fastboot ç­‰å·¥å…·ã€‚ ç‰ˆæœ¬å· Windows Mac OSX Linux platform-tools-r22 platform-tools_r22-windows.zip platform-tools_r22-mac.zip platform-tools_r22-linux.zip platform-tools-r21 platform-tools_r21-windows.zip platform-tools_r21-mac.zip platform-tools_r21-linux.zip platform-tools-r20 platform-tools_r20-windows.zip platform-tools_r20-mac.zip platform-tools_r20-linux.zip Build-Toolsè¿™æ˜¯Androidå¼€å‘æ‰€éœ€çš„Build-Toolsï¼Œä¸‹è½½å¹¶è§£å‹åï¼Œå°†è§£å‹å‡ºçš„æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶æˆ–è€…ç§»åŠ¨åˆ° your sdk è·¯å¾„/build-tools æ–‡ä»¶å¤¹å³å¯ã€‚ ç‰ˆæœ¬å· Windows Mac OSX Linux 22.0.0 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ 21.1.2 ä¸‹è½½ ä¸‹è½½ 21.1.1 ä¸‹è½½ ä¸‹è½½ 21.1.0 ä¸‹è½½ ä¸‹è½½ 21.0.2 ä¸‹è½½ ä¸‹è½½ 21.0.1 ä¸‹è½½ ä¸‹è½½ 21.0.0 ä¸‹è½½ ä¸‹è½½ 20.0.0 ä¸‹è½½ 19.1.0 ä¸‹è½½ ä¸‹è½½ 19.0.3 ä¸‹è½½ ä¸‹è½½ 19.0.2 ä¸‹è½½ ä¸‹è½½ 19.0.1 ä¸‹è½½ ä¸‹è½½ 19.0.0 ä¸‹è½½ ä¸‹è½½ SDKè¿™æ˜¯Androidå¼€å‘æ‰€éœ€çš„sdkï¼Œä¸‹è½½å¹¶è§£å‹åï¼Œå°†è§£å‹å‡ºçš„æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶æˆ–è€…ç§»åŠ¨åˆ°your sdk è·¯å¾„/platformsæ–‡ä»¶å¤¹ï¼Œç„¶åæ‰“å¼€SDK Managerï¼Œæ‰“å¼€Tools(å·¥å…·)èœå•é€‰æ‹©Options(é€‰é¡¹)èœå•é¡¹æ‰“å¼€Android SDK Manager Settingå¯¹è¯æ¡†ï¼Œç‚¹å‡»Clear Cache(æ¸…é™¤ç¼“å­˜)æŒ‰é’®ï¼Œç„¶åé‡å¯Eclipse(æˆ–Android Studio)å’ŒSDK Managerã€‚ ç³»ç»Ÿç‰ˆæœ¬å· Windows Mac OSX Linux android 5.0 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android L Rev3 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android L ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.4W ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.4.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.3 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.2.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.1.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.0.3 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.0 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 3.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 3.1 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 3.0 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 2.3.3 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 2.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ SDK System imagesè¿™æ˜¯åœ¨åˆ›å»ºæ¨¡æ‹Ÿå™¨æ—¶éœ€è¦çš„system imageï¼Œä¹Ÿå°±æ˜¯åœ¨åˆ›å»ºæ¨¡æ‹Ÿå™¨æ—¶CPU/ABIé¡¹éœ€è¦é€‰æ‹©çš„ï¼Œä¸‹è½½å¹¶è§£å‹åï¼Œå°†è§£å‹å‡ºçš„æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶æˆ–è€…ç§»åŠ¨åˆ°your sdk è·¯å¾„/system-imagesæ–‡ä»¶å¤¹ä¸‹å³å¯ï¼Œ å¦‚æœæ²¡æœ‰system-imagesç›®å½•å°±å…ˆåˆ›å»ºæ­¤æ–‡ä»¶å¤¹ï¼Œç„¶åæ‰“å¼€SDK Managerï¼Œæ‰“å¼€Tools(å·¥å…·)èœå•é€‰æ‹©Options(é€‰é¡¹)èœå•é¡¹æ‰“å¼€Android SDK Manager Settingå¯¹è¯æ¡†ï¼Œç‚¹å‡»Clear Cache(æ¸…é™¤ç¼“å­˜)æŒ‰é’®ï¼Œç„¶åé‡å¯Eclipse(æˆ–Android Studio)å’ŒSDK Managerã€‚ ç³»ç»Ÿç‰ˆæœ¬å· Windows Mac OSX Linux android 5.0 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android L ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.4W ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.4.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.3 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.2.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.1.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.0.3 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.0 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ GoogleMap APIs SDKè¿™æ˜¯GoogleMap APIs SDKï¼Œä¸‹è½½å¹¶è§£å‹åï¼Œå°†è§£å‹å‡ºçš„æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶æˆ–è€…ç§»åŠ¨åˆ°your sdk è·¯å¾„/add-onsæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åæ‰“å¼€SDK Managerï¼Œæ‰“å¼€Tools(å·¥å…·)èœå•é€‰æ‹©Options(é€‰é¡¹)èœå•é¡¹æ‰“å¼€Android SDK Manager Settingå¯¹è¯æ¡†ï¼Œç‚¹å‡»Clear Cache(æ¸…é™¤ç¼“å­˜)æŒ‰é’®ï¼Œç„¶åé‡å¯Eclipse(æˆ–Android Studio)å’ŒSDK Managerã€‚ ç³»ç»Ÿç‰ˆæœ¬å· Windows Mac OSX Linux android 4.4.2 ä¸‹è½½ARMç‰ˆ ä¸‹è½½x86ç‰ˆ ä¸‹è½½ARMç‰ˆ ä¸‹è½½x86ç‰ˆ ä¸‹è½½ARMç‰ˆ ä¸‹è½½x86ç‰ˆ android 4.3 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.2.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.1.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.0.3 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.0 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 3.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 3.1 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 3.0 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 2.3.3 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 2.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ Google Glass SDKè¿™æ˜¯GDKï¼Œä¸‹è½½å¹¶è§£å‹åï¼Œå°†è§£å‹å‡ºçš„æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶æˆ–è€…ç§»åŠ¨åˆ°your sdk è·¯å¾„/add-onsæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åæ‰“å¼€SDK Managerï¼Œæ‰“å¼€Tools(å·¥å…·)èœå•é€‰æ‹©Options(é€‰é¡¹)èœå•é¡¹æ‰“å¼€Android SDK Manager Settingå¯¹è¯æ¡†ï¼Œç‚¹å‡»Clear Cache(æ¸…é™¤ç¼“å­˜)æŒ‰é’®ï¼Œç„¶åé‡å¯Eclipse(æˆ–Android Studio)å’ŒSDK Managerã€‚ ç³»ç»Ÿç‰ˆæœ¬ Windows Mac OSX Linux android 4.4.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ android 4.0.3 ä¸‹è½½ Google TV Addonè¿™æ˜¯Google TV Addonï¼Œä¸‹è½½å¹¶è§£å‹åï¼Œå°†è§£å‹å‡ºçš„æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶æˆ–è€…ç§»åŠ¨åˆ°your sdk è·¯å¾„/add-onsæ–‡ä»¶å¤¹ï¼Œç„¶åæ‰“å¼€SDK Managerï¼Œæ‰“å¼€Tools(å·¥å…·)èœå•é€‰æ‹©Options(é€‰é¡¹)èœå•é¡¹æ‰“å¼€Android SDK Manager Settingå¯¹è¯æ¡†ï¼Œç‚¹å‡»Clear Cache(æ¸…é™¤ç¼“å­˜)æŒ‰é’®ï¼Œç„¶åé‡å¯Eclipse(æˆ–Android Studio)å’ŒSDK Managerã€‚ ç³»ç»Ÿç‰ˆæœ¬ Windows Mac OSX Linux android 3.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ ####Android Framework Source Codeè¿™æ˜¯Android Framework Source Codeï¼Œä¸‹è½½å¹¶è§£å‹åï¼Œå°†è§£å‹å‡ºçš„æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶æˆ–è€…ç§»åŠ¨åˆ°your sdk è·¯å¾„/sourcesæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åé‡å¯Eclipse(æˆ–Android Studio)ï¼Œè¿™æ ·å½“ä½ åœ¨Eclipseé‡Œé¢æŒ‰ä½Ctrlé”®ç‚¹å‡»æŸä¸ªç³»ç»Ÿç±»æ—¶å°±å¯ä»¥æ‰“å¼€è¯¥ç±»çš„æºç æ–‡ä»¶æŸ¥çœ‹æºç äº†ã€‚ ç³»ç»Ÿç‰ˆæœ¬ android 5.0 android 4.4W android 4.4.2 android 4.3 android 4.2.2 android 4.1.2 android 4.0.3 android 4.0 android 3.0 android 2.3.3 android 2.2 Android SDK ExtrasåŒ…å« Android Support Library ã€ Google Cloud Messaging for Android Library ã€Google Play services ã€ Google Play services for fit preview ã€Google Play services for Froyo ã€Google Play APK Expansion Libraryã€Google Play Billing Library ã€Google Play Licensing Library ç­‰ï¼Œä¸‹è½½è§£å‹åå°†è§£å‹å‡ºçš„æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶æˆ–è€…ç§»åŠ¨åˆ°your sdkæ ¹ç›®å½•ä¸‹ä¸‹ï¼Œå¦‚æœå·²ç»å­˜åœ¨extrasæ–‡ä»¶å¤¹å°±æ›¿æ¢æ‰ã€‚ ç‰ˆæœ¬å· 21.0.3 21.0.2 21 20 Support LibraryåŒ…å«support v4ã€v7ã€v13ã€v17ã€multidexå’Œm2repositoryï¼Œä¸‹è½½è§£å‹åå°†è§£å‹å‡ºçš„æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶æˆ–è€…ç§»åŠ¨åˆ°your sdk è·¯å¾„/extrasä¸‹ï¼Œç„¶åæ‰“å¼€SDK Managerï¼Œæ‰“å¼€Tools(å·¥å…·)èœå•é€‰æ‹©Options(é€‰é¡¹)èœå•é¡¹æ‰“å¼€Android SDK Manager Settingå¯¹è¯æ¡†ï¼Œç‚¹å‡»Clear Cache(æ¸…é™¤ç¼“å­˜)æŒ‰é’®ï¼Œç„¶åé‡å¯Eclipse(æˆ–Android Studio)å’ŒSDK Managerã€‚ ç‰ˆæœ¬å· 21.0.3 21.0.2 21 20 SDK Samplesè¿™æ˜¯Android SDKè‡ªå¸¦çš„ç¤ºä¾‹ä»£ç ï¼Œä¸‹è½½å¹¶è§£å‹åï¼Œå°†è§£å‹å‡ºçš„æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶æˆ–è€…ç§»åŠ¨åˆ°your sdk è·¯å¾„/samplesæ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åé‡å¯Eclipse(æˆ–Android Studio)ã€‚ã€‚ ç³»ç»Ÿç‰ˆæœ¬ android 21 android L android 4.4W android 4.4.2 android 4.3 android 4.2.2 android 4.1.2 android 4.0.3 android 4.0 android 3.2 android 3.1 android 3.0 android 2.3.3 android 2.2 NDKC/C++å¼€å‘Androidåº”ç”¨å·¥å…·åŒ…,Linux/Mac OS X ä¸‹NDK r10cçš„å®‰è£…æ–¹æ³•è¯·æˆ³ è¿™é‡Œ ç‰ˆæœ¬å· Windows Mac OSX Linux MD5/SHA-1æ ¡éªŒç  å®˜æ–¹SHA-1æ ¡éªŒç æˆªå›¾ ndk-r11b 32ä½ 64ä½ 64ä½ 64ä½ Win:b42da395440cc1c5dc4eeeb383679331addeb3ea 480eca1b29cfe73a5b35374730e6a82ca65c2aa6 Mac: c64fb355fec4da57d329ab45bf0aa29a1aec58dc Linux: cf0658956945c81d3d3fad5f9a24fa062d4c9d41 æŸ¥çœ‹ ndk-r10e 32ä½ 64ä½ 64ä½ 32ä½ 64ä½ Win: 1a82445baaf62aec3a46386ab1e5772c 8412bb4991a95e08fda50b5a44d95df7 Mac: 2cb8893a5701603519d38a7e04c50e81 Linux: c3edd3273029da1cbd2f62c48249e978 19af543b068bdb7f27787c2bc69aba7f æŸ¥çœ‹ Additional Download (32-, 64-bit) Package r10 STL debug info android-ndk-r10-cxx-stl-libs-with-debug-info.zip r9 STL debug info android-ndk-r9-cxx-stl-libs-with-debug-info.zip Android L Preview System Imageè¿™ä¸ªæ˜¯Android L Previewç³»ç»Ÿçš„åˆ·æœºé•œåƒã€‚ è®¾å¤‡ ä¸‹è½½ Nexus 5 (GSM/LTE) â€œhammerheadâ€ hammerhead-lpv79-preview-ac1d8a8e.tgz Nexus 7 (Wifi) â€œrazorâ€ razor-lpv79-preview-d0ddf8ce.tgz JDK ç‰ˆæœ¬å· Windows Mac OSX Linux 1.8 u77 32ä½ 64ä½ 64ä½ 32ä½ 64ä½ 1.8 u74 32ä½ 64ä½ 64ä½ 32ä½ 64ä½ 1.7 u80 32ä½ 64ä½ 64ä½ 32ä½ 64ä½ 1.6 u45 32ä½ 64ä½ 64ä½ 32ä½ 64ä½ ADT BundleADT BundleåŒ…å«äº†Eclipseã€ADTæ’ä»¶å’ŒSDK Toolsï¼Œæ˜¯å·²ç»é›†æˆå¥½çš„IDEï¼Œåªéœ€å®‰è£…å¥½Jdkå³å¯å¼€å§‹å¼€å‘ï¼Œæ¨èåˆå­¦è€…ä¸‹è½½ADT Bundleï¼Œä¸ç”¨å†æŠ˜è…¾å¼€å‘ç¯å¢ƒã€‚ ç‰ˆæœ¬å· Windows Mac OSX Linux 23.0.2 32ä½ 64ä½ 64ä½ 32ä½ 64ä½ 23.0.0 32ä½ 64ä½ 64ä½ 32ä½ 64ä½ ADT Pluginç¦»çº¿å®‰è£…ADTæ’ä»¶è¯·æˆ³é¡¹ç›®wiki ç‰ˆæœ¬å· ADT-23.0.7 ADT-23.0.6 ADT-23.0.4 ADT-23.0.3 ADT-23.0.2 ADT-23.0.0 ADT-22.6.3 AdT-22.6.1 Gradle ç‰ˆæœ¬å· gradle-2.12-all.zip gradle-2.11-all.zip gradle-2.10-all.zip gradle-2.9-all.zip gradle-2.8-all.zip gradle-2.7-all.zip gradle-2.6-all.zip gradle-2.5-all.zip gradle-2.4-all.zip gradle-2.3-all.zip gradle-2.2.1-all.zip gradle-2.2-all.zip gradle-2.1-all.zip gradle-2.0-all.zip gradle-1.12-all.zip gradle-1.11-all.zip gradle-1.10-all.zip gradle-1.9-all.zip gradle-1.8-all.zip gradle-1.7-all.zip Android Gradle Plugin DSL åœ¨çº¿æ–‡æ¡£http://google.github.io/android-gradle-dsl/ Gradle Dependencies Configuration Generatorï¼ˆéœ€è¦æ¢¯å­ï¼‰http://gradleplease.appspot.com ç‰ˆæœ¬æ§åˆ¶å·¥å…·Git ç‰ˆæœ¬å· Windows Mac OSX Linux Git-2.0.1 ä¸‹è½½ ä¸‹è½½ Git-1.9.4 ä¸‹è½½ ä¸‹è½½ Git-1.8.5.2 ä¸‹è½½ ä¸‹è½½ ä¸‹è½½ SVN Plugin For Eclipse ç‰ˆæœ¬å· 1.10.5 1.8.22 1.6.18 åç¼–è¯‘å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Enjarify Enjarify æ˜¯ä¸€ä¸ªç”¨ Python å†™çš„ï¼Œ Google å®˜æ–¹å¼€æºçš„å¯ä»¥å°† Dalvik å­—èŠ‚ç è½¬æ¢ä¸º Java å­—èŠ‚ç çš„å·¥å…·ã€‚ ä¸‹è½½ JEB Android Decompiler ä¸‹è½½ Virtuous Ten Studio ä¸‹è½½ Apkæ–‡ä»¶ä¿®æ”¹å·¥å…·Root Tools ä¸‹è½½ Dexæ–‡ä»¶åç¼–è¯‘å·¥å…·Dedexer ä¸‹è½½ APK+Dexæ–‡ä»¶åç¼–è¯‘åŠå›ç¼–è¯‘å·¥å…· ä¸‹è½½ android-apktool ä¸‹è½½ Onekey Decompile Apk] ä¸‹è½½ Baksmali ä¸‹è½½ Smali ä¸‹è½½ AXMLPrinter2 ä¸‹è½½ JAD Java Decompiler ä¸‹è½½ JD-GUI Decompiler ä¸‹è½½ XJad V2.2 ä¸‹è½½ Android APK Decompiler åœ¨çº¿åç¼–è¯‘å·¥å…· ä¸‹è½½ JADX - Dex to Java decompiler ä¸‹è½½ dex2jar ä¸‹è½½ SmaliViewer æ˜¯ä¸€æ¬¾å…è´¹çš„APKåˆ†æè½¯ä»¶ï¼Œæ— è®ºä»åˆ†æçš„æ·±åº¦è¿˜æ˜¯å¹¿åº¦æ¥çœ‹ï¼Œéƒ½æ˜¯ä¸€æ¬¾èƒ½å¤Ÿæ»¡è¶³ç”¨æˆ·éœ€æ±‚çš„äº§å“ï¼Œä½¿æ‚¨åœ¨APKåˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œæ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚ ä¸‹è½½ ä½¿ç”¨æŒ‡å— Androidé€†å‘åŠ©æ‰‹ Androidé€†å‘åŠ©æ‰‹æ˜¯ä¸€åŠŸèƒ½å¼ºå¤§çš„é€†å‘è¾…åŠ©è½¯ä»¶ã€‚è¯¥è½¯ä»¶å¯ä»¥å¸®åŠ©ç”¨æˆ·æ¥è¿›è¡Œapkåç¼–è¯‘æ‰“åŒ…ç­¾åï¼›dex/jaräº’è½¬æ›¿æ¢æå–ä¿®å¤ï¼›soåç¼–è¯‘ï¼›xmlã€txtåŠ å¯†ï¼›å­—ç¬¦ä¸²ç¼–ç ç­‰ç­‰ï¼Œæ“ä½œç®€å•ï¼Œåªéœ€è¦ç›´æ¥å°†æ–‡ä»¶æ‹–æ”¾åˆ°æºå’Œç›®æ ‡æ–‡ä»¶ã€‚ ä¸‹è½½ ä½¿ç”¨æŒ‡å— Android Killer Android Killer æ˜¯ä¸€æ¬¾å¯è§†åŒ–çš„å®‰å“åº”ç”¨é€†å‘å·¥å…·ï¼Œé›†Apkåç¼–è¯‘ã€Apkæ‰“åŒ…ã€Apkç­¾åï¼Œç¼–ç äº’è½¬ï¼ŒADBé€šä¿¡ï¼ˆåº”ç”¨å®‰è£…-å¸è½½-è¿è¡Œ-è®¾å¤‡æ–‡ä»¶ç®¡ç†ï¼‰ç­‰ç‰¹è‰²åŠŸèƒ½äºä¸€ èº«ï¼Œæ”¯æŒlogcatæ—¥å¿—è¾“å‡ºï¼Œè¯­æ³•é«˜äº®ï¼ŒåŸºäºå…³é”®å­—ï¼ˆæ”¯æŒå•è¡Œä»£ç æˆ–å¤šè¡Œä»£ç æ®µï¼‰é¡¹ç›®å†…æœç´¢ï¼Œå¯è‡ªå®šä¹‰å¤–éƒ¨å·¥å…·ï¼›å¸æ”¶èæ±‡å¤šç§å·¥å…·åŠŸèƒ½ä¸ç‰¹ç‚¹ï¼Œæ‰“é€ ä¸€ç«™ å¼é€†å‘å·¥å…·æ“ä½œä½“éªŒï¼Œå¤§å¤§ç®€åŒ–äº†ç”¨æˆ·åœ¨å®‰å“åº”ç”¨/æ¸¸æˆä¿®æ”¹è¿‡ç¨‹ä¸­çš„å„ç±»ç¹çå·¥ä½œã€‚ ä¸‹è½½1ä¸‹è½½2 ä½¿ç”¨æŒ‡å— DexExtractor android dex extractor ï¼Œanti-shellï¼Œandroid è„±å£³ã€‚ ä¸‹è½½ jadx Dex to Java decompiler ä¸‹è½½ android-classyshark a handy Android and Java executables viewer ä¸‹è½½ ShakaApktool ä¸‹è½½ å®‰å…¨å·¥å…· åç§° ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ APKfuscator ä¸‹è½½ ApkAnalyser ä¸‹è½½ AppXplore ä¸‹è½½ Android analysis framework ä¸‹è½½ Androguard ä¸‹è½½ Droidbox ä¸‹è½½ dsploit ä¸‹è½½ Androwarn ä¸‹è½½ Anubis ä¸‹è½½ Drozer ä¸‹è½½ VirusTotal ä¸‹è½½ GDB for Android ä¸‹è½½ VisualGDB ä¸‹è½½ é™æ€ä»£ç åˆ†æå·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ infer Facebook å¼€æºçš„é™æ€ä»£ç åˆ†æå·¥å…·ï¼Œç”¨äºåœ¨å‘å¸ƒç§»åŠ¨åº”ç”¨ä¹‹å‰å¯¹ä»£ç è¿›è¡Œåˆ†æï¼Œæ‰¾å‡ºæ½œåœ¨çš„é—®é¢˜ã€‚ ä¸‹è½½ æœç´¢å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Structural Java Exception Search Javaå¼‚å¸¸æœç´¢å·¥å…· ä¸‹è½½ Android Library Finder æœ€å¿«çš„æ–¹å¼è·å–ä¾èµ–åº“ ä¸‹è½½ Codota ç¤ºä¾‹ä»£ç æœç´¢ç½‘ç«™ ä¸‹è½½ Debugè°ƒè¯•å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Stetho Stetho æ˜¯Facebookæ¨å‡ºçš„Android è°ƒè¯•å¹³å°ï¼ŒåŸºäº Chrome Developer Tools ï¼Œè°ƒè¯•ç½‘ç»œè¯·æ±‚æ–¹é¢ç‰¹åˆ«æ–¹ä¾¿ã€‚ ä¸‹è½½ æ•™ç¨‹ Augmented Traffic Control Facebookå®£å¸ƒå¼€æºç§»åŠ¨ç½‘ç»œæµ‹è¯•å·¥å…·ATCï¼Œè¯¥å·¥å…·æ”¯æŒåˆ©ç”¨Wi-Fiç½‘ç»œæ¨¡æ‹Ÿ2Gã€2.5Gã€3Gä»¥åŠLTE 4Gç§»åŠ¨ç½‘ç»œç¯å¢ƒï¼Œè®©æµ‹è¯•å·¥ç¨‹å¸ˆä»¬èƒ½å¤Ÿå¿«é€Ÿå¯¹æ™ºèƒ½æ‰‹æœºå’ŒAppåœ¨ä¸åŒå›½å®¶åœ°åŒºå’Œåº”ç”¨ç¯å¢ƒä¸‹çš„æ€§èƒ½è¡¨ç°è¿›è¡Œæµ‹è¯•ã€‚ ä¸‹è½½ Apiæµ‹è¯•å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ bat ä¸€ä¸ªç”¨Goå†™çš„å‘½ä»¤è¡ŒAPIæµ‹è¯•åˆ©å™¨ï¼Œæ”¯æŒæ–‡ä»¶ä¸‹è½½ï¼Œæ–‡ä»¶ä¸Šä¼ ï¼Œæ”¯æŒLinuxçš„pipeæ–¹å¼ï¼Œæ€»ä¹‹å°±æ˜¯ç‚«é…·ã€‚ ä¸‹è½½ ä½¿ç”¨æŒ‡å— Eclipse/Android Studio/IDEAæ’ä»¶Eclipse åç§° ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ SVN ä¸‹è½½ Genymobileæ¨¡æ‹Ÿå™¨ ä¸‹è½½ Memory-Analyzer-Tools ä¸‹è½½ Droidinspector ä¸‹è½½ SQLiteManager ä¸‹è½½ Color Theme ä¸‹è½½ RoboVM ä¸‹è½½ Newrelic ä¸‹è½½ Android Studio/IDEA åç§° ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android Resource Resizer Plugin ä¸‹è½½ Gradle Dependencies Helper Plugin ä¸‹è½½ Android Parcelable code generation Plugin ä¸‹è½½ Android Holo Colors IDEA Plugin ä¸‹è½½ Android Toolbox Plugin ä¸‹è½½ Android Gradle Sign Plugin ä¸‹è½½ Android Permissions Usage Plugin ä¸‹è½½ Android Helper Plugin ä¸‹è½½ Android Studio Prettify Plugin ä¸‹è½½ IDEA ADB Plugin ä¸‹è½½ Otto Intellij Plugin ä¸‹è½½ Dagger intellij Plugin ä¸‹è½½ Gradle Gui Plugin ä¸‹è½½ Android Studio Unit Test Plugin ä¸‹è½½ Android Layout ID Converter Plugin ä¸‹è½½ IDEA protobuf Plugin ä¸‹è½½ Simple Team Code Reviewer Plugin ä¸‹è½½ Android XML Plugin ä¸‹è½½ ADF Plugin ä¸‹è½½ Java2smali Plugin ä¸‹è½½ IDEA gitignore Plugin ä¸‹è½½ IDEA Background Image Plugin ä¸‹è½½ IDEA Maven Plugin ä¸‹è½½ Gradle GooglePlay Publisher Plugin ä¸‹è½½ Drawable Selectors Generates Plugin ä¸‹è½½ Android Drawable Importer ä¸‹è½½ Color themes for IntelliJ IDEA ä¸‹è½½ GsonFormat ä¸‹è½½ ormlite-android-gradle-plugin ä¸‹è½½ Androidèµ„æº/Themes/Styleç”Ÿæˆå·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android Asset Studio ä¸‹è½½ Android Drawable Factory ä¸‹è½½ Android Action Bar Style Generator ä¸‹è½½ Android Holo Colors Generator ä¸‹è½½ Android Simple Nine-patch Generator ä¸‹è½½ Android Device Frame Generator ä¸‹è½½ Android 9-patch shadow generator ä¸‹è½½ Androidèµ„æºåˆ†æå·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android Assets Viewer ä¸‹è½½ Android Layout Parserå·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android Layout Binder ä¸‹è½½ Android Content Providerä»£ç ç”Ÿæˆå·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Content Provider Code Generator ä¸‹è½½ Android Fragment Code Generatorä»£ç ç”Ÿæˆå·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android Fragment Code Generator ä¸‹è½½ ä»£ç ç”Ÿæˆå·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android KickstartR AndroidKickstartRå¸®åŠ©æ‚¨å¿«é€Ÿåˆ›å»ºAndroidåº”ç”¨ç¨‹åºå¹¶ä½¿ç”¨æœ€æµè¡Œçš„åº“è¿›è¡Œé…ç½®ã€‚å®ƒåˆ›å»ºå’Œé…ç½®ä½ çš„é¡¹ç›®ç»™ä½ ã€‚åªä¸“æ³¨äºä»£ç ! ä¸‹è½½ Android Button Maker Android Button Makeræ˜¯ä¸€ä¸ªåœ¨çº¿ç”ŸæˆAndroidåº”ç”¨æŒ‰é’®ä»£ç çš„å·¥å…·ã€‚Androidçš„APIæä¾›å¯ç»˜åˆ¶èµ„æºï¼Œå…¶ä¸­çš„XMLæ–‡ä»¶å®šä¹‰çš„å‡ ä½•å½¢çŠ¶ï¼ŒåŒ…æ‹¬é¢œè‰²ï¼Œè¾¹æ¡†å’Œæ¢¯åº¦ã€‚è¿™äº›æŒ‰é’®æ˜¯åœ¨shape drawable XMLä»£ç åŸºç¡€ä¸Šäº§ç”Ÿçš„ç›¸æ¯”é€šå¸¸çš„PNGæŒ‰é’®åŠ è½½é€Ÿåº¦æ›´å¿«ã€‚æ‚¨å¯ä»¥åœ¨è®¾ç½®é¢æ¿ä¸­è‡ªå®šä¹‰æŒ‰é’®çš„å±æ€§å’Œè·å¾—æºä»£ç ã€‚ ä¸‹è½½ DroidDraw ä¸‹è½½ Android SVG to VectorDrawable ä¸€ä¸ªå¯ä»¥å°†SVGå›¾ç‰‡è½¬æ¢ä¸ºVector Drawable xmlæ–‡ä»¶çš„åœ¨çº¿å·¥å…·ã€‚ ä¸‹è½½ Android Nativeå¼€å‘å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android++ ä¸‹è½½ Androidæµ‹è¯•å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Appurify ä¸‹è½½ Monkey ä¸‹è½½ Testin ä¸‹è½½ Spoon ä¸‹è½½ Little Eye ä¸‹è½½ æ˜“æµ‹äº‘ ä¸‹è½½ Emmagee ä¸‹è½½ Apk View Tracer ä¸‹è½½ APT APTæ˜¯ä¸€ä¸ªAndroidå¹³å°é«˜æ•ˆæ€§èƒ½æµ‹è¯•ç»„ä»¶ï¼Œæä¾›ä¸°å¯Œå®ç”¨çš„åŠŸèƒ½ï¼Œé€‚ç”¨äºå¼€å‘è‡ªæµ‹ã€å®šä½æ€§èƒ½ç“¶é¢ˆï¼›æµ‹è¯•äººå‘˜å®Œæˆæ€§èƒ½åŸºå‡†æµ‹è¯•ã€ç«å“å¯¹æ¯”æµ‹è¯•ã€‚ ä¸‹è½½ æ•™ç¨‹ GT GTï¼ˆéšèº«è°ƒï¼‰æ˜¯APPçš„éšèº«è°ƒæµ‹å¹³å°ï¼Œå®ƒæ˜¯ç›´æ¥è¿è¡Œåœ¨æ‰‹æœºä¸Šçš„â€œé›†æˆè°ƒæµ‹ç¯å¢ƒâ€(IDTE, Integrated Debug&amp;Test Environment)ã€‚ ä¸‹è½½ æ•™ç¨‹ Mobile-Checker ç§»åŠ¨ç«¯é¡µé¢æ£€æŸ¥å·¥å…·,å¯ä»¥é€‰æ‹©ä¸‰ç§å±å¹•è§„æ ¼ï¼Œé€šè¿‡å·¥å…·å‘ç°ç½‘ç«™åœ¨ç§»åŠ¨ç«¯å­˜åœ¨çš„é—®é¢˜ã€‚ ä¸‹è½½ Androidå¤šæ¸ é“æ‰“åŒ…å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Umengå¤šæ¸ é“æ‰“åŒ…å·¥å…· ä¸‹è½½ AppToolså…· ä¸‹è½½ package_tool ä¸‹è½½ RyApkTool ä¸‹è½½ å…°è´å£³å„¿ ä¸‹è½½ æ•™ç¨‹ Android Bugæ—¥å¿—æ”¶é›†å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Crashlytics ä¸‹è½½ ACRA ä¸‹è½½ ChkBugReport ä¸‹è½½ Log Collector ä¸‹è½½ Android Crash Catcher ä¸‹è½½ å…¶ä»–è¯­è¨€å¼€å‘Androidåº”ç”¨å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Xamarin ä¸‹è½½ Basic4android ä¸‹è½½ Scripting Layer ä¸‹è½½ Ruby Rhodes ç§»åŠ¨è®¾å¤‡ä¸Šçš„Ruby ä¸‹è½½ PHP for Android ä¸‹è½½ Codename One ä¸‹è½½ Touchqode ä¸‹è½½ App Inventor ä¸‹è½½ ä¼ æ„Ÿå™¨æ¨¡æ‹Ÿå·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Sensor Simulator ç‹¬ç«‹çš„Javaåº”ç”¨ç¨‹åºï¼Œå®ƒæ¨¡æ‹Ÿä¼ æ„Ÿå™¨çš„æ•°æ®å¹¶å°†å®ƒä»¬ä¼ é€åˆ°Androidæ¨¡æ‹Ÿå™¨ã€‚ ä¸‹è½½ Androidä¸²å£å¼€å‘å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android Serialport Api ä¸‹è½½ å›¾ç‰‡å°ºå¯¸å¤„ç†å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ 9-Patch Resizer ä¸‹è½½ å›¾ç‰‡å‹ç¼©å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ OptiPNG ä¸‹è½½ Pngcrush ä¸‹è½½ ImageOptim ä¸‹è½½ Tinypng ä¸‹è½½ èµ„æºæ¸…ç†å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android Lint ä¸‹è½½ Android Resource Cleaner ä¸‹è½½ Android Unused Resources ä¸‹è½½ Android Resource Remover ä¸‹è½½ pxå’Œdpè½¬æ¢/è®¡ç®—å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android dp px Calculator ä¸‹è½½ dp px converter ä¸‹è½½ pixelcalc ä¸‹è½½ androidpixels ä¸‹è½½ android dpi calculator ä¸‹è½½ DPI Calculator ä¸‹è½½ Android DPI Calculatoræ’ä»¶ ä¸‹è½½ Java To iOS åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ j2Objc ä¸‹è½½ RoboVM ä¸‹è½½ JSON/XMLè½¬æ¢ä¸ºPOJO Classå·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ jsonschema2pojo ä¸‹è½½ Convert XML or JSON to Java Pojo ä¸‹è½½ Java DAO Generateå·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Generate Java DAO for relational data table ä¸‹è½½ Chromeæ’ä»¶Androidæ’ä»¶ åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android SDK Search ä¸‹è½½ Android Resource Navigator ä¸‹è½½ ADB Plugin for remote debugging Chrome on Android ä¸‹è½½ Mobile/RWD Tester ä¸‹è½½ ExtensionAndroid SDK Samples Search ä¸‹è½½ Android Developer Improvements ä¸‹è½½ Android downloader ä¸‹è½½ JSON/XMLæ ¼å¼åŒ–æ’ä»¶ åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ JSONView ä¸‹è½½ JSON Formatter ä¸‹è½½ JSON Viewer ä¸‹è½½ JSON Finder ä¸‹è½½ Encode/Decodeæ’ä»¶ åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Base64 Encode and Decode ä¸‹è½½ Git åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Git Cheat Sheet ä¸‹è½½ GuidesGoogle Javaç¼–ç¨‹é£æ ¼æŒ‡å—ä¸­æ–‡ç‰ˆè‹±æ–‡åœ°å€ï¼šhttp://google-styleguide.googlecode.com/svn/trunk/javaguide.html åœ°å€0ï¼šhttp://hawstein.com/posts/google-java-style.html åœ°å€1ï¼šhttps://github.com/codeset/google-java-styleguide Android Developers å›½å†…é•œåƒç«™åœ°å€: Android Developers å›½å†…é•œåƒç«™ Android Apiä¸­æ–‡ç‰ˆåœ°å€ï¼šhttp://www.embeddedlinux.org.cn/androidapi/ ####Android APIæŒ‡å—ä¸­æ–‡ç‰ˆ åœ°å€ï¼šhttp://api.apkbus.com/guide Android Proguardæ··æ·†é…ç½®æŒ‡å—åœ°å€ï¼šhttps://github.com/inferjay/AndroidProguardGuide/ Gradleæ’ä»¶ä½¿ç”¨æŒ‡å—ä¸­æ–‡ç‰ˆåœ°å€ï¼šhttp://avatarqing.github.io/Gradle-Plugin-User-Guide-Chinese-Verision Gradle User GuideGradle 1.12ç”¨æˆ·æŒ‡å—ï¼šhttp://pan.baidu.com/s/1dD7sC2d TutorialsAndroidå­¦ä¹ ä¹‹è·¯åœ°å€ï¼šhttp://stormzhang.github.io/android/2014/07/07/learn-android-from-rookie/ Google Androidå®˜æ–¹åŸ¹è®­è¯¾ç¨‹ä¸­æ–‡ç‰ˆåœ°å€ï¼šhttp://hukai.me/android-training-course-in-chinese/index.html Developing Android Appsåœ°å€ï¼šhttps://www.udacity.com/course/ud853 Java Design Patterns Samples in Java.Java Design Patterns Design Design ToolsPhotoshopæ’ä»¶ åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Cut&amp;Slice åˆ‡å›¾ç¥å™¨ ä¸‹è½½ DevRocket åˆ‡å›¾ç¥å™¨ ä¸‹è½½ Cutterman æœ€å¥½ç”¨çš„åˆ‡å›¾å·¥å…· ä¸‹è½½ Ink ä¸‹è½½ Corner Editor è·¯å¾„åœ†è§’ç¼–è¾‘å·¥å…· ä¸‹è½½1 ä¸‹è½½1 GuideGuide è¾…åŠ©çº¿å·¥å…· ä¸‹è½½ Assistor PS ä¸‹è½½ Skeuomorphism.it ä¸‹è½½ QuickGuide ä¸‹è½½ Long Shadow Generator é•¿æŠ•å½±æ•ˆæœç”Ÿæˆæ’ä»¶ ä¸‹è½½ android_resizer_toolkit ä¸‹è½½ android-ps-tools ä¸€äº›æ–¹ä¾¿Android UIè®¾è®¡çš„PhototShopæ’ä»¶ã€‚ ä¸‹è½½ LayerCraft A Photoshop plugin to export UI assets from layers ä¸‹è½½ çŸ¢é‡å›¾è®¾è®¡å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Sketch 3 ä¸‹è½½ Affinity Designer ä¸‹è½½ Gravit ä¸‹è½½ Adobe Illustrator ä¸‹è½½ åˆ‡å›¾å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Slicy ä¸‹è½½ è®¾è®¡ç¨¿å°ºå¯¸æ ‡æ³¨å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ é©¬å…‹é³— ä¸‹è½½ PxCookåƒç´ å¤§å¨ UIè®¾è®¡å¸ˆæ•ˆç‡æå‡åˆ©å™¨ï¼Œè®©ä½ ä¸“æ³¨äºè®¾è®¡æœ¬è´¨ï¼Œä¸å†ä¸ºæ ‡æ³¨åˆ‡å›¾è€Œçƒ¦æ¼ï¼Œä»è®¾è®¡åˆ°å®ç°ä¸€æ°”å‘µæˆ ä¸‹è½½ ä½¿ç”¨æ•™ç¨‹ åŸå‹è®¾è®¡å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Axure ä¸‹è½½ Fluid UI ä¸‹è½½ Briefs ä¸‹è½½ Flinto ä¸‹è½½ Balsamiq Mockups ä¸‹è½½ AppCooker ä¸‹è½½ Proto.io ä¸‹è½½ UXPin ä¸‹è½½ InVision ä¸‹è½½ POP ä¸‹è½½ å¿«ç° ä¸‹è½½ Composite ä¸‹è½½ OmniGraffle ä¸‹è½½ Marvelapp ä¸‹è½½ Justinmind ä¸‹è½½ Form ä¸‹è½½ Prott ä¸‹è½½ Composite ä¸‹è½½ Avocado ä¸‹è½½ Pixate ä¸‹è½½ äº¤äº’è®¾è®¡å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Framer Studio ä¸‹è½½ Quartz Composer ä¸‹è½½ Origami ä¸‹è½½ jQC ä¸‹è½½ UIæ•ˆæœé¢„è§ˆå·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android Design Preview ä¸‹è½½ PS Play ä¸‹è½½ Pixl Preview ä¸‹è½½ Skala Preview ä¸‹è½½ LiveView ä¸‹è½½ é…è‰²å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Android Material Designå¯è§†åŒ–è°ƒè‰²æ¿ ä¸‹è½½ Android Material Design Colours.xml ä¸‹è½½ Colorubeé…è‰²ç¥å™¨ ä¸‹è½½ Adobe Kuler ä¸‹è½½ ColorSchemer Studio ä¸‹è½½ Piknik ä¸‹è½½ è®¾è®¡ç¨¿ç‰ˆæœ¬æ§åˆ¶å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ LayerVault ä¸‹è½½ å›¾æ ‡å¤„ç†å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Icon Slate ä¸‹è½½ åœ¨çº¿Iconåº“ åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ IconFont ä¸‹è½½ NounProject ä¸‹è½½ å–è‰²å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ ColorSnapper ä¸‹è½½ ä¸é€æ˜åº¦16è¿›åˆ¶å€¼ ä¸é€æ˜åº¦ 16è¿›åˆ¶å€¼ 100% FF 95% F2 90% E6 85% D9 80% CC 75% BF 70% B3 65% A6 60% 99 55% 8C 50% 80 45% 73 40% 66 35% 59 30% 4D 25% 40 20% 33 15% 26 10% 1A 5% 0D 0% 00 å‡ºè‡ªï¼šhttp://stackoverflow.com/questions/5445085/understanding-colors-in-android-6-chars æ‰‹æœºToç”µè„‘åŒæ­¥é¢„è§ˆå·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ Reflector ä¸‹è½½ x-Mirage ä¸‹è½½ AirServer ä¸‹è½½ BBQScreen ä¸‹è½½ Gifå›¾ç‰‡å½•åˆ¶å·¥å…· åç§° ç®€ä»‹ ä¸‹è½½åœ°å€ ä½¿ç”¨æ•™ç¨‹ LICEcap ä¸‹è½½ GifCam ä¸‹è½½ Android Tool ä¸‹è½½ UI Programming LanguageUILang TutorialsHackDesign GamesThe Bezier Game ä¸€ä¸ªå¸®åŠ©ä½ ç»ƒä¹ PSé‡Œé’¢ç¬”å·¥å…·çš„å°æ¸¸æˆã€‚ GuidesAndroidè®¾è®¡æŒ‡å—éå®˜æ–¹ç®€ä½“ä¸­æ–‡ç‰ˆTopfuné•œåƒåœ°å€ï¼šhttp://www.topfun.us/adchs/index.html Githubé•œåƒåœ°å€ï¼šhttp://adchs.github.io ApkBusé•œåƒåœ°å€ï¼šhttp://www.apkbus.com/design/ Segmentfaulté•œåƒåœ°å€ï¼šhttp://mirrors.segmentfault.com/adchs/ å¤šçœ‹é˜…è¯»é•œåƒåœ°å€ï¼šhttp://www.duokan.com/book/47790 Android Cheatsheet for Graphic Designersåœ°å€:http://petrnohejl.github.io/Android-Cheatsheet-For-Graphic-Designers/ Google Material Design ä¸­æ–‡ç‰ˆåœ°å€ï¼šhttp://design.1sters.com åœ°å€ï¼š http://www.ui.cn/Material/ Designerâ€™s Guide To dpiåœ°å€ï¼šhttp://sebastien-gabriel.com/designers-guide-to-dpi/home Email Design Guideåœ°å€ï¼šhttp://mailchimp.com/resources/email-design-guide/ Free Design ResourcesGoogle Material Design ç´ æ(æ„Ÿè°¢ @SanityD) Material Design Icon Templates Material Designçš„å›¾æ ‡é›† Material Design UI Kit for Sketch Nexus 5 template for Sketch Free Design Resources 434 SVG icons UI Cloun 161ä¸ªå›½å†…å¤–ç¤¾äº¤ç½‘ç«™çŸ¢é‡å›¾æ ‡ 250 free icons in 5 sizes and 14 colors MINIMALISTIC EVERYDAY ICONS Icons4Android Books Free Programming Books ä¸€å †å…è´¹çš„Androidå¼€å‘ç›¸å…³çš„ç”µå­ä¹¦ã€‚ 50 Android Hacks 50 Android Hacksè¿™æœ¬ä¹¦åˆ†12ä¸ªéƒ¨åˆ†ä»‹ç»äº†50ä¸ªAndroidå¼€å‘çš„å°æŠ€å·§ã€‚ å…è´¹çš„ç¼–ç¨‹ä¸­æ–‡ä¹¦ç±ç´¢å¼• Disclaimer ç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ï¼Œè¿™é‡Œä»…åšæ”¶é›†æ•´ç†ï¼Œæ¬¢è¿è‡ªç”±è½¬è½½-éå•†ç”¨-éè¡ç”Ÿ-ä¿æŒç½²åå’Œé“¾æ¥ã€‚ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"ä½ çœŸçš„äº†è§£AsyncTaskå—","date":"2017-07-26T12:09:45.000Z","path":"2017/07/26/ä½ çœŸçš„äº†è§£AsyncTaskå—.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ ä½ çœŸçš„äº†è§£AsyncTask?è™½è¯´ç°åœ¨åšç½‘ç»œè¯·æ±‚æœ‰äº†Volleyå…¨å®¶æ¡¶å’ŒOkHttpè¿™æ ·å¥½ç”¨çš„åº“ï¼Œä½†æ˜¯åœ¨å¤„ç†å…¶ä»–åå°ä»»åŠ¡ä»¥åŠä¸UIäº¤äº’ä¸Šï¼Œè¿˜æ˜¯éœ€è¦ç”¨åˆ°AsyncTaskã€‚ä½†æ˜¯ä½ çœŸçš„äº†è§£AsyncTaskå—ï¼Ÿ AsyncTaskçš„å®ç°å‡ ç»ä¿®æ”¹ï¼Œå› æ­¤åœ¨ä¸åŒç‰ˆæœ¬çš„Androidç³»ç»Ÿä¸Šè¡¨ç°å„å¼‚ï¼›æˆ‘ç›¸ä¿¡ï¼Œä»»ä½•ä¸€ä¸ªç”¨æˆ·é‡ä¸Šåƒä¸‡çš„äº§å“ç»å¯¹ä¸ä¼šåœ¨ä»£ç é‡Œé¢ä½¿ç”¨ç³»ç»ŸåŸç”Ÿçš„AsynTaskï¼Œå› ä¸ºå®ƒè›‹ç–¼çš„å…¼å®¹æ€§ä»¥åŠæé«˜çš„å´©æºƒç‡å®åœ¨è®©äººä¸æ•¢æ­ç»´ã€‚æœ¬æ–‡å°†å¸¦ä½ äº†è§£AsyncTaskèƒŒåçš„åŸç†ï¼Œå¹¶ç»™å‡ºä¸€ä¸ªä¹…ç»è€ƒéªŒçš„AsyncTaskä¿®æ”¹ç‰ˆã€‚ AsyncTaskæ˜¯ä»€ä¹ˆï¼ŸAsyncTaskåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå®ƒä¸è¿‡æ˜¯å¯¹çº¿ç¨‹æ± å’ŒHandlerçš„å°è£…ï¼›ç”¨çº¿ç¨‹æ± æ¥å¤„ç†åå°ä»»åŠ¡ï¼Œç”¨Handleræ¥å¤„ç†ä¸UIçš„äº¤äº’ã€‚çº¿ç¨‹æ± ä½¿ç”¨çš„æ˜¯Executoræ¥å£ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹çº¿ç¨‹æ± çš„ç‰¹æ€§ã€‚ çº¿ç¨‹æ± ThreadPoolExecutorJDK5å¸¦æ¥çš„ä¸€å¤§æ”¹è¿›å°±æ˜¯Javaçš„å¹¶å‘èƒ½åŠ›ï¼Œå®ƒæä¾›äº†ä¸‰ç§å¹¶å‘æ­¦å™¨ï¼šå¹¶å‘æ¡†æ¶Executorï¼Œå¹¶å‘é›†åˆç±»å‹å¦‚ConcurrentHashMapï¼Œå¹¶å‘æ§åˆ¶ç±»å¦‚CountDownLatchç­‰ï¼›åœ£ç»ã€ŠEffective Javaã€‹ä¹Ÿè¯´ï¼Œå°½é‡ä½¿ç”¨Exectorè€Œä¸æ˜¯ç›´æ¥ç”¨Threadç±»è¿›è¡Œå¹¶å‘ç¼–ç¨‹ã€‚ AsyncTaskå†…éƒ¨ä¹Ÿä½¿ç”¨äº†çº¿ç¨‹æ± å¤„ç†å¹¶å‘ï¼›çº¿ç¨‹æ± é€šè¿‡ThreadPoolExectorç±»æ„é€ ï¼Œè¿™ä¸ªæ„é€ å‡½æ•°å‚æ•°æ¯”è¾ƒå¤šï¼Œå®ƒå…è®¸å¼€å‘è€…å¯¹çº¿ç¨‹æ± è¿›è¡Œå®šåˆ¶ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹è¿™æ¯ä¸ªå‚æ•°æ˜¯ä»€ä¹ˆæ„æ€ï¼Œç„¶åçœ‹çœ‹Androidæ˜¯ä»¥ä½•ç§æ–¹å¼å®šåˆ¶çš„ã€‚ ThreadPoolExecutorçš„å…¶ä»–æ„é€ å‡½æ•°æœ€ç»ˆéƒ½ä¼šè°ƒç”¨å¦‚ä¸‹çš„æ„é€ å‡½æ•°å®Œæˆå¯¹è±¡åˆ›å»ºå·¥ä½œï¼š 1234567public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) corePoolSize: æ ¸å¿ƒçº¿ç¨‹æ•°ç›®ï¼Œå³ä½¿çº¿ç¨‹æ± æ²¡æœ‰ä»»åŠ¡ï¼Œæ ¸å¿ƒçº¿ç¨‹ä¹Ÿä¸ä¼šç»ˆæ­¢ï¼ˆé™¤éè®¾ç½®äº†allowCoreThreadTimeOutå‚æ•°ï¼‰å¯ä»¥ç†è§£ä¸ºâ€œå¸¸é©»çº¿ç¨‹â€ maximumPoolSize: çº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ç›®ï¼›ä¸€èˆ¬æ¥è¯´ï¼Œçº¿ç¨‹è¶Šå¤šï¼Œçº¿ç¨‹è°ƒåº¦å¼€é”€è¶Šå¤§ï¼›å› æ­¤ä¸€èˆ¬éƒ½æœ‰è¿™ä¸ªé™åˆ¶ã€‚ keepAliveTime: å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®æ¯”æ ¸å¿ƒçº¿ç¨‹å¤šçš„æ—¶å€™ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªkeepAliveTimeçš„æ—¶é—´ï¼Œå¤šä½™çš„çº¿ç¨‹ä¼šè¢«å›æ”¶ï¼›è¿™äº›ä¸æ ¸å¿ƒçº¿ç¨‹ç›¸å¯¹çš„çº¿ç¨‹é€šå¸¸è¢«ç§°ä¸ºç¼“å­˜çº¿ç¨‹ unit: keepAliveTimeçš„æ—¶é—´å•ä½ workQueue: ä»»åŠ¡æ‰§è¡Œå‰ä¿å­˜ä»»åŠ¡çš„é˜Ÿåˆ—ï¼›è¿™ä¸ªé˜Ÿåˆ—ä»…ä¿å­˜ç”±executeæäº¤çš„Runnableä»»åŠ¡ threadFactory: ç”¨æ¥æ„é€ çº¿ç¨‹æ± çš„å·¥å‚ï¼›ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨é»˜è®¤çš„ï¼› handler: å½“çº¿ç¨‹æ± ç”±äºçº¿ç¨‹æ•°ç›®å’Œé˜Ÿåˆ—é™åˆ¶è€Œå¯¼è‡´åç»­ä»»åŠ¡é˜»å¡çš„æ—¶å€™ï¼Œçº¿ç¨‹æ± çš„å¤„ç†æ–¹å¼ã€‚ é‚£ä¹ˆï¼Œå½“ä¸€ä¸ªæ–°çš„ä»»åŠ¡åˆ°è¾¾çš„æ—¶å€™ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ˜¯å¦‚ä½•è°ƒåº¦çš„å‘¢ï¼Ÿï¼ˆåˆ«æ…Œï¼Œè®²è¿™ä¹ˆä¸€å¤§æ®µçº¿ç¨‹æ± çš„çŸ¥è¯†ï¼Œæ˜¯ä¸ºäº†ç†è§£AsyncTaskï¼›Be Patientï¼‰ å¦‚æœçº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°ç›®å°‘äºcorePoolSizeï¼Œå°±ç®—çº¿ç¨‹æ± ä¸­æœ‰å…¶ä»–çš„æ²¡äº‹åšçš„æ ¸å¿ƒçº¿ç¨‹ï¼Œçº¿ç¨‹æ± è¿˜æ˜¯ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼›ç›´åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ç›®åˆ°è¾¾corePoolSizeï¼ˆå¸¸é©»çº¿ç¨‹å°±ä½ï¼‰ å¦‚æœçº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°ç›®å¤§äºæˆ–è€…ç­‰äºcorePoolSizeï¼Œä½†æ˜¯å·¥ä½œé˜Ÿåˆ—workQueueæ²¡æœ‰æ»¡ï¼Œé‚£ä¹ˆæ–°çš„ä»»åŠ¡ä¼šæ”¾åœ¨é˜Ÿåˆ—workQueueä¸­ï¼ŒæŒ‰ç…§FIFOçš„åŸåˆ™ä¾æ¬¡ç­‰å¾…æ‰§è¡Œï¼›ï¼ˆå½“æœ‰æ ¸å¿ƒçº¿ç¨‹å¤„ç†å®Œä»»åŠ¡ç©ºé—²å‡ºæ¥åï¼Œä¼šæ£€æŸ¥è¿™ä¸ªå·¥ä½œé˜Ÿåˆ—ç„¶åå–å‡ºä»»åŠ¡é»˜é»˜æ‰§è¡Œå»ï¼‰ å¦‚æœçº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°ç›®å¤§äºç­‰äºcorePoolSizeï¼Œå¹¶ä¸”å·¥ä½œé˜Ÿåˆ—workQueueæ»¡äº†ï¼Œä½†æ˜¯æ€»çº¿ç¨‹æ•°ç›®å°äºmaximumPoolSizeï¼Œé‚£ä¹ˆç›´æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¤„ç†è¢«æ·»åŠ çš„ä»»åŠ¡ã€‚ å¦‚æœå·¥ä½œé˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°ç›®åˆ°è¾¾äº†æœ€å¤§æ•°ç›®maximumPoolSizeï¼Œé‚£ä¹ˆå°±ä¼šç”¨æœ€åä¸€ä¸ªæ„é€ å‚æ•°handlerå¤„ç†ï¼›é»˜è®¤çš„å¤„ç†æ–¹å¼æ˜¯ç›´æ¥ä¸¢æ‰ä»»åŠ¡ï¼Œç„¶åæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ æ€»ç»“èµ·æ¥ï¼Œä¹Ÿå³æ˜¯è¯´ï¼Œå½“æœ‰æ–°çš„ä»»åŠ¡è¦å¤„ç†æ—¶ï¼Œå…ˆçœ‹çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡æ˜¯å¦å¤§äº corePoolSizeï¼Œå†çœ‹ç¼“å†²é˜Ÿåˆ— workQueue æ˜¯å¦æ»¡ï¼Œæœ€åçœ‹çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡æ˜¯å¦å¤§äº maximumPoolSizeã€‚å¦å¤–ï¼Œå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº corePoolSize æ—¶ï¼Œå¦‚æœé‡Œé¢æœ‰çº¿ç¨‹çš„ç©ºé—²æ—¶é—´è¶…è¿‡äº† keepAliveTimeï¼Œå°±å°†å…¶ç§»é™¤çº¿ç¨‹æ± ï¼Œè¿™æ ·ï¼Œå¯ä»¥åŠ¨æ€åœ°è°ƒæ•´çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°é‡ã€‚ æˆ‘ä»¬ä»¥API 22ä¸ºä¾‹ï¼Œçœ‹ä¸€çœ‹AsyncTaské‡Œé¢çš„çº¿ç¨‹æ± æ˜¯ä»¥ä»€ä¹ˆå‚æ•°æ„é€ çš„ï¼›AsyncTaské‡Œé¢æœ‰â€œä¸¤ä¸ªâ€çº¿ç¨‹æ± ï¼›ä¸€ä¸ªTHREAD_POOL_EXECUTORä¸€ä¸ªSERIAL_EXECUTORï¼›ä¹‹æ‰€ä»¥æ‰“å¼•å·ï¼Œæ˜¯å› ä¸ºå…¶å®SERIAL_EXECUTORä¹Ÿä½¿ç”¨THREAD_POOL_EXECUTORå®ç°çš„ï¼Œåªä¸è¿‡åŠ äº†ä¸€ä¸ªé˜Ÿåˆ—å¼„æˆäº†ä¸²è¡Œè€Œå·²ï¼Œé‚£ä¹ˆè¿™ä¸ªTHREAD_POOL_EXECUTORæ˜¯å¦‚ä½•æ„é€ çš„å‘¢ï¼Ÿ 123456789private static final int CORE_POOL_SIZE = CPU_COUNT + 1;private static final int MAXIMUM_POOL_SIZE = CPU_COUNT * 2 + 1;private static final int KEEP_ALIVE = 1;private static final BlockingQueue&lt;Runnable&gt; sPoolWorkQueue = new LinkedBlockingQueue&lt;Runnable&gt;(128);public static final Executor THREAD_POOL_EXECUTOR = new ThreadPoolExecutor(CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE, TimeUnit.SECONDS, sPoolWorkQueue, sThreadFactory); å¯ä»¥çœ‹åˆ°ï¼ŒAsyncTaské‡Œé¢çº¿ç¨‹æ± æ˜¯ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ•°ä¸ºCPU + 1ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸ºCPU * 2 + 1ï¼Œå·¥ä½œé˜Ÿåˆ—é•¿åº¦ä¸º128çš„çº¿ç¨‹æ± ï¼›å¹¶ä¸”æ²¡æœ‰ä¼ é€’handlerå‚æ•°ï¼Œé‚£ä¹ˆä½¿ç”¨çš„å°±æ˜¯é»˜è®¤çš„Handlerï¼ˆæ‹’ç»æ‰§è¡Œ). é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š å¦‚æœä»»åŠ¡è¿‡å¤šï¼Œé‚£ä¹ˆè¶…è¿‡äº†å·¥ä½œé˜Ÿåˆ—ä»¥åŠçº¿ç¨‹æ•°ç›®çš„é™åˆ¶å¯¼è‡´è¿™ä¸ªçº¿ç¨‹æ± å‘ç”Ÿé˜»å¡ï¼Œé‚£ä¹ˆæ‚²å‰§å‘ç”Ÿï¼Œé»˜è®¤çš„å¤„ç†æ–¹å¼ä¼šç›´æ¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å¯¼è‡´è¿›ç¨‹æŒ‚æ‰ã€‚å‡è®¾ä½ è‡ªå·±å†™ä¸€ä¸ªå¼‚æ­¥å›¾ç‰‡åŠ è½½çš„æ¡†æ¶ï¼Œç„¶åç”¨AsyncTaskå®ç°çš„è¯ï¼Œå½“ä½ å¿«é€Ÿæ»‘åŠ¨ListViewçš„æ—¶å€™å¾ˆå®¹æ˜“å‘ç”Ÿè¿™ç§å¼‚å¸¸ï¼›è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå„å¤§ImageLoaderéƒ½æ˜¯è‡ªå·±å†™çº¿ç¨‹æ± å’ŒHandlderçš„åŸå› ã€‚ è¿™ä¸ªçº¿ç¨‹æ± æ˜¯ä¸€ä¸ªé™æ€å˜é‡ï¼›é‚£ä¹ˆåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¹‹å†…ï¼Œæ‰€æœ‰åœ°æ–¹ä½¿ç”¨åˆ°çš„AsyncTaské»˜è®¤æ„é€ å‡½æ•°æ„é€ å‡ºæ¥çš„AsyncTaskéƒ½ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå¦‚æœAppæ¨¡å—æ¯”è¾ƒå¤šå¹¶ä¸”ä¸åŠ æ§åˆ¶çš„è¯ï¼Œå¾ˆå®¹æ˜“æ»¡è¶³ç¬¬ä¸€æ¡çš„å´©æºƒæ¡ä»¶ï¼›å¦‚æœä½ ä¸å¹¸åœ¨ä¸åŒçš„AsyncTaskçš„doInBackgroudé‡Œé¢è®¿é—®äº†å…±äº«èµ„æºï¼Œé‚£ä¹ˆå°±ä¼šå‘ç”Ÿå„ç§å¹¶å‘ç¼–ç¨‹é—®é¢˜ã€‚ åœ¨AsyncTaskå…¨éƒ¨æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œè¿›ç¨‹ä¸­è¿˜æ˜¯ä¼šå¸¸é©»corePoolSizeä¸ªçº¿ç¨‹ï¼›åœ¨Android 4.4 ï¼ˆAPI 19ï¼‰ä»¥ä¸‹ï¼Œè¿™ä¸ªcorePoolSizeæ˜¯hardcodeçš„ï¼Œæ•°å€¼æ˜¯5ï¼›API 19æ”¹æˆäº†cpu + 1ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨Android 4.4ä»¥å‰ï¼›å¦‚æœä½ æ‰§è¡Œäº†è¶…è¿‡äº”ä¸ªAsyncTaskï¼›ç„¶åå•¥ä¹Ÿä¸å¹²äº†ï¼Œè¿›ç¨‹ä¸­è¿˜æ˜¯ä¼šæœ‰5ä¸ªAsyncTaskçº¿ç¨‹ï¼›ä¸ä¿¡ï¼Œä½ çœ‹ï¼š HandlerAsyncTaské‡Œé¢çš„handlerå¾ˆç®€å•ï¼Œå¦‚ä¸‹ï¼ˆAPI 22ä»£ç ï¼‰ï¼š 12345private static final InternalHandler sHandler = new InternalHandler();public InternalHandler() &#123; super(Looper.getMainLooper());&#125; æ³¨æ„ï¼Œè¿™é‡Œç›´æ¥ç”¨çš„ä¸»çº¿ç¨‹çš„Looperï¼›å¦‚æœå»çœ‹API 22ä»¥ä¸‹çš„ä»£ç ï¼Œä¼šå‘ç°å®ƒæ²¡æœ‰è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨é»˜è®¤çš„ï¼›é»˜è®¤æƒ…å†µä¸‹ï¼ŒHandlerä¼šä½¿ç”¨å½“å‰çº¿ç¨‹çš„Looperï¼Œå¦‚æœä½ çš„AsyncTaskæ˜¯åœ¨å­çº¿ç¨‹åˆ›å»ºçš„ï¼Œé‚£ä¹ˆå¾ˆä¸å¹¸ï¼Œä½ çš„onPreExecuteå’ŒonPostExecuteå¹¶éåœ¨UIçº¿ç¨‹æ‰§è¡Œï¼Œè€Œæ˜¯è¢«Handler poståˆ°åˆ›å»ºå®ƒçš„é‚£ä¸ªçº¿ç¨‹æ‰§è¡Œï¼›å¦‚æœä½ åœ¨è¿™ä¸¤ä¸ªçº¿ç¨‹æ›´æ–°äº†UIï¼Œé‚£ä¹ˆç›´æ¥å¯¼è‡´å´©æºƒã€‚è¿™ä¹Ÿæ˜¯å¤§å®¶å£å£ç›¸ä¼ çš„AsyncTaskå¿…é¡»åœ¨ä¸»çº¿ç¨‹åˆ›å»ºçš„åŸå› ã€‚ å¦å¤–ï¼ŒAsyncTaské‡Œé¢çš„è¿™ä¸ªHandleræ˜¯ä¸€ä¸ªé™æ€å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯åœ¨ç±»åŠ è½½çš„æ—¶å€™åˆ›å»ºçš„ï¼›å¦‚æœåœ¨ä½ çš„APPè¿›ç¨‹é‡Œé¢ï¼Œä»¥å‰ä»æ¥æ²¡æœ‰ä½¿ç”¨è¿‡AsyncTaskï¼Œç„¶ååœ¨å­çº¿ç¨‹ä½¿ç”¨AsyncTaskçš„ç›¸å…³å˜é‡ï¼Œé‚£ä¹ˆå¯¼è‡´é™æ€Handleråˆå§‹åŒ–ï¼Œå¦‚æœåœ¨API 16ä»¥ä¸‹ï¼Œé‚£ä¹ˆä¼šå‡ºç°ä¸Šé¢åŒæ ·çš„é—®é¢˜ï¼›è¿™å°±æ˜¯AsyncTaskå¿…é¡»åœ¨ä¸»çº¿ç¨‹åˆå§‹åŒ– çš„åŸå› ã€‚ äº‹å®ä¸Šï¼Œåœ¨Android 4.1(API 16)ä»¥åï¼Œåœ¨APPä¸»çº¿ç¨‹ActivityThreadçš„mainå‡½æ•°é‡Œé¢ï¼Œç›´æ¥è°ƒç”¨äº†AscynTask.initå‡½æ•°ç¡®ä¿è¿™ä¸ªç±»æ˜¯åœ¨ä¸»çº¿ç¨‹åˆå§‹åŒ–çš„ï¼›å¦å¤–ï¼Œinitè¿™ä¸ªå‡½æ•°é‡Œé¢è·å–äº†InternalHandlerçš„Looperï¼Œç”±äºæ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå› æ­¤ï¼ŒAsyncTaskçš„Handlerç”¨çš„ä¹Ÿæ˜¯ä¸»çº¿ç¨‹çš„Looperã€‚è¿™ä¸ªé—®é¢˜ä»è€Œå¾—åˆ°å½»åº•çš„è§£å†³ã€‚ AsyncTaskæ˜¯å¹¶è¡Œæ‰§è¡Œçš„å—ï¼Ÿç°åœ¨çŸ¥é“AsyncTaskå†…éƒ¨æœ‰ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œé‚£ä¹ˆæ´¾å‘ç»™AsyncTaskçš„ä»»åŠ¡æ˜¯å¹¶è¡Œæ‰§è¡Œçš„å—ï¼Ÿ ç­”æ¡ˆæ˜¯ä¸ç¡®å®šã€‚åœ¨Android 1.5åˆšå¼•å…¥çš„æ—¶å€™ï¼ŒAsyncTaskçš„executeæ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼›åˆ°äº†Android 1.6ç›´åˆ°Android 2.3.2ï¼Œåˆè¢«ä¿®æ”¹ä¸ºå¹¶è¡Œæ‰§è¡Œäº†ï¼Œè¿™ä¸ªæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± å°±æ˜¯THREAD_POOL_EXECUTORï¼Œå› æ­¤åœ¨ä¸€ä¸ªè¿›ç¨‹å†…ï¼Œæ‰€æœ‰çš„AsyncTaskéƒ½æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼›ä½†æ˜¯åœ¨Android 3.0ä»¥åï¼Œå¦‚æœä½ ä½¿ç”¨executeå‡½æ•°ç›´æ¥æ‰§è¡ŒAsyncTaskï¼Œé‚£ä¹ˆè¿™äº›ä»»åŠ¡æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼›ï¼ˆä½ è¯´è›‹ç–¼ä¸ï¼‰æºä»£ç å¦‚ä¸‹ï¼š 123public final AsyncTask&lt;Params, Progress, Result&gt; execute(Params... params) &#123; return executeOnExecutor(sDefaultExecutor, params);&#125; è¿™ä¸ªsDefaultExecutorå°±æ˜¯ç”¨æ¥æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆå®ƒçš„å€¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç»§ç»­çœ‹ä»£ç ï¼š 1private static volatile Executor sDefaultExecutor = SERIAL_EXECUTOR; å› æ­¤ç»“è®ºå°±æ¥äº†ï¼šAndroid 3.0ä»¥ä¸Šï¼ŒAsyncTaské»˜è®¤å¹¶ä¸æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼› ä¸ºä»€ä¹ˆé»˜è®¤ä¸å¹¶è¡Œæ‰§è¡Œï¼Ÿä¹Ÿè®¸ä½ ä¸ç†è§£ï¼Œä¸ºä»€ä¹ˆAsyncTaské»˜è®¤æŠŠå®ƒè®¾è®¡ä¸ºä¸²è¡Œæ‰§è¡Œçš„å‘¢ï¼Ÿ ç”±äºä¸€ä¸ªè¿›ç¨‹å†…æ‰€æœ‰çš„AsyncTaskéƒ½æ˜¯ä½¿ç”¨çš„åŒä¸€ä¸ªçº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡ï¼›å¦‚æœåŒæ—¶æœ‰å‡ ä¸ªAsyncTaskä¸€èµ·å¹¶è¡Œæ‰§è¡Œçš„è¯ï¼Œæ°å¥½AysncTaskçš„ä½¿ç”¨è€…åœ¨doInbackgroudé‡Œé¢è®¿é—®äº†ç›¸åŒçš„èµ„æºï¼Œä½†æ˜¯è‡ªå·±æ²¡æœ‰å¤„ç†åŒæ­¥é—®é¢˜ï¼›é‚£ä¹ˆå°±æœ‰å¯èƒ½å¯¼è‡´ç¾éš¾æ€§çš„åæœï¼ ç”±äºå¼€å‘è€…é€šå¸¸ä¸ä¼šæ„è¯†åˆ°éœ€è¦å¯¹ä»–ä»¬åˆ›å»ºçš„æ‰€æœ‰çš„AsyncTaskå¯¹è±¡é‡Œé¢çš„doInbackgroudåšåŒæ­¥å¤„ç†ï¼Œå› æ­¤ï¼ŒAPIçš„è®¾è®¡è€…ä¸ºäº†é¿å…è¿™ç§æ— æ„ä¸­è®¿é—®å¹¶å‘èµ„æºçš„é—®é¢˜ï¼Œå¹²è„†æŠŠè¿™ä¸ªAPIè®¾ç½®ä¸ºé»˜è®¤æ‰€æœ‰ä¸²è¡Œæ‰§è¡Œçš„äº†ã€‚å¦‚æœä½ æ˜ç¡®çŸ¥é“è‡ªå·±éœ€è¦å¹¶è¡Œå¤„ç†ä»»åŠ¡ï¼Œé‚£ä¹ˆä½ éœ€è¦ä½¿ç”¨executeOnExecutor(Executor exec,Params... params)è¿™ä¸ªå‡½æ•°æ¥æŒ‡å®šä½ ç”¨æ¥æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± ï¼ŒåŒæ—¶ä¸ºè‡ªå·±çš„è¡Œä¸ºè´Ÿè´£ã€‚ï¼ˆå¤„ç†åŒæ­¥é—®é¢˜ï¼‰ å®é™…ä¸Šã€ŠEffective Javaã€‹é‡Œé¢æœ‰ä¸€æ¡åŸåˆ™è¯´çš„å°±æ˜¯è¿™ç§æƒ…å†µï¼šä¸è¦åœ¨åŒæ­¥å—é‡Œé¢è°ƒç”¨ä¸å¯ä¿¡çš„å¤–æ¥å‡½æ•°ã€‚è¿™é‡Œæ˜æ˜¾è¿èƒŒäº†è¿™ä¸ªåŸåˆ™ï¼šAsyncTaskè¿™ä¸ªç±»å¹¶ä¸çŸ¥é“ä½¿ç”¨è€…ä¼šåœ¨doInBackgroudè¿™ä¸ªå‡½æ•°é‡Œé¢åšä»€ä¹ˆï¼Œä½†æ˜¯å¯¹å®ƒçš„è¡Œä¸ºåšäº†æŸç§å‡è®¾ã€‚ å¦‚ä½•è®©AsyncTaskå¹¶è¡Œæ‰§è¡Œï¼Ÿæ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼Œå¦‚æœä½ ç¡®å®šè‡ªå·±åšå¥½äº†åŒæ­¥å¤„ç†ï¼Œæˆ–è€…ä½ æ²¡æœ‰åœ¨ä¸åŒçš„AsyncTaské‡Œé¢è®¿é—®å…±äº«èµ„æºï¼Œéœ€è¦AsyncTaskèƒ½å¤Ÿå¹¶è¡Œå¤„ç†ä»»åŠ¡çš„è¯ï¼Œä½ å¯ä»¥ç”¨å¸¦æœ‰ä¸¤ä¸ªå‚æ•°çš„executeOnExecutoræ‰§è¡Œä»»åŠ¡ï¼š 1234567new AsyncTask&lt;Void, Void, Vo @Override protected Void doInBackground(Void... params) &#123; // do something return null; &#125;&#125;.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR); æ›´å¥½çš„AsyncTaskä»ä¸Šé¢çš„åˆ†æå¾—çŸ¥ï¼ŒAsyncTaskæœ‰å¦‚ä¸‹é—®é¢˜ï¼š é»˜è®¤çš„AsyncTaskå¦‚æœå¤„ç†çš„ä»»åŠ¡è¿‡å¤šï¼Œä¼šå¯¼è‡´ç¨‹åºç›´æ¥å´©æºƒï¼› AsyncTaskç±»å¿…é¡»åœ¨ä¸»çº¿ç¨‹åˆå§‹åŒ–ï¼Œå¿…é¡»åœ¨ä¸»çº¿ç¨‹åˆ›å»ºï¼Œä¸ç„¶åœ¨API 16ä»¥ä¸‹å¾ˆå¤§æ¦‚ç‡å´©æºƒã€‚ å¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡AsyncTaskï¼Œä»¥åä¸ç”¨äº†ï¼›åœ¨Android 4.4ä»¥ä¸‹ï¼Œè¿›ç¨‹å†…ä¹Ÿé»˜è®¤æœ‰5ä¸ªAsyncTaskçº¿ç¨‹ï¼›åœ¨Android 4.4ä»¥ä¸Šï¼Œé»˜è®¤æœ‰CPU + 1ä¸ªçº¿ç¨‹ã€‚ Android 3.0ä»¥ä¸Šçš„AsyncTaské»˜è®¤æ˜¯ä¸²è¡Œæ‰§è¡Œä»»åŠ¡çš„ï¼›å¦‚æœè¦å¹¶è¡Œæ‰§è¡Œéœ€è¦è°ƒç”¨ä½ç‰ˆæœ¬æ²¡æœ‰çš„APIï¼Œå¤„ç†éº»çƒ¦ã€‚ å› æ­¤æˆ‘ä»¬å¯¹ç³»ç»Ÿçš„AsyncTaskåšäº†ä¸€äº›ä¿®æ”¹ï¼Œåœ¨ä¸åŒAndroidç‰ˆæœ¬æä¾›ä¸€è‡´çš„è¡Œä¸ºï¼Œå¹¶ä¸”æé«˜äº†ä½¿ç”¨æ­¤ç±»çš„å®‰å…¨æ€§ï¼Œä¸»è¦æ”¹åŠ¨å¦‚ä¸‹ï¼š æ·»åŠ å¯¹äºä»»åŠ¡è¿‡å¤šå¯¼è‡´å´©æºƒçš„å¼‚å¸¸ä¿æŠ¤ï¼›åœ¨è¿™é‡Œè¿›è¡Œå¿…è¦çš„æ•°æ®ç»Ÿè®¡ä¸ŠæŠ¥å·¥ä½œï¼›å¦‚æœå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œè¯´æ˜AsyncTaskä¸é€‚åˆè¿™ç§åœºæ™¯äº†ï¼Œéœ€è¦è€ƒè™‘é‡æ„ï¼› ç§»æ¤API 22å¯¹äºHandlerçš„å¤„ç†ï¼›è¿™æ ·å°±ç®—åœ¨çº¿ç¨‹åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼› æä¾›ä¸²è¡Œæ‰§è¡Œå’Œå¹¶è¡Œæ‰§è¡Œçš„executeæ–¹æ³•ï¼›é»˜è®¤ä¸²è¡Œæ‰§è¡Œï¼Œå¦‚æœæ˜ç¡®çŸ¥é“è‡ªå·±åœ¨å¹²ä»€ä¹ˆï¼Œå¯ä»¥ä½¿ç”¨executeParallelå¹¶è¡Œæ‰§è¡Œã€‚ åœ¨doInbackgroudé‡Œé¢é¢‘ç¹å´©æºƒçš„åœ°æ–¹åŠ ä¸Štry..catchï¼›è‡ªå·±å¤„ç†æ•°æ®ä¸ŠæŠ¥å·¥ä½œã€‚ å®Œæ•´ä»£ç è§gistï¼ŒBetterAsyncTask åŸæ–‡åœ°å€ï¼šhttp://weishu.me/2016/01/18/dive-into-asynctask/ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"ViewDragHelperæºç è§£æ","date":"2017-07-26T12:08:18.000Z","path":"2017/07/26/ViewDragHelperæºç è§£æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ ViewDragHelperæºç è§£æ1. ç®€ä»‹æˆ‘ä»¬äº†è§£äº†ViewDragHelperæ˜¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†å„ç§æ‹–æ‹½äº‹ä»¶çš„ç±».ä½¿ç”¨å¥½ViewDragHelperèƒ½å¸®åŠ©æˆ‘ä»¬åšå‡ºå„ç§é…·ç‚«çš„äº¤äº’,ä»Šå¤©æˆ‘ä»¬å°±æ¥åˆ†æä¸€ä¸‹ViewDragHelperçš„ä½¿ç”¨ä¸å®ç° 2. ä½¿ç”¨æ–¹æ³•æˆ‘ä»¬è¿™é‡Œå°±ä»¥ç¿”æ€»çš„è¿™ç¯‡æ–‡ç« ä¸­çš„ä¾‹å­æ¥ä»‹ç»ä¸€ä¸‹ViewDragHelperçš„ä½¿ç”¨.å¦å¤–,æœ¬æ–‡ä¸­çš„demoå¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ° é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªDragLayoutç±»å¹¶ç»§æ‰¿è‡ªLinearLayout,ç„¶åæˆ‘ä»¬å‡†å¤‡åœ¨DragLayoutæ”¾ç½®ä¸‰ä¸ªViewç¬¬ä¸€ä¸ªç”¨æ¥è¢«æˆ‘ä»¬æ‹–åŠ¨ç„¶ååœæ­¢åœ¨æ¾æ‰‹çš„ä½ç½®,ç¬¬äºŒä¸ªå¯ä»¥è¢«æˆ‘ä»¬æ‹–åŠ¨,æ¾æ‰‹çš„æ—¶å€™æ»‘åŠ¨åˆ°æŒ‡å®šä½ç½®,ç¬¬ä¸‰ä¸ªåªå¯ä»¥é€šè¿‡è§¦æ‘¸è¾¹ç¼˜æ¥è¿›è¡Œæ‹–åŠ¨, 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108public class DragLayout extends LinearLayout &#123; private ViewDragHelper mDragger; private View mDragView; private View mAutoBackView; private View mEdgeTrackerView; private Point mAutoBackOriginPos = new Point(); public DragLayout(Context context) &#123; this(context, null); &#125; public DragLayout(Context context, AttributeSet attrs) &#123; this(context, attrs, 0); &#125; public DragLayout(Context context, AttributeSet attrs, int defStyleAttr) &#123; super(context, attrs, defStyleAttr); initViewDragHelper(); &#125; private void initViewDragHelper() &#123; mDragger = ViewDragHelper.create(this,myCallback); mDragger.setEdgeTrackingEnabled(ViewDragHelper.EDGE_ALL); &#125; ViewDragHelper.Callback myCallback = new ViewDragHelper.Callback() &#123; @Override //childä¸ºå½“å‰è§¦æ‘¸åŒºåŸŸä¸‹çš„View,å¦‚æœè¿”å›true,å°±å¯ä»¥æ‹–æ‹½. public boolean tryCaptureView(View child, int pointerId) &#123; return child == mDragView || child == mAutoBackView; &#125; //æ¾æ‰‹æ—¶çš„å›è°ƒ @Override public void onViewReleased(View releasedChild, float xvel, float yvel) &#123; if (releasedChild == mAutoBackView) &#123; mDragger.settleCapturedViewAt(mAutoBackOriginPos.x, mAutoBackOriginPos.y); invalidate(); &#125; &#125; //è¾¹ç¼˜è§¦æ‘¸å¼€å§‹æ—¶çš„å›è°ƒ @Override public void onEdgeDragStarted(int edgeFlags, int pointerId) &#123; mDragger.captureChildView(mEdgeTrackerView, pointerId); &#125; //è·å–æ°´å¹³æ–¹å‘å…è®¸æ‹–æ‹½çš„åŒºåŸŸ,è¿™é‡Œæ˜¯çˆ¶å¸ƒå±€çš„å®½-å­æ§ä»¶çš„å®½ @Override public int getViewHorizontalDragRange(View child) &#123; return getMeasuredWidth() - child.getMeasuredWidth(); &#125; //è·å–å‚ç›´æ–¹å‘å…è®¸æ‹–æ‹½çš„èŒƒå›´ @Override public int getViewVerticalDragRange(View child) &#123; return getMeasuredHeight() - child.getMeasuredHeight(); &#125; //leftä¸ºchildå³å°†ç§»åŠ¨åˆ°çš„æ°´å¹³ä½ç½®çš„å€¼,ä½†æ˜¯è¿”å›å€¼ä¼šæœ€ç»ˆå†³å®šç§»åŠ¨åˆ°çš„å€¼ //è¿™é‡Œç›´æ¥è¿”å›äº†left @Override public int clampViewPositionHorizontal(View child, int left, int dx) &#123; return left; &#125; //åŒä¸Šåªæ˜¯è¿™é‡Œæ˜¯å‚ç›´æ–¹å‘ @Override public int clampViewPositionVertical(View child, int top, int dy) &#123; return top; &#125; &#125;; @Override public void computeScroll() &#123; if (mDragger.continueSettling(true)) &#123; invalidate(); &#125; &#125; @Override public boolean onInterceptTouchEvent(MotionEvent ev) &#123; return mDragger.shouldInterceptTouchEvent(ev); &#125; @Override public boolean onTouchEvent(MotionEvent event) &#123; mDragger.processTouchEvent(event); return true; &#125; @Override protected void onFinishInflate() &#123; super.onFinishInflate(); mDragView = getChildAt(0); mAutoBackView = getChildAt(1); mEdgeTrackerView = getChildAt(2); &#125; @Override protected void onLayout(boolean changed, int l, int t, int r, int b) &#123; super.onLayout(changed, l, t, r, b); mAutoBackOriginPos.x = mAutoBackView.getLeft(); mAutoBackOriginPos.y = mAutoBackView.getTop(); &#125;&#125; æˆ‘ä»¬é¦–å…ˆåœ¨æ„é€ æ–¹æ³•é‡Œä¼ å…¥äº†å½“å‰ç±»çš„å¯¹è±¡å’Œæˆ‘ä»¬å®šä¹‰çš„ViewDragHelper.Callbackå¯¹è±¡åˆå§‹åŒ–äº†æˆ‘ä»¬çš„ViewDragHelper,ç„¶åæˆ‘ä»¬å¸Œæœ›æ‰€æœ‰çš„è¾¹ç¼˜è§¦æ‘¸éƒ½èƒ½è§¦å‘mEdgeTrackerViewçš„æ‹–åŠ¨,æ‰€ä»¥æˆ‘ä»¬ç´§æ¥ç€è°ƒç”¨äº†mDragger.setEdgeTrackingEnabled(ViewDragHelper.EDGE_ALL);æ–¹æ³•. åœ¨æˆ‘ä»¬å®šä¹‰çš„Callbackä¸­,æœ‰å¤šä¸ªå›è°ƒæ–¹æ³•,æ¯ä¸ªå›è°ƒæ–¹æ³•éƒ½æœ‰å®ƒçš„ä½œç”¨,åœ¨ä»£ç é‡Œæ³¨é‡Šæ¯”è¾ƒæ¸…æ¥šäº†ï¼Œæˆ‘ä»¬ä¸‹é¢ä¹Ÿä¼šè§£ææ¯ä¸€ä¸ªCallbackä¸­å›è°ƒæ–¹æ³•çš„ä½œç”¨. ç¬¬ä¸‰æ­¥æˆ‘ä»¬éœ€è¦åœ¨onInterceptTouchEvent()æ–¹æ³•å’ŒonTouchEvent()å°†äº‹ä»¶å§”æ‰˜ç»™ViewDragHelperå»å¤„ç†,è¿™æ ·ViewDragHelperæ‰èƒ½æ ¹æ®å“åº”çš„äº‹ä»¶å¹¶å›è°ƒæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„Callbackæ¥å£æ¥è¿›è¡Œå“åº”çš„å¤„ç†, ç”±äºViewDragHelperä¸­çš„æ»‘åŠ¨æ˜¯äº¤ç»™Srcollerç±»æ¥å¤„ç†çš„æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¦é‡å†™computeScroll()æ–¹æ³•,é…åˆScrollerå®Œæˆæ»šåŠ¨åŠ¨ç”». æœ€ååœ¨onFinishInflate()é‡Œè·å–åˆ°æˆ‘ä»¬çš„Viewå¯¹è±¡å³å¯. 3. ç±»å…³ç³»å›¾ç”±äºå°±ä¸€ä¸ªç±»ç±»å›¾æˆ‘ä»¬å°±ä¸ç”»äº†,ä½†æ˜¯ä½œä¸ºä¸€ä¸ªå¼ºè¿«ç—‡æ‚£è€…,è¿™ä¸ªæ ‡é¢˜å¿…é¡»æœ‰â€¦ 4. æºç åˆ†æ4.1 ViewDragHelper.Callbackçš„å®ç°åœ¨åˆ†æViewDragHelperä¹‹å‰,æˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹Callbackçš„å®šä¹‰,çœ‹çœ‹Callbackéƒ½å®šä¹‰äº†å“ªäº›æ–¹æ³•:1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980public static abstract class Callback &#123; //å½“Viewçš„æ‹–æ‹½çŠ¶æ€æ”¹å˜æ—¶å›è°ƒ,stateä¸ºSTATE_IDLE,STATE_DRAGGING,STATE_SETTLINGçš„ä¸€ç§ //STATE_IDLE: å½“å‰æœªè¢«æ‹–æ‹½ //STATE_DRAGGINGï¼šæ­£åœ¨è¢«æ‹–æ‹½ //STATE_SETTLING: è¢«æ‹–æ‹½åéœ€è¦è¢«å®‰æ”¾åˆ°ä¸€ä¸ªä½ç½®ä¸­çš„çŠ¶æ€ public void onViewDragStateChanged(int state) &#123;&#125; //å½“Viewè¢«æ‹–æ‹½ä½ç½®å‘ç”Ÿæ”¹å˜æ—¶å›è°ƒ //changedView ï¼šè¢«æ‹–æ‹½çš„View //left : è¢«æ‹–æ‹½åViewçš„leftè¾¹ç¼˜åæ ‡ //top : è¢«æ‹–æ‹½åViewçš„topè¾¹ç¼˜åæ ‡ //dx : æ‹–åŠ¨çš„xåç§»é‡ //dy : æ‹–åŠ¨çš„yåç§»é‡ public void onViewPositionChanged(View changedView, int left, int top, int dx, int dy) &#123;&#125; //å½“ä¸€ä¸ªViewè¢«æ•è·åˆ°å‡†å¤‡å¼€å§‹æ‹–åŠ¨æ—¶å›è°ƒ, //capturedChild : æ•è·çš„View //activePointerId : å¯¹åº”çš„PointerId public void onViewCaptured(View capturedChild, int activePointerId) &#123;&#125; //å½“è¢«æ•è·æ‹–æ‹½çš„Viewè¢«é‡Šæ”¾æ˜¯å›è°ƒ //releasedChild : è¢«é‡Šæ”¾çš„View //xvel : é‡Šæ”¾Viewçš„xæ–¹å‘ä¸Šçš„åŠ é€Ÿåº¦ //yvel : é‡Šæ”¾Viewçš„yæ–¹å‘ä¸Šçš„åŠ é€Ÿåº¦ public void onViewReleased(View releasedChild, float xvel, float yvel) &#123;&#125; //å¦‚æœparentViewè®¢é˜…äº†è¾¹ç¼˜è§¦æ‘¸,åˆ™å¦‚æœæœ‰è¾¹ç¼˜è§¦æ‘¸å°±å›è°ƒçš„æ¥å£ //edgeFlags : å½“å‰è§¦æ‘¸çš„flag æœ‰: EDGE_LEFT,EDGE_TOP,EDGE_RIGHT,EDGE_BOTTOM //pointerId : ç”¨æ¥æè¿°è¾¹ç¼˜è§¦æ‘¸æ“ä½œçš„id public void onEdgeTouched(int edgeFlags, int pointerId) &#123;&#125; //æ˜¯å¦é”å®šè¯¥è¾¹ç¼˜çš„è§¦æ‘¸,é»˜è®¤è¿”å›false,è¿”å›trueè¡¨ç¤ºé”å®š public boolean onEdgeLock(int edgeFlags) &#123; return false; &#125; //è¾¹ç¼˜è§¦æ‘¸å¼€å§‹æ—¶å›è°ƒ //edgeFlags : å½“å‰è§¦æ‘¸çš„flag æœ‰: EDGE_LEFT,EDGE_TOP,EDGE_RIGHT,EDGE_BOTTOM //pointerId : ç”¨æ¥æè¿°è¾¹ç¼˜è§¦æ‘¸æ“ä½œçš„id public void onEdgeDragStarted(int edgeFlags, int pointerId) &#123;&#125; //åœ¨å¯»æ‰¾å½“å‰è§¦æ‘¸ç‚¹ä¸‹çš„å­Viewæ—¶ä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå¯»æ‰¾åˆ°çš„Viewä¼šæä¾›ç»™tryCaptureViewForDrag()æ¥å°è¯•æ•è·ã€‚ //å¦‚æœéœ€è¦æ”¹å˜å­Viewçš„éå†æŸ¥è¯¢é¡ºåºå¯æ”¹å†™æ­¤æ–¹æ³•ï¼Œä¾‹å¦‚è®©ä¸‹å±‚çš„Viewä¼˜å…ˆäºä¸Šå±‚çš„Viewè¢«é€‰ä¸­ã€‚ public int getOrderedChildIndex(int index) &#123; return index; &#125; //è·å–è¢«æ‹–æ‹½View child çš„æ°´å¹³æ‹–æ‹½èŒƒå›´,è¿”å›0è¡¨ç¤ºæ— æ³•è¢«æ°´å¹³æ‹–æ‹½ public int getViewHorizontalDragRange(View child) &#123; return 0; &#125; //è·å–è¢«æ‹–æ‹½View child çš„å‚ç›´æ‹–æ‹½èŒƒå›´,è¿”å›0è¡¨ç¤ºæ— æ³•è¢«æ°´å¹³æ‹–æ‹½ public int getViewVerticalDragRange(View child) &#123; return 0; &#125; //å°è¯•æ•è·è¢«æ‹–æ‹½çš„View public abstract boolean tryCaptureView(View child, int pointerId); //å†³å®šæ‹–æ‹½Viewåœ¨æ°´å¹³æ–¹å‘ä¸Šåº”è¯¥ç§»åŠ¨åˆ°çš„ä½ç½® //child : è¢«æ‹–æ‹½çš„View //left : æœŸæœ›ç§»åŠ¨åˆ°ä½ç½®çš„Viewçš„leftå€¼ //dx : ç§»åŠ¨çš„æ°´å¹³è·ç¦» //è¿”å›å€¼ : ç›´æ¥å†³å®šViewåœ¨æ°´å¹³æ–¹å‘çš„ä½ç½® public int clampViewPositionHorizontal(View child, int left, int dx) &#123; return 0; &#125; //å†³å®šæ‹–æ‹½Viewåœ¨å‚ç›´æ–¹å‘ä¸Šåº”è¯¥ç§»åŠ¨åˆ°çš„ä½ç½® //child : è¢«æ‹–æ‹½çš„View //top : æœŸæœ›ç§»åŠ¨åˆ°ä½ç½®çš„Viewçš„topå€¼ //dy : ç§»åŠ¨çš„å‚ç›´è·ç¦» //è¿”å›å€¼ : ç›´æ¥å†³å®šViewåœ¨å‚ç›´æ–¹å‘çš„ä½ç½® public int clampViewPositionVertical(View child, int top, int dy) &#123; return 0; &#125;&#125; æƒ³å¿…æ³¨é‡Šå·²ç»å¾ˆæ¸…æ¥šäº†,æ­£æ˜¯è¿™äº›å›è°ƒæ–¹æ³•,å†ç»“åˆViewDragHelperä¸­çš„å„ç§æ–¹æ³•,æ¥å¸®åŠ©æˆ‘ä»¬å®ç°å„ç§å„æ ·çš„æ‹–æ‹½çš„æ•ˆæœã€‚ 4.2 shouldInterceptTouchEvent()æ–¹æ³•çš„å®ç°åœ¨è¿™é‡Œæˆ‘ä»¬å‡è®¾å¤§å®¶éƒ½æ¸…æ¥šäº†Androidçš„äº‹ä»¶åˆ†å‘æœºåˆ¶,å¦‚æœä¸æ¸…æ¥šè¯·çœ‹è¿™é‡Œ,è¦æƒ³å¤„ç†è§¦æ‘¸äº‹ä»¶,æˆ‘ä»¬éœ€è¦åœ¨onInterceptTouchEvent(MotionEvent ev)æ–¹æ³•é‡Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªè¿™æ¬¡è§¦æ‘¸äº‹ä»¶,å¦‚æœæ­¤æ–¹æ³•è¿”å›trueåˆ™è§¦æ‘¸äº‹ä»¶å°†ä¼šäº¤ç»™onTouchEvent(MotionEvent event)å¤„ç†,è¿™æ ·æˆ‘ä»¬å°±èƒ½å¤„ç†è§¦æ‘¸äº‹ä»¶äº†,æ‰€ä»¥æˆ‘ä»¬åœ¨ä¸Šé¢çš„ä½¿ç”¨æ–¹æ³•é‡Œä¼šè¿™æ ·å†™: 1234567891011@Overridepublic boolean onInterceptTouchEvent(MotionEvent ev) &#123; return mDragger.shouldInterceptTouchEvent(ev);&#125;@Overridepublic boolean onTouchEvent(MotionEvent event) &#123; mDragger.processTouchEvent(event); return true;&#125; è¿™æ ·å°±å°†æ˜¯å¦æ‹¦æˆªè§¦æ‘¸äº‹ä»¶,ä»¥åŠå¤„ç†è§¦æ‘¸äº‹ä»¶å§”æ‰˜ç»™ViewDragHelperæ¥å¤„ç†äº†,æ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ViewDragHelperä¸­shouldInterceptTouchEvent();æ–¹æ³•çš„å®ç°: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150public boolean shouldInterceptTouchEvent(MotionEvent ev) &#123; //è·å–action final int action = MotionEventCompat.getActionMasked(ev); //è·å–actionå¯¹åº”çš„index final int actionIndex = MotionEventCompat.getActionIndex(ev); //å¦‚æœæ˜¯æŒ‰ä¸‹çš„actionåˆ™é‡ç½®ä¸€äº›ä¿¡æ¯,åŒ…æ‹¬å„ç§äº‹ä»¶ç‚¹çš„æ•°ç»„ if (action == MotionEvent.ACTION_DOWN) &#123; // Reset things for a new event stream, just in case we didn't get // the whole previous stream. cancel(); &#125; //åˆå§‹åŒ–mVelocityTracker if (mVelocityTracker == null) &#123; mVelocityTracker = VelocityTracker.obtain(); &#125; mVelocityTracker.addMovement(ev); //æ ¹æ®actionæ¥åšç›¸åº”çš„å¤„ç† switch (action) &#123; case MotionEvent.ACTION_DOWN: &#123; final float x = ev.getX(); final float y = ev.getY(); //è·å–è¿™ä¸ªäº‹ä»¶å¯¹åº”çš„pointerId,ä¸€èˆ¬æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ªæ‰‹æŒ‡è§¦æ‘¸æ—¶ä¸º0 //ä¸¤ä¸ªæ‰‹æŒ‡è§¦æ‘¸æ—¶ç¬¬äºŒä¸ªæ‰‹æŒ‡è§¦æ‘¸è¿”å›çš„pointerIdä¸º1ï¼Œä»¥æ­¤ç±»æ¨ final int pointerId = MotionEventCompat.getPointerId(ev, 0); //ä¿å­˜ç‚¹çš„æ•°æ® //TODO (1) saveInitialMotion(x, y, pointerId); //è·å–å½“å‰è§¦æ‘¸ç‚¹ä¸‹æœ€é¡¶å±‚çš„å­View //TODO (2) final View toCapture = findTopChildUnder((int) x, (int) y); //å¦‚æœtoCaptureæ˜¯å·²ç»æ•è·çš„View,è€Œä¸”æ­£åœ¨å¤„äºè¢«é‡Šæ”¾çŠ¶æ€ //é‚£ä¹ˆå°±é‡æ–°æ•è· if (toCapture == mCapturedView &amp;&amp; mDragState == STATE_SETTLING) &#123; tryCaptureViewForDrag(toCapture, pointerId); &#125; //å¦‚æœè§¦æ‘¸äº†è¾¹ç¼˜,å›è°ƒcallbackçš„onEdgeTouched()æ–¹æ³• final int edgesTouched = mInitialEdgesTouched[pointerId]; if ((edgesTouched &amp; mTrackingEdges) != 0) &#123; mCallback.onEdgeTouched(edgesTouched &amp; mTrackingEdges, pointerId); &#125; break; &#125; //å½“åˆæœ‰ä¸€ä¸ªæ‰‹æŒ‡è§¦æ‘¸æ—¶ case MotionEventCompat.ACTION_POINTER_DOWN: &#123; final int pointerId = MotionEventCompat.getPointerId(ev, actionIndex); final float x = MotionEventCompat.getX(ev, actionIndex); final float y = MotionEventCompat.getY(ev, actionIndex); //ä¿å­˜è§¦æ‘¸ä¿¡æ¯ saveInitialMotion(x, y, pointerId); //å› ä¸ºåŒä¸€æ—¶é—´ViewDragHelperåªèƒ½æ“æ§ä¸€ä¸ªView,æ‰€ä»¥å½“æœ‰æ–°çš„æ‰‹æŒ‡è§¦æ‘¸æ—¶ //åªè®¨è®ºå½“æ— è§¦æ‘¸å‘ç”Ÿæ—¶,å›è°ƒè¾¹ç¼˜è§¦æ‘¸çš„callback //æˆ–è€…æ­£åœ¨å¤„äºé‡Šæ”¾çŠ¶æ€æ—¶é‡æ–°æ•è·View if (mDragState == STATE_IDLE) &#123; final int edgesTouched = mInitialEdgesTouched[pointerId]; if ((edgesTouched &amp; mTrackingEdges) != 0) &#123; mCallback.onEdgeTouched(edgesTouched &amp; mTrackingEdges, pointerId); &#125; &#125; else if (mDragState == STATE_SETTLING) &#123; // Catch a settling view if possible. final View toCapture = findTopChildUnder((int) x, (int) y); if (toCapture == mCapturedView) &#123; tryCaptureViewForDrag(toCapture, pointerId); &#125; &#125; break; &#125; //å½“æ‰‹æŒ‡ç§»åŠ¨æ—¶ case MotionEvent.ACTION_MOVE: &#123; if (mInitialMotionX == null || mInitialMotionY == null) break; // First to cross a touch slop over a draggable view wins. Also report edge drags. //å¾—åˆ°è§¦æ‘¸ç‚¹çš„æ•°é‡,å¹¶å¾ªç¯å¤„ç†,åªå¤„ç†ç¬¬ä¸€ä¸ªå‘ç”Ÿäº†æ‹–æ‹½çš„äº‹ä»¶ final int pointerCount = MotionEventCompat.getPointerCount(ev); for (int i = 0; i &lt; pointerCount; i++) &#123; final int pointerId = MotionEventCompat.getPointerId(ev, i); final float x = MotionEventCompat.getX(ev, i); final float y = MotionEventCompat.getY(ev, i); //è·å¾—æ‹–æ‹½åç§»é‡ final float dx = x - mInitialMotionX[pointerId]; final float dy = y - mInitialMotionY[pointerId]; //è·å–å½“å‰è§¦æ‘¸ç‚¹ä¸‹æœ€é¡¶å±‚çš„å­View final View toCapture = findTopChildUnder((int) x, (int) y); //å¦‚æœæ‰¾åˆ°äº†æœ€é¡¶å±‚View,å¹¶ä¸”äº§ç”Ÿäº†æ‹–åŠ¨(checkTouchSlop()è¿”å›true) //TODO (3) final boolean pastSlop = toCapture != null &amp;&amp; checkTouchSlop(toCapture, dx, dy); if (pastSlop) &#123; //æ ¹æ®callbackçš„å››ä¸ªæ–¹æ³•getView[Horizontal|Vertical]DragRangeå’Œ //clampViewPosition[Horizontal|Vertical]æ¥æ£€æŸ¥æ˜¯å¦å¯ä»¥æ‹–åŠ¨ final int oldLeft = toCapture.getLeft(); final int targetLeft = oldLeft + (int) dx; final int newLeft = mCallback.clampViewPositionHorizontal(toCapture, targetLeft, (int) dx); final int oldTop = toCapture.getTop(); final int targetTop = oldTop + (int) dy; final int newTop = mCallback.clampViewPositionVertical(toCapture, targetTop, (int) dy); final int horizontalDragRange = mCallback.getViewHorizontalDragRange( toCapture); final int verticalDragRange = mCallback.getViewVerticalDragRange(toCapture); //å¦‚æœéƒ½ä¸å…è®¸ç§»åŠ¨åˆ™è·³å‡ºå¾ªç¯ if ((horizontalDragRange == 0 || horizontalDragRange &gt; 0 &amp;&amp; newLeft == oldLeft) &amp;&amp; (verticalDragRange == 0 || verticalDragRange &gt; 0 &amp;&amp; newTop == oldTop)) &#123; break; &#125; &#125; //è®°å½•å¹¶å›è°ƒæ˜¯å¦æœ‰è¾¹ç¼˜è§¦æ‘¸ reportNewEdgeDrags(dx, dy, pointerId); if (mDragState == STATE_DRAGGING) &#123; // Callback might have started an edge drag break; &#125; //å¦‚æœäº§ç”Ÿäº†æ‹–åŠ¨åˆ™è°ƒç”¨tryCaptureViewForDrag() //TODO (4) if (pastSlop &amp;&amp; tryCaptureViewForDrag(toCapture, pointerId)) &#123; break; &#125; &#125; //ä¿å­˜è§¦æ‘¸ç‚¹çš„ä¿¡æ¯ saveLastMotion(ev); break; &#125; //å½“æœ‰ä¸€ä¸ªæ‰‹æŒ‡æŠ¬èµ·æ—¶,æ¸…é™¤è¿™ä¸ªæ‰‹æŒ‡çš„è§¦æ‘¸æ•°æ® case MotionEventCompat.ACTION_POINTER_UP: &#123; final int pointerId = MotionEventCompat.getPointerId(ev, actionIndex); clearMotionHistory(pointerId); break; &#125; //æ¸…é™¤æ‰€æœ‰è§¦æ‘¸æ•°æ® case MotionEvent.ACTION_UP: case MotionEvent.ACTION_CANCEL: &#123; cancel(); break; &#125; &#125; //å¦‚æœmDragStateç­‰äºæ­£åœ¨æ‹–æ‹½åˆ™è¿”å›true return mDragState == STATE_DRAGGING;&#125; ä¸Šé¢å°±æ˜¯æ•´ä¸ªshouldInterceptTouchEvent()çš„å®ç°,ä¸Šé¢çš„æ³¨é‡Šä¹Ÿè¶³å¤Ÿæ¸…æ¥šäº†,æˆ‘ä»¬è¿™é‡Œå°±å…ˆä¸åˆ†ææŸä¸€ç§è§¦æ‘¸äº‹ä»¶,å¤§å®¶å¯ä»¥çœ‹åˆ°æˆ‘ä¸Šé¢ç•™äº†å‡ ä¸ªTODO,ä¸‹æ–‡ä¼šä¸€èµ·åˆ†æ,è¿™é‡Œæˆ‘å‡è®¾å¤§å®¶éƒ½å·²ç»å¯¹è§¦æ‘¸äº‹ä»¶åˆ†å‘å¤„ç†éƒ½æœ‰å……åˆ†çš„ç†è§£äº†,æˆ‘ä»¬ä¸‹é¢å°±ç›´æ¥çœ‹ViewDragHelperé‡ŒprocessTouchEvent()æ–¹æ³•çš„å®ç°. 4.3 processTouchEvent()æ–¹æ³•çš„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112public void processTouchEvent(MotionEvent ev) &#123; final int action = MotionEventCompat.getActionMasked(ev); final int actionIndex = MotionEventCompat.getActionIndex(ev); ...ï¼ˆçœå»éƒ¨åˆ†ä»£ç ï¼‰ switch (action) &#123; case MotionEvent.ACTION_DOWN: &#123; ...ï¼ˆçœå»éƒ¨åˆ†ä»£ç ï¼‰ break; &#125; case MotionEventCompat.ACTION_POINTER_DOWN: &#123; ...ï¼ˆçœå»éƒ¨åˆ†ä»£ç ï¼‰ break; &#125; case MotionEvent.ACTION_MOVE: &#123; //å¦‚æœç°åœ¨å·²ç»æ˜¯æ‹–æ‹½çŠ¶æ€ if (mDragState == STATE_DRAGGING) &#123; final int index = MotionEventCompat.findPointerIndex(ev, mActivePointerId); final float x = MotionEventCompat.getX(ev, index); final float y = MotionEventCompat.getY(ev, index); final int idx = (int) (x - mLastMotionX[mActivePointerId]); final int idy = (int) (y - mLastMotionY[mActivePointerId]); //æ‹–æ‹½è‡³æŒ‡å®šä½ç½® //TODO (5) dragTo(mCapturedView.getLeft() + idx, mCapturedView.getTop() + idy, idx, idy); saveLastMotion(ev); &#125; else &#123; // Check to see if any pointer is now over a draggable view. //å¦‚æœè¿˜ä¸æ˜¯æ‹–æ‹½çŠ¶æ€,å°±æ£€æµ‹æ˜¯å¦ç»è¿‡äº†ä¸€ä¸ªView final int pointerCount = MotionEventCompat.getPointerCount(ev); for (int i = 0; i &lt; pointerCount; i++) &#123; final int pointerId = MotionEventCompat.getPointerId(ev, i); final float x = MotionEventCompat.getX(ev, i); final float y = MotionEventCompat.getY(ev, i); final float dx = x - mInitialMotionX[pointerId]; final float dy = y - mInitialMotionY[pointerId]; reportNewEdgeDrags(dx, dy, pointerId); if (mDragState == STATE_DRAGGING) &#123; // Callback might have started an edge drag. break; &#125; final View toCapture = findTopChildUnder((int) x, (int) y); if (checkTouchSlop(toCapture, dx, dy) &amp;&amp; tryCaptureViewForDrag(toCapture, pointerId)) &#123; break; &#125; &#125; saveLastMotion(ev); &#125; break; &#125; //å½“å¤šä¸ªæ‰‹æŒ‡ä¸­çš„ä¸€ä¸ªæ‰‹æœºæ¾å¼€æ—¶ case MotionEventCompat.ACTION_POINTER_UP: &#123; final int pointerId = MotionEventCompat.getPointerId(ev, actionIndex); //å¦‚æœå½“å‰ç‚¹æ­£åœ¨è¢«æ‹–æ‹½,åˆ™å†å‰©ä½™è¿˜åœ¨è§¦æ‘¸çš„ç‚¹é’Ÿå¯»æ‰¾æ˜¯å¦æ­£åœ¨Viewä¸Š if (mDragState == STATE_DRAGGING &amp;&amp; pointerId == mActivePointerId) &#123; // Try to find another pointer that's still holding on to the captured view. int newActivePointer = INVALID_POINTER; final int pointerCount = MotionEventCompat.getPointerCount(ev); for (int i = 0; i &lt; pointerCount; i++) &#123; final int id = MotionEventCompat.getPointerId(ev, i); if (id == mActivePointerId) &#123; // This one's going away, skip. continue; &#125; final float x = MotionEventCompat.getX(ev, i); final float y = MotionEventCompat.getY(ev, i); if (findTopChildUnder((int) x, (int) y) == mCapturedView &amp;&amp; tryCaptureViewForDrag(mCapturedView, id)) &#123; newActivePointer = mActivePointerId; break; &#125; &#125; if (newActivePointer == INVALID_POINTER) &#123; // We didn't find another pointer still touching the view, release it. //å¦‚æœæ²¡æ‰¾åˆ°åˆ™é‡Šæ”¾View //TODO (6) releaseViewForPointerUp(); &#125; &#125; clearMotionHistory(pointerId); break; &#125; case MotionEvent.ACTION_UP: &#123; //å¦‚æœæ˜¯æ‹–æ‹½çŠ¶æ€çš„é‡Šæ”¾åˆ™è°ƒç”¨ //releaseViewForPointerUp() if (mDragState == STATE_DRAGGING) &#123; releaseViewForPointerUp(); &#125; cancel(); break; &#125; case MotionEvent.ACTION_CANCEL: &#123; if (mDragState == STATE_DRAGGING) &#123; dispatchViewReleased(0, 0); &#125; cancel(); break; &#125; &#125;&#125; ä¸Šé¢å°±æ˜¯processTouchEvent()æ–¹æ³•çš„å®ç°,æˆ‘ä»¬çœå»äº†éƒ¨åˆ†å¤§è‡´ä¸shouldInterceptTouchEvent()ç›¸åŒçš„é€»è¾‘ä»£ç ,é€šè¿‡äº‹ä»¶ä¼ é€’æœºåˆ¶æˆ‘ä»¬çŸ¥é“,å¦‚æœç¨‹åºå·²ç»è¿›å…¥åˆ°processTouchEvent()ä¸­,ä¹Ÿå°±æ„å‘³ç€è§¦æ‘¸äº‹ä»¶å°±ä¸ä¼šå†å‘ä¸‹ä¼ é€’,éƒ½ä¼šäº¤ç»™æ­¤æ–¹æ³•å¤„ç†,æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦å¤„ç†æ‹–æ‹½äº‹ä»¶äº†,é€šè¿‡ä¸Šé¢çš„æ³¨é‡Š,æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†åœ¨MotionEvent.ACTION_MOVE,MotionEventCompat.ACTION_POINTER_UP,MotionEvent.ACTION_UPå’ŒMotionEvent.ACTION_CANCELéƒ½åˆ†åˆ«è¿›è¡Œäº†å¤„ç† ,æˆ‘ä»¬çŸ¥é“è§¦æ‘¸äº‹ä»¶å¤§è‡´çš„æµç¨‹æ˜¯: ACTION_DOWN -&gt; ACTION_MOVE -&gt; ... -&gt; ACTION_MOVE -&gt; ACTION_UP å†é…åˆäº‹ä»¶çš„åˆ†å‘æœºåˆ¶,æˆ‘ä»¬å°±èƒ½å¾ˆæ¸…æ™°çš„åˆ†æå‡ºä¸€æ¬¡å®Œæ•´çš„äº‹ä»¶è°ƒç”¨è¿‡ç¨‹,æ‰€ä»¥æ•´ä¸ªViewDragHelperçš„æ‹–æ‹½è¿‡ç¨‹ä¹Ÿèƒ½å¾ˆæ¸…æ™°çš„åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤: æ•è·æ‹–æ‹½ç›®æ ‡View -&gt; æ‹–æ‹½ç›®æ ‡View -&gt; å¤„ç†ç›®æ ‡Viewé‡Šæ”¾æ“ä½œ æœ€åæˆ‘ä»¬å†åˆ†æä¸Šé¢ä¸¤æ®µä»£ç çš„6ä¸ªTODO: 4.4 saveInitialMotion()æ–¹æ³•123456789101112private void saveInitialMotion(float x, float y, int pointerId) &#123; //ç¡®ä¿å„ä¸ªæ•°ç»„çš„å¤§å°è¶³å¤Ÿå­˜æ”¾æ•°æ® ensureMotionHistorySizeForId(pointerId); //ä¿å­˜xåæ ‡ mInitialMotionX[pointerId] = mLastMotionX[pointerId] = x; //ä¿å­˜yåæ ‡ mInitialMotionY[pointerId] = mLastMotionY[pointerId] = y; //ä¿å­˜æ˜¯å¦è§¦æ‘¸åˆ°è¾¹ç¼˜ mInitialEdgesTouched[pointerId] = getEdgesTouched((int) x, (int) y); //ä¿å­˜å½“å‰idæ˜¯å¦åœ¨è§¦æ‘¸,ç”¨äºåç»­éªŒè¯ mPointersDown |= 1 &lt;&lt; pointerId;&#125; 4.5 findTopChildUnder()æ–¹æ³•1234567891011public View findTopChildUnder(int x, int y) &#123; final int childCount = mParentView.getChildCount(); for (int i = childCount - 1; i &gt;= 0; i--) &#123; final View child = mParentView.getChildAt(mCallback.getOrderedChildIndex(i)); if (x &gt;= child.getLeft() &amp;&amp; x &lt; child.getRight() &amp;&amp; y &gt;= child.getTop() &amp;&amp; y &lt; child.getBottom()) &#123; return child; &#125; &#125; return null;&#125; ä»£ç å¾ˆç®€å•å°±æ˜¯æ ¹æ®xå’Œyåæ ‡å’Œæ¥æ‰¾åˆ°æŒ‡å®šView,æ³¨æ„è¿™é‡Œå›è°ƒäº†callbackä¸­çš„getOrderedChildIndex()æ–¹æ³•,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè¿”å›æŒ‡å®šçš„Viewçš„index. 4.6 checkTouchSlop()æ–¹æ³•12345678910111213141516private boolean checkTouchSlop(View child, float dx, float dy) &#123; if (child == null) &#123; return false; &#125; final boolean checkHorizontal = mCallback.getViewHorizontalDragRange(child) &gt; 0; final boolean checkVertical = mCallback.getViewVerticalDragRange(child) &gt; 0; if (checkHorizontal &amp;&amp; checkVertical) &#123; return dx * dx + dy * dy &gt; mTouchSlop * mTouchSlop; &#125; else if (checkHorizontal) &#123; return Math.abs(dx) &gt; mTouchSlop; &#125; else if (checkVertical) &#123; return Math.abs(dy) &gt; mTouchSlop; &#125; return false;&#125; ç”¨æ¥æ ¹æ®mTouchSlopæœ€å°æ‹–åŠ¨çš„è·ç¦»æ¥åˆ¤æ–­æ˜¯å¦å±äºæ‹–åŠ¨,mTouchSlopæ ¹æ®æˆ‘ä»¬è®¾å®šçš„çµæ•åº¦å†³å®š. 4.7 tryCaptureViewForDrag()æ–¹æ³•12345678910111213141516boolean tryCaptureViewForDrag(View toCapture, int pointerId) &#123; //å¦‚æœå·²ç»æ•è·è¯¥View ç›´æ¥è¿”å›true if (toCapture == mCapturedView &amp;&amp; mActivePointerId == pointerId) &#123; // Already done! return true; &#125; //æ ¹æ®mCallback.tryCaptureView()æ–¹æ³•æ¥æœ€ç»ˆå†³å®šæ˜¯å¦å¯ä»¥æ•è·View if (toCapture != null &amp;&amp; mCallback.tryCaptureView(toCapture, pointerId)) &#123; mActivePointerId = pointerId; //å¦‚æœå¯ä»¥åˆ™è°ƒç”¨captureChildView(),å¹¶è¿”å›true captureChildView(toCapture, pointerId); return true; &#125; return false;&#125; å¯ä»¥çœ‹åˆ°å¦‚æœå¯ä»¥æ•è·Viewåˆ™è°ƒç”¨äº†captureChildView()æ–¹æ³•: 1234567891011121314public void captureChildView(View childView, int activePointerId) &#123; if (childView.getParent() != mParentView) &#123; throw new IllegalArgumentException(\"captureChildView: parameter must be a descendant \" + \"of the ViewDragHelper's tracked parent view (\" + mParentView + \")\"); &#125; //èµ‹å€¼mCapturedView mCapturedView = childView; mActivePointerId = activePointerId; //å›è°ƒcallback mCallback.onViewCaptured(childView, activePointerId); //è®¾å®šmDragStateçš„çŠ¶æ€ä¸ºSTATE_DRAGGING setDragState(STATE_DRAGGING);&#125; å¦‚æœç¨‹åºæ‰§è¡Œåˆ°è¿™é‡Œ,å°±è¯æ˜Viewå·²ç»å¤„äºæ‹–æ‹½çŠ¶æ€äº†,åç»­çš„è§¦æ‘¸æ“ä½œ,å°†ç›´æ¥æ ¹æ®mDragStateä¸ºSTATE_DRAGGINGçš„çŠ¶æ€å¤„ç†. 4.8 dragTo()æ–¹æ³•çš„å®ç°123456789101112131415161718192021222324252627private void dragTo(int left, int top, int dx, int dy) &#123; int clampedX = left; int clampedY = top; final int oldLeft = mCapturedView.getLeft(); final int oldTop = mCapturedView.getTop(); if (dx != 0) &#123; //å›è°ƒcallbackæ¥å†³å®šViewæœ€ç»ˆè¢«æ‹–æ‹½çš„xæ–¹å‘ä¸Šçš„åç§»é‡ clampedX = mCallback.clampViewPositionHorizontal(mCapturedView, left, dx); //ç§»åŠ¨View ViewCompat.offsetLeftAndRight(mCapturedView, clampedX - oldLeft); &#125; if (dy != 0) &#123; //å›è°ƒcallbackæ¥å†³å®šViewæœ€ç»ˆè¢«æ‹–æ‹½çš„yæ–¹å‘ä¸Šçš„åç§»é‡ clampedY = mCallback.clampViewPositionVertical(mCapturedView, top, dy); //ç§»åŠ¨View ViewCompat.offsetTopAndBottom(mCapturedView, clampedY - oldTop); &#125; if (dx != 0 || dy != 0) &#123; final int clampedDx = clampedX - oldLeft; final int clampedDy = clampedY - oldTop; //å›è°ƒcallback mCallback.onViewPositionChanged(mCapturedView, clampedX, clampedY, clampedDx, clampedDy); &#125;&#125; å› ä¸ºdragTo()æ–¹æ³•æ˜¯åœ¨processTouchEvent()ä¸­çš„MotionEvent.ACTION_MOVE caseè¢«è°ƒç”¨æ‰€ä»¥å½“ç¨‹åºè¿è¡Œåˆ°è¿™é‡Œæ—¶Viewå°±ä¼šä¸æ–­çš„è¢«æ‹–åŠ¨äº†ã€‚å¦‚æœä¸€æ—¦æ‰‹æŒ‡é‡Šæ”¾åˆ™æœ€ç»ˆä¼šè°ƒç”¨releaseViewForPointerUp()æ–¹æ³• 4.8 releaseViewForPointerUp()æ–¹æ³•çš„å®ç°123456789101112private void releaseViewForPointerUp() &#123; //è®¡ç®—å‡ºå½“å‰xå’Œyæ–¹å‘ä¸Šçš„åŠ é€Ÿåº¦ mVelocityTracker.computeCurrentVelocity(1000, mMaxVelocity); final float xvel = clampMag( VelocityTrackerCompat.getXVelocity(mVelocityTracker, mActivePointerId), mMinVelocity, mMaxVelocity); final float yvel = clampMag( VelocityTrackerCompat.getYVelocity(mVelocityTracker, mActivePointerId), mMinVelocity, mMaxVelocity); dispatchViewReleased(xvel, yvel);&#125; è®¡ç®—å®ŒåŠ é€Ÿåº¦åå°±è°ƒç”¨äº†dispatchViewReleased(): 123456789101112131415private void dispatchViewReleased(float xvel, float yvel) &#123; //è®¾å®šå½“å‰æ­£å¤„äºé‡Šæ”¾é˜¶æ®µ mReleaseInProgress = true; //å›è°ƒcallbackçš„onViewReleased()æ–¹æ³• mCallback.onViewReleased(mCapturedView, xvel, yvel); mReleaseInProgress = false; //è®¾å®šçŠ¶æ€ if (mDragState == STATE_DRAGGING) &#123; // onViewReleased didn't call a method that would have changed this. Go idle. //å¦‚æœonViewReleased()ä¸­æ²¡æœ‰è°ƒç”¨ä»»ä½•æ–¹æ³•,åˆ™çŠ¶æ€è®¾å®šä¸ºSTATE_IDLE setDragState(STATE_IDLE); &#125;&#125; æ‰€ä»¥æœ€åé‡Šæ”¾åçš„å¤„ç†äº¤ç»™äº†callbackä¸­çš„onViewReleased()æ–¹æ³•,å¦‚æœæˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸åš,é‚£ä¹ˆè¿™ä¸ªè¢«æ‹–æ‹½çš„Viewå°±æ˜¯åœæ­¢åœ¨å½“å‰ä½ç½®,æˆ–è€…æˆ‘ä»¬å¯ä»¥è°ƒç”¨ViewDragHelperæä¾›ç»™æˆ‘ä»¬çš„è¿™å‡ ä¸ªæ–¹æ³•: settleCapturedViewAt(int finalLeft, int finalTop)ä»¥æ¾æ‰‹å‰çš„æ»‘åŠ¨é€Ÿåº¦ä¸ºåˆé€ŸåŠ¨ï¼Œè®©æ•è·åˆ°çš„Viewè‡ªåŠ¨æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®ã€‚åªèƒ½åœ¨Callbackçš„onViewReleased()ä¸­è°ƒç”¨ã€‚ flingCapturedView(int minLeft, int minTop, int maxLeft, int maxTop)ä»¥æ¾æ‰‹å‰çš„æ»‘åŠ¨é€Ÿåº¦ä¸ºåˆé€ŸåŠ¨ï¼Œè®©æ•è·åˆ°çš„Viewåœ¨æŒ‡å®šèŒƒå›´å†…flingã€‚åªèƒ½åœ¨Callbackçš„onViewReleased()ä¸­è°ƒç”¨ã€‚ smoothSlideViewTo(View child, int finalLeft, int finalTop)æŒ‡å®šæŸä¸ªViewè‡ªåŠ¨æ»šåŠ¨åˆ°æŒ‡å®šçš„ä½ç½®ï¼Œåˆé€Ÿåº¦ä¸º0ï¼Œå¯åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ã€‚ å¼•ç”¨è‡ªè¿™ç¯‡æ–‡ç« ,å…·ä½“é‡Šæ”¾åçš„åŸç†æˆ‘ä»¬å°±ä¸åˆ†æäº†,å…¶å®å°±æ˜¯é…åˆScrollerè¿™ä¸ªç±»æ¥å®ç°,å…·ä½“ä¹Ÿå¯ä»¥å‚ç…§ä¸Šé¢è¿™ç¯‡æ–‡ç« ã€‚å¥½,æˆ‘ä»¬å…³äºViewDragHelperçš„æºç åˆ†æå°±åˆ°è¿™é‡Œ. 5. å¼€æºé¡¹ç›®ä¸­çš„ä½¿ç”¨ViewDragHelperåœ¨å„ç§å…³äºæ‹–æ‹½å’Œå„ç§æ‰‹åŠ¿åŠ¨ç”»çš„å¼€æºåº“ä¸­ä½¿ç”¨å¹¿æ³›,æˆ‘è¿™é‡Œå°±ç®€è¦åˆ—å‡ºä¸€äº›,å¤§å®¶å¯ä»¥å¤šå»çœ‹çœ‹æ˜¯å¦‚ä½•ä½¿ç”¨ViewDragHelperçš„: SwipeBackLayout android-card-slide-panel FlowingDrawer 6. ä¸ªäººè¯„ä»·ViewDragHelperçš„å‡ºç°,å¤§å¤§ç®€åŒ–äº†æˆ‘ä»¬å¼€å‘ç›¸å…³è§¦æ‘¸å’Œæ‹–æ‹½åŠŸèƒ½çš„å¤æ‚åº¦å’Œä»£ç é‡,å¸®åŠ©æˆ‘ä»¬æ¯”è¾ƒå®¹æ˜“çš„å®ç°å„ç§æ•ˆæœ,è®©æˆ‘ä»¬å¼€å‘é…·ç‚«çš„äº¤äº’æ›´åŠ å®¹æ˜“äº†ã€‚ä½†æ˜¯ä»ä¸€äº›å¼€æºé¡¹ç›®ä¸­å‘ç°,ViewDragHelperä¸­è¿˜æ˜¯æœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„,æ¯”å¦‚ç»™Scrolleræä¾›äº†ä¸€ä¸ªå›ºå®šçš„Interpolator,å¯¼è‡´å¦‚æœæˆ‘ä»¬æƒ³å®ç°ä¾‹å¦‚åå¼¹æ•ˆæœçš„è¯,è¿˜è¦æŠŠViewDragHelperçš„ä»£ç æ‹·è´ä¸€ä»½å¹¶ä¿®æ”¹Interpolator,è¿™æ ·åšè‚¯å®šæ˜¯ä¸å¤ªå¥½çš„.å½“ç„¶å»ºè®®æˆ‘ä»¬è‡ªå·±ä¿®æ”¹ä¸€ä¸ªViewDragHelperåå¦‚æœé¡¹ç›®é‡Œæœ‰å¤šå¤„ä½¿ç”¨,å¯ä»¥åŒ…è£…æˆä¸€ä¸ªæä¾›ç»™æˆ‘ä»¬è‡ªå·±é¡¹ç›®çš„æ¨¡å—ä½¿ç”¨,é˜²æ­¢å‡ºç°æ›´å¤šçš„å¤šä½™ä»£ç  å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"TextViewæºç è§£æ","date":"2017-07-26T12:07:19.000Z","path":"2017/07/26/TextViewæºç è§£æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ TextViewæºç è§£æ1.ç®€ä»‹ TextViewä½œä¸ºAndroidç³»ç»Ÿä¸Šæ˜¾ç¤ºå’Œæ’ç‰ˆæ–‡å­—ä»¥åŠæä¾›å¯¹æ–‡å­—çš„å¢åˆ æ”¹æŸ¥ã€å›¾æ–‡æ··æ’ç­‰åŠŸèƒ½çš„æ§ä»¶ï¼Œå†…éƒ¨æ˜¯ç›¸å¯¹æ¯”è¾ƒå¤æ‚çš„ã€‚è¿™ä¹ˆä¸€ä¸ªå¤æ‚çš„æ§ä»¶è‡ªç„¶éœ€è¦ä¾èµ–äºä¸€äº›å…¶ä»–çš„è¾…åŠ©ç±»ï¼Œä¾‹å¦‚ï¼šLayoutä»¥åŠLayoutçš„ç›¸å…³å­ç±»ã€Spanç›¸å…³çš„ç±»ã€MovementMethodæ¥å£ã€TransformationMethodæ¥å£ç­‰ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»TextViewçš„ç»“æ„å’Œå†…éƒ¨å¤„ç†æ–‡å­—çš„æµç¨‹ä»¥åŠTextViewç›¸å…³çš„è¾…åŠ©ç±»åœ¨TextViewå¤„ç†æ–‡å­—è¿‡ç¨‹ä¸­çš„ä½œç”¨ã€‚ 2.TextViewçš„å†…éƒ¨ç»“æ„å’Œè¾…åŠ©ç±»TextViewå†…éƒ¨é™¤äº†ç»§æ‰¿è‡ªViewçš„ç›¸å…³å±æ€§å’Œmeasureã€layoutã€drawæ­¥éª¤ï¼Œè¿˜åŒ…æ‹¬ï¼š Layout: TextViewçš„æ–‡å­—æ’ç‰ˆã€æŠ˜è¡Œç­–ç•¥ä»¥åŠæ–‡æœ¬ç»˜åˆ¶éƒ½æ˜¯åœ¨Layouté‡Œé¢å®Œæˆçš„ï¼ŒTextViewçš„è‡ªèº«æµ‹é‡ä¹Ÿå—Layoutçš„å½±å“ã€‚Layoutæ˜¯TextViewæ‰§è¡ŒsetTextæ–¹æ³•åï¼Œç”±TextViewå†…éƒ¨åˆ›å»ºçš„å®ä¾‹ï¼Œå¹¶ä¸èƒ½ç”±å¤–éƒ¨æä¾›ã€‚å¯ä»¥ç”¨getLayout()æ–¹æ³•è·å–ã€‚ TransformationMethod: ç”¨æ¥å¤„ç†æœ€ç»ˆçš„æ˜¾ç¤ºç»“æœçš„ç±»ï¼Œä¾‹å¦‚æ˜¾ç¤ºå¯†ç çš„æ—¶å€™æŠŠå¯†ç è½¬æ¢æˆåœ†ç‚¹ã€‚è¿™ä¸ªç±»å¹¶ä¸ç›´æ¥å½±å“TextViewå†…éƒ¨å‚¨å­˜çš„Textï¼Œåªå½±å“æ˜¾ç¤ºçš„ç»“æœã€‚ MovementMethod: ç”¨æ¥å¤„ç†TextViewå†…éƒ¨äº‹ä»¶å“åº”çš„ç±»ï¼Œå¯ä»¥é’ˆå¯¹TextViewå†…æ–‡æœ¬çš„æŸä¸€ä¸ªåŒºåŸŸåšè½¯é”®ç›˜è¾“å…¥æˆ–è€…è§¦æ‘¸äº‹ä»¶çš„å“åº”ã€‚ Drawables: TextViewçš„é™æ€å†…éƒ¨ç±»ï¼Œç”¨æ¥å¤„ç†å’Œå‚¨å­˜TextViewçš„CompoundDrawables,åŒ…æ‹¬TextViewçš„ä¸Šä¸‹å·¦å³çš„Drawableä»¥åŠé”™è¯¯æç¤ºçš„Drawableã€‚ Spans: Spanså¹¶ä¸æ˜¯ç‰¹å®šçš„æŸä¸€ä¸ªç±»æˆ–è€…å®ç°äº†æŸä¸€ä¸ªæ¥å£çš„ç±»ã€‚å®ƒå¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼ŒSpanså®é™…ä¸Šåšçš„äº‹æƒ…æ˜¯åœ¨TextViewçš„å†…éƒ¨çš„textçš„æŸä¸€ä¸ªåŒºåŸŸåšæ ‡è®°ã€‚å…¶ä¸­æœ‰éƒ¨åˆ†Spanså¯ä»¥å½±å“TextViewçš„ç»˜åˆ¶å’Œæµ‹é‡ï¼Œå¦‚ImageSpanã€BackgroundColorSpanã€AbsoluteSizeSpanã€‚è¿˜æœ‰å¯ä»¥å“åº”ç‚¹å‡»äº‹ä»¶çš„ClickableSpanã€‚ Editor: TextViewä½œä¸ºå¯ç¼–è¾‘æ–‡æœ¬æ§ä»¶çš„æ—¶å€™(EditText)ï¼Œä½¿ç”¨Editoræ¥å¤„ç†æ–‡æœ¬çš„åŒºåŸŸé€‰æ‹©å¤„ç†å’Œåˆ¤æ–­ã€æ‹¼å†™æ£€æŸ¥ã€å¼¹å‡ºæ–‡æœ¬èœå•ç­‰ã€‚ InputConnection: EditTextçš„æ–‡æœ¬è¾“å…¥éƒ¨åˆ†æ˜¯åœ¨TextViewä¸­å®Œæˆçš„ã€‚è€ŒInputConnectionæ˜¯è½¯é”®ç›˜å’ŒTextViewä¹‹é—´çš„æ¡¥æ¢ï¼Œæ‰€æœ‰çš„è½¯é”®ç›˜çš„è¾“å…¥æ–‡å­—ã€ä¿®æ”¹æ–‡å­—å’Œåˆ é™¤æ–‡å­—éƒ½æ˜¯é€šè¿‡InputConnectionä¼ é€’ç»™TextViewçš„ã€‚ 3.TextViewçš„onTouchEventå¤„ç†TextViewå†…éƒ¨èƒ½å¤„ç†è§¦æ‘¸äº‹ä»¶çš„ï¼ŒåŒ…æ‹¬è‡ªèº«çš„è§¦æ‘¸å¤„ç†ã€Editorçš„onTouchEventã€MovementMethodçš„onTouchEventã€‚Editorçš„onTouchEventä¸»è¦å¤„ç†å‡ºäºç¼–è¾‘çŠ¶æ€ä¸‹çš„è§¦æ‘¸äº‹ä»¶ï¼Œæ¯”å¦‚ç‚¹å‡»é€‰ä¸­ã€é•¿æŒ‰ç­‰ã€‚MovementMethodåˆ™ä¸»è¦è´Ÿè´£æ–‡æœ¬å†…éƒ¨æœ‰Spançš„æ—¶å€™çš„ç›¸å…³å¤„ç†ï¼Œæ¯”è¾ƒå¸¸è§çš„å°±æ˜¯LinkMovementMethodå¤„ç†ClickableSpançš„ç‚¹å‡»äº‹ä»¶ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹TextViewå†…éƒ¨å¯¹è¿™äº›è§¦æ‘¸äº‹ä»¶çš„å¤„ç†å’Œä¼˜å…ˆçº§çš„åˆ†é…ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687public boolean onTouchEvent(MotionEvent event) &#123; final int action = event.getActionMasked(); //å½“Editorä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œç»™Editorçš„åŒå‡»äº‹ä»¶é¢„è®¾å€¼ if (mEditor != null &amp;&amp; action == MotionEvent.ACTION_DOWN) &#123; if (mFirstTouch &amp;&amp; (SystemClock.uptimeMillis() - mLastTouchUpTime) &lt;= ViewConfiguration.getDoubleTapTimeout()) &#123; mEditor.mDoubleTap = true; mFirstTouch = false; &#125; else &#123; mEditor.mDoubleTap = false; mFirstTouch = true; &#125; &#125; if (action == MotionEvent.ACTION_UP) &#123; mLastTouchUpTime = SystemClock.uptimeMillis(); &#125; //å½“Editorä¸ä¸ºç©ºï¼Œä¼˜å…ˆå¤„ç†Editorçš„è§¦æ‘¸äº‹ä»¶ if (mEditor != null) &#123; mEditor.onTouchEvent(event); //ç”±äºEditorå†…éƒ¨onTouchEventå®é™…ä¸Šäº¤ç»™äº†mSelectionModifierCursorControllerå¤„ç†ï¼Œæ‰€ä»¥è¿™è¾¹åˆ¤æ–­mSelectionModifierCursorControlleræ˜¯å¦éœ€è¦å¤„ç†æ¥ä¸‹æ¥çš„ä¸€ç³»åˆ—äº‹ä»¶ï¼Œå¦‚æœæ˜¯åˆ™ç›´æ¥è¿”å›è·³è¿‡ä¸‹é¢çš„æ­¥éª¤ if (mEditor.mSelectionModifierCursorController != null &amp;&amp; mEditor.mSelectionModifierCursorController.isDragAcceleratorActive()) &#123; return true; &#125; &#125; final boolean superResult = super.onTouchEvent(event); //å¤„ç†API 23æ–°åŠ å…¥çš„InsertionActinoMode if (mEditor != null &amp;&amp; mEditor.mDiscardNextActionUp &amp;&amp; action == MotionEvent.ACTION_UP) &#123; mEditor.mDiscardNextActionUp = false; if (mEditor.mIsInsertionActionModeStartPending) &#123; mEditor.startInsertionActionMode(); mEditor.mIsInsertionActionModeStartPending = false; &#125; return superResult; &#125; final boolean touchIsFinished = (action == MotionEvent.ACTION_UP) &amp;&amp; (mEditor == null || !mEditor.mIgnoreActionUpEvent) &amp;&amp; isFocused(); if ((mMovement != null || onCheckIsTextEditor()) &amp;&amp; isEnabled() &amp;&amp; mText instanceof Spannable &amp;&amp; mLayout != null) &#123; boolean handled = false; //MovementMethodçš„è§¦æ‘¸æ—¶é—´å¤„ç†ï¼Œå¦‚æœMovementMethodç±»å‹æ˜¯LinkMovementMethodåˆ™ä¼šå¤„ç†æ–‡æœ¬å†…çš„æ‰€æœ‰ClickableSpançš„ç‚¹å‡» if (mMovement != null) &#123; handled |= mMovement.onTouchEvent(this, (Spannable) mText, event); &#125; final boolean textIsSelectable = isTextSelectable(); if (touchIsFinished &amp;&amp; mLinksClickable &amp;&amp; mAutoLinkMask != 0 &amp;&amp; textIsSelectable) &#123; //åœ¨æ–‡æœ¬å¯é€‰æ‹©çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰LinkMovementMethodæ¥å¤„ç†ClickableSpanç›¸å…³çš„ç‚¹å‡»çš„ï¼Œæ‰€ä»¥åœ¨æ–‡æœ¬å¯é€‰æ‹©æƒ…å†µï¼ŒTextViewå¯¹æ‰€æœ‰çš„ClickableSpanè¿›è¡Œç»Ÿä¸€å¤„ç† ClickableSpan[] links = ((Spannable) mText).getSpans(getSelectionStart(), getSelectionEnd(), ClickableSpan.class); if (links.length &gt; 0) &#123; links[0].onClick(this); handled = true; &#125; &#125; if (touchIsFinished &amp;&amp; (isTextEditable() || textIsSelectable)) &#123; final InputMethodManager imm = InputMethodManager.peekInstance(); viewClicked(imm); if (!textIsSelectable &amp;&amp; mEditor.mShowSoftInputOnFocus) &#123; handled |= imm != null &amp;&amp; imm.showSoftInput(this, 0); &#125; mEditor.onTouchUpEvent(event); handled = true; &#125; if (handled) &#123; return true; &#125; &#125; return superResult; &#125; 4.TextViewçš„åˆ›å»ºLayoutçš„è¿‡ç¨‹TextViewå†…éƒ¨å¹¶ä¸ä»…ä»…åªæœ‰ä¸€ä¸ªç”¨æ¥æ˜¾ç¤ºæ–‡æœ¬å†…å®¹çš„Layoutï¼Œåœ¨è®¾ç½®äº†hintçš„æ—¶å€™ï¼Œè¿˜éœ€è¦æœ‰ä¸€ä¸ªmHintLayoutæ¥å¤„ç†hintçš„å†…å®¹ã€‚å¦‚æœè®¾ç½®äº†Ellipsizeç±»å‹ä¸ºMarqueeæ—¶ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªmSavedMarqueeModeLayoutä¸“é—¨ç”¨æ¥æ˜¾ç¤ºmarqueeæ•ˆæœã€‚è¿™äº›Layoutéƒ½æ˜¯é€šè¿‡å†…éƒ¨çš„makeNewLayoutæ–¹æ³•æ¥åˆ›å»ºçš„ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138protected void makeNewLayout(int wantWidth, int hintWidth BoringLayout.Metrics boring, BoringLayout.Metrics hintBoring, int ellipsisWidth, boolean bringIntoView) &#123; //å¦‚æœå½“å‰æœ‰marqueeåŠ¨ç”»ï¼Œåˆ™å…ˆåœæ­¢åŠ¨ç”» stopMarquee(); mOldMaximum = mMaximum; mOldMaxMode = mMaxMode; mHighlightPathBogus = true; if (wantWidth &lt; 0) &#123; wantWidth = 0; &#125; if (hintWidth &lt; 0) &#123; hintWidth = 0; &#125; //æ–‡æœ¬å¯¹é½æ–¹å¼ Layout.Alignment alignment = getLayoutAlignment(); final boolean testDirChange = mSingleLine &amp;&amp; mLayout != null &amp;&amp; (alignment == Layout.Alignment.ALIGN_NORMAL || alignment == Layout.Alignment.ALIGN_OPPOSITE); int oldDir = 0; if (testDirChange) oldDir = mLayout.getParagraphDirection(0); //æ£€æµ‹æ˜¯å¦è®¾ç½®äº†ellipsize boolean shouldEllipsize = mEllipsize != null &amp;&amp; getKeyListener() == null; final boolean switchEllipsize = mEllipsize == TruncateAt.MARQUEE &amp;&amp; mMarqueeFadeMode != MARQUEE_FADE_NORMAL; TruncateAt effectiveEllipsize = mEllipsize; if (mEllipsize == TruncateAt.MARQUEE &amp;&amp; mMarqueeFadeMode == MARQUEE_FADE_SWITCH_SHOW_ELLIPSIS) &#123; effectiveEllipsize = TruncateAt.END_SMALL; &#125; //æ–‡æœ¬æ–¹å‘ if (mTextDir == null) &#123; mTextDir = getTextDirectionHeuristic(); &#125; //åˆ›å»ºä¸»Layout mLayout = makeSingleLayout(wantWidth, boring, ellipsisWidth, alignment, shouldEllipsize, effectiveEllipsize, effectiveEllipsize == mEllipsize); //éå¸¸è§„çš„Marqueeæ¨¡å¼ä¸‹ï¼Œéœ€è¦åˆ›å»ºmSavedMarqueeModeLayoutæ¥ä¿å­˜marqueeåŠ¨ç”»æ—¶æ‰€ç”¨çš„Layoutï¼Œå¹¶ä¸”åœ¨åŠ¨ç”»æœŸé—´æŠŠå®ƒå’ŒTextViewçš„ä¸»Layoutå¯¹æ¢ if (switchEllipsize) &#123; TruncateAt oppositeEllipsize = effectiveEllipsize == TruncateAt.MARQUEE ? TruncateAt.END : TruncateAt.MARQUEE; mSavedMarqueeModeLayout = makeSingleLayout(wantWidth, boring, ellipsisWidth, alignment, shouldEllipsize, oppositeEllipsize, effectiveEllipsize != mEllipsize); &#125; shouldEllipsize = mEllipsize != null; mHintLayout = null; //åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ›å»ºhintLayout if (mHint != null) &#123; if (shouldEllipsize) hintWidth = wantWidth; if (hintBoring == UNKNOWN_BORING) &#123; hintBoring = BoringLayout.isBoring(mHint, mTextPaint, mTextDir, mHintBoring); if (hintBoring != null) &#123; mHintBoring = hintBoring; &#125; &#125; //åˆ¤æ–­æ˜¯å¦ä¸ºboringï¼Œå¦‚æœæ˜¯åˆ™åˆ›å»ºBoringLayout if (hintBoring != null) &#123; if (hintBoring.width &lt;= hintWidth &amp;&amp; (!shouldEllipsize || hintBoring.width &lt;= ellipsisWidth)) &#123; if (mSavedHintLayout != null) &#123; mHintLayout = mSavedHintLayout. replaceOrMake(mHint, mTextPaint, hintWidth, alignment, mSpacingMult, mSpacingAdd, hintBoring, mIncludePad); &#125; else &#123; mHintLayout = BoringLayout.make(mHint, mTextPaint, hintWidth, alignment, mSpacingMult, mSpacingAdd, hintBoring, mIncludePad); &#125; mSavedHintLayout = (BoringLayout) mHintLayout; &#125; else if (shouldEllipsize &amp;&amp; hintBoring.width &lt;= hintWidth) &#123; if (mSavedHintLayout != null) &#123; mHintLayout = mSavedHintLayout. replaceOrMake(mHint, mTextPaint, hintWidth, alignment, mSpacingMult, mSpacingAdd, hintBoring, mIncludePad, mEllipsize, ellipsisWidth); &#125; else &#123; mHintLayout = BoringLayout.make(mHint, mTextPaint, hintWidth, alignment, mSpacingMult, mSpacingAdd, hintBoring, mIncludePad, mEllipsize, ellipsisWidth); &#125; &#125; &#125; //ä¸æ˜¯boringçš„çŠ¶æ€ä¸‹ï¼Œç”¨StaticLayoutæ¥åˆ›å»º if (mHintLayout == null) &#123; StaticLayout.Builder builder = StaticLayout.Builder.obtain(mHint, 0, mHint.length(), mTextPaint, hintWidth) .setAlignment(alignment) .setTextDirection(mTextDir) .setLineSpacing(mSpacingAdd, mSpacingMult) .setIncludePad(mIncludePad) .setBreakStrategy(mBreakStrategy) .setHyphenationFrequency(mHyphenationFrequency); if (shouldEllipsize) &#123; builder.setEllipsize(mEllipsize) .setEllipsizedWidth(ellipsisWidth) .setMaxLines(mMaxMode == LINES ? mMaximum : Integer.MAX_VALUE); &#125; mHintLayout = builder.build(); &#125; &#125; if (bringIntoView || (testDirChange &amp;&amp; oldDir != mLayout.getParagraphDirection(0))) &#123; registerForPreDraw(); &#125; //åˆ¤æ–­æ˜¯å¦éœ€è¦å¼€å§‹MarqueeåŠ¨ç”» if (mEllipsize == TextUtils.TruncateAt.MARQUEE) &#123; if (!compressText(ellipsisWidth)) &#123; final int height = mLayoutParams.height; if (height != LayoutParams.WRAP_CONTENT &amp;&amp; height != LayoutParams.MATCH_PARENT) &#123; startMarquee(); &#125; else &#123; mRestartMarquee = true; &#125; &#125; &#125; if (mEditor != null) mEditor.prepareCursorControllers(); &#125; TextViewçš„å¸ƒå±€åˆ›å»ºè¿‡ç¨‹æ¶‰åŠåˆ°ä¸€ä¸ªboringçš„æ¦‚å¿µï¼Œboringæ˜¯æŒ‡å¸ƒå±€æ‰€ç”¨çš„æ–‡æœ¬é‡Œé¢ä¸åŒ…å«ä»»ä½•Spanï¼Œæ‰€æœ‰çš„æ–‡æœ¬æ–¹å‘éƒ½æ˜¯ä»å·¦åˆ°å³çš„å¸ƒå±€ï¼Œå¹¶ä¸”ä»…éœ€ä¸€è¡Œå°±èƒ½æ˜¾ç¤ºå®Œå…¨çš„å¸ƒå±€ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒTextViewä¼šä½¿ç”¨BoringLayoutç±»æ¥åˆ›å»ºç›¸å…³çš„å¸ƒå±€ï¼Œä»¥èŠ‚çœä¸å¿…è¦çš„æ–‡æœ¬æµ‹é‡ä»¥åŠæ–‡æœ¬æŠ˜è¡Œã€Spanå®½åº¦ã€æ–‡æœ¬æ–¹å‘ç­‰çš„è®¡ç®—ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹makeNewLayoutä¸­ä½¿ç”¨é¢‘ç‡æ¯”è¾ƒé«˜çš„makeSingleLayoutçš„ä»£ç : 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273private Layout makeSingleLayout(int wantWidth, BoringLayout.Metrics boring, int ellipsisWidth, Layout.Alignment alignment, boolean shouldEllipsize, TruncateAt effectiveEllipsize, boolean useSaved) &#123; Layout result = null; //åˆ¤æ–­æ˜¯å¦Spannableï¼Œå¦‚æœæ˜¯åˆ™ç”¨DynamicLayoutç±»æ¥åˆ›å»ºå¸ƒå±€ï¼ŒDynamicLayoutå†…éƒ¨å®é™…ä¹Ÿæ˜¯ä½¿ç”¨StaticLayoutæ¥åšæ–‡æœ¬çš„æµ‹é‡ç»˜åˆ¶ï¼Œå¹¶åœ¨StaticLayoutçš„åŸºç¡€ä¸Šå¢åŠ äº†æ–‡æœ¬æˆ–è€…Spanæ”¹å˜æ—¶çš„ç›‘å¬ï¼ŒåŠæ—¶å¯¹æ–‡æœ¬æˆ–è€…Spançš„å˜åŒ–åšå‡ºååº”ã€‚ if (mText instanceof Spannable) &#123; result = new DynamicLayout(mText, mTransformed, mTextPaint, wantWidth, alignment, mTextDir, mSpacingMult, mSpacingAdd, mIncludePad, mBreakStrategy, mHyphenationFrequency, getKeyListener() == null ? effectiveEllipsize : null, ellipsisWidth); &#125; else &#123; //å¦‚æœboringæ˜¯æœªçŸ¥çŠ¶æ€ï¼Œåˆ™é‡æ–°åˆ¤æ–­ä¸€æ¬¡æ˜¯å¦boring if (boring == UNKNOWN_BORING) &#123; boring = BoringLayout.isBoring(mTransformed, mTextPaint, mTextDir, mBoring); if (boring != null) &#123; mBoring = boring; &#125; &#125; //æ ¹æ®boringçš„å±æ€§æ¥åˆ›å»ºå¯¹åº”çš„å¸ƒå±€ï¼Œå¦‚æœæœ‰mSavedLayoutåˆ™ä»mSavedLayoutåˆ›å»º if (boring != null) &#123; if (boring.width &lt;= wantWidth &amp;&amp; (effectiveEllipsize == null || boring.width &lt;= ellipsisWidth)) &#123; if (useSaved &amp;&amp; mSavedLayout != null) &#123; //ä»ä¹‹å‰ä¿å­˜çš„Layoutä¸­åˆ›å»º result = mSavedLayout.replaceOrMake(mTransformed, mTextPaint, wantWidth, alignment, mSpacingMult, mSpacingAdd, boring, mIncludePad); &#125; else &#123; //åˆ›å»ºæ–°çš„Layout result = BoringLayout.make(mTransformed, mTextPaint, wantWidth, alignment, mSpacingMult, mSpacingAdd, boring, mIncludePad); &#125; if (useSaved) &#123; mSavedLayout = (BoringLayout) result; &#125; &#125; else if (shouldEllipsize &amp;&amp; boring.width &lt;= wantWidth) &#123; if (useSaved &amp;&amp; mSavedLayout != null) &#123; result = mSavedLayout.replaceOrMake(mTransformed, mTextPaint, wantWidth, alignment, mSpacingMult, mSpacingAdd, boring, mIncludePad, effectiveEllipsize, ellipsisWidth); &#125; else &#123; result = BoringLayout.make(mTransformed, mTextPaint, wantWidth, alignment, mSpacingMult, mSpacingAdd, boring, mIncludePad, effectiveEllipsize, ellipsisWidth); &#125; &#125; &#125; &#125; //å¦‚æœæ²¡æœ‰åˆ›å»ºBoringLayout, åˆ™ä½¿ç”¨StaticLayoutç±»æ¥åˆ›å»ºå¸ƒå±€ if (result == null) &#123; StaticLayout.Builder builder = StaticLayout.Builder.obtain(mTransformed, 0, mTransformed.length(), mTextPaint, wantWidth) .setAlignment(alignment) .setTextDirection(mTextDir) .setLineSpacing(mSpacingAdd, mSpacingMult) .setIncludePad(mIncludePad) .setBreakStrategy(mBreakStrategy) .setHyphenationFrequency(mHyphenationFrequency); if (shouldEllipsize) &#123; builder.setEllipsize(effectiveEllipsize) .setEllipsizedWidth(ellipsisWidth) .setMaxLines(mMaxMode == LINES ? mMaximum : Integer.MAX_VALUE); &#125; result = builder.build(); &#125; return result; &#125; 5.TextViewçš„æ–‡å­—å¤„ç†å’Œç»˜åˆ¶TextViewä¸»è¦çš„æ–‡å­—æ’ç‰ˆå’Œæ¸²æŸ“å¹¶ä¸æ˜¯åœ¨TextViewé‡Œé¢å®Œæˆçš„ï¼Œè€Œæ˜¯ç”±Layoutç±»æ¥å¤„ç†æ–‡å­—æ’ç‰ˆå·¥ä½œã€‚åœ¨å•çº¯åœ°ä½¿ç”¨TextViewæ¥å±•ç¤ºé™æ€æ–‡æœ¬çš„æ—¶å€™ï¼Œè¿™ä»¶äº‹æƒ…åˆ™æ˜¯ç”±Layoutçš„å­ç±»StaticLayoutæ¥å®Œæˆçš„ã€‚ StaticLayoutæ¥æ”¶åˆ°å­—ç¬¦ä¸²åï¼Œé¦–å…ˆåšçš„äº‹æƒ…æ˜¯æ ¹æ®å­—ç¬¦ä¸²é‡Œé¢çš„æ¢è¡Œç¬¦å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ‹†åˆ†ã€‚ 123456for (int paraStart = bufStart; paraStart &lt;= bufEnd; paraStart = paraEnd) &#123; paraEnd = TextUtils.indexOf(source, CHAR_NEW_LINE, paraStart, bufEnd); if (paraEnd &lt; 0) paraEnd = bufEnd; else paraEnd++; æ‹†åˆ†åçš„æ®µè½(Paragraph)è¢«åˆ†é…ç»™è¾…åŠ©ç±»MeasuredTextè¿›è¡Œæµ‹é‡å¾—åˆ°æ¯ä¸ªå­—ç¬¦çš„å®½åº¦ä»¥åŠæ¯ä¸ªæ®µè½çš„FontMetricã€‚å¹¶é€šè¿‡LineBreakerè¿›è¡ŒæŠ˜è¡Œçš„åˆ¤æ–­ 1234567//æŠŠæ®µè½è½½å…¥åˆ°MeasuredTextä¸­ï¼Œå¹¶åˆ†é…å¯¹åº”çš„ç¼“å­˜ç©ºé—´measured.setPara(source, paraStart, paraEnd, textDir, b); char[] chs = measured.mChars; float[] widths = measured.mWidths; byte[] chdirs = measured.mLevels; int dir = measured.mDir; boolean easy = measured.mEasy; //æŠŠç›¸å…³å±æ€§ä¼ ç»™JNIå±‚çš„LineBreaker nSetupParagraph(b.mNativePtr, chs, paraEnd - paraStart, firstWidth, firstWidthLineCount, restWidth, variableTabStops, TAB_INCREMENT, b.mBreakStrategy, b.mHyphenationFrequency); 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647int fmCacheCount = 0;int spanEndCacheCount = 0;for (int spanStart = paraStart, spanEnd; spanStart &lt; paraEnd; spanStart = spanEnd) &#123; if (fmCacheCount * 4 &gt;= fmCache.length) &#123; int[] grow = new int[fmCacheCount * 4 * 2]; System.arraycopy(fmCache, 0, grow, 0, fmCacheCount * 4); fmCache = grow; &#125; if (spanEndCacheCount &gt;= spanEndCache.length) &#123; int[] grow = new int[spanEndCacheCount * 2]; System.arraycopy(spanEndCache, 0, grow, 0, spanEndCacheCount); spanEndCache = grow; &#125; if (spanned == null) &#123; spanEnd = paraEnd; int spanLen = spanEnd - spanStart; //æ®µè½æ²¡æœ‰Spançš„æƒ…å†µä¸‹ï¼ŒæŠŠæ•´ä¸ªæ®µè½äº¤ç»™MeasuredTextè®¡ç®—æ¯ä¸ªå­—ç¬¦çš„å®½åº¦å’ŒFontMetric measured.addStyleRun(paint, spanLen, fm); &#125; else &#123; spanEnd = spanned.nextSpanTransition(spanStart, paraEnd, MetricAffectingSpan.class); int spanLen = spanEnd - spanStart; MetricAffectingSpan[] spans = spanned.getSpans(spanStart, spanEnd, MetricAffectingSpan.class); spans = TextUtils.removeEmptySpans(spans, spanned, MetricAffectingSpan.class); //æŠŠå¯¹æ’ç‰ˆæœ‰å½±å“çš„Spanäº¤ç»™MeasuredTextæµ‹é‡å®½åº¦å¹¶è®¡ç®—FontMetric measured.addStyleRun(paint, spans, spanLen, fm); &#125; //æŠŠæµ‹é‡åçš„FontMetricç¼“å­˜ä¸‹æ¥æ–¹ä¾¿åé¢ä½¿ç”¨ fmCache[fmCacheCount * 4 + 0] = fm.top; fmCache[fmCacheCount * 4 + 1] = fm.bottom; fmCache[fmCacheCount * 4 + 2] = fm.ascent; fmCache[fmCacheCount * 4 + 3] = fm.descent; fmCacheCount++; spanEndCache[spanEndCacheCount] = spanEnd; spanEndCacheCount++;&#125;nGetWidths(b.mNativePtr, widths);//è®¡ç®—æ®µè½ä¸­éœ€è¦æŠ˜è¡Œçš„ä½ç½®ï¼Œå¹¶è¿”å›æŠ˜è¡Œçš„æ•°é‡int breakCount = nComputeLineBreaks(b.mNativePtr, lineBreaks, lineBreaks.breaks, lineBreaks.widths, lineBreaks.flags, lineBreaks.breaks.length); è®¡ç®—å®Œæ¯ä¸€è¡Œçš„æµ‹é‡ç›¸å…³ä¿¡æ¯ã€Spanå®½é«˜ä»¥åŠæŠ˜è¡Œä½ç½®ï¼Œå°±å¯ä»¥å¼€å§‹æŒ‰ç…§æœ€ç»ˆçš„è¡Œæ•°ä¸€è¡Œä¸€è¡Œåœ°ä¿å­˜ä¸‹æ¥ï¼Œä»¥ä¾›åé¢ç»˜åˆ¶å’Œè·å–å¯¹åº”æ–‡æœ¬ä¿¡æ¯çš„æ—¶å€™ä½¿ç”¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657for (int spanStart = paraStart, spanEnd; spanStart &lt; paraEnd; spanStart = spanEnd) &#123; spanEnd = spanEndCache[spanEndCacheIndex++]; // è·å–ä¹‹å‰ç¼“å­˜çš„FontMetricä¿¡æ¯ fm.top = fmCache[fmCacheIndex * 4 + 0]; fm.bottom = fmCache[fmCacheIndex * 4 + 1]; fm.ascent = fmCache[fmCacheIndex * 4 + 2]; fm.descent = fmCache[fmCacheIndex * 4 + 3]; fmCacheIndex++; if (fm.top &lt; fmTop) &#123; fmTop = fm.top; &#125; if (fm.ascent &lt; fmAscent) &#123; fmAscent = fm.ascent; &#125; if (fm.descent &gt; fmDescent) &#123; fmDescent = fm.descent; &#125; if (fm.bottom &gt; fmBottom) &#123; fmBottom = fm.bottom; &#125; while (breakIndex &lt; breakCount &amp;&amp; paraStart + breaks[breakIndex] &lt; spanStart) &#123; breakIndex++; &#125; while (breakIndex &lt; breakCount &amp;&amp; paraStart + breaks[breakIndex] &lt;= spanEnd) &#123; int endPos = paraStart + breaks[breakIndex]; boolean moreChars = (endPos &lt; bufEnd); //é€è¡ŒæŠŠç›¸å…³ä¿¡æ¯å‚¨å­˜ä¸‹æ¥ v = out(source, here, endPos, fmAscent, fmDescent, fmTop, fmBottom, v, spacingmult, spacingadd, chooseHt, chooseHtv, fm, flags[breakIndex], needMultiply, chdirs, dir, easy, bufEnd, includepad, trackpad, chs, widths, paraStart, ellipsize, ellipsizedWidth, lineWidths[breakIndex], paint, moreChars); if (endPos &lt; spanEnd) &#123; fmTop = fm.top; fmBottom = fm.bottom; fmAscent = fm.ascent; fmDescent = fm.descent; &#125; else &#123; fmTop = fmBottom = fmAscent = fmDescent = 0; &#125; here = endPos; breakIndex++; if (mLineCount &gt;= mMaximumVisibleLineCount) &#123; return; &#125; &#125; &#125; è¿™æ ·StaticLayoutçš„æ’ç‰ˆè¿‡ç¨‹å°±å®Œæˆäº†ã€‚æ–‡æœ¬çš„ç»˜åˆ¶åˆ™æ˜¯äº¤ç»™çˆ¶ç±»Layoutæ¥åšçš„ï¼ŒLayoutçš„ç»˜åˆ¶åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼ŒdrawBackgroundå’ŒdrawTextã€‚drawBackgroundåšçš„äº‹æƒ…æ˜¯å¦‚æœæ–‡æœ¬å†…æœ‰LineBackgroundSpanåˆ™ç»˜åˆ¶æ‰€æœ‰çš„LineBackgroundSpanï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æœ‰é«˜äº®èƒŒæ™¯(æ–‡æœ¬é€‰ä¸­çš„èƒŒæ™¯)ï¼Œå¦‚æœæœ‰åˆ™ç»˜åˆ¶é«˜äº®èƒŒæ™¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566public void drawBackground(Canvas canvas, Path highlight, Paint highlightPaint, int cursorOffsetVertical, int firstLine, int lastLine) &#123; //åˆ¤æ–­å¹¶ç»˜åˆ¶LineBackgroundSpan if (mSpannedText) &#123; if (mLineBackgroundSpans == null) &#123; mLineBackgroundSpans = new SpanSet&lt;LineBackgroundSpan&gt;(LineBackgroundSpan.class); &#125; Spanned buffer = (Spanned) mText; int textLength = buffer.length(); mLineBackgroundSpans.init(buffer, 0, textLength); if (mLineBackgroundSpans.numberOfSpans &gt; 0) &#123; int previousLineBottom = getLineTop(firstLine); int previousLineEnd = getLineStart(firstLine); ParagraphStyle[] spans = NO_PARA_SPANS; int spansLength = 0; TextPaint paint = mPaint; int spanEnd = 0; final int width = mWidth; //é€è¡Œç»˜åˆ¶LineBackgroundSpan for (int i = firstLine; i &lt;= lastLine; i++) &#123; int start = previousLineEnd; int end = getLineStart(i + 1); previousLineEnd = end; int ltop = previousLineBottom; int lbottom = getLineTop(i + 1); previousLineBottom = lbottom; int lbaseline = lbottom - getLineDescent(i); if (start &gt;= spanEnd) &#123; spanEnd = mLineBackgroundSpans.getNextTransition(start, textLength); spansLength = 0; if (start != end || start == 0) &#123; //æ’é™¤ä¸åœ¨ç»˜åˆ¶èŒƒå›´å†…çš„LineBackgroundSpan for (int j = 0; j &lt; mLineBackgroundSpans.numberOfSpans; j++) &#123; if (mLineBackgroundSpans.spanStarts[j] &gt;= end || mLineBackgroundSpans.spanEnds[j] &lt;= start) continue; spans = GrowingArrayUtils.append( spans, spansLength, mLineBackgroundSpans.spans[j]); spansLength++; &#125; &#125; &#125; //å¯¹å½“å‰è¡Œå†…çš„LineBackgroundSpanè¿›è¡Œç»˜åˆ¶ for (int n = 0; n &lt; spansLength; n++) &#123; LineBackgroundSpan lineBackgroundSpan = (LineBackgroundSpan) spans[n]; lineBackgroundSpan.drawBackground(canvas, paint, 0, width, ltop, lbaseline, lbottom, buffer, start, end, i); &#125; &#125; &#125; mLineBackgroundSpans.recycle(); &#125; //åˆ¤æ–­å¹¶ç»˜åˆ¶é«˜äº®èƒŒæ™¯(å³é€‰ä¸­çš„æ–‡æœ¬) if (highlight != null) &#123; if (cursorOffsetVertical != 0) canvas.translate(0, cursorOffsetVertical); canvas.drawPath(highlight, highlightPaint); if (cursorOffsetVertical != 0) canvas.translate(0, -cursorOffsetVertical); &#125; &#125; drawTextç”¨æ¥é€è¡Œç»˜åˆ¶Layoutçš„æ–‡æœ¬ã€å½±å“æ˜¾ç¤ºæ•ˆæœçš„Spanã€ä»¥åŠEmojiè¡¨æƒ…ç­‰ã€‚å½“æœ‰Emojiæˆ–è€…Spançš„æ—¶å€™ï¼Œå®é™…ç»˜åˆ¶å·¥ä½œäº¤ç»™TextLineç±»æ¥å®Œæˆã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141public void drawText(Canvas canvas, int firstLine, int lastLine) &#123; int previousLineBottom = getLineTop(firstLine); int previousLineEnd = getLineStart(firstLine); ParagraphStyle[] spans = NO_PARA_SPANS; int spanEnd = 0; TextPaint paint = mPaint; CharSequence buf = mText; Alignment paraAlign = mAlignment; TabStops tabStops = null; boolean tabStopsIsInitialized = false; //è·å–TextLineå®ä¾‹ TextLine tl = TextLine.obtain(); //é€è¡Œç»˜åˆ¶æ–‡æœ¬ for (int lineNum = firstLine; lineNum &lt;= lastLine; lineNum++) &#123; int start = previousLineEnd; previousLineEnd = getLineStart(lineNum + 1); int end = getLineVisibleEnd(lineNum, start, previousLineEnd); int ltop = previousLineBottom; int lbottom = getLineTop(lineNum + 1); previousLineBottom = lbottom; int lbaseline = lbottom - getLineDescent(lineNum); int dir = getParagraphDirection(lineNum); int left = 0; int right = mWidth; if (mSpannedText) &#123; Spanned sp = (Spanned) buf; int textLength = buf.length(); //æ£€æµ‹æ˜¯å¦æ®µè½çš„ç¬¬ä¸€è¡Œ boolean isFirstParaLine = (start == 0 || buf.charAt(start - 1) == '\\n'); //è·å¾—æ‰€æœ‰çš„æ®µè½é£æ ¼ç›¸å…³çš„Span if (start &gt;= spanEnd &amp;&amp; (lineNum == firstLine || isFirstParaLine)) &#123; spanEnd = sp.nextSpanTransition(start, textLength, ParagraphStyle.class); spans = getParagraphSpans(sp, start, spanEnd, ParagraphStyle.class); paraAlign = mAlignment; for (int n = spans.length - 1; n &gt;= 0; n--) &#123; if (spans[n] instanceof AlignmentSpan) &#123; paraAlign = ((AlignmentSpan) spans[n]).getAlignment(); break; &#125; &#125; tabStopsIsInitialized = false; &#125; //è·å–å½±å“è¡Œç¼©è¿›çš„Span final int length = spans.length; boolean useFirstLineMargin = isFirstParaLine; for (int n = 0; n &lt; length; n++) &#123; if (spans[n] instanceof LeadingMarginSpan2) &#123; int count = ((LeadingMarginSpan2) spans[n]).getLeadingMarginLineCount(); int startLine = getLineForOffset(sp.getSpanStart(spans[n])); if (lineNum &lt; startLine + count) &#123; useFirstLineMargin = true; break; &#125; &#125; &#125; for (int n = 0; n &lt; length; n++) &#123; if (spans[n] instanceof LeadingMarginSpan) &#123; LeadingMarginSpan margin = (LeadingMarginSpan) spans[n]; if (dir == DIR_RIGHT_TO_LEFT) &#123; margin.drawLeadingMargin(canvas, paint, right, dir, ltop, lbaseline, lbottom, buf, start, end, isFirstParaLine, this); right -= margin.getLeadingMargin(useFirstLineMargin); &#125; else &#123; margin.drawLeadingMargin(canvas, paint, left, dir, ltop, lbaseline, lbottom, buf, start, end, isFirstParaLine, this); left += margin.getLeadingMargin(useFirstLineMargin); &#125; &#125; &#125; &#125; boolean hasTabOrEmoji = getLineContainsTab(lineNum); if (hasTabOrEmoji &amp;&amp; !tabStopsIsInitialized) &#123; if (tabStops == null) &#123; tabStops = new TabStops(TAB_INCREMENT, spans); &#125; else &#123; tabStops.reset(TAB_INCREMENT, spans); &#125; tabStopsIsInitialized = true; &#125; //åˆ¤æ–­å½“å‰è¡Œçš„ç¬¬äº”æ–¹å¼ Alignment align = paraAlign; if (align == Alignment.ALIGN_LEFT) &#123; align = (dir == DIR_LEFT_TO_RIGHT) ? Alignment.ALIGN_NORMAL : Alignment.ALIGN_OPPOSITE; &#125; else if (align == Alignment.ALIGN_RIGHT) &#123; align = (dir == DIR_LEFT_TO_RIGHT) ? Alignment.ALIGN_OPPOSITE : Alignment.ALIGN_NORMAL; &#125; int x; if (align == Alignment.ALIGN_NORMAL) &#123; if (dir == DIR_LEFT_TO_RIGHT) &#123; x = left + getIndentAdjust(lineNum, Alignment.ALIGN_LEFT); &#125; else &#123; x = right + getIndentAdjust(lineNum, Alignment.ALIGN_RIGHT); &#125; &#125; else &#123; int max = (int)getLineExtent(lineNum, tabStops, false); if (align == Alignment.ALIGN_OPPOSITE) &#123; if (dir == DIR_LEFT_TO_RIGHT) &#123; x = right - max + getIndentAdjust(lineNum, Alignment.ALIGN_RIGHT); &#125; else &#123; x = left - max + getIndentAdjust(lineNum, Alignment.ALIGN_LEFT); &#125; &#125; else &#123; // Alignment.ALIGN_CENTER max = max &amp; ~1; x = ((right + left - max) &gt;&gt; 1) + getIndentAdjust(lineNum, Alignment.ALIGN_CENTER); &#125; &#125; paint.setHyphenEdit(getHyphen(lineNum)); Directions directions = getLineDirections(lineNum); if (directions == DIRS_ALL_LEFT_TO_RIGHT &amp;&amp; !mSpannedText &amp;&amp; !hasTabOrEmoji) &#123; //æ²¡æœ‰ä»»ä½•Emojiæˆ–è€…spançš„æ—¶å€™ï¼Œç›´æ¥è°ƒç”¨Canvasæ¥ç»˜åˆ¶æ–‡æœ¬ canvas.drawText(buf, start, end, x, lbaseline, paint); &#125; else &#123; //å½“æœ‰Emojiæˆ–è€…Spançš„æ—¶å€™ï¼Œäº¤ç»™TextLineç±»æ¥ç»˜åˆ¶ tl.set(paint, buf, start, end, dir, directions, hasTabOrEmoji, tabStops); tl.draw(canvas, x, ltop, lbaseline, lbottom); &#125; paint.setHyphenEdit(0); &#125; TextLine.recycle(tl); &#125; æˆ‘ä»¬ä¸‹é¢å†æ¥çœ‹çœ‹TextLineæ˜¯å¦‚ä½•ç»˜åˆ¶æœ‰ç‰¹æ®Šæƒ…å†µçš„æ–‡æœ¬çš„ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475void draw(Canvas c, float x, int top, int y, int bottom) &#123; //åˆ¤æ–­æ˜¯å¦æœ‰Tabæˆ–è€…Emoji if (!mHasTabs) &#123; if (mDirections == Layout.DIRS_ALL_LEFT_TO_RIGHT) &#123; drawRun(c, 0, mLen, false, x, top, y, bottom, false); return; &#125; if (mDirections == Layout.DIRS_ALL_RIGHT_TO_LEFT) &#123; drawRun(c, 0, mLen, true, x, top, y, bottom, false); return; &#125; &#125; float h = 0; int[] runs = mDirections.mDirections; RectF emojiRect = null; int lastRunIndex = runs.length - 2; //é€ä¸ªç»˜åˆ¶ for (int i = 0; i &lt; runs.length; i += 2) &#123; int runStart = runs[i]; int runLimit = runStart + (runs[i+1] &amp; Layout.RUN_LENGTH_MASK); if (runLimit &gt; mLen) &#123; runLimit = mLen; &#125; boolean runIsRtl = (runs[i+1] &amp; Layout.RUN_RTL_FLAG) != 0; int segstart = runStart; for (int j = mHasTabs ? runStart : runLimit; j &lt;= runLimit; j++) &#123; int codept = 0; Bitmap bm = null; if (mHasTabs &amp;&amp; j &lt; runLimit) &#123; codept = mChars[j]; if (codept &gt;= 0xd800 &amp;&amp; codept &lt; 0xdc00 &amp;&amp; j + 1 &lt; runLimit) &#123; codept = Character.codePointAt(mChars, j); if (codept &gt;= Layout.MIN_EMOJI &amp;&amp; codept &lt;= Layout.MAX_EMOJI) &#123; //è·å–Emojiå¯¹åº”çš„å›¾åƒ bm = Layout.EMOJI_FACTORY.getBitmapFromAndroidPua(codept); &#125; else if (codept &gt; 0xffff) &#123; ++j; continue; &#125; &#125; &#125; if (j == runLimit || codept == '\\t' || bm != null) &#123; //ç»˜åˆ¶æ–‡å­— h += drawRun(c, segstart, j, runIsRtl, x+h, top, y, bottom, i != lastRunIndex || j != mLen); if (codept == '\\t') &#123; h = mDir * nextTab(h * mDir); &#125; else if (bm != null) &#123; float bmAscent = ascent(j); float bitmapHeight = bm.getHeight(); float scale = -bmAscent / bitmapHeight; float width = bm.getWidth() * scale; if (emojiRect == null) &#123; emojiRect = new RectF(); &#125; //è°ƒæ•´emojiå›¾åƒç»˜åˆ¶çŸ©å½¢ emojiRect.set(x + h, y + bmAscent, x + h + width, y); //ç»˜åˆ¶Emojiå›¾åƒ c.drawBitmap(bm, null, emojiRect, mPaint); h += width; j++; &#125; segstart = j + 1; &#125; &#125; &#125; &#125; è¿™æ ·å°±å®Œæˆäº†æ–‡æœ¬çš„ç»˜åˆ¶å·¥ä½œï¼Œç®€å•åœ°æ€»ç»“å°±æ˜¯ï¼šåˆ†ææ•´ä½“æ–‡æœ¬â€”&gt;æ‹†åˆ†ä¸ºæ®µè½â€”&gt;è®¡ç®—æ•´ä½“æ®µè½çš„æ–‡æœ¬åŒ…æ‹¬Spançš„æµ‹é‡ä¿¡æ¯â€”&gt;å¯¹æ–‡æœ¬è¿›è¡ŒæŠ˜è¡Œâ€”&gt;æ ¹æ®æœ€ç»ˆè¡Œæ•°æŠŠæ–‡æœ¬æµ‹é‡ä¿¡æ¯ä¿å­˜â€”&gt;ç»˜åˆ¶æ–‡æœ¬çš„è¡ŒèƒŒæ™¯â€”&gt;åˆ¤æ–­å¹¶è·å–æ–‡æœ¬ç§çš„Spanå’ŒEmojiå›¾åƒâ€”&gt;ç»˜åˆ¶æœ€ç»ˆçš„æ–‡æœ¬å’Œå›¾åƒã€‚å½“ç„¶æˆ‘ä»¬çœç•¥äº†ä¸€éƒ¨åˆ†å†…å®¹ï¼Œæ¯”å¦‚æ®µè½æ–‡æœ¬æ–¹å‘ï¼Œå•è¡Œçš„æ–‡æœ¬æ’ç‰ˆæ–¹å‘çš„è®¡ç®—ï¼Œå®é™…çš„å¤„ç†è¦æ›´ä¸ºå¤æ‚ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨æµ‹é‡è¿‡ç¨‹ä¸­å‡ºç°çš„FontMetricsï¼Œè¿™æ˜¯ä¸€ä¸ªPaintçš„é™æ€å†…éƒ¨ç±»ã€‚ä¸»è¦ç”¨æ¥å‚¨å­˜æ–‡å­—æ’ç‰ˆçš„Yè½´ç›¸å…³ä¿¡æ¯ã€‚å†…éƒ¨ä»…åŒ…å«ascentã€descentã€topã€bottomã€leadingäº”ä¸ªæ•°å€¼ã€‚å¦‚ä¸‹å›¾: é™¤äº†leadingä»¥å¤–ï¼Œå…¶ä»–çš„æ•°å€¼éƒ½æ˜¯ç›¸å¯¹äºæ¯ä¸€è¡Œçš„baselineçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å…¶ä»–çš„æ•°å€¼éœ€è¦åŠ ä¸Šå¯¹åº”è¡Œçš„baselineæ‰èƒ½å¾—åˆ°æœ€ç»ˆçœŸå®çš„åæ ‡ã€‚ 6.TextViewæ¥æ”¶è½¯é”®ç›˜è¾“å…¥Androidä¸Šçš„æ ‡å‡†æ–‡æœ¬ç¼–è¾‘æ§ä»¶æ˜¯EditTextï¼Œè€ŒEditTextå¯¹è½¯é”®ç›˜è¾“å…¥çš„å¤„ç†ï¼Œå´æ˜¯åœ¨TextViewå†…éƒ¨å®ç°çš„ã€‚Androidä¸ºæ‰€æœ‰çš„Viewé¢„ç•™äº†ä¸€ä¸ªæ¥æ”¶è½¯é”®ç›˜è¾“å…¥çš„æ¥å£ç±»ï¼Œå«InputConnectionã€‚è½¯é”®ç›˜ä»¥InputConnectionä¸ºæ¡¥æ¢æŠŠæ–‡å­—è¾“å…¥ã€æ–‡å­—ä¿®æ”¹ã€æ–‡å­—åˆ é™¤ç­‰ä¼ é€’ç»™Viewã€‚ä»»æ„Viewåªè¦é‡å†™onCheckIsTextEditor()å¹¶è¿”å›trueï¼Œç„¶åé‡å†™onCreateInputConnection(EditorInfo outAttrs)è¿”å›ä¸€ä¸ªInputConnectionçš„å®ä¾‹ï¼Œä¾¿å¯ä»¥æ¥æ”¶è½¯é”®ç›˜çš„è¾“å…¥ã€‚TextViewçš„è½¯é”®ç›˜è¾“å…¥æ¥æ”¶ï¼Œæ˜¯é€šè¿‡EditableInputConnectionç±»æ¥å®ç°çš„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public InputConnection onCreateInputConnection(EditorInfo outAttrs) &#123; //åˆ¤æ–­æ˜¯å¦å¤„äºå¯ç¼–è¾‘çŠ¶æ€ if (onCheckIsTextEditor() &amp;&amp; isEnabled()) &#123; mEditor.createInputMethodStateIfNeeded(); //è®¾ç½®è¾“å…¥æ³•ç›¸å…³çš„ä¿¡æ¯ outAttrs.inputType = getInputType(); if (mEditor.mInputContentType != null) &#123; outAttrs.imeOptions = mEditor.mInputContentType.imeOptions; outAttrs.privateImeOptions = mEditor.mInputContentType.privateImeOptions; outAttrs.actionLabel = mEditor.mInputContentType.imeActionLabel; outAttrs.actionId = mEditor.mInputContentType.imeActionId; outAttrs.extras = mEditor.mInputContentType.extras; &#125; else &#123; outAttrs.imeOptions = EditorInfo.IME_NULL; &#125; if (focusSearch(FOCUS_DOWN) != null) &#123; outAttrs.imeOptions |= EditorInfo.IME_FLAG_NAVIGATE_NEXT; &#125; if (focusSearch(FOCUS_UP) != null) &#123; outAttrs.imeOptions |= EditorInfo.IME_FLAG_NAVIGATE_PREVIOUS; &#125; if ((outAttrs.imeOptions&amp;EditorInfo.IME_MASK_ACTION) == EditorInfo.IME_ACTION_UNSPECIFIED) &#123; if ((outAttrs.imeOptions&amp;EditorInfo.IME_FLAG_NAVIGATE_NEXT) != 0) &#123; //æŠŠè½¯é”®ç›˜çš„enterè®¾ä¸ºä¸‹ä¸€æ­¥ outAttrs.imeOptions |= EditorInfo.IME_ACTION_NEXT; &#125; else &#123; //æŠŠè½¯é”®ç›˜çš„enterè®¾ä¸ºå®Œæˆ outAttrs.imeOptions |= EditorInfo.IME_ACTION_DONE; &#125; if (!shouldAdvanceFocusOnEnter()) &#123; outAttrs.imeOptions |= EditorInfo.IME_FLAG_NO_ENTER_ACTION; &#125; &#125; if (isMultilineInputType(outAttrs.inputType)) &#123; outAttrs.imeOptions |= EditorInfo.IME_FLAG_NO_ENTER_ACTION; &#125; outAttrs.hintText = mHint; //åˆ¤æ–­TextViewå†…éƒ¨æ–‡æœ¬æ˜¯å¦å¯ç¼–è¾‘ if (mText instanceof Editable) &#123; //è¿”å›EditableInputConnectionå®ä¾‹ InputConnection ic = new EditableInputConnection(this); outAttrs.initialSelStart = getSelectionStart(); outAttrs.initialSelEnd = getSelectionEnd(); outAttrs.initialCapsMode = ic.getCursorCapsMode(getInputType()); return ic; &#125; &#125; return null; &#125; æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹EditableInputConnectioné‡Œé¢çš„å‡ ä¸ªä¸»è¦çš„æ–¹æ³•ï¼š é¦–å…ˆæ˜¯commitTextæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥æ”¶è¾“å…¥æ³•è¾“å…¥çš„å­—ç¬¦å¹¶æäº¤ç»™TextViewã€‚ 12345678910111213141516171819public boolean commitText(CharSequence text, int newCursorPosition) &#123; //åˆ¤æ–­TextViewæ˜¯å¦ä¸ºç©º if (mTextView == null) &#123; return super.commitText(text, newCursorPosition); &#125; //åˆ¤æ–­æ–‡æœ¬æ˜¯å¦Spanï¼Œæ¥è‡ªè¾“å…¥æ³•çš„Spanä¸€èˆ¬åªæœ‰SuggestionSpanï¼ŒSuggestionSpanæºå¸¦äº†è¾“å…¥æ³•çš„é”™åˆ«å­—ä¿®æ­£çš„è¯ if (text instanceof Spanned) &#123; Spanned spanned = ((Spanned) text); SuggestionSpan[] spans = spanned.getSpans(0, text.length(), SuggestionSpan.class); mIMM.registerSuggestionSpansForNotification(spans); &#125; mTextView.resetErrorChangedFlag(); //æäº¤å­—ç¬¦ boolean success = super.commitText(text, newCursorPosition); mTextView.hideErrorIfUnchanged(); //è¿”å›æ˜¯å¦æˆåŠŸ return success; &#125; getEditableæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¹¶ä¸æ˜¯InputConnectionæ¥å£çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯EditableInputConnectionçš„çˆ¶ç±»BaseInputConnectionçš„æ–¹æ³•ï¼Œç”¨æ¥è·å–ä¸€ä¸ªå¯ç¼–è¾‘å¯¹è±¡ï¼ŒEditableInputConnectioné‡Œé¢çš„æ‰€æœ‰ä¿®æ”¹éƒ½é’ˆå¯¹è¿™ä¸ªå¯ç¼–è¾‘å¯¹è±¡æ¥åšã€‚ 12345678public Editable getEditable() &#123; TextView tv = mTextView; if (tv != null) &#123; //è¿”å›TextViewçš„å¯ç¼–è¾‘å¯¹è±¡ return tv.getEditableText(); &#125; return null; &#125; deleteSurroundingTextæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥åˆ é™¤å…‰æ ‡å‰åçš„å†…å®¹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public boolean deleteSurroundingText(int beforeLength, int afterLength) &#123; if (DEBUG) Log.v(TAG, \"deleteSurroundingText \" + beforeLength + \" / \" + afterLength); final Editable content = getEditable(); if (content == null) return false; //æ‰¹é‡åˆ é™¤æ ‡è®° beginBatchEdit(); //è·å–å½“å‰å·²é€‰æ‹©çš„æ–‡æœ¬çš„ä½ç½® int a = Selection.getSelectionStart(content); int b = Selection.getSelectionEnd(content); if (a &gt; b) &#123; int tmp = a; a = b; b = tmp; &#125; int ca = getComposingSpanStart(content); int cb = getComposingSpanEnd(content); if (cb &lt; ca) &#123; int tmp = ca; ca = cb; cb = tmp; &#125; if (ca != -1 &amp;&amp; cb != -1) &#123; if (ca &lt; a) a = ca; if (cb &gt; b) b = cb; &#125; int deleted = 0; //åˆ é™¤å…‰æ ‡ä¹‹å‰çš„æ–‡æœ¬ if (beforeLength &gt; 0) &#123; int start = a - beforeLength; if (start &lt; 0) start = 0; content.delete(start, a); deleted = a - start; &#125; //åˆ é™¤å…‰æ ‡ä¹‹åçš„æ–‡æœ¬ if (afterLength &gt; 0) &#123; b = b - deleted; int end = b + afterLength; if (end &gt; content.length()) end = content.length(); content.delete(b, end); &#125; //ç»“æŸæ‰¹é‡ç¼–è¾‘ endBatchEdit(); return true; &#125; commitCompletionå’ŒcommitCorrectionæ–¹æ³•ï¼Œå³æ˜¯ç”¨æ¥è¡¥å…¨å•è¯å’Œä¿®æ­£é”™åˆ«å­—çš„æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å†…éƒ¨éƒ½æ˜¯è°ƒç”¨TextViewå¯¹åº”çš„æ–¹æ³•æ¥å®ç°çš„ã€‚ 12345678910111213141516public boolean commitCompletion(CompletionInfo text) &#123; if (DEBUG) Log.v(TAG, \"commitCompletion \" + text); mTextView.beginBatchEdit(); mTextView.onCommitCompletion(text); mTextView.endBatchEdit(); return true; &#125; @Override public boolean commitCorrection(CorrectionInfo correctionInfo) &#123; if (DEBUG) Log.v(TAG, \"commitCorrection\" + correctionInfo); mTextView.beginBatchEdit(); mTextView.onCommitCorrection(correctionInfo); mTextView.endBatchEdit(); return true; &#125; 8.æ€»ç»“ä¸€ä¸ªå±•ç¤ºæ–‡æœ¬+æ–‡æœ¬ç¼–è¾‘å™¨åŠŸèƒ½çš„æ§ä»¶éœ€è¦åšçš„äº‹æƒ…å¾ˆå¤šï¼Œè¦å¯¹æ–‡æœ¬è¿›è¡Œæ’ç‰ˆã€å¤„ç†ä¸åŒçš„æ®µè½é£æ ¼ã€å¤„ç†æ®µè½å†…çš„ä¸åŒemojiå’Œspanã€è¿›è¡ŒæŠ˜è¡Œè®¡ç®—ï¼Œç„¶åè¿˜éœ€è¦åšæ–‡æœ¬ç¼–è¾‘ã€æ–‡æœ¬é€‰æ‹©ç­‰ã€‚è€ŒTextViewæŠŠè¿™äº›äº‹æƒ…æ˜ç¡®åˆ†å·¥ç»™ä¸åŒçš„ç±»ã€‚è¿™æ ·ä¸ä»…ä»…æŠŠå¤æ‚é—®é¢˜æ‹†åˆ†æˆäº†ä¸€ä¸ªä¸ªç®€å•çš„å°åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿå¤§å¤§å¢åŠ äº†å¯æ‰©å±•æ€§ã€‚ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"TabLayoutæºç è§£æ","date":"2017-07-26T12:06:13.000Z","path":"2017/07/26/TabLayoutæºç è§£æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ TabLayout æºç è§£æ1. åŠŸèƒ½ä»‹ç»1.1 TabLayoutTabsè·ŸéšActionbaråœ¨Android 3.0è¿›å…¥å¤§å®¶çš„è§†çº¿ï¼Œæ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„è®¾è®¡ã€‚å®ƒä¹Ÿæ˜¯Material Design è§„èŒƒä¸­æåŠçš„Componentä¹‹ä¸€ã€‚Tabs or Bottom navigationï¼Ÿç›¸ä¿¡ä¸å°‘Androidå¼€å‘è€…ä¸äº§å“éƒ½æ’•è¿‡ï¼Œå°±è¿å¾®ä¿¡åœ¨å…¶ä¸­ä¹Ÿæœ‰è¿‡æŠ‰æ‹©ã€‚Googleåœ¨Google+ä»¥åŠGoogle Photoä¸­ç›¸ç»§é‡‡ç”¨Bottom navigationçš„è®¾è®¡æŠŠå‰§æƒ…æ¨åˆ°å‘é«˜æ½®ï¼Œä¸€åº¦è½°åŠ¨æ•´ä¸ªç¤¾åŒºã€‚Googleç»§è€Œåœ¨Material Design è§„èŒƒåŠ å…¥äº†Bottom navigationï¼Œè¡¨æ˜äº†æ€åº¦ï¼Œä¹Ÿç»™è¿™èµ·äº‰è®ºç”»ä¸Šäº†åœ†æ»¡çš„å¥å·ã€‚ åœ¨ support desgin lib å‘å¸ƒå‰ï¼Œå¤§å®¶åŸºæœ¬éƒ½é‡‡ç”¨PagerSlidingTabStripæ¥å®ç°tabæ•ˆæœã€‚å…¶å®TabLayoutåœ¨å®ç°ä¸Šå’ŒPagerSlidingTabStripååˆ†ç›¸ä¼¼ï¼Œä»Šå¤©æˆ‘ä»¬æ¥åˆ†æTabLayoutã€‚ 1.2 TabLayoutä½¿ç”¨TabLayoutä½¿ç”¨æ¯”è¾ƒç®€å•ã€‚æ—¢å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸ViewPageré…åˆä½¿ç”¨ã€‚ 1.2.1 TabLayoutå•ç‹¬ä½¿ç”¨åœ¨javaä»£ç ä¸­æ·»åŠ Tabs1234TabLayout tabLayout = (TabLayout) findViewById(R.id.tabLayout);tabLayout.addTab(tabLayout.newTab().setText(\"Tab 1\"));tabLayout.addTab(tabLayout.newTab().setText(\"Tab 2\"));tabLayout.addTab(tabLayout.newTab().setText(\"Tab 3\")); ä¹Ÿå¯ä»¥åœ¨xmlä¸­æ·»åŠ Tabs1234567891011&lt;android.support.design.widget.TabLayout android:layout_height=\"wrap_content\" android:layout_width=\"match_parent\"&gt; &lt;android.support.design.widget.TabItem android:text=\"@string/tab_text\"/&gt; &lt;android.support.design.widget.TabItem android:icon=\"@drawable/ic_android\"/&gt;&lt;/android.support.design.widget.TabLayout&gt; 1.2.2 ä¸ViewPageræ­é…ä½¿ç”¨1234567891011121314// find viewTabLayout tabLayout = ...;ViewPager viewPager = ...;PagerAdapter adapter = new PagerAdapter()&#123; // ...Override some methods // TabLayoutè°ƒç”¨è¿™ä¸ªæ–¹æ³•è·å–Tabçš„title @Override public CharSequence getPageTitle(int position) &#123; return \"Tab 1\"; &#125;&#125;viewPager.setAdapter(adapter);tabLayout.setupWithViewPager(viewPager); 2. æ€»ä½“è®¾è®¡ TabLayoutç»§æ‰¿HorizontalScrollViewå¤©ç”Ÿå°±æ˜¯ä¸€ä¸ªå¯ä»¥æ¨ªå‘æ»šåŠ¨çš„ViewGroup. æˆ‘ä»¬çŸ¥é“, HorizontalScrollViewä¸ScrollViewä¸€æ ·, æœ€å¤šåªèƒ½åŒ…å«ä¸€ä¸ªå­View. SlidingTabStripç»§æ‰¿äºLinearLayoutï¼Œæ˜¯TabLayoutçš„å†…éƒ¨ç±»ã€‚å®ƒæ˜¯TabLayoutå”¯ä¸€çš„å­View. æ‰€æœ‰çš„TabViewéƒ½æ˜¯å®ƒçš„å­View. TabViewç»§æ‰¿äºLinearLayout,ä»¥Tabä¸ºæ•°æ®æºï¼Œæ¥å±•ç¤ºTabçš„æ ·å¼ã€‚æœ€ç»ˆç”¨forå¾ªç¯è¢«addè¿›SlidingTabStrip. Tabæ˜¯ä¸€ä¸ªç®€å•çš„View Modelå®ä½“ç±»ï¼Œæ§åˆ¶TabViewçš„title, icon, custom layout idç­‰å±æ€§ã€‚ TabItemç»§æ‰¿äºView. ç”¨äºåœ¨layout xmlä¸­æ¥æè¿°Tab. éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒä¸ä¼šaddåˆ°SlidingTabStripä¸­å»ã€‚å®ƒçš„ä½œç”¨æ˜¯ä»xmlä¸­è·å–åˆ°textï¼Œiconï¼Œcustom layout idç­‰å±æ€§ã€‚TabLayout inflateåˆ°TabItemå¹¶è·å–å±æ€§åˆ°è£…é…åˆ°Tabä¸­ï¼Œæœ€ç»ˆaddåˆ°SlidingTabStripä¸­çš„è¿˜æ˜¯TabView. OnTabSelectedListeneræ˜¯TabLayoutä¸­çš„å†…éƒ¨æ¥å£ï¼Œç”¨äºç›‘å¬SlidingTabStripä¸­å­TabViewé€‰ä¸­çŠ¶æ€çš„æ”¹å˜ã€‚ Modeæ˜¯TabLayoutæ»šåŠ¨æ¨¡å¼çš„æè¿°ï¼Œä¸€å…±æœ‰ä¸¤ç§çŠ¶æ€ã€‚MODE_FIXEDä¸å¯æ»šåŠ¨æ¨¡å¼ï¼Œä»¥åŠMODE_SCROLLABLEå¯ä»¥æ»šåŠ¨æ¨¡å¼ã€‚ Gravityæ˜¯TabViewåœ¨SlidingTabStripä¸­layoutæ–¹å¼çš„æè¿°ã€‚åˆ†ä¸ºï¼šGRAVITY_FILLï¼ŒGRAVITY_CENTER. 3. è¯¦ç»†è®¾è®¡3.1 ç±»å…³ç³»å›¾ 3.2 åˆ†æ3.2.1 TabLayoutå­Viewå”¯ä¸€æ€§ä¿è¯å‰é¢ä»‹ç»TabLayoutç»§æ‰¿äºHorizontalScrollViewæœ€å¤šåªèƒ½æœ‰1ä¸ªå­View. ä½†TabLayoutå¯ä»¥åœ¨layoutä¸­æ·»åŠ å¤šä¸ªå­ViewèŠ‚ç‚¹. è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ1234567891011&lt;android.support.design.widget.TabLayout android:layout_height=\"wrap_content\" android:layout_width=\"match_parent\"&gt; &lt;android.support.design.widget.TabItem android:text=\"@string/tab_text\"/&gt; &lt;android.support.design.widget.TabItem android:icon=\"@drawable/ic_android\"/&gt;&lt;/android.support.design.widget.TabLayout&gt; çœ‹è¿‡LayoutInflateræºç çš„åŒå­¦å¯èƒ½ä¼šçŸ¥é“è¿™ä¸ªè¿‡ç¨‹ï¼šå…ˆinflateåˆ°ç”ŸæˆViewå¯¹è±¡ï¼Œå†è°ƒç”¨ViewGroup#addView(...)ç³»åˆ—æ–¹æ³•æŠŠviewæ·»åŠ åˆ°ViewGroupä¸­ã€‚æˆ‘ä»¬å‘ç°TabLayoutçš„addView(...)ç³»åˆ—æ–¹æ³•ï¼Œéƒ½åˆ å»superè°ƒç”¨ï¼Œä¸”è°ƒç”¨äº†å…±åŒçš„ä¸€ä¸ªæ–¹æ³•ï¼ŒaddViewInternal(View view)ã€‚ 1234567private void addViewInternal(final View child) &#123; if (child instanceof TabItem) &#123; addTabFromItemView((TabItem) child); &#125; else &#123; throw new IllegalArgumentException(\"Only TabItem instances can be added to TabLayout\"); &#125;&#125; å¯è§ï¼Œè‹¥childéTabItemå¯¹è±¡ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æ‰€ä»¥xmlä¸­ç»™TabLayoutæ·»åŠ tabæ—¶ï¼Œåªèƒ½æ·»åŠ TabItemå¯¹è±¡ã€‚è‹¥æƒ³æ·»åŠ å…¶å®ƒViewç±»å‹æ€ä¹ˆåŠï¼ŸTabItemæœ‰android:customViewè¿™ä¸ªå±æ€§ã€‚æˆ‘ä»¬ç»§ç»­æ¥çœ‹ã€‚12345678910111213141516171819202122232425262728293031323334private void addTabFromItemView(@NonNull TabItem item) &#123; final Tab tab = newTab(); if (item.mText != null) &#123; tab.setText(item.mText); &#125; if (item.mIcon != null) &#123; tab.setIcon(item.mIcon); &#125; if (item.mCustomLayout != 0) &#123; tab.setCustomView(item.mCustomLayout); &#125; addTab(tab);&#125;public Tab newTab() &#123; Tab tab = sTabPool.acquire(); if (tab == null) &#123; tab = new Tab(); &#125; tab.mParent = this; tab.mView = createTabView(tab); return tab;&#125;private TabView createTabView(@NonNull final Tab tab) &#123; TabView tabView = mTabViewPool != null ? mTabViewPool.acquire() : null; if (tabView == null) &#123; tabView = new TabView(getContext()); &#125; tabView.setTab(tab); tabView.setFocusable(true); tabView.setMinimumWidth(getTabMinWidth()); return tabView;&#125; è¿™é‡Œè°ƒnewTab()æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªtabå¯¹è±¡ï¼Œå¹¶ä¸”ç”¨å¯¹è±¡æ± æŠŠåˆ›å»ºçš„tabå¯¹è±¡ç¼“å­˜èµ·æ¥ã€‚ç„¶åå°†TabItemå¯¹è±¡çš„å±æ€§éƒ½èµ‹å€¼ç»™tabå¯¹è±¡ã€‚åœ¨createTabView(Tab tab)è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé¦–å…ˆä»TabViewæ± ä¸­è·å–TabViewå¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶è°ƒç”¨tabView.setTab(tab)æ–¹æ³•æ¥è¿›è¡Œäº†æ•°æ®ç»‘å®šã€‚ addTab(...)æœ‰ä¸‰ä¸ªé‡è½½æ–¹æ³•ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨å¦‚ä¸‹æ–¹æ³•ï¼š1234567891011121314151617181920212223242526272829public void addTab(@NonNull Tab tab, boolean setSelected) &#123; if (tab.mParent != this) &#123; throw new IllegalArgumentException(\"Tab belongs to a different TabLayout.\"); &#125; addTabView(tab, setSelected); configureTab(tab, mTabs.size()); if (setSelected) &#123; tab.select(); &#125;&#125;private void addTabView(Tab tab, int position, boolean setSelected) &#123; final TabView tabView = tab.mView; mTabStrip.addView(tabView, position, createLayoutParamsForTabs()); if (setSelected) &#123; tabView.setSelected(true); &#125;&#125;private void configureTab(Tab tab, int position) &#123; tab.setPosition(position); mTabs.add(position, tab); final int count = mTabs.size(); for (int i = position + 1; i &lt; count; i++) &#123; mTabs.get(i).setPosition(i); &#125;&#125; åœ¨addView(Tab, int, boolean)æ–¹æ³•ä¸­ï¼ŒæŠŠTabViewå¯¹è±¡addè¿›äº†SlidingTabStripè¿™ä¸ªViewGroupä¸­ã€‚å®é™…ä¸ŠSlidingTabStripçš„å¯¹è±¡mTabStripæ‰æ˜¯TabLayoutçš„å”¯ä¸€å­View.åœ¨TabLayoutçš„æ„é€ æ–¹æ³•ä¸­:1234567891011public TabLayout(Context context, AttributeSet attrs, int defStyleAttr) &#123; super(context, attrs, defStyleAttr); // ç¦ç”¨æ¨ªå‘æ»‘åŠ¨æ¡ setHorizontalScrollBarEnabled(false); // new ä¸€ä¸ª'SlidingTabStrip'çš„å®ä¾‹ï¼Œå¹¶ä½œä¸ºå”¯ä¸€çš„å­View addè¿›'TabLayout'. mTabStrip = new SlidingTabStrip(context); super.addView(mTabStrip, 0, new HorizontalScrollView.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.MATCH_PARENT)); // çœç•¥ä¸‹é¢çš„æ— å…³ä»£ç ...ï½ è‡³æ­¤ï¼Œæˆ‘ä»¬å°±æ˜ç™½äº†TabLayoutä¸­å­Viewçš„ä¸€è‡´æ€§æ˜¯å¦‚ä½•ä¿è¯çš„ã€‚ä¹Ÿæ˜ç™½äº†TabViewå…¶å®æ‰æ˜¯äº²ç”Ÿçš„ï¼ŒTabItemå…¶å®æ˜¯åå¨˜å…»çš„! è¿™äº›ä»£ç éƒ½å¾ˆç®€å•ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥ä»ä¸­å­¦ä¹ åˆ°å¾ˆå¤šæœ‰ç”¨çš„æ€æƒ³ã€‚ è‡³æ­¤ï¼Œä¸€ä¸ªæ¸…æ™°çš„Viewå±‚çº§å›¾åº”è¯¥å°±å‡ºç°åœ¨äº†å„ä½åŒå­¦çš„çœ¼å‰ã€‚ 3.2.2 ä¸ViewPageræ­é…ä½¿ç”¨æœ‰äº†ä¸Šé¢çš„çš„åŸºç¡€ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹TabLayoutæ˜¯å¦‚ä½•å’Œå®ƒçš„å¥½åŸºå‹ViewPageræ­é…ä½¿ç”¨çš„ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243public void setupWithViewPager(@Nullable final ViewPager viewPager) &#123; //... //ä¸ºç†è§£ç®€å•èµ·è§ï¼Œåˆ æ‰è¾¹è§’æ€§å¹²æ‰°ä»£ç ï¼Œä¸»è¦æ¥çœ‹æ ¸å¿ƒé€»è¾‘ mViewPager = viewPager; // Add our custom OnPageChangeListener to the ViewPager if (mPageChangeListener == null) &#123; mPageChangeListener = new TabLayoutOnPageChangeListener(this); &#125; mPageChangeListener.reset(); viewPager.addOnPageChangeListener(mPageChangeListener); // Now we'll add a tab selected listener to set ViewPager's current item setOnTabSelectedListener(new ViewPagerOnTabSelectedListener(viewPager)); // Now we'll populate ourselves from the pager adapter setPagerAdapter(adapter, true);&#125;public void setOnTabSelectedListener(OnTabSelectedListener onTabSelectedListener) &#123; mOnTabSelectedListener = onTabSelectedListener;&#125;private void setPagerAdapter(@Nullable final PagerAdapter adapter, final boolean addObserver) &#123; if (mPagerAdapter != null &amp;&amp; mPagerAdapterObserver != null) &#123; // If we already have a PagerAdapter, unregister our observer mPagerAdapter.unregisterDataSetObserver(mPagerAdapterObserver); &#125; mPagerAdapter = adapter; if (addObserver &amp;&amp; adapter != null) &#123; // Register our observer on the new adapter if (mPagerAdapterObserver == null) &#123; mPagerAdapterObserver = new PagerAdapterObserver(); &#125; adapter.registerDataSetObserver(mPagerAdapterObserver); &#125; // Finally make sure we reflect the new adapter populateFromPagerAdapter();&#125; è¿™é‡Œçš„TabLayoutOnPageChangeListenerå®ç°äº†ViewPager.OnPageChangeListener. é¦–å…ˆè°ƒç”¨ViewPagerå¯¹è±¡addOnPageChangeListener(OnPageChangeListener)æ¥ç›‘å¬ViewPagerçš„æ»‘åŠ¨ä»¥åŠå½“å‰ä¹Ÿçš„é€‰ä¸­ã€‚ç„¶åè®¾ç½®ViewPagerOnTabSelectedListenerå¯¹è±¡ï¼Œä¿è¯ViewPagerçš„é¡µé¢å’ŒTabLayoutçš„itemçš„é€‰ä¸­çŠ¶æ€ä¿æŒä¸€è‡´ï¼Œä»¥åŠæ»šåŠ¨çš„ååŒæ€§ã€‚è¿™é‡Œçš„ç›‘å¬åœ¨3.2.3ä¸­è¯¦ç»†è®²è§£ã€‚ æˆ‘ä»¬ä¸€èˆ¬è°ƒç”¨viewPager.getAdapter().notifyDataSetChanged()æ¥è¿›è¡ŒViewPagerçš„åˆ·æ–°. ç°åœ¨æˆ‘ä»¬åœ¨ViewPagerçš„adapterä¸­æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ï¼Œç›‘å¬ViewPagerçš„åˆ·æ–°è¡Œä¸ºã€‚ç›®çš„æ˜¯ä¸ºäº†åˆ·æ–°ViewPagerçš„åŒæ—¶ä¹Ÿå¯ä»¥åˆ·æ–°TabLayout. æˆ‘ä»¬æ¥çœ‹çœ‹PagerAdapterObserverè¿™ä¸ªç›‘å¬å™¨æ˜¯å¦‚ä½•åˆ·æ–°TabLayoutçš„ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748private class PagerAdapterObserver extends DataSetObserver &#123; @Override public void onChanged() &#123; populateFromPagerAdapter(); &#125; @Override public void onInvalidated() &#123; populateFromPagerAdapter(); &#125;&#125;private void populateFromPagerAdapter() &#123; removeAllTabs(); if (mPagerAdapter != null) &#123; final int adapterCount = mPagerAdapter.getCount(); for (int i = 0; i &lt; adapterCount; i++) &#123; addTab(newTab().setText(mPagerAdapter.getPageTitle(i)), false); &#125; // Make sure we reflect the currently set ViewPager item if (mViewPager != null &amp;&amp; adapterCount &gt; 0) &#123; final int curItem = mViewPager.getCurrentItem(); if (curItem != getSelectedTabPosition() &amp;&amp; curItem &lt; getTabCount()) &#123; selectTab(getTabAt(curItem)); &#125; &#125; &#125; else &#123; removeAllTabs(); &#125;&#125;public void removeAllTabs() &#123; // Remove all the views for (int i = mTabStrip.getChildCount() - 1; i &gt;= 0; i--) &#123; removeTabViewAt(i); &#125; for (final Iterator&lt;Tab&gt; i = mTabs.iterator(); i.hasNext();) &#123; final Tab tab = i.next(); i.remove(); tab.reset(); sTabPool.release(tab); &#125; mSelectedTab = null;&#125; åˆ·æ–°æ–¹å¼å¾ˆç®€å•ç²—æš´ï¼Œä»SlidingTabStripå¯¹è±¡ä¸­ç§»é™¤æ‰€æœ‰çš„TabViewï¼Œç»§è€Œä»View ModelmTabsä¸­ç§»é™¤æ‰€æœ‰Tabå¯¹è±¡ã€‚ç„¶åä»adapterä¸­è·å–tabä¿¡æ¯ï¼Œå¾ªç¯è°ƒç”¨addTab(Tab, boolean)æ–¹æ³•é‡æ–°æ·»åŠ TabViewã€‚æœ€åè°ƒç”¨ViewPagerå¯¹è±¡çš„getCurrentItem()æ–¹æ³•ï¼Œè·å–å½“å‰ä½ç½®ï¼Œç„¶åè°ƒç”¨selectTab(int position)æ¢å¤TabViewçš„é€‰ä¸­çŠ¶æ€ï¼ˆé’ˆå¯¹TabViewçš„é€‰ä¸­ï¼Œ3.2.4ä¸­æœ‰è¯¦ç»†ä»‹ç»)ã€‚ 3.2.3 ViewPagerä¸TabLayoutçš„TabåŠindicaotrååŒæ»šåŠ¨12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public static class TabLayoutOnPageChangeListener implements ViewPager.OnPageChangeListener &#123; private final WeakReference&lt;TabLayout&gt; mTabLayoutRef; private int mPreviousScrollState; private int mScrollState; public TabLayoutOnPageChangeListener(TabLayout tabLayout) &#123; mTabLayoutRef = new WeakReference&lt;&gt;(tabLayout); &#125; @Override public void onPageScrollStateChanged(int state) &#123; mPreviousScrollState = mScrollState; mScrollState = state; &#125; @Override public void onPageScrolled(int position, float positionOffset, int positionOffsetPixels) &#123; final TabLayout tabLayout = mTabLayoutRef.get(); if (tabLayout != null) &#123; // Only update the text selection if we're not settling, or we are settling after // being dragged final boolean updateText = mScrollState != SCROLL_STATE_SETTLING || mPreviousScrollState == SCROLL_STATE_DRAGGING; // Update the indicator if we're not settling after being idle. This is caused // from a setCurrentItem() call and will be handled by an animation from // onPageSelected() instead. final boolean updateIndicator = !(mScrollState == SCROLL_STATE_SETTLING &amp;&amp; mPreviousScrollState == SCROLL_STATE_IDLE); tabLayout.setScrollPosition(position, positionOffset, updateText, updateIndicator); &#125; &#125; @Override public void onPageSelected(int position) &#123; final TabLayout tabLayout = mTabLayoutRef.get(); if (tabLayout != null &amp;&amp; tabLayout.getSelectedTabPosition() != position) &#123; // Select the tab, only updating the indicator if we're not being dragged/settled // (since onPageScrolled will handle that). final boolean updateIndicator = mScrollState == SCROLL_STATE_IDLE || (mScrollState == SCROLL_STATE_SETTLING &amp;&amp; mPreviousScrollState == SCROLL_STATE_IDLE); tabLayout.selectTab(tabLayout.getTabAt(position), updateIndicator); &#125; &#125; private void reset() &#123; mPreviousScrollState = mScrollState = SCROLL_STATE_IDLE; &#125;&#125; ç”¨è¿‡ViewPagerçš„åŒå­¦å¯¹OnPageChangeListenerä¸ä¼šé™Œç”Ÿï¼Œä¸å¤šèµ˜è¿°ã€‚TabLayoutOnPageChangeListenerå®ç°äº†OnPageChangeListener, åœ¨onPageScrolled(...)æ–¹æ³•ä¸­åšååŒæ»šåŠ¨å¤„ç†ã€‚æ»šåŠ¨çš„æ¡ä»¶æ˜¯ï¼š1final boolean updateIndicator = !(mScrollState == SCROLL_STATE_SETTLING &amp;&amp; mPreviousScrollState == SCROLL_STATE_IDLE); è°ƒç”¨TabLayoutçš„setScrollPosition(...)æ–¹æ³•æ¥æ§åˆ¶TabLayoutä¸­TabViewå’Œindocatorçš„ååŒæ»šåŠ¨ã€‚12345678910111213141516171819202122private void setScrollPosition(int position, float positionOffset, boolean updateSelectedText, boolean updateIndicatorPosition) &#123; final int roundedPosition = Math.round(position + positionOffset); if (roundedPosition &lt; 0 || roundedPosition &gt;= mTabStrip.getChildCount()) &#123; return; &#125; // Set the indicator position, if enabled if (updateIndicatorPosition) &#123; mTabStrip.setIndicatorPositionFromTabPosition(position, positionOffset); &#125; // Now update the scroll position, canceling any running animation if (mScrollAnimator != null &amp;&amp; mScrollAnimator.isRunning()) &#123; mScrollAnimator.cancel(); &#125; scrollTo(calculateScrollXForTab(position, positionOffset), 0); // Update the 'selected state' view as we scroll, if enabled if (updateSelectedText) &#123; setSelectedTabView(roundedPosition); &#125;&#125; 3.2.3.1 TabLayoutçš„IndicatorååŒæ»šåŠ¨indicatorçš„æ»šåŠ¨ç”±SlidingTabStripæ¥å¤„ç†ï¼š 1234// Set the indicator position, if enabledif (updateIndicatorPosition) &#123; mTabStrip.setIndicatorPositionFromTabPosition(position, positionOffset);&#125; è¿™é‡Œçš„positionæ˜¯å½“å‰é€‰ä¸­çš„ä½ç½®ã€‚positionOffsetæ˜¯: è·å½“å‰Tabæ»‘åŠ¨çš„è·ç¦»ï¼ä»å½“å‰tabæ»‘åŠ¨åˆ°ä¸‹ä¸€ä¸ªtabçš„æ€»è·ç¦» è¿™æ ·ä¸€ä¸ªèŒƒå›´åœ¨ï¼»0ï¼Œ1ï¼½é—´çš„å°æ•°ã€‚ SlidingTabStrip#setIndicatorPositionFromTabPosition(int, float)123456789void setIndicatorPositionFromTabPosition(int position, float positionOffset) &#123; if (mIndicatorAnimator != null &amp;&amp; mIndicatorAnimator.isRunning()) &#123; mIndicatorAnimator.cancel(); &#125; mSelectedPosition = position; mSelectionOffset = positionOffset; updateIndicatorPosition();&#125; SlidingTabStrip#updateIndicatorPosition()12345678910111213141516171819202122private void updateIndicatorPosition() &#123; final View selectedTitle = getChildAt(mSelectedPosition); int left, right; if (selectedTitle != null &amp;&amp; selectedTitle.getWidth() &gt; 0) &#123; left = selectedTitle.getLeft(); right = selectedTitle.getRight(); if (mSelectionOffset &gt; 0f &amp;&amp; mSelectedPosition &lt; getChildCount() - 1) &#123; // Draw the selection partway between the tabs View nextTitle = getChildAt(mSelectedPosition + 1); left = (int) (mSelectionOffset * nextTitle.getLeft() + (1.0f - mSelectionOffset) * left); right = (int) (mSelectionOffset * nextTitle.getRight() + (1.0f - mSelectionOffset) * right); &#125; &#125; else &#123; left = right = -1; &#125; setIndicatorPosition(left, right);&#125; é€šè¿‡getChildAt(mSelectedPosition), è·å–åˆ°åˆ°mSelectedPositionå¤„çš„TabViewã€‚è‹¥æ»‘åŠ¨çš„mSelectionOffset&gt;0fä¸”å½“å‰é€‰ä¸­çš„ä½ç½®mSelectedPositionä¸æ˜¯æœ€åä¸€ä¸ªTabView. è·å–åˆ°ä¸‹ä¸€ä¸ªTabViewï¼Œå¹¶è®¡ç®—å‡ºindicatorçš„leftå’Œrightã€‚ SlidingTabStripï¼ƒsetIndicatorPosition(int, int)12345678private void setIndicatorPosition(int left, int right) &#123; if (left != mIndicatorLeft || right != mIndicatorRight) &#123; // If the indicator's left/right has changed, invalidate mIndicatorLeft = left; mIndicatorRight = right; ViewCompat.postInvalidateOnAnimation(this); &#125;&#125; éå¸¸ç®€å•çš„ä»£ç ï¼Œåœ¨è°ƒç”¨ViewCompat.postInvalidateOnAnimation(this)é‡ç»˜Viewä¹‹å‰ï¼Œå»æ‰ä¸€äº›é‡å¤ç»˜åˆ¶çš„å¸§ã€‚ 12345678910@Overridepublic void draw(Canvas canvas) &#123; super.draw(canvas); // Thick colored underline below the current selection if (mIndicatorLeft &gt;= 0 &amp;&amp; mIndicatorRight &gt; mIndicatorLeft) &#123; canvas.drawRect(mIndicatorLeft, getHeight() - mSelectedIndicatorHeight, mIndicatorRight, getHeight(), mSelectedIndicatorPaint); &#125;&#125; ç»˜åˆ¶é€»è¾‘å¾ˆç®€å•ã€‚è°ƒç”¨canvas.drawRect(float left, float top, float right, float bottom, Paint paint)æ¥ç»˜åˆ¶indicator.è¿™é‡Œï¼š1234left = mIndicatorLeft;top = getHeight() - mSelectedIndicatorHeight;right = mIndicatorRight;bottom = getHeight(); 3.2.3.2 TabLayoutçš„TabViewååŒæ»šåŠ¨æˆ‘ä»¬å›å¤´æ¥çœ‹ 3.2.3ä¸­setScrollPosition(...)æ–¹æ³•12345678910111213141516171819202122private void setScrollPosition(int position, float positionOffset, boolean updateSelectedText, boolean updateIndicatorPosition) &#123; final int roundedPosition = Math.round(position + positionOffset); if (roundedPosition &lt; 0 || roundedPosition &gt;= mTabStrip.getChildCount()) &#123; return; &#125; // Set the indicator position, if enabled if (updateIndicatorPosition) &#123; mTabStrip.setIndicatorPositionFromTabPosition(position, positionOffset); &#125; // Now update the scroll position, canceling any running animation if (mScrollAnimator != null &amp;&amp; mScrollAnimator.isRunning()) &#123; mScrollAnimator.cancel(); &#125; scrollTo(calculateScrollXForTab(position, positionOffset), 0); // Update the 'selected state' view as we scroll, if enabled if (updateSelectedText) &#123; setSelectedTabView(roundedPosition); &#125;&#125; åœ¨3.2.3.1ä¸­æˆ‘ä»¬çŸ¥é“indicatorçš„æ»šåŠ¨æ˜¯é€šè¿‡mTabStrip.setIndicatorPositionFromTabPosition(position, positionOffset)å®ç°çš„ã€‚é‚£TabViewçš„æ»šåŠ¨å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“TabLayoutæ˜¯ç»§æ‰¿HorizonScrollViewå¤©ç”Ÿå°±æ˜¯ä¸€ä¸ªå¯ä»¥æ¨ªè¡Œæ»šåŠ¨çš„Viewï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨scrollTo(int x, int y)æ–¹æ³•å°±å¯ä»¥å®ç°æ¨ªå‘æ»šåŠ¨ã€‚1scrollTo(calculateScrollXForTab(position, positionOffset), 0); è¿™é‡Œxæ–¹å‘çš„åç§»é‡è°ƒç”¨calculateScrollXForTab(position, positionOffset)å®æ—¶è®¡ç®—å¾—å‡ºï¼Œyæ–¹å‘çš„åç§»é‡ä¸º0ã€‚12345678910111213141516private int calculateScrollXForTab(int position, float positionOffset) &#123; if (mMode == MODE_SCROLLABLE) &#123; final View selectedChild = mTabStrip.getChildAt(position); final View nextChild = position + 1 &lt; mTabStrip.getChildCount() ? mTabStrip.getChildAt(position + 1) : null; final int selectedWidth = selectedChild != null ? selectedChild.getWidth() : 0; final int nextWidth = nextChild != null ? nextChild.getWidth() : 0; return selectedChild.getLeft() + ((int) ((selectedWidth + nextWidth) * positionOffset * 0.5f)) + (selectedChild.getWidth() / 2) - (getWidth() / 2); &#125; return 0;&#125; è‡³æ­¤ï¼Œæˆ‘ä»¬å°±æ˜ç™½äº†TabLayoutæ˜¯å¦‚ä½•éšViewPagerçš„æ»šåŠ¨è€Œæ»šåŠ¨çš„ã€‚ 3.2.4 Tabé€‰ä¸­çŠ¶æ€123456789private void setSelectedTabView(int position) &#123; final int tabCount = mTabStrip.getChildCount(); if (position &lt; tabCount &amp;&amp; !mTabStrip.getChildAt(position).isSelected()) &#123; for (int i = 0; i &lt; tabCount; i++) &#123; final View child = mTabStrip.getChildAt(i); child.setSelected(i == position); &#125; &#125;&#125; è°ƒç”¨Viewçš„setSelected(boolean)æ–¹æ³•ã€‚ 4. å¼€æºé¡¹ç›®ä¸­çš„ä½¿ç”¨å¼€æºé¡¹ç›®ä¸­ä½¿ç”¨TabLayoutçš„ä¾‹å­ç‰¹åˆ«å¤š, è¿™é‡Œç»™å‡ºæˆ‘å†™çš„ä¸€ä¸ªé¡¹ç›®ï¼š SwipeToLoadLayoutçš„demo å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"SwipeRefreshLayoutæºç åˆ†æ","date":"2017-07-26T12:04:43.000Z","path":"2017/07/26/SwipeRefreshLayoutæºç åˆ†æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ ç®€ä»‹å®˜æ–¹æ–‡æ¡£ SwipeRefreshLayout æ˜¯ä¸€ä¸ªä¸‹æ‹‰åˆ·æ–°æ§ä»¶ï¼Œå‡ ä¹å¯ä»¥åŒ…è£¹ä¸€ä¸ªä»»ä½•å¯ä»¥æ»šåŠ¨çš„å†…å®¹ï¼ˆListView GridView ScrollView RecyclerViewï¼‰ï¼Œå¯ä»¥è‡ªåŠ¨è¯†åˆ«å‚ç›´æ»šåŠ¨æ‰‹åŠ¿ã€‚ä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚ 1.å°†éœ€è¦ä¸‹æ‹‰åˆ·æ–°çš„ç©ºé—´åŒ…è£¹èµ·æ¥ 12345678910&lt;android.support.v4.widget.SwipeRefreshLayout android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt; &lt;android.support.v7.widget.RecyclerView android:id=\"@+id/recyclerView\" android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"/&gt;&lt;/android.support.v4.widget.SwipeRefreshLayout&gt; 2.è®¾ç½®åˆ·æ–°åŠ¨ç”»çš„è§¦å‘å›è°ƒ 123456789101112131415161718192021222324252627282930//è®¾ç½®ä¸‹æ‹‰å‡ºç°å°åœ†åœˆæ˜¯å¦æ˜¯ç¼©æ”¾å‡ºç°ï¼Œå‡ºç°çš„ä½ç½®ï¼Œæœ€å¤§çš„ä¸‹æ‹‰ä½ç½®mySwipeRefreshLayout.setProgressViewOffset(true, 50, 200);//è®¾ç½®ä¸‹æ‹‰åœ†åœˆçš„å¤§å°ï¼Œä¸¤ä¸ªå€¼ LARGEï¼Œ DEFAULTmySwipeRefreshLayout.setSize(SwipeRefreshLayout.LARGE);// è®¾ç½®ä¸‹æ‹‰åœ†åœˆä¸Šçš„é¢œè‰²ï¼Œè“è‰²ã€ç»¿è‰²ã€æ©™è‰²ã€çº¢è‰²mySwipeRefreshLayout.setColorSchemeResources( android.R.color.holo_blue_bright, android.R.color.holo_green_light, android.R.color.holo_orange_light, android.R.color.holo_red_light);// é€šè¿‡ setEnabled(false) ç¦ç”¨ä¸‹æ‹‰åˆ·æ–°mySwipeRefreshLayout.setEnabled(false);// è®¾å®šä¸‹æ‹‰åœ†åœˆçš„èƒŒæ™¯mSwipeLayout.setProgressBackgroundColor(R.color.red);/* * è®¾ç½®æ‰‹åŠ¿ä¸‹æ‹‰åˆ·æ–°çš„ç›‘å¬ */mySwipeRefreshLayout.setOnRefreshListener( new SwipeRefreshLayout.OnRefreshListener() &#123; @Override public void onRefresh() &#123; // åˆ·æ–°åŠ¨ç”»å¼€å§‹åå›è°ƒåˆ°æ­¤æ–¹æ³• &#125; &#125;); é€šè¿‡ setRefreshing(false) å’Œ setRefreshing(true) æ¥æ‰‹åŠ¨è°ƒç”¨åˆ·æ–°çš„åŠ¨ç”»ã€‚ onRefresh çš„å›è°ƒåªæœ‰åœ¨æ‰‹åŠ¿ä¸‹æ‹‰çš„æƒ…å†µä¸‹æ‰ä¼šè§¦å‘ï¼Œé€šè¿‡ setRefreshing åªèƒ½è°ƒç”¨åˆ·æ–°çš„åŠ¨ç”»æ˜¯å¦æ˜¾ç¤ºã€‚SwipeRefreshLayout ä¹Ÿå¯æ”¾åœ¨ CoordinatorLayout å†…å…±åŒå¤„ç†æ»‘åŠ¨å†²çªï¼Œæœ‰å…´è¶£å¯ä»¥å°è¯•ã€‚ SwipeRefreshLayout æºç åˆ†æ æœ¬æ–‡åŸºäº v4 ç‰ˆæœ¬ 23.2.0 extends ViewGroup implements NestedScrollingParent NestedScrollingChild1234java.lang.Object â†³ android.view.View â†³ android.view.ViewGroup â†³ android.support.v4.widget.SwipeRefreshLayout SwipeRefreshLayout çš„åˆ†æåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šè‡ªå®šä¹‰ ViewGroup çš„éƒ¨åˆ†ï¼Œå¤„ç†å’Œå­è§†å›¾çš„åµŒå¥—æ»šåŠ¨éƒ¨åˆ†ã€‚ SwipeRefreshLayout extends ViewGroupå…¶å®å°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ ViewGroup ï¼Œç»“åˆæˆ‘ä»¬è‡ªå·±å¹³æ—¶è‡ªå®šä¹‰ ViewGroup çš„æ­¥éª¤ï¼š åˆå§‹åŒ–å˜é‡ onMeasure onLayout å¤„ç†äº¤äº’ ï¼ˆdispatchTouchEvent onInterceptTouchEvent onTouchEventï¼‰ æ¥ä¸‹æ¥å°±æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤è¿›è¡Œåˆ†æã€‚ 1.åˆå§‹åŒ–å˜é‡SwipeRefreshLayout å†…éƒ¨æœ‰ 2 ä¸ª Viewï¼Œä¸€ä¸ªåœ†åœˆï¼ˆmCircleViewï¼‰ï¼Œä¸€ä¸ªå†…éƒ¨å¯æ»šåŠ¨çš„Viewï¼ˆmTargetï¼‰ã€‚é™¤äº† Viewï¼Œè¿˜åŒ…å«ä¸€ä¸ª OnRefreshListener æ¥å£ï¼Œå½“åˆ·æ–°åŠ¨ç”»è¢«è§¦å‘æ—¶å›è°ƒã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243/** * Constructor that is called when inflating SwipeRefreshLayout from XML. * * @param context * @param attrs */public SwipeRefreshLayout(Context context, AttributeSet attrs) &#123; super(context, attrs); // ç³»ç»Ÿé»˜è®¤çš„æœ€å°æ»šåŠ¨è·ç¦» mTouchSlop = ViewConfiguration.get(context).getScaledTouchSlop(); // ç³»ç»Ÿé»˜è®¤çš„åŠ¨ç”»æ—¶é•¿ mMediumAnimationDuration = getResources().getInteger( android.R.integer.config_mediumAnimTime); setWillNotDraw(false); mDecelerateInterpolator = new DecelerateInterpolator(DECELERATE_INTERPOLATION_FACTOR); // è·å– xml ä¸­å®šä¹‰çš„å±æ€§ final TypedArray a = context.obtainStyledAttributes(attrs, LAYOUT_ATTRS); setEnabled(a.getBoolean(0, true)); a.recycle(); // åˆ·æ–°çš„åœ†åœˆçš„å¤§å°ï¼Œå•ä½è½¬æ¢æˆ sp final DisplayMetrics metrics = getResources().getDisplayMetrics(); mCircleWidth = (int) (CIRCLE_DIAMETER * metrics.density); mCircleHeight = (int) (CIRCLE_DIAMETER * metrics.density); // åˆ›å»ºåˆ·æ–°åŠ¨ç”»çš„åœ†åœˆ createProgressView(); ViewCompat.setChildrenDrawingOrderEnabled(this, true); // the absolute offset has to take into account that the circle starts at an offset mSpinnerFinalOffset = DEFAULT_CIRCLE_TARGET * metrics.density; // åˆ·æ–°åŠ¨ç”»çš„ä¸´ç•Œè·ç¦»å€¼ mTotalDragDistance = mSpinnerFinalOffset; // é€šè¿‡ NestedScrolling æœºåˆ¶æ¥å¤„ç†åµŒå¥—æ»šåŠ¨ mNestedScrollingParentHelper = new NestedScrollingParentHelper(this); mNestedScrollingChildHelper = new NestedScrollingChildHelper(this); setNestedScrollingEnabled(true);&#125; // åˆ›å»ºåˆ·æ–°åŠ¨ç”»çš„åœ†åœˆ12345678private void createProgressView() &#123; mCircleView = new CircleImageView(getContext(), CIRCLE_BG_LIGHT, CIRCLE_DIAMETER/2); mProgress = new MaterialProgressDrawable(getContext(), this); mProgress.setBackgroundColor(CIRCLE_BG_LIGHT); mCircleView.setImageDrawable(mProgress); mCircleView.setVisibility(View.GONE); addView(mCircleView);&#125; åˆå§‹åŒ–çš„æ—¶å€™åˆ›å»ºä¸€ä¸ªå‡ºæ¥ä¸€ä¸ª View ï¼ˆä¸‹æ‹‰åˆ·æ–°çš„åœ†åœˆï¼‰ã€‚å¯ä»¥çœ‹å‡ºä½¿ç”¨èƒŒæ™¯åœ†åœˆæ˜¯ v4 åŒ…é‡Œæä¾›çš„ CircleImageView æ§ä»¶ï¼Œä¸­é—´çš„æ˜¯ MaterialProgressDrawable è¿›åº¦æ¡ã€‚å¦ä¸€ä¸ª View æ˜¯åœ¨ xml ä¸­åŒ…å«çš„å¯æ»šåŠ¨è§†å›¾ã€‚ 2.onMeasureonMeasure ç¡®å®šå­è§†å›¾çš„å¤§å°ã€‚ 123456789101112131415161718192021222324252627282930313233343536@Overridepublic void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123; super.onMeasure(widthMeasureSpec, heightMeasureSpec); if (mTarget == null) &#123; // ç¡®å®šå†…éƒ¨è¦æ»šåŠ¨çš„Viewï¼Œå¦‚ RecycleView ensureTarget(); &#125; if (mTarget == null) &#123; return; &#125; // æµ‹é‡å­ View ï¼ˆmTargetï¼‰ mTarget.measure(MeasureSpec.makeMeasureSpec( getMeasuredWidth() - getPaddingLeft() - getPaddingRight(), MeasureSpec.EXACTLY), MeasureSpec.makeMeasureSpec( getMeasuredHeight() - getPaddingTop() - getPaddingBottom(), MeasureSpec.EXACTLY)); // æµ‹é‡åˆ·æ–°çš„åœ†åœˆ mCircleView mCircleView.measure(MeasureSpec.makeMeasureSpec(mCircleWidth, MeasureSpec.EXACTLY), MeasureSpec.makeMeasureSpec(mCircleHeight, MeasureSpec.EXACTLY)); if (!mUsingCustomStart &amp;&amp; !mOriginalOffsetCalculated) &#123; mOriginalOffsetCalculated = true; mCurrentTargetOffsetTop = mOriginalOffsetTop = -mCircleView.getMeasuredHeight(); &#125; // è®¡ç®— mCircleView åœ¨ ViewGroup ä¸­çš„ç´¢å¼• mCircleViewIndex = -1; // Get the index of the circleview. for (int index = 0; index &lt; getChildCount(); index++) &#123; if (getChildAt(index) == mCircleView) &#123; mCircleViewIndex = index; break; &#125; &#125;&#125; è¿™ä¸ªæ­¥éª¤ç¡®å®šäº† mCircleView å’Œ SwipeRefreshLayout çš„å­è§†å›¾çš„å¤§å°ã€‚ 3.onLayoutonLayout ä¸»è¦è´Ÿè´£ç¡®å®šå„ä¸ªå­è§†å›¾çš„ä½ç½®ã€‚ 12345678910111213141516171819202122232425262728@Overrideprotected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123; // è·å– SwipeRefreshLayout çš„å®½é«˜ final int width = getMeasuredWidth(); final int height = getMeasuredHeight(); if (getChildCount() == 0) &#123; return; &#125; if (mTarget == null) &#123; ensureTarget(); &#125; if (mTarget == null) &#123; return; &#125; // è€ƒè™‘åˆ°ç»™æ§ä»¶è®¾ç½® paddingï¼Œå»é™¤ padding çš„è·ç¦» final View child = mTarget; final int childLeft = getPaddingLeft(); final int childTop = getPaddingTop(); final int childWidth = width - getPaddingLeft() - getPaddingRight(); final int childHeight = height - getPaddingTop() - getPaddingBottom(); // è®¾ç½® mTarget çš„ä½ç½® child.layout(childLeft, childTop, childLeft + childWidth, childTop + childHeight); int circleWidth = mCircleView.getMeasuredWidth(); int circleHeight = mCircleView.getMeasuredHeight(); // æ ¹æ® mCurrentTargetOffsetTop å˜é‡çš„å€¼æ¥è®¾ç½® mCircleView çš„ä½ç½® mCircleView.layout((width / 2 - circleWidth / 2), mCurrentTargetOffsetTop, (width / 2 + circleWidth / 2), mCurrentTargetOffsetTop + circleHeight);&#125; åœ¨ onLayout ä¸­æ”¾ç½®äº† mCircleView çš„ä½ç½®ï¼Œæ³¨æ„ é¡¶éƒ¨ä½ç½®æ˜¯ mCurrentTargetOffsetTop ï¼ŒmCurrentTargetOffsetTop åˆå§‹è·ç¦»æ˜¯-mCircleView.getMeasuredHeight()ï¼Œæ‰€ä»¥æ˜¯åœ¨ SwipeRefreshLayout å¤–ã€‚ ç»è¿‡ä»¥ä¸Šå‡ ä¸ªæ­¥éª¤ï¼ŒSwipeRefreshLayout åˆ›å»ºäº†å­è§†å›¾ï¼Œç¡®å®šä»–ä»¬çš„å¤§å°ã€ä½ç½®ï¼Œç°åœ¨æ‰€æœ‰è§†å›¾å¯ä»¥æ˜¾ç¤ºåœ¨ç•Œé¢äº†ã€‚ å¤„ç†ä¸å­è§†å›¾çš„æ»šåŠ¨äº¤äº’ä¸‹æ‹‰åˆ·æ–°æ§ä»¶çš„ä¸»è¦åŠŸèƒ½æ˜¯å½“å­è§†å›¾ä¸‹æ‹‰åˆ°æœ€é¡¶éƒ¨æ—¶ï¼Œç»§ç»­ä¸‹æ‹‰å¯ä»¥å‡ºç°åˆ·æ–°åŠ¨ç”»ã€‚è€Œå­è§†å›¾å¯ä»¥æ»šåŠ¨æ—¶éœ€è¦å°†æ‰€æœ‰æ»šåŠ¨äº‹ä»¶éƒ½äº¤ç»™å­è§†å›¾ã€‚å€ŸåŠ© Android æä¾›çš„ NestedScrolling æœºåˆ¶ï¼Œä½¿å¾— SwipeRefreshLayout å¾ˆè½»æ¾çš„è§£å†³äº†ä¸å­è§†å›¾çš„æ»šåŠ¨å†²çªé—®é¢˜ã€‚SwipeRefreshLayout é€šè¿‡å®ç° NestedScrollingParent å’Œ NestedScrollingChild æ¥å£æ¥å¤„ç†æ»šåŠ¨å†²çªã€‚SwipeRefreshLayout ä½œä¸º Parent åµŒå¥—ä¸€ä¸ªå¯ä»¥æ»šåŠ¨çš„å­è§†å›¾ï¼Œé‚£ä¹ˆå°±éœ€è¦äº†è§£ä¸€ä¸‹ NestedScrollingParent æ¥å£ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596/** å½“ä½ å¸Œæœ›è‡ªå·±çš„è‡ªå®šä¹‰å¸ƒå±€æ”¯æŒåµŒå¥—å­è§†å›¾å¹¶ä¸”å¤„ç†æ»šåŠ¨æ“ä½œï¼Œå°±å¯ä»¥å®ç°è¯¥æ¥å£ã€‚ å®ç°è¿™ä¸ªæ¥å£åå¯ä»¥åˆ›å»ºä¸€ä¸ª NestedScrollingParentHelper å­—æ®µï¼Œä½¿ç”¨å®ƒæ¥å¸®åŠ©ä½ å¤„ç†å¤§éƒ¨åˆ†çš„æ–¹æ³•ã€‚ å¤„ç†åµŒå¥—çš„æ»šåŠ¨æ—¶åº”è¯¥ä½¿ç”¨ `ViewCompat`ï¼Œ`ViewGroupCompat`æˆ–`ViewParentCompat` ä¸­çš„æ–¹æ³•æ¥å¤„ç†ï¼Œè¿™æ˜¯ä¸€äº›å…¼å®¹åº“ï¼Œ ä»–ä»¬ä¿è¯ Android 5.0ä¹‹å‰çš„å…¼å®¹æ€§å«ç‰‡çš„é™æ€æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥å…¼å®¹ Android 5.0 ä¹‹å‰çš„ç‰ˆæœ¬ã€‚ */public interface NestedScrollingParent &#123; /** * å½“å­è§†å›¾è°ƒç”¨ startNestedScroll(View, int) åè°ƒç”¨è¯¥æ–¹æ³•ã€‚è¿”å› true è¡¨ç¤ºå“åº”å­è§†å›¾çš„æ»šåŠ¨ã€‚ * å®ç°è¿™ä¸ªæ–¹æ³•æ¥å£°æ˜æ”¯æŒåµŒå¥—æ»šåŠ¨ï¼Œå¦‚æœè¿”å› trueï¼Œé‚£ä¹ˆè¿™ä¸ªè§†å›¾å°†è¦é…åˆå­è§†å›¾åµŒå¥—æ»šåŠ¨ã€‚å½“åµŒå¥—æ»šåŠ¨ç»“æŸæ—¶ä¼šè°ƒç”¨åˆ° onStopNestedScroll(View)ã€‚ * * @param child å¯æ»šåŠ¨çš„å­è§†å›¾ * @param target NestedScrollingParent çš„ç›´æ¥å¯æ»šåŠ¨çš„è§†å›¾ï¼Œä¸€èˆ¬æƒ…å†µå°±æ˜¯ child * @param nestedScrollAxes åŒ…å« ViewCompat#SCROLL_AXIS_HORIZONTAL, ViewCompat#SCROLL_AXIS_VERTICAL æˆ–è€…ä¸¤ä¸ªå€¼éƒ½æœ‰ã€‚ * @return è¿”å› true è¡¨ç¤ºå“åº”å­è§†å›¾çš„æ»šåŠ¨ã€‚ */ public boolean onStartNestedScroll(View child, View target, int nestedScrollAxes); /** * å¦‚æœ onStartNestedScroll è¿”å› true ï¼Œç„¶åèµ°è¯¥æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œå¯ä»¥åšä¸€äº›åˆå§‹åŒ–ã€‚ */ public void onNestedScrollAccepted(View child, View target, int nestedScrollAxes); /** * å­è§†å›¾å¼€å§‹æ»šåŠ¨å‰ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è¿™æ—¶å€™çˆ¶å¸ƒå±€ï¼ˆä¹Ÿå°±æ˜¯å½“å‰çš„ NestedScrollingParent çš„å®ç°ç±»ï¼‰å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥é…åˆå­è§†å›¾åŒæ—¶å¤„ç†æ»šåŠ¨äº‹ä»¶ã€‚ * * @param target æ»šåŠ¨çš„å­è§†å›¾ * @param dx ç»å¯¹å€¼ä¸ºæ‰‹æŒ‡åœ¨xæ–¹å‘æ»šåŠ¨çš„è·ç¦»ï¼Œdx&lt;0 è¡¨ç¤ºæ‰‹æŒ‡åœ¨å±å¹•å‘å³æ»šåŠ¨ * @param dy ç»å¯¹å€¼ä¸ºæ‰‹æŒ‡åœ¨yæ–¹å‘æ»šåŠ¨çš„è·ç¦»ï¼Œdy&lt;0 è¡¨ç¤ºæ‰‹æŒ‡åœ¨å±å¹•å‘ä¸‹æ»šåŠ¨ * @param consumed ä¸€ä¸ªæ•°ç»„ï¼Œå€¼ç”¨æ¥è¡¨ç¤ºçˆ¶å¸ƒå±€æ¶ˆè€—äº†å¤šå°‘è·ç¦»ï¼Œæœªæ¶ˆè€—å‰ä¸º[0,0], å¦‚æœçˆ¶å¸ƒå±€æƒ³å¤„ç†æ»šåŠ¨äº‹ä»¶ï¼Œå°±å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•çš„å®ç°ä¸­ä¸ºconsumed[0]ï¼Œconsumed[1]èµ‹å€¼ã€‚ * åˆ†åˆ«è¡¨ç¤ºxå’Œyæ–¹å‘æ¶ˆè€—çš„è·ç¦»ã€‚å¦‚çˆ¶å¸ƒå±€æƒ³åœ¨ç«–ç›´æ–¹å‘ï¼ˆyï¼‰å®Œå…¨æ‹¦æˆªå­è§†å›¾ï¼Œé‚£ä¹ˆè®© consumed[1] = dyï¼Œå°±æŠŠæ‰‹æŒ‡äº§ç”Ÿçš„è§¦æ‘¸äº‹ä»¶ç»™æ‹¦æˆªäº†ï¼Œå­è§†å›¾ä¾¿å“åº”ä¸åˆ°è§¦æ‘¸äº‹ä»¶äº† ã€‚ */ public void onNestedPreScroll(View target, int dx, int dy, int[] consumed); /** * è¿™ä¸ªæ–¹æ³•è¡¨ç¤ºå­è§†å›¾æ­£åœ¨æ»šåŠ¨ï¼Œå¹¶ä¸”æŠŠæ»šåŠ¨è·ç¦»å›è°ƒç”¨åˆ°è¯¥æ–¹æ³•ï¼Œå‰ææ˜¯ onStartNestedScroll è¿”å›äº† trueã€‚ * &lt;p&gt;Both the consumed and unconsumed portions of the scroll distance are reported to the * ViewParent. An implementation may choose to use the consumed portion to match or chase scroll * position of multiple child elements, for example. The unconsumed portion may be used to * allow continuous dragging of multiple scrolling or draggable elements, such as scrolling * a list within a vertical drawer where the drawer begins dragging once the edge of inner * scrolling content is reached.&lt;/p&gt; * * @param target æ»šåŠ¨çš„å­è§†å›¾ * @param dxConsumed æ‰‹æŒ‡äº§ç”Ÿçš„è§¦æ‘¸è·ç¦»ä¸­ï¼Œå­è§†å›¾æ¶ˆè€—çš„xæ–¹å‘çš„è·ç¦» * @param dyConsumed æ‰‹æŒ‡äº§ç”Ÿçš„è§¦æ‘¸è·ç¦»ä¸­ï¼Œå­è§†å›¾æ¶ˆè€—çš„yæ–¹å‘çš„è·ç¦» ï¼Œå¦‚æœ onNestedPreScroll ä¸­ dy = 20ï¼Œ consumed[0] = 8ï¼Œé‚£ä¹ˆ dy = 12 * @param dxUnconsumed æ‰‹æŒ‡äº§ç”Ÿçš„è§¦æ‘¸è·ç¦»ä¸­ï¼Œæœªè¢«å­è§†å›¾æ¶ˆè€—çš„xæ–¹å‘çš„è·ç¦» * @param dyUnconsumed æ‰‹æŒ‡äº§ç”Ÿçš„è§¦æ‘¸è·ç¦»ä¸­ï¼Œæœªè¢«å­è§†å›¾æ¶ˆè€—çš„yæ–¹å‘çš„è·ç¦» */ public void onNestedScroll(View target, int dxConsumed, int dyConsumed,int dxUnconsumed, int dyUnconsumed); /** * å“åº”åµŒå¥—æ»šåŠ¨ç»“æŸ * * å½“ä¸€ä¸ªåµŒå¥—æ»šåŠ¨ç»“æŸåï¼ˆå¦‚MotionEvent#ACTION_UPï¼Œ MotionEvent#ACTION_CANCELï¼‰ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼Œåœ¨è¿™é‡Œå¯æœ‰åšä¸€äº›æ”¶å°¾å·¥ä½œï¼Œæ¯”å¦‚å˜é‡é‡ç½® */ public void onStopNestedScroll(View target); /** * æ‰‹æŒ‡åœ¨å±å¹•å¿«é€Ÿæ»‘è§¦å‘Flingå‰å›è°ƒï¼Œå¦‚æœå‰é¢ onNestedPreScroll ä¸­çˆ¶å¸ƒå±€æ¶ˆè€—äº†äº‹ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªä¹Ÿä¼šè¢«è§¦å‘ * è¿”å›trueè¡¨ç¤ºçˆ¶å¸ƒå±€å®Œå…¨å¤„ç† fling äº‹ä»¶ * * @param target æ»šåŠ¨çš„å­è§†å›¾ * @param velocityX xæ–¹å‘çš„é€Ÿåº¦ï¼ˆpx/sï¼‰ * @param velocityY yæ–¹å‘çš„é€Ÿåº¦ * @return true if this parent consumed the fling ahead of the target view */ public boolean onNestedPreFling(View target, float velocityX, float velocityY); /** * å­è§†å›¾fling æ—¶å›è°ƒï¼Œçˆ¶å¸ƒå±€å¯ä»¥é€‰æ‹©ç›‘å¬å­è§†å›¾çš„ flingã€‚ * true è¡¨ç¤ºçˆ¶å¸ƒå±€å¤„ç† flingï¼Œfalseè¡¨ç¤ºçˆ¶å¸ƒå±€ç›‘å¬å­è§†å›¾çš„fling * * @param target View that initiated the nested scroll * @param velocityX Horizontal velocity in pixels per second * @param velocityY Vertical velocity in pixels per second * @param consumed true è¡¨ç¤ºå­è§†å›¾å¤„ç†äº†fling */ public boolean onNestedFling(View target, float velocityX, float velocityY, boolean consumed); /** * è¿”å›å½“å‰ NestedScrollingParent çš„æ»šåŠ¨æ–¹å‘ï¼Œ * * @return * @see ViewCompat#SCROLL_AXIS_HORIZONTAL * @see ViewCompat#SCROLL_AXIS_VERTICAL * @see ViewCompat#SCROLL_AXIS_NONE */ public int getNestedScrollAxes();&#125; çœ‹ä¸€ä¸‹ SwipeRefreshLayout å®ç° NestedScrollingParent çš„ç›¸å…³æ–¹æ³•123456789101112131415161718// NestedScrollingParent// å­ View ï¼ˆNestedScrollingChildï¼‰å¼€å§‹æ»šåŠ¨å‰å›è°ƒæ­¤æ–¹æ³•,è¿”å› true è¡¨ç¤ºæ¥ Parent æ”¶åµŒå¥—æ»šåŠ¨ï¼Œç„¶åè°ƒç”¨ onNestedScrollAccepted// å…·ä½“å¯ä»¥çœ‹ NestedScrollingChildHelper çš„æºç @Overridepublic boolean onStartNestedScroll(View child, View target, int nestedScrollAxes) &#123; // å­ View å›è°ƒï¼Œåˆ¤æ–­æ˜¯å¦å¼€å§‹åµŒå¥—æ»šåŠ¨ ï¼Œ return isEnabled() &amp;&amp; !mReturningToStart &amp;&amp; !mRefreshing &amp;&amp; (nestedScrollAxes &amp; ViewCompat.SCROLL_AXIS_VERTICAL) != 0;&#125;@Override public void onNestedScrollAccepted(View child, View target, int axes) &#123; // Reset the counter of how much leftover scroll needs to be consumed. mNestedScrollingParentHelper.onNestedScrollAccepted(child, target, axes); // ...çœç•¥ä»£ç  &#125; SwipeRefreshLayout åªæ¥å—ç«–ç›´æ–¹å‘ï¼ˆYè½´ï¼‰çš„æ»šåŠ¨ï¼Œå¹¶ä¸”åœ¨åˆ·æ–°åŠ¨ç”»è¿›è¡Œä¸­ä¸æ¥å—æ»šåŠ¨ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546// NestedScrollingChild åœ¨æ»šåŠ¨çš„æ—¶å€™ä¼šè§¦å‘ï¼Œ çœ‹çˆ¶ç±»æ¶ˆè€—äº†å¤šå°‘è·ç¦»// * @param dx x è½´æ»šåŠ¨çš„è·ç¦»// * @param dy y è½´æ»šåŠ¨çš„è·ç¦»// * @param consumed ä»£è¡¨ çˆ¶ View æ¶ˆè´¹çš„æ»šåŠ¨è·ç¦»//@Overridepublic void onNestedPreScroll(View target, int dx, int dy, int[] consumed) &#123; // dy &gt; 0 è¡¨ç¤ºæ‰‹æŒ‡åœ¨å±å¹•å‘ä¸Šç§»åŠ¨ // mTotalUnconsumed è¡¨ç¤ºå­è§†å›¾Yè½´æœªæ¶ˆè´¹çš„è·ç¦» // ç°åœ¨è¡¨ç¤º if (dy &gt; 0 &amp;&amp; mTotalUnconsumed &gt; 0) &#123; if (dy &gt; mTotalUnconsumed) &#123; consumed[1] = dy - (int) mTotalUnconsumed; // SwipeRefreshLayout å°±å§å­è§†å›¾ä½æ¶ˆè´¹çš„è·ç¦»å…¨éƒ¨æ¶ˆè´¹äº†ã€‚ mTotalUnconsumed = 0; &#125; else &#123; mTotalUnconsumed -= dy; // æ¶ˆè´¹çš„ y è½´çš„è·ç¦» consumed[1] = dy; &#125; // å‡ºç°åŠ¨ç”»åœ†åœˆï¼Œå¹¶å‘ä¸Šç§»åŠ¨ moveSpinner(mTotalUnconsumed); &#125; // ... çœç•¥ä»£ç &#125;// onStartNestedScroll è¿”å› true æ‰ä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚æ­¤æ–¹æ³•è¡¨ç¤ºå­Viewå°†æ»šåŠ¨äº‹ä»¶åˆ†å‘åˆ°çˆ¶ Viewï¼ˆSwipeRefreshLayoutï¼‰@Overridepublic void onNestedScroll(final View target, final int dxConsumed, final int dyConsumed, final int dxUnconsumed, final int dyUnconsumed) &#123; // ... çœç•¥ä»£ç  // This is a bit of a hack. Nested scrolling works from the bottom up, and as we are // sometimes between two nested scrolling views, we need a way to be able to know when any // nested scrolling parent has stopped handling events. We do that by using the // 'offset in window 'functionality to see if we have been moved from the event. // This is a decent indication of whether we should take over the event stream or not. // æ‰‹æŒ‡åœ¨å±å¹•ä¸Šå‘ä¸‹æ»šåŠ¨ï¼Œå¹¶ä¸”å­è§†å›¾ä¸å¯ä»¥æ»šåŠ¨ final int dy = dyUnconsumed + mParentOffsetInWindow[1]; if (dy &lt; 0 &amp;&amp; !canChildScrollUp()) &#123; mTotalUnconsumed += Math.abs(dy); moveSpinner(mTotalUnconsumed); &#125;&#125; SwipeRefreshLayout é€šè¿‡ NestedScrollingParent æ¥å£å®Œæˆäº†å¤„ç†å­è§†å›¾çš„æ»šåŠ¨çš„å†²çªï¼Œä¸­é—´çœç•¥äº†ä¸€äº› SwipeRefreshLayoutä½œä¸º child çš„ç›¸å…³ä»£ç ï¼Œè¿™ç§æƒ…å†µæ˜¯ä¸ºäº†å…¼å®¹å°† SwipeRefreshLayout ä½œä¸ºå­è§†å›¾æ”¾åœ¨çŸ¥è¯†åµŒå¥—æ»šåŠ¨çš„çˆ¶å¸ƒå±€çš„æƒ…å†µï¼Œè¿™é‡Œä¸åšæ·±å…¥è®¨è®ºã€‚ä½†æ˜¯ä¸‹æ‹‰åˆ·æ–°éœ€è¦åˆ¤æ–­æ‰‹æŒ‡åœ¨å±å¹•çš„çŠ¶æ€æ¥è¿›è¡Œä¸€ä¸ªåˆ·æ–°çš„åŠ¨ç”»ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œåˆ¤æ–­æ‰‹æŒ‡åœ¨å±å¹•ä¸­çš„çŠ¶æ€ã€‚ é¦–å…ˆæ˜¯ onInterceptTouchEventï¼Œè¿”å› true è¡¨ç¤ºæ‹¦æˆªè§¦æ‘¸äº‹ä»¶ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566@Overridepublic boolean onInterceptTouchEvent(MotionEvent ev) &#123; ensureTarget(); final int action = MotionEventCompat.getActionMasked(ev); // æ‰‹æŒ‡æŒ‰ä¸‹æ—¶æ¢å¤çŠ¶æ€ if (mReturningToStart &amp;&amp; action == MotionEvent.ACTION_DOWN) &#123; mReturningToStart = false; &#125; // æ§ä»¶å¯ç”¨ || åˆ·æ–°äº‹ä»¶åˆšç»“æŸæ­£åœ¨æ¢å¤åˆå§‹çŠ¶æ€æ—¶ || å­ View å¯æ»šåŠ¨ || æ­£åœ¨åˆ·æ–° || çˆ¶ View æ­£åœ¨æ»šåŠ¨ if (!isEnabled() || mReturningToStart || canChildScrollUp() || mRefreshing || mNestedScrollInProgress) &#123; // Fail fast if we're not in a state where a swipe is possible return false; &#125; switch (action) &#123; case MotionEvent.ACTION_DOWN: setTargetOffsetTopAndBottom(mOriginalOffsetTop - mCircleView.getTop(), true); mActivePointerId = MotionEventCompat.getPointerId(ev, 0); mIsBeingDragged = false; // è®°å½•æ‰‹æŒ‡æŒ‰ä¸‹çš„ä½ç½®ï¼Œä¸ºäº†åˆ¤æ–­æ˜¯å¦å¼€å§‹æ»šåŠ¨ final float initialDownY = getMotionEventY(ev, mActivePointerId); if (initialDownY == -1) &#123; return false; &#125; mInitialDownY = initialDownY; break; case MotionEvent.ACTION_MOVE: if (mActivePointerId == INVALID_POINTER) &#123; Log.e(LOG_TAG, \"Got ACTION_MOVE event but don't have an active pointer id.\"); return false; &#125; final float y = getMotionEventY(ev, mActivePointerId); if (y == -1) &#123; return false; &#125; // åˆ¤æ–­å½“æ‹–åŠ¨è·ç¦»å¤§äºæœ€å°è·ç¦»æ—¶è®¾ç½® mIsBeingDragged = true; final float yDiff = y - mInitialDownY; if (yDiff &gt; mTouchSlop &amp;&amp; !mIsBeingDragged) &#123; mInitialMotionY = mInitialDownY + mTouchSlop; mIsBeingDragged = true; // æ­£åœ¨æ‹–åŠ¨çŠ¶æ€ï¼Œæ›´æ–°åœ†åœˆçš„ progressbar çš„ alpha å€¼ mProgress.setAlpha(STARTING_PROGRESS_ALPHA); &#125; break; case MotionEventCompat.ACTION_POINTER_UP: onSecondaryPointerUp(ev); break; case MotionEvent.ACTION_UP: case MotionEvent.ACTION_CANCEL: mIsBeingDragged = false; mActivePointerId = INVALID_POINTER; break; &#125; return mIsBeingDragged;&#125; å¯ä»¥çœ‹åˆ°æºç ä¹Ÿå°±æ˜¯è¿›è¡Œç®€å•å¤„ç†ï¼ŒDOWN çš„æ—¶å€™è®°å½•ä¸€ä¸‹ä½ç½®ï¼ŒMOVE æ—¶åˆ¤æ–­ç§»åŠ¨çš„è·ç¦»ï¼Œè¿”å›å€¼ mIsBeingDragged ä¸º true æ—¶ï¼Œ å³ onInterceptTouchEvent è¿”å›trueï¼ŒSwipeRefreshLayout æ‹¦æˆªè§¦æ‘¸äº‹ä»¶ï¼Œä¸åˆ†å‘ç»™ mTargetï¼Œç„¶åæŠŠ MotionEvent ä¼ ç»™ onTouchEvent æ–¹æ³•ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªåˆ¤æ–­å­Viewçš„æ˜¯å¦è¿˜å¯ä»¥æ»šåŠ¨çš„æ–¹æ³• canChildScrollUpã€‚ 12345678910111213141516171819/** * @return Whether it is possible for the child view of this layout to * scroll up. Override this if the child view is a custom view. */public boolean canChildScrollUp() &#123; if (android.os.Build.VERSION.SDK_INT &lt; 14) &#123; // åˆ¤æ–­ AbsListView çš„å­ç±» ListView æˆ–è€… GridView ç­‰ if (mTarget instanceof AbsListView) &#123; final AbsListView absListView = (AbsListView) mTarget; return absListView.getChildCount() &gt; 0 &amp;&amp; (absListView.getFirstVisiblePosition() &gt; 0 || absListView.getChildAt(0) .getTop() &lt; absListView.getPaddingTop()); &#125; else &#123; return ViewCompat.canScrollVertically(mTarget, -1) || mTarget.getScrollY() &gt; 0; &#125; &#125; else &#123; return ViewCompat.canScrollVertically(mTarget, -1); &#125;&#125; å½“SwipeRefreshLayout æ‹¦æˆªäº†è§¦æ‘¸äº‹ä»¶ä¹‹åï¼ˆ mIsBeingDragged ä¸º true ï¼‰ï¼Œå°† MotionEvent äº¤ç»™ onTouchEvent å¤„ç†ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152@Overridepublic boolean onTouchEvent(MotionEvent ev) &#123; // ... çœç•¥ä»£ç  switch (action) &#123; case MotionEvent.ACTION_DOWN: // è·å–ç¬¬ä¸€ä¸ªæŒ‰ä¸‹çš„æ‰‹æŒ‡ mActivePointerId = MotionEventCompat.getPointerId(ev, 0); mIsBeingDragged = false; break; case MotionEvent.ACTION_MOVE: &#123; // å¤„ç†å¤šæŒ‡è§¦æ§ pointerIndex = MotionEventCompat.findPointerIndex(ev, mActivePointerId); // ... çœç•¥ä»£ç  final float y = MotionEventCompat.getY(ev, pointerIndex); final float overscrollTop = (y - mInitialMotionY) * DRAG_RATE; if (mIsBeingDragged) &#123; if (overscrollTop &gt; 0) &#123; // æ­£åœ¨æ‹–åŠ¨çŠ¶æ€ï¼Œæ›´æ–°åœ†åœˆçš„ä½ç½® moveSpinner(overscrollTop); &#125; else &#123; return false; &#125; &#125; break; &#125; // ... çœç•¥ä»£ç  case MotionEvent.ACTION_UP: &#123; pointerIndex = MotionEventCompat.findPointerIndex(ev, mActivePointerId); if (pointerIndex &lt; 0) &#123; Log.e(LOG_TAG, \"Got ACTION_UP event but don't have an active pointer id.\"); return false; &#125; final float y = MotionEventCompat.getY(ev, pointerIndex); final float overscrollTop = (y - mInitialMotionY) * DRAG_RATE; mIsBeingDragged = false; // æ‰‹æŒ‡æ¾å¼€ï¼Œå°†åœ†åœˆç§»åŠ¨åˆ°æ­£ç¡®çš„ä½ç½® finishSpinner(overscrollTop); mActivePointerId = INVALID_POINTER; return false; &#125; // ... çœç•¥ä»£ç  &#125; return true;&#125; åœ¨æ‰‹æŒ‡æ»šåŠ¨è¿‡ç¨‹ä¸­é€šè¿‡åˆ¤æ–­ mIsBeingDragged æ¥ç§»åŠ¨åˆ·æ–°çš„åœ†åœˆï¼ˆå¯¹åº”çš„æ˜¯ moveSpinner ï¼‰ï¼Œæ‰‹æŒ‡æ¾å¼€å°†åœ†åœˆç§»åŠ¨åˆ°æ­£ç¡®ä½ç½®ï¼ˆåˆå§‹ä½ç½®æˆ–è€…åˆ·æ–°åŠ¨ç”»çš„ä½ç½®ï¼Œå¯¹åº”çš„æ˜¯ finishSpinner æ–¹æ³•ï¼‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566// æ‰‹æŒ‡ä¸‹æ‹‰è¿‡ç¨‹ä¸­è§¦å‘çš„åœ†åœˆçš„å˜åŒ–è¿‡ç¨‹ï¼Œé€æ˜åº¦å˜åŒ–ï¼Œæ¸æ¸å‡ºç°ç®­å¤´ï¼Œå¤§å°çš„å˜åŒ–private void moveSpinner(float overscrollTop) &#123; // è®¾ç½®ä¸ºæœ‰ç®­å¤´çš„ progress mProgress.showArrow(true); // è¿›åº¦è½¬åŒ–æˆç™¾åˆ†æ¯” float originalDragPercent = overscrollTop / mTotalDragDistance; // é¿å…ç™¾åˆ†æ¯”è¶…è¿‡ 100% float dragPercent = Math.min(1f, Math.abs(originalDragPercent)); // è°ƒæ•´æ‹–åŠ¨ç™¾åˆ†æ¯”ï¼Œé€ æˆè§†å·®æ•ˆæœ float adjustedPercent = (float) Math.max(dragPercent - .4, 0) * 5 / 3; // float extraOS = Math.abs(overscrollTop) - mTotalDragDistance; // è¿™é‡ŒmUsingCustomStart ä¸º true ä»£è¡¨ç”¨æˆ·è‡ªå®šä¹‰äº†èµ·å§‹å‡ºç°çš„åæ ‡ float slingshotDist = mUsingCustomStart ? mSpinnerFinalOffset - mOriginalOffsetTop : mSpinnerFinalOffset; // å¼¹æ€§ç³»æ•° float tensionSlingshotPercent = Math.max(0, Math.min(extraOS, slingshotDist * 2) / slingshotDist); float tensionPercent = (float) ((tensionSlingshotPercent / 4) - Math.pow( (tensionSlingshotPercent / 4), 2)) * 2f; float extraMove = (slingshotDist) * tensionPercent * 2; // å› ä¸ºæœ‰å¼¹æ€§ç³»æ•°ï¼Œä¸åŒçš„æ‰‹æŒ‡æ»šåŠ¨è·ç¦»ä¸åŒäºviewçš„ç§»åŠ¨è·ç¦» int targetY = mOriginalOffsetTop + (int) ((slingshotDist * dragPercent) + extraMove); // where 1.0f is a full circle if (mCircleView.getVisibility() != View.VISIBLE) &#123; mCircleView.setVisibility(View.VISIBLE); &#125; // è®¾ç½®çš„æ˜¯å¦æœ‰ç¼©æ”¾ if (!mScale) &#123; ViewCompat.setScaleX(mCircleView, 1f); ViewCompat.setScaleY(mCircleView, 1f); &#125; // è®¾ç½®ç¼©æ”¾è¿›åº¦ if (mScale) &#123; setAnimationProgress(Math.min(1f, overscrollTop / mTotalDragDistance)); &#125; // ç§»åŠ¨è·ç¦»æœªè¾¾åˆ°æœ€å¤§è·ç¦» if (overscrollTop &lt; mTotalDragDistance) &#123; if (mProgress.getAlpha() &gt; STARTING_PROGRESS_ALPHA &amp;&amp; !isAnimationRunning(mAlphaStartAnimation)) &#123; // Animate the alpha startProgressAlphaStartAnimation(); &#125; &#125; else &#123; if (mProgress.getAlpha() &lt; MAX_ALPHA &amp;&amp; !isAnimationRunning(mAlphaMaxAnimation)) &#123; // Animate the alpha startProgressAlphaMaxAnimation(); &#125; &#125; // å‡ºç°çš„è¿›åº¦ï¼Œè£å‰ª mProgress float strokeStart = adjustedPercent * .8f; mProgress.setStartEndTrim(0f, Math.min(MAX_PROGRESS_ANGLE, strokeStart)); mProgress.setArrowScale(Math.min(1f, adjustedPercent)); // æ—‹è½¬ float rotation = (-0.25f + .4f * adjustedPercent + tensionPercent * 2) * .5f; mProgress.setProgressRotation(rotation); setTargetOffsetTopAndBottom(targetY - mCurrentTargetOffsetTop, true /* requires update */);&#125; åˆ·æ–°åœ†åœˆçš„ç§»åŠ¨è¿‡ç¨‹ä¹Ÿæ˜¯æœ‰å¥½å‡ ç§çŠ¶æ€ï¼Œçœ‹ä¸Šé¢çš„æ³¨é‡ŠåŸºæœ¬ä¸Šå°±æ¯”è¾ƒæ¸…æ¥šäº†ã€‚ 12345678910111213141516private void finishSpinner(float overscrollTop) &#123; if (overscrollTop &gt; mTotalDragDistance) &#123; //ç§»åŠ¨è·ç¦»è¶…è¿‡äº†åˆ·æ–°çš„ä¸´ç•Œå€¼ï¼Œè§¦å‘åˆ·æ–°åŠ¨ç”» setRefreshing(true, true /* notify */); &#125; else &#123; // å–æ¶ˆåˆ·æ–°çš„åœ†åœˆï¼Œå°†åœ†åœˆç§»åŠ¨åˆ°åˆå§‹ä½ç½® mRefreshing = false; mProgress.setStartEndTrim(0f, 0f); // ...çœç•¥ä»£ç  // ç§»åŠ¨åˆ°åˆå§‹ä½ç½® animateOffsetToStartPosition(mCurrentTargetOffsetTop, listener); // è®¾ç½®æ²¡æœ‰ç®­å¤´ mProgress.showArrow(false) &#125;&#125; å¯ä»¥çœ‹åˆ°è°ƒç”¨ setRefresh(true,true) æ–¹æ³•è§¦å‘åˆ·æ–°åŠ¨ç”»å¹¶è¿›è¡Œå›è°ƒï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æ˜¯ private çš„ã€‚å‰é¢æåˆ°æˆ‘ä»¬è‡ªå·±è°ƒç”¨ setRefresh(true) åªèƒ½äº§ç”ŸåŠ¨ç”»ï¼Œè€Œä¸èƒ½å›è°ƒåˆ·æ–°å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨åå°„è°ƒç”¨ 2 ä¸ªå‚æ•°çš„ setRefresh å‡½æ•°ã€‚ æˆ–è€…æ‰‹åŠ¨è°ƒ setRefreshing(true)+ OnRefreshListener.onRefresh æ–¹æ³•ã€‚ setRefresh123456789101112131415161718192021222324/** * æ”¹å˜åˆ·æ–°åŠ¨ç”»çš„çš„åœ†åœˆåˆ·æ–°çŠ¶æ€ã€‚Notify the widget that refresh state has changed. Do not call this when * refresh is triggered by a swipe gesture. * * @param refreshing æ˜¯å¦æ˜¾ç¤ºåˆ·æ–°çš„åœ†åœˆ */ public void setRefreshing(boolean refreshing) &#123; if (refreshing &amp;&amp; mRefreshing != refreshing) &#123; // scale and show mRefreshing = refreshing; int endTarget = 0; if (!mUsingCustomStart) &#123; endTarget = (int) (mSpinnerFinalOffset + mOriginalOffsetTop); &#125; else &#123; endTarget = (int) mSpinnerFinalOffset; &#125; setTargetOffsetTopAndBottom(endTarget - mCurrentTargetOffsetTop, true /* requires update */); mNotify = false; startScaleUpAnimation(mRefreshListener); &#125; else &#123; setRefreshing(refreshing, false /* notify */); &#125; &#125; startScaleUpAnimation å¼€å¯ä¸€ä¸ªåŠ¨ç”»ï¼Œç„¶ååœ¨åŠ¨ç”»ç»“æŸåå›è°ƒ onRefresh æ–¹æ³•ã€‚ 12345678910111213141516171819private Animation.AnimationListener mRefreshListener = new Animation.AnimationListener() &#123; // .. çœç•¥ä»£ç  @Override public void onAnimationEnd(Animation animation) &#123; if (mRefreshing) &#123; mProgress.setAlpha(MAX_ALPHA); //ç¡®ä¿åˆ·æ–°åœ†åœˆä¸­é—´çš„è¿›åº¦æ¡æ˜¯å®Œå…¨ä¸é€æ˜äº† mProgress.start(); if (mNotify) &#123; // å½“ mNotify ä¸º true æ—¶æ‰ä¼šå›è°ƒ onRefresh if (mListener != null) &#123; // å›è°ƒ listener çš„ onRefresh æ–¹æ³• mListener.onRefresh(); &#125; &#125; mCurrentTargetOffsetTop = mCircleView.getTop(); &#125; else &#123; reset(); &#125; &#125;&#125;; æ€»ç»“åˆ†æ SwipeRefreshLayout çš„æµç¨‹å°±æ˜¯æŒ‰ç…§å¹³æ—¶æˆ‘ä»¬è‡ªå®šä¹‰ ViewGroup çš„æµç¨‹ï¼Œä½†æ˜¯å…¶ä¸­ä¹Ÿæœ‰å¥½å¤šéœ€è¦æˆ‘ä»¬å€Ÿé‰´çš„åœ°æ–¹ï¼Œå¦‚ä½•ä½¿ç”¨ NestedScrollingç›¸å…³æœºåˆ¶ ï¼Œå¤šç‚¹è§¦æ§çš„å¤„ç†ï¼ŒonMeasure ä¸­å‡å»äº† paddingï¼Œå¦‚ä½•åˆ¤æ–­å­ View æ˜¯å¦å¯æ»šåŠ¨ï¼Œå¦‚ä½•ç¡®å®š ViewGroup ä¸­æŸä¸€ä¸ª View çš„ç´¢å¼•ç­‰ã€‚æ­¤å¤–ï¼Œä¸€ä¸ªå¥½çš„ä¸‹æ‹‰åˆ·æ–°æ¡†æ¶ä¸ä»…ä»…è¦å…¼å®¹å„ç§æ»šåŠ¨çš„å­æ§ä»¶ï¼Œè¿˜è¦è€ƒè™‘è‡ªå·±è¦å…¼å®¹ NestedScrollingChild çš„æƒ…å†µï¼Œæ¯”å¦‚æ”¾åˆ° CooCoordinatorLayout çš„æƒ…å†µï¼Œç›®å‰å¤§å¤šæ•°å¼€æºçš„ä¸‹æ‹‰åˆ·æ–°å¥½åƒéƒ½æ²¡æœ‰è¾¾åˆ°è¿™ä¸ªè¦æ±‚ï¼Œä¸€èˆ¬éƒ½æ˜¯åªè€ƒè™‘äº†å†…éƒ¨åµŒå¥—æ»šåŠ¨å­è§†å›¾çš„æƒ…å†µï¼Œæ²¡æœ‰è€ƒè™‘è‡ªå·±ä½œä¸ºæ»šåŠ¨å­è§†å›¾çš„æƒ…å†µã€‚ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"SearchViewæºç è§£æ","date":"2017-07-26T11:59:27.000Z","path":"2017/07/26/SearchViewæºç è§£æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ SearchViewæºç è§£æSearchViewæ˜¯ä¸€ä¸ªæœç´¢æ¡†æ§ä»¶ï¼Œæ ·å¼ä¹ŸæŒºå¥½çœ‹çš„ã€‚è¿™æ¬¡è§£æä¸»è¦å›´ç»•android.support.v7.widgetåŒ…ä¸‹çš„SearchViewï¼ˆAPI &gt;= 7ï¼‰,android.widget.SearchViewæ”¯æŒAPI &gt;= 11ï¼Œå¦å¤–æœ‰ä¸ªandroid.support.v4.widget.SearchViewCompat 1. æºç è§£æv7ç‰ˆæœ¬ï¼š23.2.1 1.1 ç»§æ‰¿å…³ç³»12345java.lang.Object â†³ android.view.View â†³ android.view.ViewGroup â†³ android.support.v7.widget.LinearLayoutCompat â†³ android.support.v7.widget.SearchView 1.2 ä¸»è¦ç»„ä»¶12345678910private final SearchAutoComplete mSearchSrcTextView;private final View mSearchEditFrame;private final View mSearchPlate;private final View mSubmitArea;private final ImageView mSearchButton;private final ImageView mGoButton;private final ImageView mCloseButton;private final ImageView mVoiceButton;private final View mDropDownAnchor;private final ImageView mCollapsedIcon; çœ‹å‘½åä¹Ÿèƒ½å¤§æ¦‚çŸ¥é“æ§ä»¶å„è‡ªå……å½“äº†ä»€ä¹ˆè§’è‰²äº†ã€‚ 1.3 æ„é€ æ–¹æ³•å’Œè‡ªå®šä¹‰æ¥ä¸‹æ¥çœ‹æ„é€ æ–¹æ³•public SearchView(Context context, AttributeSet attrs, int defStyleAttr),v7çš„SearchViewå¹¶ä¸æ˜¯ç”¨TypedArrayè€Œæ˜¯ä½¿ç”¨TintTypedArrayï¼Œçœ‹äº†æºç å‘ç°TintTypedArrayé‡Œæœ‰ä¸ªï¼šfinal TypedArray mWrapped; ```æ‰€ä»¥ä¸»è¦è¿˜æ˜¯`TypedArray`ï¼Œä¸åŒç‚¹æ˜¯`getDrawable(int index)`å’Œæ–°åŠ çš„`getDrawableIfKnown(int index)`æ–¹æ³•ï¼Œ123456789101112131415å¹¶åœ¨æ»¡è¶³æ¡ä»¶ä¸‹ä¼šè°ƒç”¨`AppCompatDrawableManager.get().getDrawable(mContext, resourceId)`ã€‚ä¸ºäº†èƒ½æ›´å¥½çš„è‡ªå®šä¹‰ï¼Œ`SearchView`çš„layoutä¹Ÿæ˜¯å¯ä»¥æŒ‡å®šçš„ï¼Œä¸è¿‡è‡ªå®šä¹‰çš„layoutå¿…é¡»åŒ…æ‹¬ä¸Šé¢é‚£äº›æ§ä»¶ï¼ŒåŒæ—¶idä¹Ÿæ˜¯æŒ‡å®šçš„ï¼Œä¸ç„¶åé¢ä¼šæŠ¥é”™ï¼Œå› ä¸º`findViewById(id)`æ— æ³•æ‰¾åˆ°å„è‡ªæ§ä»¶ï¼Œç„¶åè°ƒç”¨æ§ä»¶æ–¹æ³•çš„æ—¶å€™å°±ã€‚ã€‚ã€‚æ„é€ æ–¹æ³•æœ€åæ˜¯æ›´æ–°æ§ä»¶çŠ¶æ€ï¼Œ`mIconifiedByDefault`é»˜è®¤æ˜¯`true`çš„ï¼Œ`setIconifiedByDefault(boolean iconified)`æ”¹å˜å€¼åä¹Ÿä¼šæ‰§è¡Œå¦‚ä¸‹æ–¹æ³•ï¼š```java public void setIconifiedByDefault(boolean iconified) &#123; if (mIconifiedByDefault == iconified) return; mIconifiedByDefault = iconified; //æ›´æ–°ç»„ä»¶ updateViewsVisibility(iconified); updateQueryHint(); &#125; æ‰€ä»¥setIconifiedByDefault(false)ä¼šè®©SearchViewä¸€ç›´å‘ˆç°å±•å¼€çŠ¶æ€ï¼Œå¹¶ä¸”è¾“å…¥æ¡†å†…iconä¹Ÿä¼šä¸æ˜¾ç¤ºã€‚å…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼Œè¯¥æ–¹æ³•åœ¨updateQueryHint()ä¸­è¢«è°ƒç”¨ï¼š12345678910111213141516private CharSequence getDecoratedHint(CharSequence hintText) &#123; //å¦‚æœmIconifiedByDefaultä¸ºfalseæˆ–è€…mSearchHintIconä¸ºnull //å°†ä¸ä¼šæ·»åŠ æœç´¢iconåˆ°æç¤ºhintä¸­ if (!mIconifiedByDefault || mSearchHintIcon == null) &#123; return hintText; &#125; final int textSize = (int) (mSearchSrcTextView.getTextSize() * 1.25); mSearchHintIcon.setBounds(0, 0, textSize, textSize); final SpannableStringBuilder ssb = new SpannableStringBuilder(\" \"); ssb.setSpan(new ImageSpan(mSearchHintIcon), 1, 2, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE); ssb.append(hintText); return ssb;&#125; 1.4 Listenerç„¶åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹SearchViewé‡Œé¢æœ‰å“ªäº›Listenerï¼š 1234567891011121314151617181920212223//é‡Œé¢æœ‰2ä¸ªæ–¹æ³•ï¼š //onQueryTextSubmit(String query)ï¼šå½“ç”¨æˆ·æäº¤æŸ¥è¯¢çš„æ—¶å€™ä¼šè°ƒç”¨ //onQueryTextChange(String newText)ï¼šå½“æŸ¥è¯¢æ–‡å­—æ”¹å˜çš„æ—¶å€™ä¼šè°ƒç”¨private OnQueryTextListener mOnQueryChangeListener;//é‡Œé¢æœ‰1ä¸ªæ–¹æ³•ï¼šboolean onClose(); //onClose()ï¼šå½“mCloseButtonè¢«ç‚¹å‡»å’ŒsetIconified(true)ä¼šåˆ¤æ–­æ˜¯å¦è°ƒç”¨ //æ˜¯å¦è°ƒç”¨æ˜¯åœ¨onCloseClicked()é‡Œåˆ¤æ–­ï¼Œåé¢ä¼šè¿›è¡Œåˆ†æprivate OnCloseListener mOnCloseListener;//Viewç±»é‡Œå®šä¹‰çš„æ¥å£private OnFocusChangeListener mOnQueryTextFocusChangeListener;//é‡Œé¢æœ‰2ä¸ªæ–¹æ³•ï¼š //onSuggestionSelect(int position)ï¼šé€‰æ‹©å»ºè®®å¯é€‰é¡¹ï¼ˆæœç´¢æ¡†ä¸‹æ–¹å‡ºç°çš„ï¼‰åè§¦å‘ //onSuggestionClick(int position)ï¼šç‚¹å‡»å»ºè®®å¯é€‰é¡¹åè§¦å‘private OnSuggestionListener mOnSuggestionListener;//Viewç±»é‡Œå®šä¹‰çš„æ¥å£private OnClickListener mOnSearchClickListener;//è¿˜æœ‰å…¶ä»–mOnClickListenerï¼ŒmTextKeyListenerç­‰ æˆ‘ä»¬çœ‹çœ‹OnQueryTextListeneræ˜¯æ€æ ·è¿›è¡Œç›‘å¬çš„ï¼š onQueryTextChange(String newText) 12//åœ¨æ„é€ æ–¹æ³•é‡Œæ·»åŠ äº†ç›‘å¬mSearchSrcTextView.addTextChangedListener(mTextWatcher); ç„¶ååœ¨mTextWatcherçš„onTextChanged()æ–¹æ³•é‡Œè°ƒç”¨äº†SearchViewçš„onTextChanged(CharSequence newText)æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿™é‡Œè¿›è¡Œäº†åˆ¤æ–­è§¦å‘: 12345678910111213private void onTextChanged(CharSequence newText) &#123; /** * çœç•¥ä»£ç ,ä¸»è¦æ˜¯æ›´æ–°ç»„ä»¶ */ //å½“listener!=nullå’Œå½“æ–‡æœ¬ä¸ä¸€æ ·çš„æ—¶å€™ä¼šè§¦å‘ã€‚ if (mOnQueryChangeListener != null &amp;&amp; !TextUtils.equals(newText, mOldQueryText)) &#123; mOnQueryChangeListener.onQueryTextChange(newText.toString()); &#125; //çœç•¥ä»£ç &#125; onQueryTextSubmit(String query) 12345678910111213141516171819202122232425262728293031323334353637//åŒåœ¨æ„é€ æ–¹æ³•é‡Œæ·»åŠ äº†ç›‘å¬mSearchSrcTextView.setOnEditorActionListener(mOnEditorActionListener);private final OnEditorActionListener mOnEditorActionListener = new OnEditorActionListener() &#123; /** * Called when the input method default action key is pressed. */ public boolean onEditorAction(TextView v, int actionId, KeyEvent event) &#123; onSubmitQuery(); return true; &#125;&#125;;private void onSubmitQuery() &#123; CharSequence query = mSearchSrcTextView.getText(); if (query != null &amp;&amp; TextUtils.getTrimmedLength(query) &gt; 0) &#123; //å½“ç›‘å¬OnQueryChangeListeneräº†ä¹‹åï¼Œ //å½“onQueryTextSubmit() return trueçš„è¯ï¼Œæ˜¯ä¸ä¼šæ‰§è¡Œä¸‹é¢æ“ä½œçš„ if (mOnQueryChangeListener == null || !mOnQueryChangeListener.onQueryTextSubmit(query.toString())) &#123; //è®¾ç½®äº†Searchableåï¼Œä¼šstartActivityåˆ°é…ç½®æŒ‡å®šçš„Activity if (mSearchable != null) &#123; launchQuerySearch(KeyEvent.KEYCODE_UNKNOWN, null, query.toString()); &#125; //è®¾ç½®é”®ç›˜æ˜¯å¦æ˜¾ç¤º setImeVisibility(false); //ä¸‹æ‹‰å¯é€‰é¡¹æ˜¯ç”¨ListPopupWindowæ˜¾ç¤ºçš„ï¼Œå…·ä½“å¯çœ‹ AutoCompleteTextView æºç  //æœç´¢æäº¤åï¼Œdismissåå°±ä¸ä¼šç»§ç»­æ˜¾ç¤ºè€ŒæŒ¡ä½å†…å®¹ä»€ä¹ˆçš„ dismissSuggestions(); &#125; &#125;&#125; åœ¨ifé‡ŒåŠ å…¥!mOnQueryChangeListener.onQueryTextSubmit(query.toString())ï¼Œè¿™æ ·åšå°±å¯ä»¥è®©ä½¿ç”¨è€…è‡ªå·±å†³å®šæ˜¯å¦å®Œå…¨è‡ªå·±å¤„ç†ï¼Œçµæ´»æ€§ä¹Ÿæ›´é«˜ã€‚ å…¶ä»–Listenerå·®ä¸å¤šä¹Ÿæ˜¯è¿™æ ·ï¼Œé‚£æ¥ä¸‹æ¥çœ‹çœ‹å…¶ä»–çš„ã€‚ 1.5 CollapsibleActionViewæ¥å£SearchViewå®ç°äº†CollapsibleActionViewæ¥å£ï¼šonActionViewExpanded()å’ŒonActionViewCollapsed(),å…·ä½“æ“ä½œå°±æ˜¯è®¾ç½®é”®ç›˜åŠæ§ä»¶ï¼Œå¹¶ä½¿ç”¨å…¨å±€å˜é‡mExpandedInActionViewè®°å½•ActionViewæ˜¯å¦ä¼¸å±•ã€‚åªæœ‰å½“SearchViewä½œä¸ºMenuItemçš„æ—¶å€™æ‰ä¼šè§¦å‘ï¼Œå¦‚æœæ˜¯ä½¿ç”¨v7åŒ…çš„è¯ï¼Œæƒ³è¦é€šè¿‡menuè·å–SearchViewå°±éœ€è¦ä½¿ç”¨MenuItemCompatç±»ï¼Œå…·ä½“å¯ä»¥çœ‹demoã€‚1MenuItemCompat.getActionView(android.view.MenuItem item); 1.6 çŠ¶æ€çš„ä¿å­˜å’Œæ¢å¤SearchViewè¦†å†™äº†onSaveInstanceState()å’ŒonRestoreInstanceState(Parcelable state)ç”¨æ¥ä¿å­˜å’Œæ¢å¤çŠ¶æ€ï¼Œä¸ºä»€ä¹ˆè¦è¦†å†™å‘¢ï¼Ÿå› ä¸ºéœ€è¦é¢å¤–ä¿å­˜boolean mIconifiedï¼Œä¸ºæ­¤è¿˜å»ºäº†ä¸ªå†…éƒ¨é™æ€ç±»SavedStateç”¨æ¥ä¿å­˜mIconifiedã€‚ 123456789//å®ç°äº†Parcelableåºåˆ—åŒ–static class SavedState extends BaseSavedState &#123; boolean isIconified; /** * çœç•¥å…¶ä»–ä»£ç  */&#125; 1.7 å…³äºSuggestionså’ŒSearchableå¦‚æœä½ ä½¿ç”¨äº†Suggestionsï¼Œè€Œä¸”æ²¡æœ‰setSearchableInfoï¼Œé‚£ä¹ˆå½“ä½ ç‚¹å‡»å»ºè®®å¯é€‰é¡¹çš„æ—¶å€™ä¼šlogï¼š 12345678W/SearchView: Search suggestions cursor at row 0 returned exception. java.lang.NullPointerException at android.support.v7.widget.SearchView.createIntentFromSuggestion(SearchView.java:1620) at android.support.v7.widget.SearchView.launchSuggestion(SearchView.java:1436) at android.support.v7.widget.SearchView.onItemClicked(SearchView.java:1349) at android.support.v7.widget.SearchView.access$1800(SearchView.java:103) at android.support.v7.widget.SearchView$10.onItemClick(SearchView.java:1373) ...... å®šä½åˆ°ç¬¬1620è¡Œï¼š 123456789101112131415161718192021222324252627private Intent createIntentFromSuggestion(Cursor c, int actionKey, String actionMsg) &#123; try &#123; // use specific action if supplied, or default action if supplied, or fixed default String action = getColumnString(c, SearchManager.SUGGEST_COLUMN_INTENT_ACTION); //åœ¨è¿™é‡Œå¹¶æ²¡æœ‰æ£€æŸ¥mSearchableæ˜¯å¦ä¸ºnull if (action == null &amp;&amp; Build.VERSION.SDK_INT &gt;= 8) &#123; action = mSearchable.getSuggestIntentAction(); //ç¬¬1620è¡Œ &#125; /** *çœç•¥éƒ¨åˆ†ä»£ç  */ return createIntent(action, dataUri, extraData, query, actionKey, actionMsg); &#125; catch (RuntimeException e ) &#123; /** *çœç•¥éƒ¨åˆ†ä»£ç  */ Log.w(LOG_TAG, \"Search suggestions cursor at row \" + rowNum + \" returned exception.\", e); return null; &#125;&#125; å‘ç°è°ƒç”¨mSearchableçš„æ–¹æ³•ä¹‹å‰å¹¶æ²¡æœ‰æ£€æŸ¥mSearchableæ˜¯å¦ä¸ºnullï¼Œå…¶ä»–åœ°æ–¹æ˜¯æœ‰åˆ¤æ–­çš„ï¼Œç”±äºåšäº†catchæ‰€ä»¥ä¸ä¼šcrashï¼Œä¹Ÿä¸å½±å“ä½¿ç”¨ï¼Œå¦å¤–ï¼Œå¦‚æœsetOnSuggestionListenerï¼š 1234567891011mSearchView.setOnQueryTextListener(new SearchView.OnQueryTextListener() &#123; @Override public boolean onQueryTextSubmit(String query) &#123; return false; &#125; @Override public boolean onQueryTextChange(String newText) &#123; return true; //è¿”å›true &#125;&#125;); onSuggestionClick(int position) è¿”å› true å°±ä¸ä¼šæ‰§è¡ŒcreateIntentFromSuggestion(~)ï¼Œä¹Ÿå°±ä¸ä¼šlogäº†ï¼Œä½†è¿™æ ·ï¼Œé”®ç›˜çš„éšè—å’Œå¯é€‰é¡¹popçš„dismissä¹Ÿä¸ä¼šæ‰§è¡Œï¼Œéœ€è¦è‡ªå·±å¤„ç†ï¼Œä½¿ç”¨SearchViewçš„clearFocus()æ–¹æ³•å°±èƒ½è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚ é‚£æ—¢ç„¶æ˜¯æŠ¥nullï¼Œé‚£å°±è®¾ç½®Searchableå§ï¼Œè®¾ç½®åæ˜¯ä¼šstartActivityçš„(æ‰§è¡Œå®ŒcreateIntentFromSuggestion(~)åå°±ä¼šæ‰§è¡Œ)ã€‚ç„¶åæ•ˆæœå°±æ˜¯å½“ä½ ç‚¹å‡»äº†å¯é€‰é¡¹å°±ä¼šstartActivityï¼Œçœ‹éœ€æ±‚åšé€‰æ‹©å§ã€‚ã€‚ 1.8 è¯­éŸ³æœç´¢åŠŸèƒ½SearchViewè¿˜æœ‰è¯­éŸ³æœç´¢åŠŸèƒ½(API &gt;= 8)ï¼Œéœ€è¦é€šè¿‡é…ç½®Searchableæ¥å¼€å¯ï¼Œåœ¨xmlé…ç½®æ–‡ä»¶ä¸­åŠ å…¥ï¼š 1android:voiceSearchMode=\"showVoiceSearchButton|launchRecognizer\" showVoiceSearchButtonæ˜¾ç¤ºè¯­éŸ³æœç´¢æŒ‰é’®ï¼ŒlaunchRecognizerè¡¨ç¤ºè¦å¯åŠ¨ä¸€ä¸ªè¯­éŸ³è¯†åˆ«å™¨æ¥è½¬æ¢æˆæ–‡å­—ä¼ ç»™æŒ‡å®šçš„searchable activityã€‚æœ‰ä¸ªå…¨å±€å˜é‡boolean mVoiceButtonEnabledè¡¨ç¤ºæ˜¯å¦å¯ç”¨ï¼Œåœ¨setSearchableInfo(~)æ–¹æ³•é‡Œè¿›è¡Œäº†è®¾ç½®ï¼š 1mVoiceButtonEnabled = IS_AT_LEAST_FROYO &amp;&amp; hasVoiceSearch(); IS_AT_LEAST_FROYOæ˜¯Build.VERSION.SDK_INT &gt;= 8ï¼Œä¸ºäº†ç¡®ä¿æ­£ç¡®æ€§ï¼Œæˆ‘è¯•äº†ä¸‹ï¼Œç»“æœå¹¶æ²¡æœ‰æ˜¾ç¤ºè¯­è¨€æœç´¢æŒ‰é’®ï¼Œdebugåå‘ç°åœ¨hasVoiceSearch()é‡Œï¼š 123ResolveInfo ri = getContext().getPackageManager().resolveActivity(testIntent, PackageManager.MATCH_DEFAULT_ONLY);return ri != null; åœ¨è¿™é‡Œå¹¶æ²¡æœ‰resolveåˆ°Activityï¼Œç»“æœreturn falseï¼ŒmVoiceButtonEnabledä¹Ÿå°±å˜æˆfalseäº† ç»ˆäºçŸ¥é“ä¸ºä»€ä¹ˆäº†ï¼ŒåŸæ¥é˜‰å‰²ç‰ˆçš„ç³»ç»Ÿéƒ½ä¸ä¼šå‡ºç°è¯­éŸ³æœç´¢æŒ‰é’®ï¼Œåä¸º/é­…æ—/Genymotionè¯•è¿‡éƒ½ä¸è¡Œ(æ²¡æœ‰è¯•è¿‡å…¨ç‰ˆæœ¬ç³»ç»Ÿ)ï¼ŒASè‡ªå¸¦æ¨¡æ‹Ÿå™¨å¯ä»¥(æœ‰GoogleæœåŠ¡)ï¼Œå…·ä½“åº”è¯¥å°±æ˜¯æ²¡æœ‰resolveåˆ°Googleè¯­éŸ³è¯†åˆ«Activityã€‚å¯¹è¯­éŸ³è¯†åˆ«æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥æœç´¢RecognizerIntentã€‚ 1.9 AutoCompleteTextViewReflectorv7åŒ…çš„SearchViewä½¿ç”¨äº†åå°„æœºåˆ¶ï¼Œé€šè¿‡åå°„æ‹¿åˆ°AutoCompleteTextViewå’ŒInputMethodManageréšè—çš„æ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041static final AutoCompleteTextViewReflector HIDDEN_METHOD_INVOKER = new AutoCompleteTextViewReflector();private static class AutoCompleteTextViewReflector &#123; private Method doBeforeTextChanged, doAfterTextChanged; private Method ensureImeVisible; private Method showSoftInputUnchecked; AutoCompleteTextViewReflector() &#123; /** * çœç•¥éƒ¨åˆ†ä»£ç  */ try &#123; showSoftInputUnchecked = InputMethodManager.class.getMethod( \"showSoftInputUnchecked\", int.class, ResultReceiver.class); showSoftInputUnchecked.setAccessible(true); &#125; catch (NoSuchMethodException e) &#123; // Ah well. &#125; &#125; /** * çœç•¥éƒ¨åˆ†ä»£ç  */ void showSoftInputUnchecked(InputMethodManager imm, View view, int flags) &#123; if (showSoftInputUnchecked != null) &#123; try &#123; showSoftInputUnchecked.invoke(imm, flags, null); return; &#125; catch (Exception e) &#123; &#125; &#125; //åªæœ‰è¿™ä¸ªæ–¹æ³•æ‰æœ‰åœ¨ifåé¢åšå¤„ç† // Hidden method failed, call public version instead imm.showSoftInput(view, flags); &#125; &#125; 1.10 onMeasure æµ‹é‡æŸ¥çœ‹äº†ä¸‹onMeasureï¼Œå‘ç°æœ‰ä¸ªåœ°æ–¹è¿˜æ˜¯æ¯”è¾ƒåœ¨æ„çš„ã€‚ å½“isIconified()è¿”å›falseçš„æ—¶å€™ï¼Œwidthçš„modeåœ¨æœ€åéƒ½ä¼šè¢«è®¾ç½®æˆMeasureSpec.EXACTLYã€‚ åœ¨SearchViewä¼¸å±•æ”¶ç¼©çš„æ—¶å€™ï¼ŒonMeasureä¼šè¢«æ‰§è¡Œå¤šæ¬¡ï¼Œwidthæ ¹æ®å…¶modeæ”¹å˜, ä¹‹åmodeè®¾ç½®ä¸ºEXACTLYå†è°ƒç”¨çˆ¶ç±»superæ–¹æ³•è¿›è¡Œæµ‹é‡ã€‚ è®¾ç½®ä¸ºEXACTLYï¼Œè¿™æ ·çˆ¶æ§ä»¶å°±èƒ½ç¡®åˆ‡çš„å†³å®šviewçš„å¤§å°ï¼Œé‚£ä¸ºä»€ä¹ˆåªå¯¹widthè€Œä¸å¯¹heightè¿›è¡Œè®¾ç½®å‘¢? é€šè¿‡æŸ¥çœ‹é»˜è®¤çš„ layoutï¼Œå¯ä»¥çœ‹åˆ°ä¸»è¦ç»„ä»¶çš„layout_heightçš„å¤§å¤šéƒ½æ˜¯match_parent(å¯¹åº”EXACTLYæ¨¡å¼)ï¼Œè€Œlayout_widthåŸºæœ¬éƒ½æ˜¯wrap_content(å¯¹åº”AT_MOSTæ¨¡å¼)ã€‚ å¦å¤–ï¼Œä¸æ˜¯åªæœ‰ä¼¸å±•æ”¶ç¼©çš„æ—¶å€™ï¼ŒonMeasureæ‰ä¼šè¢«æ‰§è¡Œ, ç‚¹å‡»è¯­éŸ³æœç´¢æŒ‰é’®/è¾“å…¥æ¡†è·å–ç„¦ç‚¹çš„æ—¶å€™/â€¦ä¹Ÿä¼šæ‰§è¡Œã€‚ 1234567891011121314151617181920212223242526272829303132333435@Overrideprotected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123; // Let the standard measurements take effect in iconified state. if (isIconified()) &#123; super.onMeasure(widthMeasureSpec, heightMeasureSpec); return; &#125; int widthMode = MeasureSpec.getMode(widthMeasureSpec); int width = MeasureSpec.getSize(widthMeasureSpec); switch (widthMode) &#123; case MeasureSpec.AT_MOST: // If there is an upper limit, don't exceed maximum width (explicit or implicit) if (mMaxWidth &gt; 0) &#123; width = Math.min(mMaxWidth, width); &#125; else &#123; width = Math.min(getPreferredWidth(), width); &#125; break; case MeasureSpec.EXACTLY: // If an exact width is specified, still don't exceed any specified maximum width if (mMaxWidth &gt; 0) &#123; width = Math.min(mMaxWidth, width); &#125; break; case MeasureSpec.UNSPECIFIED: // Use maximum width, if specified, else preferred width width = mMaxWidth &gt; 0 ? mMaxWidth : getPreferredWidth(); break; &#125; widthMode = MeasureSpec.EXACTLY; super.onMeasure(MeasureSpec.makeMeasureSpec(width, widthMode), heightMeasureSpec);&#125; 2. å±•æœ›æœªæ¥åœ¨v7åŒ…çš„SearchViewé‡Œï¼Œæœ‰ä¸€ä¸ªå£°æ˜å¹¶åˆå§‹åŒ–äº†çš„å˜é‡ï¼Œä½†å¹¶æ²¡æœ‰ç”¨åˆ°è¿‡: 1234private final AppCompatDrawableManager mDrawableManager;//åœ¨æ„é€ æ–¹æ³•é‡Œåˆå§‹åŒ–mDrawableManager = AppCompatDrawableManager.get(); æˆ–è®¸åç»­ç‰ˆæœ¬ä¼šç”¨åˆ°å§! æŠ±ç€å¥½å¥‡çš„å¿ƒå»çœ‹äº†AppCompatDrawableManageræºç ï¼Œä½†å¹¶æ²¡æœ‰æ³¨é‡Šè¯´æ˜è¿™ä¸ªç±»æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Œçœ‹åå­—åªçŸ¥é“æ˜¯ç®¡ç†Drawableçš„ã€‚ æ—¢ç„¶è¿™æ ·ï¼Œé‚£å°±æ¥çœ‹ä¸‹AppCompatDrawableManagerèƒ½å¹²äº›ä»€ä¹ˆå§ã€‚ ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œå…ˆçœ‹çœ‹å®ƒåˆå§‹åŒ–çš„æ—¶å€™å¹²äº†äº›ä»€ä¹ˆï¼ŒæŸ¥çœ‹get()æ–¹æ³•: 123456789101112131415161718192021222324public static AppCompatDrawableManager get() &#123; //ä½¿ç”¨äº†æ‡’æ±‰å¼ if (INSTANCE == null) &#123; INSTANCE = new AppCompatDrawableManager(); installDefaultInflateDelegates(INSTANCE); &#125; return INSTANCE;&#125;private static void installDefaultInflateDelegates(@NonNull AppCompatDrawableManager manager) &#123; final int sdk = Build.VERSION.SDK_INT; // åªåœ¨Android 5.0ä»¥ä¸‹çš„ç³»ç»Ÿ if (sdk &lt; 21) &#123; // åœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨ VectorDrawableCompat è¿›è¡Œè‡ªåŠ¨å¤„ç† manager.addDelegate(\"vector\", new VdcInflateDelegate()); if (sdk &gt;= 11) &#123; // AnimatedVectorDrawableCompat åªèƒ½åœ¨ API v11+ ä½¿ç”¨ manager.addDelegate(\"animated-vector\", new AvdcInflateDelegate()); &#125; &#125;&#125; ä»è¿™é‡Œ, æˆ‘ä»¬å¯ä»¥çœ‹å‡ºè·ŸVector(çŸ¢é‡)æœ‰å…³ã€‚ VectorDrawableèƒ½åˆ›å»ºä¸€ä¸ªåŸºäºxmlæè¿°çš„çŸ¢é‡å›¾; AnimatedVectorDrawableä½¿ç”¨ObjectAnimatorå’ŒAnimatorSetä¸ºVectorDrawableåˆ›å»ºåŠ¨ç”»ã€‚ ç„¶åæˆ‘ç²—ç•¥çš„çœ‹äº†æ–¹æ³•åï¼Œæœ‰å‡ ä¸ªå…³é”®è¯: Tintç€è‰²ï¼ŒCacheï¼Œâ€¦â€¦ æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥æœä¸‹ç›¸å…³èµ„æ–™ï¼Œè¿™é‡Œå°±ä¸å†æ·±å…¥äº†ã€‚ å¦‚æœæˆ‘å“ªé‡Œåˆ†æé”™äº†ï¼Œè¯·å¤§å®¶åŠæ—¶çº æ­£æˆ‘ï¼Œè°¢è°¢ã€‚ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"Scrolleræºç è§£æ","date":"2017-07-26T11:58:31.000Z","path":"2017/07/26/Scrolleræºç è§£æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ æœ¬æ–‡åˆ†æç‰ˆæœ¬: Android API 22 1. ç®€ä»‹Androidå¼€å‘ä¸­ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ä¸€ä¸ªViewæ»‘åŠ¨çš„è¯ï¼Œé™¤äº†ä½¿ç”¨å±æ€§åŠ¨ç”»å¤–ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›ç»™æˆ‘ä»¬çš„ä¸¤ä¸ªç±»Scrollerå’ŒOverScrollerç”¨æ¥å®ç°å¼¹æ€§æ»‘åŠ¨ã€‚åœ¨æˆ‘ä»¥å‰çš„ä¸€ç¯‡ViewDragHelperæºç åˆ†æä¸­æˆ‘ä»¬æœ‰è®²åˆ°è¿‡Scrollerçš„ä½œç”¨ã€‚é‚£ä¹ˆæˆ‘ä»¬ä»Šå¤©å°±æ¥ä»”ç»†åˆ†æä¸€ä¸‹Scrollerçš„ä½¿ç”¨æ–¹æ³•ä»¥åŠå®ç°æ–¹å¼ã€‚ 2. ä½¿ç”¨æ–¹æ³•åœ¨çœ‹Scrollerçš„ä½¿ç”¨æ–¹æ³•ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹Viewä¸­çš„scrollBy()å’ŒscrollTo()æ–¹æ³•ï¼ŒscrollTo()æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š 1234567891011121314151617 public void scrollTo(int x, int y) &#123; //å¦‚æœå½“å‰åç§»é‡å˜åŒ– if (mScrollX != x || mScrollY != y) &#123; int oldX = mScrollX; int oldY = mScrollY;//èµ‹å€¼åç§»é‡ mScrollX = x; mScrollY = y; invalidateParentCaches(); //å›è°ƒonScrollChangedæ–¹æ³• onScrollChanged(mScrollX, mScrollY, oldX, oldY); if (!awakenScrollBars()) &#123; postInvalidateOnAnimation(); &#125; &#125; &#125; scrollTo()æ˜¯æŒ‡å°†å½“å‰è§†å›¾å†…å®¹æ¨ªå‘åç§»xè·ç¦»ï¼Œçºµå‘åç§»yè·ç¦»ã€‚æ³¨æ„è¿™é‡Œæ˜¯Viewçš„å†…å®¹çš„åç§»ï¼Œè€Œä¸æ˜¯Viewæœ¬èº«ã€‚è€ŒscrollBy()æ–¹æ³•å¦‚ä¸‹ï¼š 123public void scrollBy(int x, int y) &#123; scrollTo(mScrollX + x, mScrollY + y);&#125; scrollBy()æ–¹æ³•é‡Œç›´æ¥è°ƒç”¨äº†scrollTo()æ–¹æ³•ï¼Œè¡¨ç¤ºåœ¨å½“å‰åç§»é‡çš„åŸºç¡€ä¸Šç»§ç»­åç§»(x,y)ã€‚ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹Scrollerçš„ç”¨æ³•ã€‚SkyScrollerDemoæ˜¯æˆ‘å†™çš„ä¸€ä¸ªScrollerå’ŒOverScrollerçš„ä½¿ç”¨demoã€‚ä¸‹é¢çš„ç”¨æ³•éƒ½æ˜¯æ¥è‡ªäºè¿™ä¸ªdemoé‡Œï¼Œå¤§å®¶å¯ä»¥cloneä¸‹æ¥é…åˆæœ¬æ–‡ä¸€èµ·é˜…è¯»ã€‚æœ¬æ–‡æˆ‘ä»¬ä¸»è¦ç ”ç©¶Scrollerã€‚å¯¹äºOverScrolleræˆ‘åœ¨demoé‡Œä¹Ÿå†™äº†ç›¸å…³çš„ä½¿ç”¨æ–¹æ³•ï¼Œåœ¨æœ¬æ–‡çš„æœ€åæˆ‘ä»¬å†åšè®¨è®ºã€‚ Scrollerä¸€èˆ¬éœ€è¦é…åˆé‡å†™computeScroll()ä¸€èµ·ä½¿ç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233public class ScrollTextView extends TextView &#123; private Context mContext; private Scroller mScroller; public ScrollTextView(Context context, AttributeSet attrs, int defStyleAttr) &#123; super(context, attrs, defStyleAttr); this.mContext = context; init(); &#125; private void init() &#123; mScroller = new Scroller(mContext); &#125; @Override public void computeScroll() &#123; if (mScroller.computeScrollOffset()) &#123; offsetLeftAndRight(mScroller.getCurrX() - mLeft); offsetTopAndBottom(mScroller.getCurrY() - mTop); invalidate(); &#125; &#125; //ä»¥mLeft,mTopä¸ºåˆå§‹ç‚¹ï¼Œåœ¨DEFAULT_DURATIONçš„æ—¶é—´å†…ï¼Œåœ¨Yè½´ä¸Šæ»‘åŠ¨-400çš„åç§»é‡ public void startScrollerScroll() &#123; mScroller.startScroll(mLeft, mTop, 0, -400, DEFAULT_DURATION); invalidate(); &#125; //ä»¥mLeft,mTopä¸ºåˆå§‹ç‚¹ï¼Œå¹¶ä»¥Yæ–¹å‘ä¸Š-5000çš„åŠ é€Ÿåº¦æ»‘åŠ¨ï¼Œæœ€å°Yåæ ‡ä¸º200ï¼Œæœ€å¤§Yåæ ‡ä¸º1200 public void startScrollerFling() &#123; mScroller.fling(mLeft, mTop, 0, -5000, mLeft, mLeft, 200, 1200); invalidate(); &#125;&#125; åœ¨ä¸Šé¢çš„ä»£ç é‡Œï¼Œå½“æˆ‘ä»¬è°ƒç”¨startScrollerScroll()ä¸startScrollerFling()æ–¹æ³•æ—¶æˆ‘ä»¬å°±å‘ç°Viewæ»‘åŠ¨äº†ã€‚å¦‚æœä»¥å‰æ²¡äº†è§£è¿‡Scrollerçš„åŒå­¦å¯èƒ½ä¼šä¸ç†è§£ã€‚è¿™é‡Œå¤§è‡´åˆ†æä¸€ä¸‹è°ƒç”¨æµç¨‹ï¼Œé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“Scrollerå…¶å®åªè´Ÿè´£è®¡ç®—ï¼Œå®ƒå¹¶ä¸è´Ÿè´£æ»‘åŠ¨Viewï¼Œå½“æˆ‘ä»¬è°ƒç”¨äº†Scrollerçš„startScrollerScroll()æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ç´§æ¥ç€è°ƒç”¨äº†invalidate()æ–¹æ³•ã€‚invalidate()æ–¹æ³•ä¼šä½¿Viewé‡æ–°ç»˜åˆ¶ã€‚å› æ­¤ä¼šè°ƒç”¨Viewçš„draw()æ–¹æ³•ï¼Œåœ¨Viewçš„draw()æ–¹æ³•ä¸­åˆä¼šå»è°ƒç”¨computeScroll()æ–¹æ³•ï¼ŒcomputeScroll()æ–¹æ³•åœ¨Viewä¸­æ˜¯ä¸€ä¸ªç©ºå®ç°ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°computeScroll()æ–¹æ³•ã€‚åœ¨ä¸Šé¢çš„computeScroll()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†mScroller.computeScrollOffset()æ–¹æ³•æ¥è®¡ç®—å½“å‰æ»‘åŠ¨çš„åç§»é‡ã€‚å¦‚æœè¿˜åœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­å°±ä¼šè¿”å›trueã€‚æ‰€ä»¥æˆ‘ä»¬å°±èƒ½åœ¨ifä¸­é€šè¿‡Scrolleræ‹¿åˆ°å½“å‰çš„æ»‘åŠ¨åæ ‡ä»è€Œåšä»»ä½•æˆ‘ä»¬æƒ³åšçš„å¤„ç†ã€‚åœ¨demoé‡Œæˆ‘ä»¬æ ¹æ®æ»‘åŠ¨çš„åç§»é‡æ¥æ”¹å˜äº†Viewçš„åæ ‡åç§»é‡ã€‚ä»è€Œå½¢æˆäº†æ»‘åŠ¨åŠ¨ç”»ã€‚ä¸‹é¢æˆ‘ä»¬è§£é‡Šä¸€ä¸‹Scrollerçš„ä¸¤ä¸ªæ–¹æ³•çš„å…·ä½“ä½œç”¨ï¼š 1.startScroll(int startX, int startY, int dx, int dy, int duration):é€šè¿‡èµ·å§‹ç‚¹ã€åç§»çš„è·ç¦»å’Œæ»‘åŠ¨çš„æ—¶é—´æ¥å¼€å§‹æ»‘åŠ¨ã€‚ startX èµ·å§‹æ»‘åŠ¨ç‚¹çš„Xåæ ‡ startY èµ·å§‹æ»‘åŠ¨ç‚¹çš„Yåæ ‡ dx æ»‘åŠ¨çš„æ°´å¹³åç§»é‡ã€‚&gt;0 åˆ™è¡¨ç¤ºå¾€å·¦æ»‘åŠ¨ã€‚ dy æ»‘åŠ¨çš„å‚ç›´åç§»é‡ã€‚&gt;0 åˆ™è¡¨ç¤ºå¾€ä¸Šæ»‘åŠ¨ã€‚ duration æ»‘åŠ¨æ‰§è¡Œçš„æ—¶é—´ 2.fling(int startX, int startY, int velocityX, int velocityY, int minX, int maxX, int minY, int maxY) :åŸºäºä¸€ä¸ªå¿«é€Ÿæ»‘åŠ¨æ‰‹åŠ¿ä¸‹çš„æ»‘åŠ¨ã€‚æ»‘åŠ¨çš„è·ç¦»ä¸è¿™ä¸ªæ‰‹åŠ¿æœ€åˆçš„åŠ é€Ÿåº¦æœ‰å…³ã€‚ startX èµ·å§‹æ»‘åŠ¨ç‚¹çš„Xåæ ‡ startY èµ·å§‹æ»‘åŠ¨ç‚¹çš„Yåæ ‡ velocityX Xæ–¹å‘ä¸Šçš„åŠ é€Ÿåº¦ velocityY Yæ–¹å‘ä¸Šçš„åŠ é€Ÿåº¦ minX Xæ–¹å‘ä¸Šæ»‘åŠ¨çš„æœ€å°å€¼ï¼Œä¸ä¼šæ»‘åŠ¨è¶…è¿‡è¿™ä¸ªç‚¹ maxX Xæ–¹å‘ä¸Šæ»‘åŠ¨çš„æœ€å¤§å€¼ï¼Œä¸ä¼šæ»‘åŠ¨è¶…è¿‡è¿™ä¸ªç‚¹ minY Yæ–¹å‘ä¸Šæ»‘åŠ¨çš„æœ€å°å€¼ï¼Œä¸ä¼šæ»‘åŠ¨è¶…è¿‡è¿™ä¸ªç‚¹ maxY Yæ–¹å‘ä¸Šæ»‘åŠ¨çš„æœ€å¤§å€¼ï¼Œä¸ä¼šæ»‘åŠ¨è¶…è¿‡è¿™ä¸ªç‚¹ 3. æºç åˆ†ææˆ‘ä»¬ä¾ç„¶é€šè¿‡è°ƒç”¨æµç¨‹æ¥åˆ†æScrollerçš„å®ç°ï¼š 1.æ„é€ æ–¹æ³•12345678910111213141516171819202122public Scroller(Context context) &#123; this(context, null);&#125;public Scroller(Context context, Interpolator interpolator) &#123; this(context, interpolator, context.getApplicationInfo().targetSdkVersion &gt;= Build.VERSION_CODES.HONEYCOMB);&#125;public Scroller(Context context, Interpolator interpolator, boolean flywheel) &#123; mFinished = true; if (interpolator == null) &#123; mInterpolator = new ViscousFluidInterpolator(); &#125; else &#123; mInterpolator = interpolator; &#125; mPpi = context.getResources().getDisplayMetrics().density * 160.0f; mDeceleration = computeDeceleration(ViewConfiguration.getScrollFriction()); mFlywheel = flywheel; mPhysicalCoeff = computeDeceleration(0.84f); // look and feel tuning&#125; æœ€ç»ˆéƒ½ä¼šè°ƒç”¨æœ€åä¸€ä¸ªæ„é€ æ–¹æ³•ã€‚å¿…é¡»ä¼ å…¥Contextå¯¹è±¡ã€‚å¯ä»¥ä¼ å…¥è‡ªå®šä¹‰çš„interpolatorå’Œæ˜¯å¦æ”¯æŒé£è½®flywheelçš„åŠŸèƒ½ï¼Œå½“ç„¶è¿™ä¸¤ä¸ªå¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚å¦‚æœä¸ä¼ å…¥interpolatorä¼šé»˜è®¤åˆ›å»ºä¸€ä¸ªViscousFluidInterpolatorï¼Œä»å­—é¢æ„ä¹‰ä¸Šçœ‹æ˜¯ä¸€ä¸ªç²˜æ€§æµä½“æ’å€¼å™¨ã€‚å¯¹äºflywheelæ˜¯æŒ‡æ˜¯å¦æ”¯æŒåœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰æ–°çš„fling()æ–¹æ³•è°ƒç”¨æ˜¯å¦ç´¯åŠ åŠ é€Ÿåº¦ã€‚å¦‚æœä¸ä¼ é»˜è®¤åœ¨2.3ä»¥ä¸Šéƒ½ä¼šæ”¯æŒã€‚å‰©ä¸‹å°±æ˜¯åˆå§‹åŒ–äº†ä¸€äº›ç”¨äºè®¡ç®—çš„å‚æ•°ã€‚è¿™æ ·å°±å®Œæˆäº†Scrollerçš„åˆå§‹åŒ–äº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹startScroll()æ–¹æ³•çš„å®ç°ï¼š 2.startScroll()æ–¹æ³•çš„å®ç°123456789101112131415161718192021222324public void startScroll(int startX, int startY, int dx, int dy, int duration) &#123; // mMode åˆ†ä¸¤ç§æ–¹å¼ 1.æ»‘åŠ¨:SCROLL_MODE 2. åŠ é€Ÿåº¦æ»‘åŠ¨:FLING_MODE mMode = SCROLL_MODE; // æ˜¯å¦æ»‘åŠ¨ç»“æŸ è¿™é‡Œæ˜¯å¼€å§‹æ‰€ä»¥è®¾ç½®ä¸ºfalse mFinished = false; // æ»‘åŠ¨çš„æ—¶é—´ mDuration = duration; // å¼€å§‹çš„æ—¶é—´ mStartTime = AnimationUtils.currentAnimationTimeMillis(); // å¼€å§‹æ»‘åŠ¨ç‚¹çš„Xåæ ‡ mStartX = startX; // å¼€å§‹æ»‘åŠ¨ç‚¹çš„Yåæ ‡ mStartY = startY; // æœ€ç»ˆæ»‘åŠ¨åˆ°ä½ç½®çš„Xåæ ‡ mFinalX = startX + dx; // æœ€ç»ˆæ»‘åŠ¨åˆ°ä½ç½®çš„Yåæ ‡ mFinalY = startY + dy; // Xæ–¹å‘ä¸Šæ»‘åŠ¨çš„åç§»é‡ mDeltaX = dx; // Yæ–¹å‘ä¸Šæ»‘åŠ¨çš„åç§»é‡ mDeltaY = dy; // æŒç»­æ—¶é—´çš„å€’æ•° æœ€ç»ˆç”¨æ¥è®¡ç®—å¾—åˆ°æ’å€¼å™¨è¿”å›çš„å€¼ mDurationReciprocal = 1.0f / (float) mDuration;&#125; å¾ˆç®€å•åªæ˜¯ä¸€äº›å˜é‡çš„èµ‹å€¼ã€‚æ ¹æ®æˆ‘ä»¬å‰é¢ä½¿ç”¨æ–¹æ³•é‡Œçš„åˆ†æï¼Œæœ€ç»ˆä¼šè°ƒç”¨computeScrollOffset()æ–¹æ³•ï¼š 3.computeScrollOffset() æ–¹æ³•ä¸­ SCROLL_MODE çš„å®ç°12345678910111213141516171819202122232425262728293031// å½“ä½ éœ€è¦çŸ¥é“æ–°çš„ä½ç½®çš„æ—¶å€™è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœåŠ¨ç”»è¿˜æœªç»“æŸåˆ™è¿”å›truepublic boolean computeScrollOffset() &#123; //å¦‚æœå·²ç»ç»“æŸ åˆ™ç›´æ¥è¿”å›false if (mFinished) &#123; return false; &#125; //å¾—åˆ°ä»¥åŠåº¦è¿‡çš„æ—¶é—´ int timePassed = (int)(AnimationUtils.currentAnimationTimeMillis() - mStartTime); //å¦‚æœè¿˜åœ¨åŠ¨ç”»æ—¶é—´å†… if (timePassed &lt; mDuration) &#123; switch (mMode) &#123; case SCROLL_MODE: // æ ¹æ®timePassed * mDurationReciprocal,ä»mInterpolatorä¸­å–å‡ºå½“å‰éœ€è¦åç§»é‡çš„æ¯”ä¾‹ final float x = mInterpolator.getInterpolation(timePassed * mDurationReciprocal); // èµ‹å€¼ç»™ mCurrXï¼ŒmCurrY mCurrX = mStartX + Math.round(x * mDeltaX); mCurrY = mStartY + Math.round(x * mDeltaY); break; case FLING_MODE: ... break; &#125; &#125; else &#123; mCurrX = mFinalX; mCurrY = mFinalY; mFinished = true; &#125; return true;&#125; é¦–å…ˆçš„åˆ°å½“å‰æ—¶é—´ä¸æ»‘åŠ¨å¼€å§‹æ—¶é—´çš„æ—¶é—´å·®ï¼Œå¦‚æœè¿˜åœ¨æ»‘åŠ¨æ—¶é—´å†…åˆ™é€šè¿‡æ’å€¼å™¨è·å¾—å½“å‰çš„è¿›åº¦å¹¶ä¹˜ä»¥æ€»åç§»é‡å¹¶èµ‹å€¼ç»™mCurrXï¼ŒmCurrYã€‚å¦‚æœå·²ç»ç»“æŸåˆ™ç›´æ¥å°†mFinalXå’ŒmFinalYèµ‹å€¼å¹¶å°†mFinishedè®¾ç½®\bä¸ºtrueã€‚æ‰€ä»¥è¿™æ ·æˆ‘ä»¬å°±èƒ½é€šè¿‡getCurrX()å’ŒgetCurrY()æ¥å¾—åˆ°å¯¹åº”çš„mCurrXå’ŒmCurrYæ¥åšç›¸åº”çš„å¤„ç†äº†ã€‚æ•´ä¸ªScrollçš„è¿‡ç¨‹å°±æ˜¯è¿™æ ·äº†ã€‚ 4.fling()æ–¹æ³•çš„å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657public void fling(int startX, int startY, int velocityX, int velocityY, int minX, int maxX, int minY, int maxY) &#123; // å¦‚æœå‰ä¸€æ¬¡æ»‘åŠ¨è¿˜æœªç»“æŸï¼Œåˆè°ƒç”¨äº†æ–°çš„fling()æ–¹æ³•æ—¶ï¼Œ // åˆ™ç´¯åŠ ç›¸åŒæ–¹å‘ä¸ŠåŠ é€Ÿåº¦ if (mFlywheel &amp;&amp; !mFinished) &#123; float oldVel = getCurrVelocity(); float dx = (float) (mFinalX - mStartX); float dy = (float) (mFinalY - mStartY); float hyp = FloatMath.sqrt(dx * dx + dy * dy); float ndx = dx / hyp; float ndy = dy / hyp; float oldVelocityX = ndx * oldVel; float oldVelocityY = ndy * oldVel; if (Math.signum(velocityX) == Math.signum(oldVelocityX) &amp;&amp; Math.signum(velocityY) == Math.signum(oldVelocityY)) &#123; velocityX += oldVelocityX; velocityY += oldVelocityY; &#125; &#125; //è®¾ç½®ä¸ºFLING_MODE mMode = FLING_MODE; mFinished = false; //æ ¹æ®å‹¾è‚¡å®šç†è·å¾—æ€»åŠ é€Ÿåº¦ float velocity = FloatMath.sqrt(velocityX * velocityX + velocityY * velocityY); mVelocity = velocity; // é€šè¿‡åŠ é€Ÿåº¦å¾—åˆ°æ»‘åŠ¨æŒç»­æ—¶é—´ mDuration = getSplineFlingDuration(velocity); mStartTime = AnimationUtils.currentAnimationTimeMillis(); mStartX = startX; mStartY = startY; float coeffX = velocity == 0 ? 1.0f : velocityX / velocity; float coeffY = velocity == 0 ? 1.0f : velocityY / velocity; double totalDistance = getSplineFlingDistance(velocity); mDistance = (int) (totalDistance * Math.signum(velocity)); mMinX = minX; mMaxX = maxX; mMinY = minY; mMaxY = maxY; mFinalX = startX + (int) Math.round(totalDistance * coeffX); // Pin to mMinX &lt;= mFinalX &lt;= mMaxX mFinalX = Math.min(mFinalX, mMaxX); mFinalX = Math.max(mFinalX, mMinX); mFinalY = startY + (int) Math.round(totalDistance * coeffY); // Pin to mMinY &lt;= mFinalY &lt;= mMaxY mFinalY = Math.min(mFinalY, mMaxY); mFinalY = Math.max(mFinalY, mMinY);&#125; ä¾ç„¶æ˜¯ä¸ºè®¡ç®—éœ€è¦çš„å„ç§å˜é‡èµ‹å€¼ã€‚å› ä¸ºå¼•å…¥äº†åŠ é€Ÿåº¦çš„æ¦‚å¿µæ‰€ä»¥å˜å¾—ç›¸å¯¹å¤æ‚ï¼Œé¦–å…ˆå…ˆåˆ¤æ–­äº†å¦‚æœä¸€æ¬¡æ»‘åŠ¨æœªç»“æŸåˆè§¦å‘å¦ä¸€æ¬¡æ»‘åŠ¨æ—¶ï¼Œæ˜¯å¦éœ€è¦ç´¯åŠ åŠ é€Ÿåº¦ã€‚ç„¶åæ˜¯è®¾ç½®mModeä¸ºFLING_MODEã€‚ç„¶åæ ¹æ®velocityXå’ŒvelocityYç®—å‡ºæ€»çš„åŠ é€Ÿåº¦velocityï¼Œç´§æ¥ç€ç®—å‡ºè¿™ä¸ªåŠ é€Ÿåº¦ä¸‹å¯ä»¥æ»‘åŠ¨çš„è·ç¦»mDistanceã€‚æœ€åå†é€šè¿‡xæˆ–yæ–¹å‘ä¸Šçš„åŠ é€Ÿåº¦æ¯”å€¼ä»¥åŠæˆ‘ä»¬è®¾å®šçš„æœ€å¤§å€¼å’Œæœ€å°å€¼æ¥ç»™mFinalXæˆ–mFinalYèµ‹å€¼ã€‚èµ‹å€¼ç»“æŸåï¼Œé€šè¿‡è°ƒç”¨invalidate()ï¼Œæœ€ç»ˆä¾ç„¶ä¼šè°ƒç”¨computeScrollOffset()æ–¹æ³•ï¼š 5.computeScrollOffset() æ–¹æ³•ä¸­ FLING_MODE çš„å®ç°12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public boolean computeScrollOffset() &#123; if (mFinished) &#123; return false; &#125; int timePassed = (int)(AnimationUtils.currentAnimationTimeMillis() - mStartTime); if (timePassed &lt; mDuration) &#123; switch (mMode) &#123; case SCROLL_MODE: ... break; case FLING_MODE: // å½“å‰å·²æ»‘åŠ¨çš„æ—¶é—´ä¸æ€»æ»‘åŠ¨æ—¶é—´çš„æ¯”å€¼ final float t = (float) timePassed / mDuration; final int index = (int) (NB_SAMPLES * t); // è·ç¦»ç³»æ•° float distanceCoef = 1.f; // åŠ é€Ÿåº¦ç³»æ•° float velocityCoef = 0.f; if (index &lt; NB_SAMPLES) &#123; final float t_inf = (float) index / NB_SAMPLES; final float t_sup = (float) (index + 1) / NB_SAMPLES; final float d_inf = SPLINE_POSITION[index]; final float d_sup = SPLINE_POSITION[index + 1]; velocityCoef = (d_sup - d_inf) / (t_sup - t_inf); distanceCoef = d_inf + (t - t_inf) * velocityCoef; &#125; // è®¡ç®—å‡ºå½“å‰çš„åŠ é€Ÿåº¦ mCurrVelocity = velocityCoef * mDistance / mDuration * 1000.0f; // è®¡ç®—å‡ºå½“å‰çš„mCurrX ä¸mCurrY mCurrX = mStartX + Math.round(distanceCoef * (mFinalX - mStartX)); // Pin to mMinX &lt;= mCurrX &lt;= mMaxX mCurrX = Math.min(mCurrX, mMaxX); mCurrX = Math.max(mCurrX, mMinX); mCurrY = mStartY + Math.round(distanceCoef * (mFinalY - mStartY)); // Pin to mMinY &lt;= mCurrY &lt;= mMaxY mCurrY = Math.min(mCurrY, mMaxY); mCurrY = Math.max(mCurrY, mMinY); // å¦‚æœåˆ°è¾¾äº†ç»ˆç‚¹ åˆ™ç»“æŸ if (mCurrX == mFinalX &amp;&amp; mCurrY == mFinalY) &#123; mFinished = true; &#125; break; &#125; &#125; else &#123; mCurrX = mFinalX; mCurrY = mFinalY; mFinished = true; &#125; return true;&#125; ç”±äºfling()æ–¹æ³•ä¸­å°†mModeèµ‹å€¼ä¸ºFLING_MODEã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æ¥æ¥çœ‹FLING_MODEä¸­çš„ä»£ç ã€‚å¯ä»¥çœ‹å‡ºæ ¹æ®å½“å‰æ»‘åŠ¨æ—¶é—´ä¸æ€»æ»‘åŠ¨æ—¶é—´çš„æ¯”ä¾‹ã€‚å†æ ¹æ®ä¸€ä¸ªSPLINE_POSITIONæ•°ç»„è®¡ç®—å‡ºäº†è·ç¦»ç³»æ•°distanceCoefä¸åŠ é€Ÿåº¦ç³»æ•°velocityCoefã€‚å†æ ¹æ®è¿™ä¸¤ä¸ªç³»æ•°è®¡ç®—å‡ºå½“å‰åŠ é€Ÿåº¦ä¸å½“å‰çš„mCurrXä¸mCurrYã€‚å…³äºSPLINE_POSITIONçš„åˆå§‹åŒ–æ˜¯åœ¨ä¸‹é¢çš„é™æ€ä»£ç å—é‡Œèµ‹å€¼çš„ï¼š 1234567891011121314151617181920212223242526272829303132static &#123; float x_min = 0.0f; float y_min = 0.0f; for (int i = 0; i &lt; NB_SAMPLES; i++) &#123; final float alpha = (float) i / NB_SAMPLES; float x_max = 1.0f; float x, tx, coef; while (true) &#123; x = x_min + (x_max - x_min) / 2.0f; coef = 3.0f * x * (1.0f - x); tx = coef * ((1.0f - x) * P1 + x * P2) + x * x * x; if (Math.abs(tx - alpha) &lt; 1E-5) break; if (tx &gt; alpha) x_max = x; else x_min = x; &#125; SPLINE_POSITION[i] = coef * ((1.0f - x) * START_TENSION + x) + x * x * x; float y_max = 1.0f; float y, dy; while (true) &#123; y = y_min + (y_max - y_min) / 2.0f; coef = 3.0f * y * (1.0f - y); dy = coef * ((1.0f - y) * START_TENSION + y) + y * y * y; if (Math.abs(dy - alpha) &lt; 1E-5) break; if (dy &gt; alpha) y_max = y; else y_min = y; &#125; SPLINE_TIME[i] = coef * ((1.0f - y) * P1 + y * P2) + y * y * y; &#125; SPLINE_POSITION[NB_SAMPLES] = SPLINE_TIME[NB_SAMPLES] = 1.0f;&#125; æˆ‘å¹¶æ²¡æœ‰çœ‹æ‡‚è¿™æ®µä»£ç çš„å®é™…æ„ä¹‰ã€‚ç½‘ä¸Šä¹Ÿæ²¡æœ‰æ‰¾åˆ°æ¯”è¾ƒæ¸…æ™°çš„è§£é‡Šã€‚é€šè¿‡debugå¾—çŸ¥SPLINE_POSITIONæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º101å¹¶ä¸”ä»0-1é€’å¢æ•°ç»„ã€‚çŒœæƒ³è¿™åº”è¯¥æ˜¯ä¸€ä¸ªå‡½æ•°æ¨¡å‹å¹¶ä¸”æœ€ç»ˆç”¨äºè®¡ç®—å‡ºæ»‘åŠ¨è¿‡ç¨‹ä¸­çš„åŠ é€Ÿåº¦ä¸ä½ç½®ã€‚è‡³æ­¤Scrollerçš„ä¸¤ä¸ªä¸»è¦æ–¹æ³•çš„å®ç°æˆ‘ä»¬å°±åˆ†æå®Œäº†ã€‚ 4. OverScrollerè§£æOverScrolleræ˜¯å¯¹Scrollerçš„æ‹“å±•ï¼Œå®ƒåœ¨Scrollerçš„åŸºç¡€ä¸Šæ‹“å±•å‡ºäº†æ›´å¤šçš„æ–¹æ³•ã€‚OverScrollerçš„flingæ–¹æ³•æ”¯æŒæ»‘åŠ¨åˆ°ç»ˆç‚¹ä¹‹åå¹¶è¶…å‡ºä¸€æ®µè·ç¦»å¹¶è¿”å›ï¼Œç±»ä¼¼äºå¼¹æ€§æ•ˆæœã€‚å¦å¤–ä¸€ä¸ªspringBack()æ–¹æ³•æ˜¯æŒ‡å°†æŒ‡å®šçš„ç‚¹å¹³æ»‘æ»šåŠ¨åˆ°æŒ‡å®šçš„ç»ˆç‚¹ä¸Šã€‚è¿™ä¸ªç»ˆç‚¹ç”±è®¾ç½®çš„å‚æ•°å†³å®šã€‚åŸç†æˆ‘ä»¬å°±ä¸å†æ¢ç©¶äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œç ”ç©¶è¿™ä¸¤ä¸ªç±»çš„å·®åˆ«ã€‚æœ€åå…·ä½“çš„ä½¿ç”¨æ–¹æ³•åœ¨æ–‡ç« æœ€ä¸Šé¢çš„demoé‡Œéƒ½æœ‰æä¾›ã€‚å¯ä»¥cloneä¸‹æ¥å¸®åŠ©ç†è§£ã€‚ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"LruCacheæºç è§£æ","date":"2017-07-26T11:57:39.000Z","path":"2017/07/26/LruCacheæºç è§£æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ 1. ç®€ä»‹ LRU æ˜¯ Least Recently Used æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ã€‚ æ›¾ç»ï¼Œåœ¨å„å¤§ç¼“å­˜å›¾ç‰‡çš„æ¡†æ¶æ²¡æµè¡Œçš„æ—¶å€™ã€‚æœ‰ä¸€ç§å¾ˆå¸¸ç”¨çš„å†…å­˜ç¼“å­˜æŠ€æœ¯ï¼šSoftReference å’Œ WeakReferenceï¼ˆè½¯å¼•ç”¨å’Œå¼±å¼•ç”¨ï¼‰ã€‚ä½†æ˜¯èµ°åˆ°äº† Android 2.3ï¼ˆLevel 9ï¼‰æ—¶ä»£ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶æ›´å€¾å‘äºå›æ”¶ SoftReference æˆ– WeakReference çš„å¯¹è±¡ã€‚åæ¥ï¼Œåˆæ¥åˆ°äº† Android3.0ï¼Œå›¾ç‰‡ç¼“å­˜åœ¨å†…å®¹ä¸­ï¼Œå› ä¸ºä¸çŸ¥é“è¦åœ¨æ˜¯ä»€ä¹ˆæ—¶å€™é‡Šæ”¾å†…å­˜ï¼Œæ²¡æœ‰ç­–ç•¥ï¼Œæ²¡ç”¨ä¸€ç§å¯ä»¥é¢„è§çš„åœºåˆå»å°†å…¶é‡Šæ”¾ã€‚è¿™å°±é€ æˆäº†å†…å­˜æº¢å‡ºã€‚ 2. ä½¿ç”¨æ–¹æ³•å½“æˆä¸€ä¸ª Map ç”¨å°±å¯ä»¥äº†ï¼Œåªä¸è¿‡å®ç°äº† LRU ç¼“å­˜ç­–ç•¥ã€‚ ä½¿ç”¨çš„æ—¶å€™è®°ä½å‡ ç‚¹å³å¯ï¼š 1.ï¼ˆå¿…å¡«ï¼‰ä½ éœ€è¦æä¾›ä¸€ä¸ªç¼“å­˜å®¹é‡ä½œä¸ºæ„é€ å‚æ•°ã€‚ 2.ï¼ˆå¿…å¡«ï¼‰ è¦†å†™ sizeOf æ–¹æ³• ï¼Œè‡ªå®šä¹‰è®¾è®¡ä¸€æ¡æ•°æ®æ”¾è¿›æ¥çš„å®¹é‡è®¡ç®—ï¼Œå¦‚æœä¸è¦†å†™å°±æ— æ³•é¢„çŸ¥æ•°æ®çš„å®¹é‡ï¼Œä¸èƒ½ä¿è¯ç¼“å­˜å®¹é‡é™å®šåœ¨æœ€å¤§å®¹é‡ä»¥å†…ã€‚ 3.ï¼ˆé€‰å¡«ï¼‰ è¦†å†™ entryRemoved æ–¹æ³• ï¼Œä½ å¯ä»¥çŸ¥é“æœ€å°‘ä½¿ç”¨çš„ç¼“å­˜è¢«æ¸…é™¤æ—¶çš„æ•°æ®ï¼ˆ evicted, key, oldValue, newVaule ï¼‰ã€‚ 4.ï¼ˆè®°ä½ï¼‰LruCacheæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å†…éƒ¨çš„ getã€putã€remove åŒ…æ‹¬ trimToSize éƒ½æ˜¯å®‰å…¨çš„ï¼ˆå› ä¸ºéƒ½ä¸Šé”äº†ï¼‰ã€‚ 5.ï¼ˆé€‰å¡«ï¼‰ è¿˜æœ‰å°±æ˜¯è¦†å†™ create æ–¹æ³• ã€‚ ä¸€èˆ¬åšåˆ° 1ã€2ã€3ã€4å°±è¶³å¤Ÿäº†ï¼Œ5å¯ä»¥æ— è§† ã€‚ ä»¥ä¸‹æ˜¯ ä¸€ä¸ª LruCache å®ç° Bitmap å°ç¼“å­˜çš„æ¡ˆä¾‹, entryRemoved é‡Œçš„è‡ªå®šä¹‰é€»è¾‘å¯ä»¥æ— è§†ï¼Œæƒ³çœ‹çš„å¯ä»¥å»åˆ°æˆ‘çš„æˆ‘çš„å±•ç¤º demo é‡Œçš„çœ‹è‡ªå®šä¹‰ entryRemoved é€»è¾‘ã€‚1234567891011121314private static final float ONE_MIB = 1024 * 1024;// 7MBprivate static final int CACHE_SIZE = (int) (7 * ONE_MIB);private LruCache&lt;String, Bitmap&gt; bitmapCache;this.bitmapCache = new LruCache&lt;String, Bitmap&gt;(CACHE_SIZE) &#123; protected int sizeOf(String key, Bitmap value) &#123; return value.getByteCount(); &#125; @Override protected void entryRemoved(boolean evicted, String key, Bitmap oldValue, Bitmap newValue) &#123; ... &#125;&#125;; 3. æ•ˆæœå±•ç¤ºLruCache æ•ˆæœå±•ç¤º 4. æºç åˆ†æ4.1 LruCache åŸç†æ¦‚è¦è§£æLruCache å°±æ˜¯ åˆ©ç”¨ LinkedHashMap çš„ä¸€ä¸ªç‰¹æ€§ï¼ˆ accessOrderï¼true åŸºäºè®¿é—®é¡ºåº ï¼‰å†åŠ ä¸Šå¯¹ LinkedHashMap çš„æ•°æ®æ“ä½œä¸Šé”å®ç°çš„ç¼“å­˜ç­–ç•¥ã€‚ LruCache çš„æ•°æ®ç¼“å­˜æ˜¯å†…å­˜ä¸­çš„ã€‚ 1.é¦–å…ˆè®¾ç½®äº†å†…éƒ¨ LinkedHashMap æ„é€ å‚æ•° accessOrder=trueï¼Œ å®ç°äº†æ•°æ®æ’åºæŒ‰ç…§è®¿é—®é¡ºåºã€‚ 2.ç„¶ååœ¨æ¯æ¬¡ LruCache.get(K key) æ–¹æ³•é‡Œéƒ½ä¼šè°ƒç”¨ LinkedHashMap.get(Object key)ã€‚ 3.å¦‚ä¸Šè¿°è®¾ç½®äº† accessOrder=true åï¼Œæ¯æ¬¡ LinkedHashMap.get(Object key) éƒ½ä¼šè¿›è¡Œ LinkedHashMap.makeTail(LinkedEntry&amp;lt;K, V&gt; e)ã€‚ 4.LinkedHashMap æ˜¯åŒå‘å¾ªç¯é“¾è¡¨ï¼Œç„¶åæ¯æ¬¡ LruCache.get -&gt; LinkedHashMap.get çš„æ•°æ®å°±è¢«æ”¾åˆ°æœ€æœ«å°¾äº†ã€‚ 5.åœ¨ put å’Œ trimToSize çš„æ–¹æ³•æ‰§è¡Œä¸‹ï¼Œå¦‚æœå‘ç”Ÿæ•°æ®é‡ç§»é™¤ï¼Œä¼šä¼˜å…ˆç§»é™¤æ‰æœ€å‰é¢çš„æ•°æ®ï¼ˆå› ä¸ºæœ€æ–°è®¿é—®çš„æ•°æ®åœ¨å°¾éƒ¨ï¼‰ã€‚ å…·ä½“è§£æåœ¨ï¼š 4.2ã€4.3ã€4.4ã€4.5 4.2 LruCache çš„å”¯ä¸€æ„é€ æ–¹æ³•12345678910111213141516/** * LruCacheçš„æ„é€ æ–¹æ³•ï¼šéœ€è¦ä¼ å…¥æœ€å¤§ç¼“å­˜ä¸ªæ•° */public LruCache(int maxSize) &#123; ... this.maxSize = maxSize; /* * åˆå§‹åŒ–LinkedHashMap * ç¬¬ä¸€ä¸ªå‚æ•°ï¼šinitialCapacityï¼Œåˆå§‹å¤§å° * ç¬¬äºŒä¸ªå‚æ•°ï¼šloadFactorï¼Œè´Ÿè½½å› å­=0.75f * ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šaccessOrder=trueï¼ŒåŸºäºè®¿é—®é¡ºåºï¼›accessOrder=falseï¼ŒåŸºäºæ’å…¥é¡ºåº */ this.map = new LinkedHashMap&lt;K, V&gt;(0, 0.75f, true);&#125; ç¬¬ä¸€ä¸ªå‚æ•° initialCapacity ç”¨äºåˆå§‹åŒ–è¯¥ LinkedHashMap çš„å¤§å°ã€‚ å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ ç¬¬äºŒä¸ªå‚æ•° loadFactorï¼Œè¿™ä¸ªå…¶å®çš„ HashMap é‡Œçš„æ„é€ å‚æ•°ï¼Œæ¶‰åŠåˆ°æ‰©å®¹é—®é¢˜ï¼Œæ¯”å¦‚ HashMap çš„æœ€å¤§å®¹é‡æ˜¯100ï¼Œé‚£ä¹ˆè¿™é‡Œè®¾ç½®0.75fçš„è¯ï¼Œåˆ°75å®¹é‡çš„æ—¶å€™å°±ä¼šæ‰©å®¹ã€‚ ä¸»è¦æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•° accessOrder=true ï¼Œè¿™æ ·çš„è¯ LinkedHashMap æ•°æ®æ’åºå°±ä¼šåŸºäºæ•°æ®çš„è®¿é—®é¡ºåºï¼Œä»è€Œå®ç°äº† LruCache æ ¸å¿ƒå·¥ä½œåŸç†ã€‚ 4.3 LruCache.get(K key)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475/** * æ ¹æ® key æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœå­˜åœ¨äºç¼“å­˜æˆ–è€…è¢« create æ–¹æ³•åˆ›å»ºäº†ã€‚ * å¦‚æœå€¼è¿”å›äº†ï¼Œé‚£ä¹ˆå®ƒå°†è¢«ç§»åŠ¨åˆ°åŒå‘å¾ªç¯é“¾è¡¨çš„çš„å°¾éƒ¨ã€‚ * å¦‚æœæ²¡æœ‰ç¼“å­˜çš„å€¼ï¼Œåˆ™è¿”å› nullã€‚ */public final V get(K key) &#123; ... V mapValue; synchronized (this) &#123; // å…³é”®ç‚¹ï¼šLinkedHashMapæ¯æ¬¡getéƒ½ä¼šåŸºäºè®¿é—®é¡ºåºæ¥é‡æ•´æ•°æ®é¡ºåº mapValue = map.get(key); // è®¡ç®— å‘½ä¸­æ¬¡æ•° if (mapValue != null) &#123; hitCount++; return mapValue; &#125; // è®¡ç®— ä¸¢å¤±æ¬¡æ•° missCount++; &#125; /* * å®˜æ–¹è§£é‡Šï¼š * å°è¯•åˆ›å»ºä¸€ä¸ªå€¼ï¼Œè¿™å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œå¹¶ä¸”Mapå¯èƒ½åœ¨create()è¿”å›çš„å€¼æ—¶æœ‰æ‰€ä¸åŒã€‚å¦‚æœåœ¨create()æ‰§è¡Œçš„æ—¶ * å€™ï¼Œä¸€ä¸ªå†²çªçš„å€¼è¢«æ·»åŠ åˆ°Mapï¼Œæˆ‘ä»¬åœ¨Mapä¸­åˆ é™¤è¿™ä¸ªå€¼ï¼Œé‡Šæ”¾è¢«åˆ›é€ çš„å€¼ã€‚ */ V createdValue = create(key); if (createdValue == null) &#123; return null; &#125; /*************************** * ä¸è¦†å†™createæ–¹æ³•èµ°ä¸åˆ°ä¸‹é¢ * ***************************/ /* * æ­£å¸¸æƒ…å†µèµ°ä¸åˆ°è¿™é‡Œ * èµ°åˆ°è¿™é‡Œçš„è¯ è¯´æ˜ å®ç°äº†è‡ªå®šä¹‰çš„ create(K key) é€»è¾‘ * å› ä¸ºé»˜è®¤çš„ create(K key) é€»è¾‘ä¸ºnull */ synchronized (this) &#123; // è®°å½• create çš„æ¬¡æ•° createCount++; // å°†è‡ªå®šä¹‰createåˆ›å»ºçš„å€¼ï¼Œæ”¾å…¥LinkedHashMapä¸­ï¼Œå¦‚æœkeyå·²ç»å­˜åœ¨ï¼Œä¼šè¿”å› ä¹‹å‰ç›¸åŒkey çš„å€¼ mapValue = map.put(key, createdValue); // å¦‚æœä¹‹å‰å­˜åœ¨ç›¸åŒkeyçš„valueï¼Œå³æœ‰å†²çªã€‚ if (mapValue != null) &#123; /* * æœ‰å†²çª * æ‰€ä»¥ æ’¤é”€ åˆšæ‰çš„ æ“ä½œ * å°† ä¹‹å‰ç›¸åŒkey çš„å€¼ é‡æ–°æ”¾å›å» */ map.put(key, mapValue); &#125; else &#123; // æ‹¿åˆ°é”®å€¼å¯¹ï¼Œè®¡ç®—å‡ºåœ¨å®¹é‡ä¸­çš„ç›¸å¯¹é•¿åº¦ï¼Œç„¶ååŠ ä¸Š size += safeSizeOf(key, createdValue); &#125; &#125; // å¦‚æœä¸Šé¢ åˆ¤æ–­å‡ºäº† å°†è¦æ”¾å…¥çš„å€¼å‘ç”Ÿå†²çª if (mapValue != null) &#123; /* * åˆšæ‰createçš„å€¼è¢«åˆ é™¤äº†ï¼ŒåŸæ¥çš„ ä¹‹å‰ç›¸åŒkey çš„å€¼è¢«é‡æ–°æ·»åŠ å›å»äº† * å‘Šè¯‰ è‡ªå®šä¹‰ çš„ entryRemoved æ–¹æ³• */ entryRemoved(false, key, createdValue, mapValue); return mapValue; &#125; else &#123; // ä¸Šé¢ è¿›è¡Œäº† size += æ“ä½œ æ‰€ä»¥è¿™é‡Œè¦é‡æ•´é•¿åº¦ trimToSize(maxSize); return createdValue; &#125;&#125; ä¸Šè¿°çš„ get æ–¹æ³•è¡¨é¢å¹¶æ²¡æœ‰çœ‹å‡ºå“ªé‡Œæœ‰å®ç°äº† LRU çš„ç¼“å­˜ç­–ç•¥ã€‚ä¸»è¦åœ¨ mapValue = map.get(key);é‡Œï¼Œè°ƒç”¨äº† LinkedHashMap çš„ get æ–¹æ³•ï¼Œå†åŠ ä¸Š LruCache æ„é€ é‡Œé»˜è®¤è®¾ç½® LinkedHashMap çš„ accessOrder=trueã€‚ 4.4 LinkedHashMap.get(Object key)1234567891011121314151617181920212223242526272829303132333435/** * Returns the value of the mapping with the specified key. * * @param key * the key. * @return the value of the mapping with the specified key, or &#123;@code null&#125; * if no mapping for the specified key is found. */@Override public V get(Object key) &#123; /* * This method is overridden to eliminate the need for a polymorphic * invocation in superclass at the expense of code duplication. */ if (key == null) &#123; HashMapEntry&lt;K, V&gt; e = entryForNullKey; if (e == null) return null; if (accessOrder) makeTail((LinkedEntry&lt;K, V&gt;) e); return e.value; &#125; int hash = Collections.secondaryHash(key); HashMapEntry&lt;K, V&gt;[] tab = table; for (HashMapEntry&lt;K, V&gt; e = tab[hash &amp; (tab.length - 1)]; e != null; e = e.next) &#123; K eKey = e.key; if (eKey == key || (e.hash == hash &amp;&amp; key.equals(eKey))) &#123; if (accessOrder) makeTail((LinkedEntry&lt;K, V&gt;) e); return e.value; &#125; &#125; return null;&#125; å…¶å®ä»”ç»†çœ‹ if (accessOrder) çš„é€»è¾‘å³å¯ï¼Œå¦‚æœ accessOrder=true é‚£ä¹ˆæ¯æ¬¡ get éƒ½ä¼šæ‰§è¡Œ N æ¬¡ makeTail(LinkedEntry&amp;lt;K, V&gt; e) ã€‚ æ¥ä¸‹æ¥çœ‹çœ‹ï¼š 4.5 LinkedHashMap.makeTail(LinkedEntry&lt;K, V&gt; e)123456789101112131415161718/** * Relinks the given entry to the tail of the list. Under access ordering, * this method is invoked whenever the value of a pre-existing entry is * read by Map.get or modified by Map.put. */private void makeTail(LinkedEntry&lt;K, V&gt; e) &#123; // Unlink e e.prv.nxt = e.nxt; e.nxt.prv = e.prv; // Relink e as tail LinkedEntry&lt;K, V&gt; header = this.header; LinkedEntry&lt;K, V&gt; oldTail = header.prv; e.nxt = header; e.prv = oldTail; oldTail.nxt = header.prv = e; modCount++;&#125; // Unlink e // Relink e as tail LinkedHashMap æ˜¯åŒå‘å¾ªç¯é“¾è¡¨ï¼Œç„¶åæ­¤æ¬¡ LruCache.get -&gt; LinkedHashMap.get çš„æ•°æ®å°±è¢«æ”¾åˆ°æœ€æœ«å°¾äº†ã€‚ ä»¥ä¸Šå°±æ˜¯ LruCache æ ¸å¿ƒå·¥ä½œåŸç†ã€‚ æ¥ä¸‹æ¥ä»‹ç» LruCache çš„å®¹é‡æº¢å‡ºç­–ç•¥ã€‚ 4.6 LruCache.put(K key, V value)123456789101112public final V put(K key, V value) &#123; ... synchronized (this) &#123; ... // æ‹¿åˆ°é”®å€¼å¯¹ï¼Œè®¡ç®—å‡ºåœ¨å®¹é‡ä¸­çš„ç›¸å¯¹é•¿åº¦ï¼Œç„¶ååŠ ä¸Š size += safeSizeOf(key, value); ... &#125; ... trimToSize(maxSize); return previous;&#125; è®°ä½å‡ ç‚¹ï¼š 1.put å¼€å§‹çš„æ—¶å€™ç¡®å®æ˜¯æŠŠå€¼æ”¾å…¥ LinkedHashMap äº†ï¼Œä¸ç®¡è¶…ä¸è¶…è¿‡ä½ è®¾å®šçš„ç¼“å­˜å®¹é‡ã€‚ 2.ç„¶åæ ¹æ® safeSizeOf æ–¹æ³•è®¡ç®— æ­¤æ¬¡æ·»åŠ æ•°æ®çš„å®¹é‡æ˜¯å¤šå°‘ï¼Œå¹¶ä¸”åŠ åˆ° size é‡Œ ã€‚ 3.è¯´åˆ° safeSizeOf å°±è¦è®²åˆ° sizeOf(K key, V value) ä¼šè®¡ç®—å‡ºæ­¤æ¬¡æ·»åŠ æ•°æ®çš„å¤§å° ã€‚ 4.ç›´åˆ° put è¦ç»“æŸæ—¶ï¼Œè¿›è¡Œäº† trimToSize æ‰åˆ¤æ–­ size æ˜¯å¦ å¤§äº maxSize ç„¶åè¿›è¡Œæœ€è¿‘å¾ˆå°‘è®¿é—®æ•°æ®çš„ç§»é™¤ã€‚ 4.7 LruCache.trimToSize(int maxSize)1234567891011121314151617181920212223242526272829303132333435public void trimToSize(int maxSize) &#123; /* * è¿™æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œ * 1.åªæœ‰ æ‰©å®¹ çš„æƒ…å†µä¸‹èƒ½ç«‹å³è·³å‡º * 2.éæ‰©å®¹çš„æƒ…å†µä¸‹ï¼Œmapçš„æ•°æ®ä¼šä¸€ä¸ªä¸€ä¸ªåˆ é™¤ï¼Œç›´åˆ°mapé‡Œæ²¡æœ‰å€¼äº†ï¼Œå°±ä¼šè·³å‡º */ while (true) &#123; K key; V value; synchronized (this) &#123; // åœ¨é‡æ–°è°ƒæ•´å®¹é‡å¤§å°å‰ï¼Œæœ¬èº«å®¹é‡å°±ä¸ºç©ºçš„è¯ï¼Œä¼šå‡ºå¼‚å¸¸çš„ã€‚ if (size &lt; 0 || (map.isEmpty() &amp;&amp; size != 0)) &#123; throw new IllegalStateException( getClass().getName() + \".sizeOf() is reporting inconsistent results!\"); &#125; // å¦‚æœæ˜¯ æ‰©å®¹ æˆ–è€… mapä¸ºç©ºäº†ï¼Œå°±ä¼šä¸­æ–­ï¼Œå› ä¸ºæ‰©å®¹ä¸ä¼šæ¶‰åŠåˆ°ä¸¢å¼ƒæ•°æ®çš„æƒ…å†µ if (size &lt;= maxSize || map.isEmpty()) &#123; break; &#125; Map.Entry&lt;K, V&gt; toEvict = map.entrySet().iterator().next(); key = toEvict.getKey(); value = toEvict.getValue(); map.remove(key); // æ‹¿åˆ°é”®å€¼å¯¹ï¼Œè®¡ç®—å‡ºåœ¨å®¹é‡ä¸­çš„ç›¸å¯¹é•¿åº¦ï¼Œç„¶åå‡å»ã€‚ size -= safeSizeOf(key, value); // æ·»åŠ ä¸€æ¬¡æ”¶å›æ¬¡æ•° evictionCount++; &#125; /* * å°†æœ€åä¸€æ¬¡åˆ é™¤çš„æœ€å°‘è®¿é—®æ•°æ®å›è°ƒå‡ºå» */ entryRemoved(true, key, value, null); &#125;&#125; ç®€å•æè¿°ï¼šä¼šåˆ¤æ–­ä¹‹å‰ size æ˜¯å¦å¤§äº maxSize ã€‚æ˜¯çš„è¯ï¼Œç›´æ¥è·³å‡ºåä»€ä¹ˆä¹Ÿä¸åšã€‚ä¸æ˜¯çš„è¯ï¼Œè¯æ˜å·²ç»æº¢å‡ºå®¹é‡äº†ã€‚ç”± makeTail å›¾å·²çŸ¥ï¼Œæœ€è¿‘ç»å¸¸è®¿é—®çš„æ•°æ®åœ¨æœ€æœ«å°¾ã€‚æ‹¿åˆ°ä¸€ä¸ªå­˜æ”¾ key çš„ Setï¼Œç„¶åä¸€ç›´ä¸€ç›´ä»å¤´å¼€å§‹åˆ é™¤ï¼Œåˆ ä¸€ä¸ªåˆ¤æ–­æ˜¯å¦æº¢å‡ºï¼Œç›´åˆ°æ²¡æœ‰æº¢å‡ºã€‚ æœ€åçœ‹çœ‹ï¼š 4.8 è¦†å†™ entryRemoved çš„ä½œç”¨entryRemovedè¢«LruCacheè°ƒç”¨çš„åœºæ™¯ï¼š 1.ï¼ˆputï¼‰ put å‘ç”Ÿ key å†²çªæ—¶è¢«è°ƒç”¨ï¼Œevicted=falseï¼Œkey=æ­¤æ¬¡ put çš„ keyï¼ŒoldValue=è¢«è¦†ç›–çš„å†²çª valueï¼ŒnewValue=æ­¤æ¬¡ put çš„ valueã€‚ 2.ï¼ˆtrimToSizeï¼‰ trimToSize çš„æ—¶å€™ï¼Œåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå°±æ˜¯æœ€åä¸€æ¬¡è¢«åˆ é™¤çš„æœ€å°‘è®¿é—®æ•°æ®å¸¦å›æ¥ã€‚evicted=trueï¼Œkey=æœ€åä¸€æ¬¡è¢«åˆ é™¤çš„ keyï¼ŒoldValue=æœ€åä¸€æ¬¡è¢«åˆ é™¤çš„ valueï¼ŒnewValue=nullï¼ˆæ­¤æ¬¡æ²¡æœ‰å†²çªï¼Œåªæ˜¯ removeï¼‰ã€‚ 3.ï¼ˆremoveï¼‰ removeçš„æ—¶å€™ï¼Œå­˜åœ¨å¯¹åº” keyï¼Œå¹¶ä¸”è¢«æˆåŠŸåˆ é™¤åè¢«è°ƒç”¨ã€‚evicted=falseï¼Œkey=æ­¤æ¬¡ putçš„ keyï¼ŒoldValue=æ­¤æ¬¡åˆ é™¤çš„ valueï¼ŒnewValue=nullï¼ˆæ­¤æ¬¡æ²¡æœ‰å†²çªï¼Œåªæ˜¯ removeï¼‰ã€‚ 4.ï¼ˆgetååŠæ®µï¼ŒæŸ¥è¯¢ä¸¢å¤±åå¤„ç†æƒ…æ™¯ï¼Œä¸è¿‡å»ºè®®å¿½ç•¥ï¼‰ get çš„æ—¶å€™ï¼Œæ­£å¸¸çš„è¯ä¸å®ç°è‡ªå®šä¹‰ create çš„è¯ï¼Œä»£ç ä¸Šçœ‹ get æ–¹æ³•åªä¼šèµ°ä¸€åŠï¼Œå¦‚æœä½ å®ç°äº†è‡ªå®šä¹‰çš„ create(K key) æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨ ä½  create åçš„å€¼æ”¾å…¥ LruCache ä¸­å‘ç”Ÿ key å†²çªæ—¶è¢«è°ƒç”¨ï¼Œevicted=falseï¼Œkey=æ­¤æ¬¡ get çš„ keyï¼ŒoldValue=è¢«ä½ è‡ªå®šä¹‰ create(key)åçš„ valueï¼ŒnewValue=åŸæœ¬å­˜åœ¨ map é‡Œçš„ key-valueã€‚ è§£é‡Šä¸€ä¸‹ç¬¬å››ç‚¹å§ï¼š ç¬¬å››ç‚¹æ˜¯è¿™æ ·çš„ï¼Œå…ˆ get(key)ï¼Œç„¶åæ²¡æ‹¿åˆ°ï¼Œä¸¢å¤±ã€‚ å¦‚æœä½ æä¾›äº† è‡ªå®šä¹‰çš„ create(key) æ–¹æ³•ï¼Œé‚£ä¹ˆ LruCache ä¼šæ ¹æ®ä½ çš„é€»è¾‘è‡ªé€ ä¸€ä¸ª valueï¼Œä½†æ˜¯å½“æ”¾å…¥çš„æ—¶å€™å‘ç°å†²çªäº†ï¼Œä½†æ˜¯å·²ç»æ”¾å…¥äº†ã€‚ æ­¤æ—¶ï¼Œä¼šå°†é‚£ä¸ªå†²çªçš„å€¼å†è®©å›å»è¦†ç›–ï¼Œæ­¤æ—¶è°ƒç”¨ä¸Šè¿°4.çš„ entryRemovedã€‚ å› ä¸º HashMap åœ¨æ•°æ®é‡å¤§æƒ…å†µä¸‹ï¼Œæ‹¿æ•°æ®å¯èƒ½é€ æˆä¸¢å¤±ï¼Œå¯¼è‡´å‰åŠæ®µæŸ¥ä¸åˆ°ï¼Œä½ è‡ªå®šä¹‰çš„ create(key) æ”¾å…¥çš„æ—¶å€™å‘ç°åˆæŸ¥åˆ°äº†ï¼ˆæœ‰å†²çªï¼‰ã€‚ç„¶ååˆæ€¥å¿™æŠŠåŸæ¥çš„å€¼æ”¾å›å»ï¼Œæ­¤æ—¶ä½ å°±ç™½ç™½createä¸€è¶Ÿï¼Œæ— æ‰€ä½œä¸ºï¼Œè¿˜è¦èµ°ä¸€éentryRemovedã€‚ ç»¼ä¸Šå°±å¦‚åŒæ³¨é‡Šå†™çš„ä¸€æ ·ï¼š12345678910/** * 1.å½“è¢«å›æ”¶æˆ–è€…åˆ æ‰æ—¶è°ƒç”¨ã€‚è¯¥æ–¹æ³•å½“valueè¢«å›æ”¶é‡Šæ”¾å­˜å‚¨ç©ºé—´æ—¶è¢«removeè°ƒç”¨ * æˆ–è€…æ›¿æ¢æ¡ç›®å€¼æ—¶putè°ƒç”¨ï¼Œé»˜è®¤å®ç°ä»€ä¹ˆéƒ½æ²¡åšã€‚ * 2.è¯¥æ–¹æ³•æ²¡ç”¨åŒæ­¥è°ƒç”¨ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹è®¿é—®ç¼“å­˜æ—¶ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šæ‰§è¡Œã€‚ * 3.evicted=trueï¼šå¦‚æœè¯¥æ¡ç›®è¢«åˆ é™¤ç©ºé—´ ï¼ˆè¡¨ç¤º è¿›è¡Œäº†trimToSize or removeï¼‰ evicted=falseï¼šputå†²çªå æˆ– geté‡ŒæˆåŠŸcreateå * å¯¼è‡´ * 4.newValue!=nullï¼Œé‚£ä¹ˆåˆ™è¢«put()æˆ–get()è°ƒç”¨ã€‚ */protected void entryRemoved(boolean evicted, K key, V oldValue, V newValue) &#123;&#125; å¯ä»¥å‚è€ƒæˆ‘çš„ demo é‡Œçš„ entryRemoved ã€‚ 4.9 LruCache å±€éƒ¨åŒæ­¥é”åœ¨ get, put, trimToSize, remove å››ä¸ªæ–¹æ³•é‡Œçš„ entryRemoved æ–¹æ³•éƒ½ä¸åœ¨åŒæ­¥å—é‡Œã€‚å› ä¸º entryRemoved å›è°ƒçš„å‚æ•°éƒ½å±äºæ–¹æ³•åŸŸå‚æ•°ï¼Œä¸ä¼šçº¿ç¨‹ä¸å®‰å…¨ã€‚ æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨æ˜¯çº¿ç¨‹éš”ç¦»çš„æ•°æ®åŒº 5. å¼€æºé¡¹ç›®ä¸­çš„ä½¿ç”¨square/picasso 6. æ€»ç»“LruCacheé‡è¦çš„å‡ ç‚¹ï¼š 1.LruCache æ˜¯é€šè¿‡ LinkedHashMap æ„é€ æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°çš„ accessOrder=true å®ç°äº† LinkedHashMap çš„æ•°æ®æ’åºåŸºäºè®¿é—®é¡ºåº ï¼ˆæœ€è¿‘è®¿é—®çš„æ•°æ®ä¼šåœ¨é“¾è¡¨å°¾éƒ¨ï¼‰ï¼Œåœ¨å®¹é‡æº¢å‡ºçš„æ—¶å€™ï¼Œå°†é“¾è¡¨å¤´éƒ¨çš„æ•°æ®ç§»é™¤ã€‚ä»è€Œï¼Œå®ç°äº† LRU æ•°æ®ç¼“å­˜æœºåˆ¶ã€‚ 2.LruCache åœ¨å†…éƒ¨çš„getã€putã€removeåŒ…æ‹¬ trimToSize éƒ½æ˜¯å®‰å…¨çš„ï¼ˆå› ä¸ºéƒ½ä¸Šé”äº†ï¼‰ã€‚ 3.LruCache è‡ªèº«å¹¶æ²¡æœ‰é‡Šæ”¾å†…å­˜ï¼Œå°† LinkedHashMap çš„æ•°æ®ç§»é™¤äº†ï¼Œå¦‚æœæ•°æ®è¿˜åœ¨åˆ«çš„åœ°æ–¹è¢«å¼•ç”¨äº†ï¼Œè¿˜æ˜¯æœ‰æ³„æ¼é—®é¢˜ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ã€‚ 4.è¦†å†™ entryRemoved æ–¹æ³•èƒ½çŸ¥é“ LruCache æ•°æ®ç§»é™¤æ˜¯æ˜¯å¦å‘ç”Ÿäº†å†²çªï¼Œä¹Ÿå¯ä»¥å»æ‰‹åŠ¨é‡Šæ”¾èµ„æºã€‚ 5.maxSize å’Œ sizeOf(K key, V value) æ–¹æ³•çš„è¦†å†™æ¯æ¯ç›¸å…³ï¼Œå¿…é¡»ç›¸åŒå•ä½ã€‚ï¼ˆ æ¯”å¦‚ maxSize æ˜¯7MBï¼Œè‡ªå®šä¹‰çš„ sizeOf è®¡ç®—æ¯ä¸ªæ•°æ®å¤§å°çš„æ—¶å€™å¿…é¡»èƒ½ç®—å‡ºä¸MBä¹‹é—´æœ‰è”ç³»çš„å•ä½ ï¼‰ 7. èµ„æºLruCacheActivity LruCache æ³¨é‡Šæºç  åŸæ–‡é“¾æ¥ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"FloatingActionButtonæºç è§£æ","date":"2017-07-26T11:55:14.000Z","path":"2017/07/26/FloatingActionButtonæºç è§£æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ èƒŒæ™¯FloatingActionButtonï¼ˆä¸‹æ–‡ä»¥fabä»£æ›¿ï¼‰æ˜¯android support designç»„ä»¶åº“ä¸­æä¾›çš„ä¸€ä¸ªè§†å›¾æ§ä»¶ï¼Œæ˜¯material designè®¾è®¡ä¸­fabçš„å®˜æ–¹å®ç°ã€‚ æ­¤æ§ä»¶çš„å®˜æ–¹ä»‹ç»å¦‚ä¸‹ï¼š Floating action buttons are used for a promoted action. They are distinguished by a circled icon floating above the UI and have motion behaviors that include morphing, launching, and a transferring anchor point. å…³äºè¯¥æ§ä»¶çš„è®¾è®¡è§„èŒƒåŠä½¿ç”¨åœºæ™¯è¯·å‚è€ƒæ–‡æ¡£ï¼š http://www.google.com/design/spec/components/buttons-floating-action-button.html# å¦‚æœä½ è¿˜ä¸äº†è§£designç»„ä»¶åº“ï¼Œè¯·å‚è€ƒå®˜æ–¹åšå®¢: http://android-developers.blogspot.hk/2015/05/android-design-support-library.html å¼€å§‹æºç ç‰ˆæœ¬:23.3.0 fabé—´æ¥ç»§æ‰¿è‡ªImageViewï¼ˆImageButtonæ˜¯ImageViewçš„å­ç±»ï¼‰ï¼Œå› è€Œæ‹¥æœ‰ImageViewçš„å¤§éƒ¨åˆ†ç‰¹æ€§ã€‚ä½†æ˜¯å…¶å†…éƒ¨è¿˜æ˜¯åšäº†å¾ˆå¤šå®šåˆ¶ï¼Œæˆ‘ä»¬ä¸€ä¸€æ¥çœ‹ã€‚ 1. fabçš„è‡ªå®šä¹‰å±æ€§ã€èƒŒæ™¯ç€è‰²ç›¸å…³ä»æ„é€ å™¨å¼€å§‹ï¼š 12345678910111213141516171819202122public FloatingActionButton(Context context, AttributeSet attrs, int defStyleAttr) &#123; super(context, attrs, defStyleAttr); //æ£€æŸ¥æ˜¯å¦ä½¿ç”¨Theme.Appcompatä¸»é¢˜ ThemeUtils.checkAppCompatTheme(context); //æ‹¿åˆ°è‡ªå®šä¹‰å±æ€§å¹¶èµ‹å€¼ TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.FloatingActionButton, defStyleAttr, R.style.Widget_Design_FloatingActionButton); ... a.recycle(); final int maxImageSize = (int) getResources().getDimension(R.dimen.design_fab_image_size); mImagePadding = (getSizeDimension() - maxImageSize) / 2; //èƒŒæ™¯ç€è‰² getImpl().setBackgroundDrawable(mBackgroundTint, mBackgroundTintMode, mRippleColor, mBorderWidth); //ç»˜åˆ¶é˜´å½± getImpl().setElevation(elevation); ... &#125; æ„é€ å™¨ä¸­ä¸»è¦æ˜¯æ‹¿åˆ°ç”¨æˆ·è®¾ç½®çš„è‡ªå®šä¹‰å±æ€§ï¼Œæ¯”å¦‚ç€è‰²ã€æ³¢çº¹é¢œè‰²ã€å¤§å°ç­‰ç­‰,ä¸€å…±æœ‰ä»¥ä¸‹å‡ ä¸ªå±æ€§å¯ä»¥å®šä¹‰ã€‚ 12345678910111213&lt;declare-styleable name=\"FloatingActionButton\"&gt;&lt;attr name=\"backgroundTint\"/&gt;&lt;attr name=\"backgroundTintMode\"/&gt;&lt;attr format=\"color\" name=\"rippleColor\"/&gt;&lt;attr name=\"fabSize\"&gt; &lt;enum name=\"normal\" value=\"0\"/&gt; &lt;enum name=\"mini\" value=\"1\"/&gt;&lt;/attr&gt;&lt;attr name=\"elevation\"/&gt;&lt;attr format=\"dimension\" name=\"pressedTranslationZ\"/&gt;&lt;attr format=\"dimension\" name=\"borderWidth\"/&gt;&lt;attr format=\"boolean\" name=\"useCompatPadding\"/&gt;&lt;/declare-styleable&gt; å±æ€§çš„é»˜è®¤å€¼å®šä¹‰å¦‚ä¸‹ï¼š 1234567891011&lt;style name=\"Widget.Design.FloatingActionButton\" parent=\"android:Widget\"&gt; &lt;item name=\"android:background\"&gt;@drawable/design_fab_background&lt;/item&gt; &lt;item name=\"backgroundTint\"&gt;?attr/colorAccent&lt;/item&gt; &lt;item name=\"fabSize\"&gt;normal&lt;/item&gt; &lt;item name=\"elevation\"&gt;@dimen/design_fab_elevation&lt;/item&gt; &lt;item name=\"pressedTranslationZ\"&gt;@dimen/design_fab_translation_z_pressed&lt;/item&gt; &lt;item name=\"rippleColor\"&gt;?attr/colorControlHighlight&lt;/item&gt; &lt;item name=\"borderWidth\"&gt;@dimen/design_fab_border_width&lt;/item&gt; &lt;/style&gt; éœ€è¦æ³¨æ„çš„æ˜¯android:backgroundå±æ€§ï¼Œè¿™é‡ŒæŒ‡å®šäº†backgroundä¸ºdesign_fab_background,å¹¶ä¸”ä¸å…è®¸æ”¹å˜: 1234@Override public void setBackgroundDrawable(Drawable background) &#123; Log.i(LOG_TAG, \"Setting a custom background is not supported.\"); &#125; é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªbackgroundé•¿å•¥æ ·ï¼š 1234&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\" android:shape=\"oval\"&gt; &lt;solid android:color=\"@android:color/white\" /&gt;&lt;/shape&gt; å¾ˆæ˜¾ç„¶ï¼Œfabçš„å½¢çŠ¶å›ºå®šä¸ºåœ†å½¢éƒ½æ˜¯å› ä¸ºè¿™ä¸ªbackgroundã€‚é‚£ä¹ˆè¿™é‡ŒæŒ‡å®šäº†èƒŒæ™¯è‰²ä¸ºç™½è‰²ï¼Œé‚£æ˜¯ä¸æ˜¯fabåªèƒ½æ˜¯ç™½è‰²èƒŒæ™¯å‘¢ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼Œè¿˜æœ‰æˆ‘ä»¬ç‰›é€¼çš„backgroundTint(å³èƒŒæ™¯ç€è‰²)ï¼Œtintæ˜¯android 5.xå¼•è¿›çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå¯ä»¥åŠ¨æ€åœ°ç»™drawableèµ„æºç€è‰²ï¼Œå…¶åŸç†å°±æ˜¯é€šè¿‡ç»™æ§ä»¶è®¾ç½®colorFilter: drawable.java 123public void setColorFilter(@ColorInt int color, @NonNull PorterDuff.Mode mode) &#123; setColorFilter(new PorterDuffColorFilter(color, mode)); &#125; é»˜è®¤çš„ç€è‰²æ¨¡å¼ä¸ºSRC_IN(å–äº¤é›†ã€æ˜¾ç¤ºä¸Šå±‚ï¼Œæ•…åº•å±‚ç™½è‰²ä¼šè¢«å¿½ç•¥)ï¼š 1static final PorterDuff.Mode DEFAULT_TINT_MODE = PorterDuff.Mode.SRC_IN; åœ¨fabæ„é€ çš„æ—¶å€™ï¼Œä¼šæŒ‡å®šç€è‰²ä¸ºï¼Ÿattr/colorAccentï¼Œå³å½“å‰ä¸»é¢˜çš„colorAccentå±æ€§å€¼ã€‚ç„¶åæ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼Œè¿›è¡Œç€è‰²ã€‚ 12getImpl().setBackgroundDrawable(mBackgroundTint, mBackgroundTintMode, mRippleColor, mBorderWidth); å› ä¸ºä¸åŒç‰ˆæœ¬é—´çš„å®ç°ç•¥æœ‰ä¸åŒï¼Œæ‰€ä»¥è¿™é‡Œä¼šæ ¹æ®ä¸åŒç‰ˆæœ¬åˆ›å»ºä¸åŒçš„FloatingActionButtonImplå®ç°ç±»ï¼š 12345678910private FloatingActionButtonImpl createImpl() &#123; final int sdk = Build.VERSION.SDK_INT; if (sdk &gt;= 21) &#123; return new FloatingActionButtonLollipop(this, new ShadowDelegateImpl()); &#125; else if (sdk &gt;= 14) &#123; return new FloatingActionButtonIcs(this, new ShadowDelegateImpl()); &#125; else &#123; return new FloatingActionButtonEclairMr1(this, new ShadowDelegateImpl()); &#125; &#125; ä»¥5.xä¸ºä¾‹ï¼Œå…¶setBackgroundDrawableå®ç°ä»£ç å¦‚ä¸‹: å…ˆåˆ›å»ºç€è‰²çš„èƒŒæ™¯drawableã€‚ 123456GradientDrawable createShapeDrawable() &#123; GradientDrawable d = new GradientDrawable(); d.setShape(GradientDrawable.OVAL); d.setColor(Color.WHITE); return d; &#125; å†å¯¹æ­¤drawableè®¾ç½®tintï¼š 1234567891011121314151617181920212223242526272829@Override void setBackgroundDrawable(ColorStateList backgroundTint, PorterDuff.Mode backgroundTintMode, int rippleColor, int borderWidth) &#123; // Now we need to tint the shape background with the tint mShapeDrawable = DrawableCompat.wrap(createShapeDrawable()); //ç€è‰²ï¼Œè¿™é‡Œä¼šå…¶å®å°±æ˜¯è®¾ç½®äº†ä¸‹colorFilter DrawableCompat.setTintList(mShapeDrawable, backgroundTint); if (backgroundTintMode != null) &#123; DrawableCompat.setTintMode(mShapeDrawable, backgroundTintMode); &#125; final Drawable rippleContent; if (borderWidth &gt; 0) &#123; mBorderDrawable = createBorderDrawable(borderWidth, backgroundTint); rippleContent = new LayerDrawable(new Drawable[]&#123;mBorderDrawable, mShapeDrawable&#125;); &#125; else &#123; mBorderDrawable = null; rippleContent = mShapeDrawable; &#125; mRippleDrawable = new RippleDrawable(ColorStateList.valueOf(rippleColor), rippleContent, null); mContentBackground = mRippleDrawable; mShadowViewDelegate.setBackgroundDrawable(mRippleDrawable); &#125; ç»è¿‡ç€è‰²ï¼Œfabå°±å‘ˆç°å‡ºæˆ‘ä»¬æƒ³è¦çš„é¢œè‰²å•¦ã€‚ 2. fabçš„å¤§å°å†æ¥çœ‹fabçš„å¤§å°ï¼Œfabæœ‰ä¸¤ç§å¤§å°ï¼Œä¸€ç§æ˜¯NORMALï¼Œä¸€ç§æ˜¯MINIï¼Œå®é™…å¤§å°åˆ†åˆ«æ˜¯56dpå’Œ40dpï¼Œå…¶å®šä¹‰å¯ä»¥åœ¨designåº“çš„values.xmlä¸­çœ‹åˆ°ã€‚ fabå¦‚ä½•æ§åˆ¶æ§ä»¶å¤§å°åªæœ‰è¿™ä¸¤ç§è§„æ ¼å‘¢(è¿™æ ·è¯´ä¸å‡†ç¡®ï¼Œäº‹å®ä¸Šä½ å¯ä»¥é€šè¿‡è®¾ç½®fabçš„layout_width/layout_heightæŒ‡å®šä¸ºä»»æ„å¤§å°ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€å¥½æŒ‰ç…§MDè§„èŒƒæ¥)?å¿…ç„¶æ˜¯é€šè¿‡å¤å†™onMeasureå•¦: 12345678910111213141516@Override protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123; //æˆ‘ä»¬å¸Œæœ›çš„å¤§å° final int preferredSize = getSizeDimension(); //æœ€ç»ˆæµ‹é‡çš„å¤§å° final int w = resolveAdjustedSize(preferredSize, widthMeasureSpec); final int h = resolveAdjustedSize(preferredSize, heightMeasureSpec); //å–å°å€¼ï¼Œä¿è¯æœ€åç»˜åˆ¶çš„æ˜¯åœ†å½¢ final int d = Math.min(w, h); // We add the shadow's padding to the measured dimension setMeasuredDimension( d + mShadowPadding.left + mShadowPadding.right, d + mShadowPadding.top + mShadowPadding.bottom); &#125; å…¶ä¸­getSizeDimensionæ–¹æ³•è®¡ç®—å‡ºæ¥çš„æ˜¯æˆ‘ä»¬æœŸæœ›çš„å¤§å°: 12345678910final int getSizeDimension() &#123; switch (mSize) &#123; case SIZE_MINI: return getResources().getDimensionPixelSize(R.dimen.design_fab_size_mini);//40dp case SIZE_NORMAL: default: return getResources().getDimensionPixelSize(R.dimen.design_fab_size_normal);//56dp &#125; &#125; ä½†æ˜¯æœ€ç»ˆçš„å€¼è¿˜æ˜¯å¾—çœ‹æˆ‘ä»¬è®¾ç½®çš„LayoutParamsã€‚å…³äºæ§ä»¶æµ‹é‡ç›¸å…³å†…å®¹ä¸åœ¨æ­¤æ–‡ä»‹ç»èŒƒå›´å†…ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œgoogleã€‚ 3.fabçš„åŠ¨ç”»fabè¿˜æ”¯æŒfabä»¥åŠ¨ç”»çš„æ–¹å¼æ˜¾ç°/éšè—ï¼Œé€šå¸¸å’ŒAppBarLayoutä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡hide()/show()ä¸¤ä¸ªæ–¹æ³•æ§åˆ¶ã€‚ é‚£ä¹ˆåŠ¨ç”»æ˜¯å¦‚ä½•å®ç°çš„å‘¢: 1234567private void show(OnVisibilityChangedListener listener, boolean fromUser) &#123; getImpl().show(wrapOnVisibilityChangedListener(listener), fromUser); &#125;private void hide(@Nullable OnVisibilityChangedListener listener, boolean fromUser) &#123; getImpl().hide(wrapOnVisibilityChangedListener(listener), fromUser);&#125; è¿™é‡Œå› ä¸ºè¦å…¼å®¹ä¸åŒç‰ˆæœ¬ï¼Œæ‰€ä»¥å…·ä½“å®ç°ä¹Ÿäº¤ç»™äº†ä¸åŒçš„fabå®ç°ç±»ã€‚3.xä¹‹åå¾ˆå¥½åŠï¼Œç›´æ¥ä½¿ç”¨å±æ€§åŠ¨ç”»ï¼Œå¦‚æœæ˜¯3.xä¹‹å‰çš„è¯ï¼Œé‚£ä¹ˆåªèƒ½ä½¿ç”¨ä¼ ç»Ÿçš„Animationäº† ä»¥hide()ä¸ºä¾‹ï¼Œä½¿ç”¨å±æ€§åŠ¨ç”»è¾ƒä¸ºç®€å•ï¼Œç›´æ¥ä½¿ç”¨View#animate()å³å¯é“¾å¼è°ƒç”¨ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253@Override void hide(@Nullable final InternalVisibilityChangedListener listener, final boolean fromUser) &#123; if (mIsHiding || mView.getVisibility() != View.VISIBLE) &#123; // A hide animation is in progress, or we're already hidden. Skip the call if (listener != null) &#123; listener.onHidden(); &#125; return; &#125; if (!ViewCompat.isLaidOut(mView) || mView.isInEditMode()) &#123; // If the view isn't laid out, or we're in the editor, don't run the animation mView.internalSetVisibility(View.GONE, fromUser); if (listener != null) &#123; listener.onHidden(); &#125; &#125; else &#123; mView.animate().cancel(); mView.animate() .scaleX(0f) .scaleY(0f) .alpha(0f) .setDuration(SHOW_HIDE_ANIM_DURATION) .setInterpolator(AnimationUtils.FAST_OUT_LINEAR_IN_INTERPOLATOR) .setListener(new AnimatorListenerAdapter() &#123; private boolean mCancelled; @Override public void onAnimationStart(Animator animation) &#123; mIsHiding = true; mCancelled = false; mView.internalSetVisibility(View.VISIBLE, fromUser); &#125; @Override public void onAnimationCancel(Animator animation) &#123; mIsHiding = false; mCancelled = true; &#125; @Override public void onAnimationEnd(Animator animation) &#123; mIsHiding = false; if (!mCancelled) &#123; mView.internalSetVisibility(View.GONE, fromUser); if (listener != null) &#123; listener.onHidden(); &#125; &#125; &#125; &#125;); &#125; &#125; å¦‚æœä½¿ç”¨ä¼ ç»ŸåŠ¨ç”»çš„è¯ï¼Œåˆ™å…ˆåœ¨xmlä¸­å®šä¹‰å¥½åŠ¨ç”»ï¼Œç„¶åæ„é€ Animationå®ä¾‹ï¼Œå¯åŠ¨åŠ¨ç”»ã€‚ 12345678910111213141516171819202122232425262728293031@Override void hide(@Nullable final InternalVisibilityChangedListener listener, final boolean fromUser) &#123; if (mIsHiding || mView.getVisibility() != View.VISIBLE) &#123; // A hide animation is in progress, or we're already hidden. Skip the call if (listener != null) &#123; listener.onHidden(); &#125; return; &#125; Animation anim = android.view.animation.AnimationUtils.loadAnimation( mView.getContext(), R.anim.design_fab_out); anim.setInterpolator(AnimationUtils.FAST_OUT_LINEAR_IN_INTERPOLATOR); anim.setDuration(SHOW_HIDE_ANIM_DURATION); anim.setAnimationListener(new AnimationUtils.AnimationListenerAdapter() &#123; @Override public void onAnimationStart(Animation animation) &#123; mIsHiding = true; &#125; @Override public void onAnimationEnd(Animation animation) &#123; mIsHiding = false; mView.internalSetVisibility(View.GONE, fromUser); if (listener != null) &#123; listener.onHidden(); &#125; &#125; &#125;); mView.startAnimation(anim); &#125; 4. fabä¸CoordinatorLayoutçš„äº¤äº’ è¿™å—å†…å®¹å› ä¸ºä¸CoordinatorLayout/CoordinatorLayout#Behavioræœ‰å¾ˆå¤§å…³è”ï¼Œå¦‚æœä¸ç†Ÿæ‚‰ï¼Œè¯·å…ˆgoogleç›¸å…³èµ„æ–™ã€‚æœ¬æ–‡å‡è®¾è¯»è€…å¯¹è¿™å—å†…å®¹å·²ç»æœ‰ä¸€å®šç†è§£ã€‚ fabå¹¶ä¸ç›´æ¥ä¸CoordinatorLayoutè”ç³»ï¼Œè€Œæ˜¯é€šè¿‡CoordinatorLayout#Behaviorä½œä¸ºæ¡¥æ¢ã€‚CoordinatorLayoutç±»é€šè¿‡CoordinatorLayout#Behaviorå¯ä»¥é—´æ¥æ§åˆ¶å…¶ç›´ç³»å­Viewçš„è¡Œä¸ºï¼Œèƒ½æ§åˆ¶ä»€ä¹ˆè¡Œä¸ºï¼ŸViewæµ‹é‡ã€å¸ƒå±€ã€touchäº‹ä»¶æ‹¦æˆªã€ç›‘å¬ã€NestedScrollç­‰ç­‰ã€‚æ˜¯ä¸æ˜¯å¾ˆå±Œã€‚ fabå†…éƒ¨å®ç°äº†CoordinatorLayout#BehavioræŠ½è±¡ç±»ã€‚è¯¥æŠ½è±¡ç±»æœ‰å¦‚ä¸‹æ¥å£: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990public static abstract class Behavior&lt;V extends View&gt; &#123; ... public boolean onInterceptTouchEvent(CoordinatorLayout parent, V child, MotionEvent ev) &#123; return false; &#125; public boolean onTouchEvent(CoordinatorLayout parent, V child, MotionEvent ev) &#123; return false; &#125; ... /** * Determine whether the supplied child view has another specific sibling view as a * layout dependency. * * &lt;p&gt;This method will be called at least once in response to a layout request. If it * returns true for a given child and dependency view pair, the parent CoordinatorLayout * will:&lt;/p&gt; * &lt;ol&gt; * &lt;li&gt;Always lay out this child after the dependent child is laid out, regardless * of child order.&lt;/li&gt; * &lt;li&gt;Call &#123;@link #onDependentViewChanged&#125; when the dependency view's layout or * position changes.&lt;/li&gt; * &lt;/ol&gt; */ public boolean layoutDependsOn(CoordinatorLayout parent, V child, View dependency) &#123; return false; &#125; /** * Respond to a change in a child's dependent view * * &lt;p&gt;This method is called whenever a dependent view changes in size or position outside * of the standard layout flow. A Behavior may use this method to appropriately update * the child view in response.&lt;/p&gt; * * &lt;p&gt;A view's dependency is determined by * &#123;@link #layoutDependsOn(CoordinatorLayout, android.view.View, android.view.View)&#125; or * if &#123;@code child&#125; has set another view as it's anchor.&lt;/p&gt; * * &lt;p&gt;Note that if a Behavior changes the layout of a child via this method, it should * also be able to reconstruct the correct position in * &#123;@link #onLayoutChild(CoordinatorLayout, android.view.View, int) onLayoutChild&#125;. * &lt;code&gt;onDependentViewChanged&lt;/code&gt; will not be called during normal layout since * the layout of each child view will always happen in dependency order.&lt;/p&gt; * * &lt;p&gt;If the Behavior changes the child view's size or position, it should return true. * The default implementation returns false.&lt;/p&gt; * */ public boolean onDependentViewChanged(CoordinatorLayout parent, V child, View dependency) &#123; return false; &#125; ... /** * Called when the parent CoordinatorLayout is about the lay out the given child view. * * &lt;p&gt;This method can be used to perform custom or modified layout of a child view * in place of the default child layout behavior. The Behavior's implementation can * delegate to the standard CoordinatorLayout measurement behavior by calling * &#123;@link CoordinatorLayout#onLayoutChild(android.view.View, int) * parent.onLayoutChild&#125;.&lt;/p&gt; * * &lt;p&gt;If a Behavior implements * &#123;@link #onDependentViewChanged(CoordinatorLayout, android.view.View, android.view.View)&#125; * to change the position of a view in response to a dependent view changing, it * should also implement &lt;code&gt;onLayoutChild&lt;/code&gt; in such a way that respects those * dependent views. &lt;code&gt;onLayoutChild&lt;/code&gt; will always be called for a dependent view * &lt;em&gt;after&lt;/em&gt; its dependency has been laid out.&lt;/p&gt; * */ public boolean onLayoutChild(CoordinatorLayout parent, V child, int layoutDirection) &#123; return false; &#125; ... public void onNestedScroll(CoordinatorLayout coordinatorLayout, V child, View target, int dxConsumed, int dyConsumed, int dxUnconsumed, int dyUnconsumed) &#123; // Do nothing &#125; &#125; çœ‹åˆ°è¿™ä¸ªæŠ½è±¡ç±»ï¼Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„: æ­¤æŠ½è±¡ç±»å¹¶æ— æŠ½è±¡æ–¹æ³•ï¼Œä¹Ÿå³å­ç±»å¯é€‰æ‹©ä»»ä½•æƒ³å¤å†™çš„æ–¹æ³•è¿›è¡Œå¤å†™ã€‚ æ­¤æŠ½è±¡ç±»æ¥å—ä¸€ä¸ªæ³›å‹ã€‚è¯¥æ³›å‹éœ€è¦æ˜¯Viewçš„å­ç±»ã€‚ fabå®ç°æ­¤æŠ½è±¡ç±»: 1public static class Behavior extends CoordinatorLayout.Behavior&lt;FloatingActionButton&gt; &#123;&#125; æœ‰é€‰æ‹©æ€§åœ°å®ç°äº†ä¸‰ä¸ªæ–¹æ³•: 12345678public boolean layoutDependsOn(CoordinatorLayout parent, FloatingActionButton child, View dependency);public boolean onDependentViewChanged(CoordinatorLayout parent, FloatingActionButton child, View dependency); public boolean onLayoutChild(CoordinatorLayout parent, FloatingActionButton child, int layoutDirection); fabä¸ºå•¥è¦å®ç°Behavior?ä¸»è¦æ˜¯ä¸ºäº†é…åˆå…¶ä»–æ§ä»¶å®Œæˆä¸€äº›å¤æ‚çš„äº¤äº’ï¼Œæ¯”è¾ƒç»å…¸çš„åƒè¿™ä¸ª: fabåŠ¨ç”»æ•ˆæœ fabéœ€è¦åœ¨snackBarå¼¹å‡ºçš„æ—¶å€™è‡ªåŠ¨å‘ä¸Šå¹³ç§»ï¼Œè¿™å°±å¾—çŸ¥é“SnackBarçš„çŠ¶æ€äº†ï¼Œå®ç°Behaviorè®©fabæœ‰æœºä¼šç›‘å¬åˆ°å…¶ä»–CoordinatorLayoutå­Viewçš„çŠ¶æ€ï¼Œå¹¶æ ¹æ®çŠ¶æ€æ›´æ–°è‡ªå·±ã€‚ å¤å†™layoutDependsOnæ–¹æ³•å¯ä»¥å‘Šè¯‰CoordinatorLayoutæˆ‘å¯¹å“ªä¸ªViewæ„Ÿå…´è¶£ï¼Œ è¿™é‡Œå½“ç„¶æ˜¯SnackBaräº†ã€‚ï¼ˆæ³¨æ„å“¦ï¼ŒSnackBaræœ€ç»ˆå±•ç°çš„æ˜¯SnackbarLayoutï¼ŒSnackBaræœ¬èº«å¹¶ä¸æ˜¯Viewï¼‰ 12345678private static final boolean SNACKBAR_BEHAVIOR_ENABLED = Build.VERSION.SDK_INT &gt;= 11; @Override public boolean layoutDependsOn(CoordinatorLayout parent, FloatingActionButton child, View dependency) &#123; // We're dependent on all SnackbarLayouts (if enabled) return SNACKBAR_BEHAVIOR_ENABLED &amp;&amp; dependency instanceof Snackbar.SnackbarLayout; &#125; ä¸ºä»€ä¹ˆAPI LEVELè¦å¤§äº11å‘¢ï¼Ÿå› ä¸ºgoogleå·æ‡’æƒ³ç›´æ¥ä½¿ç”¨å±æ€§åŠ¨ç”»ã€‚ å‰é¢å‘Šè¯‰äº†CoordinatorLayoutfabå¯¹SnackBaræ¯”è¾ƒæ„Ÿå…´è¶£,é‚£ä¹ˆå½“SnackBarçŠ¶æ€æ”¹å˜çš„æ—¶å€™ï¼ŒCoordinatorLayoutå°±ä¼šé€šè¿‡onDependentViewChangedå›è°ƒé€šçŸ¥fab: fabå°±å¯ä»¥æ›´æ–°è‡ªå·±çš„UIæ‹‰ï¼ˆè¿™é‡Œå½“ç„¶æ˜¯å¹³ç§»å–½ï¼‰: 123456789101112@Override public boolean onDependentViewChanged(CoordinatorLayout parent, FloatingActionButton child, View dependency) &#123; if (dependency instanceof Snackbar.SnackbarLayout) &#123; updateFabTranslationForSnackbar(parent, child, dependency); &#125; else if (dependency instanceof AppBarLayout) &#123; // If we're depending on an AppBarLayout we will show/hide it automatically // if the FAB is anchored to the AppBarLayout updateFabVisibility(parent, (AppBarLayout) dependency, child); &#125; return false; &#125; å¦‚æœæ˜¯SnackBarçŠ¶æ€å˜åŒ–äº†ï¼Œé‚£ä¹ˆfabå°±ä¼šæ ¹æ®æƒ…å†µè¿›è¡Œå¹³ç§»ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041private void updateFabTranslationForSnackbar(CoordinatorLayout parent, final FloatingActionButton fab, View snackbar) &#123; final float targetTransY = getFabTranslationYForSnackbar(parent, fab); if (mFabTranslationY == targetTransY) &#123; // We're already at (or currently animating to) the target value, return... return; &#125; final float currentTransY = ViewCompat.getTranslationY(fab); // Make sure that any current animation is cancelled if (mFabTranslationYAnimator != null &amp;&amp; mFabTranslationYAnimator.isRunning()) &#123; mFabTranslationYAnimator.cancel(); &#125; if (fab.isShown() &amp;&amp; Math.abs(currentTransY - targetTransY) &gt; (fab.getHeight() * 0.667f)) &#123; // If the FAB will be travelling by more than 2/3 of it's height, let's animate // it instead if (mFabTranslationYAnimator == null) &#123; mFabTranslationYAnimator = ViewUtils.createAnimator(); mFabTranslationYAnimator.setInterpolator( AnimationUtils.FAST_OUT_SLOW_IN_INTERPOLATOR); mFabTranslationYAnimator.setUpdateListener( new ValueAnimatorCompat.AnimatorUpdateListener() &#123; @Override public void onAnimationUpdate(ValueAnimatorCompat animator) &#123; ViewCompat.setTranslationY(fab, animator.getAnimatedFloatValue()); &#125; &#125;); &#125; mFabTranslationYAnimator.setFloatValues(currentTransY, targetTransY); mFabTranslationYAnimator.start(); &#125; else &#123; // Now update the translation Y ViewCompat.setTranslationY(fab, targetTransY); &#125; mFabTranslationY = targetTransY; &#125; ä»£ç é‡Œçš„æ³¨é‡Šå¾ˆå¤šï¼Œæˆ‘å°±ä¸è§£é‡Šäº†ã€‚ å‰é¢è¯´åˆ°AppBarLayoutå’Œfabä¸€èµ·ä½¿ç”¨å¯ä»¥å®Œæˆå¦ä¸€ä¸ªæ•ˆæœï¼Œå³AppBarLayoutä¼¸ç¼©æ—¶ï¼Œfabä¹Ÿå¯ä»¥ä»¥åŠ¨ç”»çš„å½¢å¼æ˜¾ç°ã€éšè—ï¼Œå…¶å®ç°å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233private boolean updateFabVisibility(CoordinatorLayout parent, AppBarLayout appBarLayout, FloatingActionButton child) &#123; final CoordinatorLayout.LayoutParams lp = (CoordinatorLayout.LayoutParams) child.getLayoutParams(); //æ³¨æ„åˆ°æˆ‘ä»¬å¿…é¡»ä¸ºfabæŒ‡å®šlayout_anchorä¸ºappBarLayout if (lp.getAnchorId() != appBarLayout.getId()) &#123; // The anchor ID doesn't match the dependency, so we won't automatically // show/hide the FAB return false; &#125; if (child.getUserSetVisibility() != VISIBLE) &#123; // The view isn't set to be visible so skip changing it's visibility return false; &#125; if (mTmpRect == null) &#123; mTmpRect = new Rect(); &#125; // First, let's get the visible rect of the dependency final Rect rect = mTmpRect; ViewGroupUtils.getDescendantRect(parent, appBarLayout, rect); if (rect.bottom &lt;= appBarLayout.getMinimumHeightForVisibleOverlappingContent()) &#123; // If the anchor's bottom is below the seam, we'll animate our FAB out child.hide(null, false); &#125; else &#123; // Else, we'll animate our FAB back in child.show(null, false); &#125; return true; &#125; é™¤æ­¤ä¹‹å¤–ï¼Œfab#Behaviorè¿˜å®ç°äº†onLayoutChild,ä¸»è¦æ˜¯ä¸ºäº†æ ¹æ®AppBarLayoutçš„å½“å‰çŠ¶æ€æ¥åˆ¤æ–­è‡ªå·±æ˜¯å¦éœ€è¦éšè—ã€‚ 123456789101112131415161718@Override public boolean onLayoutChild(CoordinatorLayout parent, FloatingActionButton child, int layoutDirection) &#123; // First, lets make sure that the visibility of the FAB is consistent final List&lt;View&gt; dependencies = parent.getDependencies(child); for (int i = 0, count = dependencies.size(); i &lt; count; i++) &#123; final View dependency = dependencies.get(i); if (dependency instanceof AppBarLayout &amp;&amp; updateFabVisibility(parent, (AppBarLayout) dependency, child)) &#123; break; &#125; &#125; // Now let the CoordinatorLayout lay out the FAB parent.onLayoutChild(child, layoutDirection); // Now offset it if needed offsetIfNeeded(parent, child); return true; &#125; æ­¤æ–¹æ³•ä¼šåœ¨CoordinatorLayoutå¯¹å­©å­å¸ƒå±€çš„æ—¶å€™è¿›è¡Œè°ƒç”¨(å³CoordinatorLayout#onLayout)ï¼ŒCoordinatorLayoutä¼šæ£€æŸ¥æ‰€æœ‰çš„ç›´ç³»å­©å­ï¼Œæ˜¯å¦è®¾ç½®äº†Behaviorï¼Œå¦‚æœè®¾ç½®äº†ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œå…¶onLayoutChildæ–¹æ³•: CoordinatorLayout#onLayout 1234567891011121314@Override protected void onLayout(boolean changed, int l, int t, int r, int b) &#123; final int layoutDirection = ViewCompat.getLayoutDirection(this); final int childCount = mDependencySortedChildren.size(); for (int i = 0; i &lt; childCount; i++) &#123; final View child = mDependencySortedChildren.get(i); final LayoutParams lp = (LayoutParams) child.getLayoutParams(); final Behavior behavior = lp.getBehavior(); if (behavior == null || !behavior.onLayoutChild(this, child, layoutDirection)) &#123; onLayoutChild(child, layoutDirection); &#125; &#125; &#125; å¦‚æœè¯¥Behaviorå®ç°äº†OnLayoutChildï¼Œå¹¶ä¸”è¿”å›äº†trueï¼Œé‚£ä¹ˆå°†ä¸ä¼šæ‰§è¡ŒCoordinatorLayout #onLayoutChild,å¦åˆ™æ‰§è¡Œé»˜è®¤çš„å¸ƒå±€æ–¹æ¡ˆã€‚æœ€åä¸€ç‚¹ï¼Œè¿™é‡Œçš„Behaviorå¦‚ä½•ç”Ÿæ•ˆçš„å‘¢ï¼Ÿé€šè¿‡æ³¨è§£ï¼š 12@CoordinatorLayout.DefaultBehavior(FloatingActionButton.Behavior.class)public class FloatingActionButton extends VisibilityAwareImageButton &#123; CoordinatorLayoutåœ¨è§£æå­©å­çš„LayoutParamsæ—¶ï¼Œä¼šcheckæœ‰æ— æ³¨è§£ï¼š 123456789101112131415161718192021LayoutParams getResolvedLayoutParams(View child) &#123; final LayoutParams result = (LayoutParams) child.getLayoutParams(); if (!result.mBehaviorResolved) &#123; Class&lt;?&gt; childClass = child.getClass(); DefaultBehavior defaultBehavior = null; while (childClass != null &amp;&amp; (defaultBehavior = childClass.getAnnotation(DefaultBehavior.class)) == null) &#123; childClass = childClass.getSuperclass(); &#125; if (defaultBehavior != null) &#123; try &#123; result.setBehavior(defaultBehavior.value().newInstance()); &#125; catch (Exception e) &#123; Log.e(TAG, \"Default behavior class \" + defaultBehavior.value().getName() + \" could not be instantiated. Did you forget a default constructor?\", e); &#125; &#125; result.mBehaviorResolved = true; &#125; return result; &#125; è‡³æ­¤fabè§£æå®Œæ¯•ï¼Œè°¢è°¢è§‚çœ‹ï¼ å¦‚æœ‰ç–‘æƒ‘ï¼Œå¯ä»¥issueã€‚ å¾®åšï¼šæ¥šå¥•RX License123456789101112131415161718192021The MIT License (MIT)Copyright (c) 2016 RowandjjPermission is hereby granted, free of charge, to any person obtaining a copyof this software and associated documentation files (the &quot;Software&quot;), to dealin the Software without restriction, including without limitation the rightsto use, copy, modify, merge, publish, distribute, sublicense, and/or sellcopies of the Software, and to permit persons to whom the Software isfurnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in allcopies or substantial portions of the Software.THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS ORIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THEAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHERLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THESOFTWARE. å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"CoordinatorLayoutæºç åˆ†æ","date":"2017-07-26T11:53:52.000Z","path":"2017/07/26/CoordinatorLayoutæºç åˆ†æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ CoordinatorLayout æºç åˆ†æCoordinatorLayoutæœ‰ä¸€äº›å¾ˆæœ‰æ„æ€çš„ç‰¹æ€§ï¼Œè®¾ç½®anchorã€NestedScrollé…åˆToolbar/TabLayoutçš„æ˜¾éšorä¼¸ç¼©ã€Fabçš„ç§»åŠ¨ç­‰ã€‚ä»Šå¤©å’±å°±æ¥ä¸€æ¢ç©¶ç«Ÿï¼ 1. ä»LayoutParamå¼€å§‹ CoordinatorLayout.LayoutParamä¸­æœ‰ä¸€äº›ä¸å¤ªä¸€æ ·çš„å±æ€§å’Œå…ƒç´ ï¼Œåœ¨æ­¤å…ˆè¿›è¡Œä»‹ç»ã€‚ 1.1 ç‰¹æ®Šå±æ€§ å±æ€§ å¯¹åº”xmlå±æ€§ ç”¨é€” AndchorId layout_anchor &amp;layout_anchorGravity å¸ƒå±€æ—¶æ ¹æ®è‡ªèº«gravity ä¸ layout_anchorGravityæ”¾ç½®åœ¨è¢«anchorçš„Viewä¸­ Behavior layout_behavior è¾…åŠ©Coordinatorå¯¹Viewè¿›è¡Œlayoutã€nestedScrollçš„å¤„ç† KeyLine layout_keyline &amp; keylines ç»™Coordinatorè®¾ç½®äº†keylinesï¼ˆæ•´æ•°æ•°ç»„ï¼‰åï¼Œå¯ä»¥ä¸ºå­Viewè®¾ç½®layout_keyline=&quot;i&quot;ä½¿å…¶çš„æ°´å¹³ä½ç½®æ ¹æ®å¯¹åº”keylines[i]è¿›è¡Œlayoutã€‚ LastChildRect æ—  è®°å½•æ¯ä¸€æ¬¡Layoutçš„ä½ç½®ï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦æ–°çš„ä¸€å¸§æ”¹å˜äº†ä½ç½® æ³¨ï¼š keylineæ˜¯ä¸€ä¸ªéå¸¸å¥‡æ€ªçš„å±æ€§ï¼Œæˆ‘åœ¨çœ‹æºç æ—¶æ‰ç¬¬ä¸€æ¬¡çœ‹åˆ°åˆ°è¿™ç©æ„ï¼Œç½‘ä¸Šçš„èµ„æ–™ä¹Ÿéå¸¸ä¹‹å°‘ã€‚åˆ†æä¸‹æ¥ï¼Œå°±æ˜¯å¦‚æœè®¾ç½®äº†keylineï¼Œé‚£ä¹ˆgravityå°±ä¼šè¢«æ— è§†ï¼Œç›´æ¥æ”¾ç½®åœ¨å¯¹åº”çš„æ°´å¹³ä½ç½®keylineä¸Šã€‚CoordinatorLayouté‡Œé¢ä¹Ÿæ²¡æœ‰å…¶ä»–çš„ç‰¹æ€§æ˜¯æ ¹æ®keylineå®ç°çš„ï¼Œä¸ªäººè®¤ä¸ºæ²¡åµç”¨ï¼Œæœ¬æ–‡å¯¹å®ƒçš„åˆ†æåŸºæœ¬éƒ½ä¼šç•¥è¿‡ã€‚ 1.2 ä¾èµ–å…³ç³»å‡è®¾æ­¤æ—¶æœ‰ä¸¤ä¸ªView: A å’ŒBï¼Œé‚£ä¹ˆæœ‰ä¸¤ç§æƒ…å†µä¼šå¯¼è‡´ä¾èµ–å…³ç³»ï¼š Açš„anchoræ˜¯B ï¼› Açš„behaviorå¯¹Bæœ‰ä¾èµ–ï¼ˆæ¯”å¦‚FloatingActionButtonä¾èµ–SnackBar)ã€‚ ä¾èµ–å…³ç³»å»ºç«‹çš„å‰ææ˜¯ä¸¤ä¸ªViewåœ¨åŒä¸€ä¸ªCoordinatorlayoutä¸­ã€‚ CoordinatorLayoutä¸­ç»´æŠ¤äº†ä¸€ä¸ªmDependencySortedChildrenåˆ—è¡¨ï¼Œé‡Œé¢å«æœ‰æ‰€æœ‰çš„å­Viewï¼ŒæŒ‰ä¾èµ–å…³ç³»æ’åºï¼Œè¢«ä¾èµ–è€…æ’åœ¨å‰é¢ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ç”¨æ¥æ’åºçš„Comparatorï¼š 12345678910111213141516final Comparator&lt;View&gt; mLayoutDependencyComparator = new Comparator&lt;View&gt;() &#123; @Override public int compare(View lhs, View rhs) &#123; if (lhs == rhs) &#123; return 0; &#125; else if (((LayoutParams) lhs.getLayoutParams()).dependsOn( CoordinatorLayout.this, lhs, rhs)) &#123; return 1; &#125; else if (((LayoutParams) rhs.getLayoutParams()).dependsOn( CoordinatorLayout.this, rhs, lhs)) &#123; return -1; &#125; else &#123; return 0; &#125; &#125;&#125;; æ³¨æ„ï¼Œåœ¨å»ºç«‹mDependencySortedChildrenå¹¶æ’åºå®Œæˆä¹‹åï¼ˆåœ¨measureçš„ç¬¬ä¸€æ­¥å¤„ç†å®Œæˆï¼‰ï¼Œæ¯æ¬¡å¯¹å­Viewçš„éå†éƒ½æ˜¯é€šè¿‡å®ƒè¿›è¡Œé¡ºåºéå†ï¼Œä¿è¯äº†è¢«ä¾èµ–çš„Viewæœ€å…ˆè¢«å¤„ç†ã€‚ 1.3 Behavioråœ¨CoordinatorLayoutä¸­å®šä¹‰äº†Behaviorç±»ï¼Œå®ƒæ˜¯ç”¨æ¥è¾…åŠ©layoutçš„å·¥å…·ã€‚å¦‚æœä¸€ä¸ªCoordinatorLayoutçš„ç›´æ¥å­Viewè®¾ç½®äº†Behaviorï¼ˆæˆ–è€…é€šè¿‡ç±»æ³¨è§£@DefaultBehavioræŒ‡å®šBehaviorï¼‰ï¼Œåˆ™è¯¥Behaviorä¼šå‚¨å­˜åœ¨è¯¥Viewçš„LayoutParamä¸­ã€‚ æ³¨æ„ï¼šä¸æ˜¯CoordinatorLayoutçš„ç›´æ¥å­Viewï¼Œè®¾ç½®Behavioræ˜¯æ— æ•ˆçš„ã€‚ä½ å¯ä»¥çœ‹åˆ°ä»»ä½•ä¸€å¤„å¯¹äºBehaviorçš„å¤„ç†éƒ½æ˜¯ç›´æ¥getChildCountï¼ˆï¼‰éå†ã€‚ åœ¨Behaviorä¸­æœ‰å‡ ç±»åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸€ä¸€è¿›è¡Œä»‹ç»ï¼š 1.3.1 è§¦æ‘¸å“åº”ç±»Behaviorä¸­æœ‰ä¸¤ä¸ªå‡½æ•°ï¼šonInterceptTouchEventã€ onTouchEventã€‚åœ¨CoordinatorLayoutæ¯æ¬¡è§¦å‘å¯¹åº”äº‹ä»¶çš„æ—¶å€™ä¼šé€‰æ‹©ä¸€ä¸ªæœ€é€‚åˆçš„å­Viewçš„Behavioræ‰§è¡Œå¯¹åº”å‡½æ•°ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹CoordinatorLayoutæ˜¯æ€ä¹ˆåˆ†å‘å’Œå¤„ç†Touchäº‹ä»¶çš„ï¼š intercept12345678910111213141516171819202122232425@Overridepublic boolean onInterceptTouchEvent(MotionEvent ev) &#123; MotionEvent cancelEvent = null; final int action = MotionEventCompat.getActionMasked(ev); // é‡ç½®å“åº”çš„Behavoir if (action == MotionEvent.ACTION_DOWN) &#123; resetTouchBehaviors(); &#125; // åœ¨è¿™é‡Œé€‰æ‹©ä¸€ä¸ªæœ€ä½³Behaviorè¿›è¡Œå¤„ç† final boolean intercepted = performIntercept(ev, TYPE_ON_INTERCEPT); if (cancelEvent != null) &#123; cancelEvent.recycle(); &#125; // é‡ç½®å“åº”çš„Behavior if (action == MotionEvent.ACTION_UP || action == MotionEvent.ACTION_CANCEL) &#123; resetTouchBehaviors(); &#125; return intercepted;&#125; åœ¨performInterceptå»é€‰æ‹©ä¸€ä¸ªæœ€é€‚åˆçš„Behavioræ¥è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªæ–¹æ³•ä¸ä»…ç”¨äºonInterceptTouchEventï¼Œå¹¶ä¸”ä¹Ÿç”¨äºonTouchEventï¼Œæ ¹æ®ä¼ å…¥typeä¸åŒæ¥è¯†åˆ«å¯¹åº”æ–¹æ³•ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„é€»è¾‘ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243private boolean performIntercept(MotionEvent ev, final int type) &#123; boolean intercepted = false; boolean newBlock = false; MotionEvent cancelEvent = null; final int action = MotionEventCompat.getActionMasked(ev); final List&lt;View&gt; topmostChildList = mTempList1; // API&gt;=21æ—¶ï¼Œä½¿ç”¨elevationç”±ä½åˆ°é«˜æ’åˆ—Viewï¼›API&lt;21æ—¶ï¼ŒæŒ‰Viewæ·»åŠ é¡ºåºæ’åˆ— getTopSortedChildren(topmostChildList); final int childCount = topmostChildList.size(); for (int i = 0; i &lt; childCount; i) &#123; final View child = topmostChildList.get(i); final LayoutParams lp = (LayoutParams) child.getLayoutParams(); final Behavior b = lp.getBehavior(); // ...(çœç•¥ä»£ç ) å¦‚æœæ­¤æ¬¡åˆ¤å®šinterceptï¼Œåˆ™å¯¹ä¸Šæ¬¡çš„Behaviorå‘é€CANCELäº‹ä»¶ã€‚ // æ ¹æ®ä¼ å…¥typeä¸åŒè°ƒç”¨ä¸åŒçš„æ–¹æ³• if (!intercepted &amp;&amp; b != null) &#123; switch (type) &#123; case TYPE_ON_INTERCEPT: intercepted = b.onInterceptTouchEvent(this, child, ev); break; case TYPE_ON_TOUCH: intercepted = b.onTouchEvent(this, child, ev); break; &#125; if (intercepted) &#123; mBehaviorTouchView = child; &#125; &#125; //...(çœç•¥ä»£ç ) å¦‚æœBehavior.blocksInteractionBelow()è¿”å›trueï¼Œåˆ™ä¸å¤„ç†åç»­çš„äº‹ä»¶ã€‚ &#125; topmostChildList.clear(); return intercepted;&#125; 1.3.2 ä¾èµ–å…³ç³»ç±» è¿™éƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œå°±ä¿©å‡½æ•°ï¼š layoutDependsOnï¼šè¿”å›trueåˆ™è¡¨ç¤ºå¯¹å¦ä¸€ä¸ªViewæœ‰ä¾èµ–å…³ç³»ï¼› onDependentViewChanged&amp;onDependentViewRemovedï¼šå¦‚æœè¢«ä¾èµ–çš„Viewåœ¨æ­£å¸¸layoutä¹‹åä»æœ‰size/positionä¸Šçš„å˜åŒ–ï¼Œæˆ–è€…è¢«removeæ‰ï¼Œéƒ½ä¼šè§¦å‘å¯¹åº”æ–¹æ³•ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒCoordinatorLayoutæ˜¯æ€ä¹ˆç›‘å¬è¿™ä¸ªè¢«ä¾èµ–çš„Viewæ”¹å˜çš„äº‹ä»¶çš„å‘¢ï¼Ÿ åŸæ¥å®ƒé‡Œé¢æœ‰ä¸€ä¸ªViewTreeObserver.OnPreDrawListenerï¼Œå®ƒåœ¨onMeasureçš„æ—¶å€™è¢«æ·»åŠ åˆ°äº†ViewTreeObserverä¸­ï¼Œè¿™æ ·æ¯ä¸€å¸§è¢«ç»˜åˆ¶å‡ºæ¥ä¹‹å‰éƒ½ä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒã€‚ 1234567class OnPreDrawListener implements ViewTreeObserver.OnPreDrawListener &#123; @Override public boolean onPreDraw() &#123; dispatchOnDependentViewChanged(false); return true; &#125;&#125; è¿™ä¸ªdispatchOnDependentViewChangedé‡Œé¢ä»£ç æ¯”è¾ƒå¤šï¼Œå°±ä¸æ”¾ä¸Šæ¥äº†ï¼Œæ€»ç»“ä¸‹æ¥å°±æ˜¯è¿™æ ·ï¼š æ ¹æ®ä¾èµ–å…³ç³»éå†å­Viewï¼Œå¯¹æ¯ä¸€ä¸ªViewåšå¦‚ä¸‹æ“ä½œ åˆ¤æ–­ä¸€ä¸‹æ–°çš„å¸ƒå±€è¾¹ç•Œä¸lastChildRectæ˜¯å¦ç›¸åŒï¼Œæ˜¯åˆ™è®°å½•æ–°çš„å¸ƒå±€è¾¹ç•Œä¸ºlastChildRectï¼Œå¹¶ç»§ç»­åç»­æµç¨‹ï¼Œå¦åˆ™è·³è¿‡ï¼› å¯¹äºä¹‹åæ¯ä¸€ä¸ªViewï¼Œå¦‚æœå®ƒä¾èµ–äºæœ¬Viewï¼Œåˆ™è°ƒç”¨å®ƒçš„Behavior.onDependentViewChangedï¼ˆå¦‚æœæœ‰Behaviorçš„è¯ï¼‰ã€‚ è‡³äºonDependentViewRemovedï¼Œæ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šè°ƒç”¨ViewGroup.setOnHierarchyChangeListener()æ–¹æ³•è®¾ç½®ä¸€ä¸ªOnHierarchyChangeListenerï¼Œè¿™æ ·æ¯æ¬¡addå’Œremoveå­Viewçš„æ—¶å€™å°±ä¼šæ¥æ”¶åˆ°å›è°ƒï¼ŒåŒæ—¶å¯¹ç›¸åº”ä¾èµ–å…³ç³»çš„Viewè¿›è¡Œå¤„ç†ã€‚ 1.3.3 å¸ƒå±€ç±»onMeasureChild&amp;onLayoutChildï¼šå¦‚æœé‡å†™äº†è¯¥æ–¹æ³•å¹¶è¿”å›trueï¼Œåˆ™CoordinatorLayoutä¼šä½¿ç”¨Behaviorå¯¹è¿™ä¸ªå­Viewè¿›è¡Œmeasure/layoutã€‚å…·ä½“çš„å¯ä»¥è§ä¸‹é¢çš„Measure&amp;Layout 1.3.4 åµŒå¥—æ»‘åŠ¨ç±»CoordinatorLayoutå®ç°äº†NestedScrollingParentï¼Œå½“CoordinatorLayoutå†…æœ‰ä¸€ä¸ªæ”¯æŒNestedScrollçš„å­Viewæ—¶ï¼Œå®ƒçš„åµŒå¥—æ»‘åŠ¨äº‹ä»¶é€šè¿‡NestedScrollingParentçš„å›è°ƒåˆ†å‘åˆ°å„ç›´æ¥å­Viewçš„Behaviorå¤„ç†ã€‚è™½ç„¶Behaviorç±»æ²¡æœ‰å®ç°NestedScrollingParentï¼Œä½†æ˜¯å®é™…ä¸Šå®ƒçš„æ–¹æ³•éƒ½æœ‰ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å»çœ‹çœ‹è¿™ä¸ªç±»ï¼Œæˆ‘ä»¬è¿™é‡Œé‡ç‚¹è®²CoordinatorLayoutçš„åˆ†å‘è¿‡ç¨‹ã€‚ å„ä¸ªäº‹ä»¶çš„åˆ†å‘è¿‡ç¨‹ç±»ä¼¼ï¼Œæ­¤å¤„å°±ä¸¾ä¸€ä¸ªä¾‹å­ï¼š 1234567891011121314151617181920public boolean onStartNestedScroll(View child, View target, int nestedScrollAxes) &#123; boolean handled = false; final int childCount = getChildCount(); for (int i = 0; i &lt; childCount; i) &#123; final View view = getChildAt(i); final LayoutParams lp = (LayoutParams) view.getLayoutParams(); final Behavior viewBehavior = lp.getBehavior(); if (viewBehavior != null) &#123; final boolean accepted = viewBehavior.onStartNestedScroll(this, view, child, target, nestedScrollAxes); handled |= accepted; lp.acceptNestedScroll(accepted); &#125; else &#123; lp.acceptNestedScroll(false); &#125; &#125; return handled;&#125; éå¸¸ç®€å•å§ï¼Œå°±éå†ä¸€ä¸‹ç›´æ¥å­Viewï¼Œæ¯ä¸ªéƒ½è°ƒä¸€ä¸‹å¯¹åº”çš„å›è°ƒæ–¹æ³•ï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå­Viewçš„behavioræ¶ˆè€—äº†è¿™ä¸ªäº‹ä»¶ï¼Œå°±ç®—æ¶ˆè€—äº†è¿™ä¸ªäº‹ä»¶ã€‚ ##2. Measure&amp;Layout æˆ‘ä»¬çŸ¥é“ï¼ŒViewGroupè¦æŠŠå­Viewå‡†ç¡®åœ°æ”¾ç½®åˆ°å±å¹•ä¸Šéƒ½æ˜¯è¦èµ°onMeasure onLayoutçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹CoordinatorLayoutåœ¨è¿™é‡Œå¹²äº†ä»€ä¹ˆã€‚ åœ¨çœ‹æ‡‚æ—¶è¯·ç¡®ä¿ä½ æ˜ç™½measure/layoutçš„æ„ä¹‰ä»¥åŠåŸºæœ¬ç”¨æ³•ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´èº«ä½“ä¸é€‚=ã€‚= 2.1 Measureæœ€ç›´æ¥çš„å°±æ˜¯çœ‹ä»£ç ï¼Œå¦‚æœä¸å–œæ¬¢ï¼Œå¯ä»¥è·³è¿‡ä»£ç çœ‹æ€»ç»“ã€‚ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344@Overrideprotected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123; prepareChildren(); /* è§£æä¾èµ–å…³ç³»ï¼Œå¹¶ç”¨1.2ä¸­æåˆ°çš„Comparatorå¯¹ViewæŒ‰ä¾èµ–å…³ç³»è¿›è¡Œæ’åº */ ensurePreDrawListener(); /* è‹¥PreDrawListeneræœªæ·»åŠ ï¼Œåˆ™æ·»åŠ åˆ°ViewTreeObserver */ //...(çœç•¥ä»£ç ) è§£æpaddingmeasureSpec final int childCount = mDependencySortedChildren.size(); for (int i = 0; i &lt; childCount; i) &#123; final View child = mDependencySortedChildren.get(i); final LayoutParams lp = (LayoutParams) child.getLayoutParams(); //...(çœç•¥ä»£ç )å¤„ç†keyline int childWidthMeasureSpec = widthMeasureSpec; int childHeightMeasureSpec = heightMeasureSpec; //...(çœç•¥ä»£ç ) å¤„ç†ç”±äºfitSystemWindowså¸¦æ¥çš„padding /* å¦‚æœchildViewæœ‰Behaviorå¹¶ä¸”å®ƒçš„onMeasureChildè¿”å›trueï¼Œåˆ™ç”±behavioræ¥å¯¹childViewè¿›è¡Œmeasureï¼Œå¦åˆ™å°±è‡ªå·±measure. */ final Behavior b = lp.getBehavior(); if (b == null || !b.onMeasureChild(this, child, childWidthMeasureSpec, keylineWidthUsed, childHeightMeasureSpec, 0)) &#123; onMeasureChild(child, childWidthMeasureSpec, keylineWidthUsed, childHeightMeasureSpec, 0); &#125; /* å–æœ€å¤§çš„child width/height åŠ ä¸Šmargin ä½œä¸ºå·²ç»æ¶ˆè€—çš„å°ºå¯¸ã€‚ */ widthUsed = Math.max(widthUsed, widthPadding child.getMeasuredWidth() lp.leftMargin lp.rightMargin); heightUsed = Math.max(heightUsed, heightPadding child.getMeasuredHeight() lp.topMargin lp.bottomMargin); childState = ViewCompat.combineMeasuredStates(childState, ViewCompat.getMeasuredState(child)); &#125; /* è®¾ç½®è‡ªèº«çš„measureå°ºå¯¸ */ final int width = ViewCompat.resolveSizeAndState(widthUsed, widthMeasureSpec, childState &amp; ViewCompat.MEASURED_STATE_MASK); final int height = ViewCompat.resolveSizeAndState(heightUsed, heightMeasureSpec, childState &lt;&lt; ViewCompat.MEASURED_HEIGHT_STATE_SHIFT); setMeasuredDimension(width, height);&#125; æ€»ç»“ä¸‹æ¥ï¼ŒonMeasureå¹²äº†è¿™ä¹ˆå‡ ä»¶äº‹ï¼š æ ¹æ®ä¾èµ–å…³ç³»å¯¹æ‰€æœ‰å­Viewè¿›è¡Œæ’åº ä¿è¯OnPreDrawListenerè¢«æ·»åŠ  æŒ‰ä¾èµ–å…³ç³»éå†å­View: å¦‚æœå­Viewæœ‰Behaviorï¼Œå¹¶ä¸”å®ƒçš„onMeasureChildè¿”å›trueï¼Œåˆ™ä½¿ç”¨Behaviorè¿›è¡Œmeasureï¼›å¦åˆ™ç›´æ¥ä½¿ç”¨measureSpecå¯¹å­Viewè¿›è¡Œmeasureï¼› å–å­VIewæœ€å¤§çš„measureå°ºå¯¸ä¸ºå·²ä½¿ç”¨çš„measureå°ºå¯¸ã€‚ æ›´æ–°æœ¬èº«çš„Measureå°ºå¯¸ã€‚ 2.2 Layout åœ¨onLayoutä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°CoordinatorLayoutä¼šå¯¹æ¯ä¸€ä¸ªå­Viewä¾ç…§ä»¥ä¸‹åˆ¤æ–­é¡ºåºè¿›è¡Œlayoutï¼š å¦‚æœå­Viewè®¾ç½®äº†Behaviorï¼Œå¹¶ä¸”è¯¥Behaviorçš„behavior.onLayoutChildè¿”å›trueï¼Œåˆ™ä½¿ç”¨behavior.onLayoutChildå¯¹è¯¥å­Viewè¿›è¡Œlayoutï¼› å¦‚æœBehaviorä¸è¿›è¡Œlayoutï¼Œåˆ™è¿›å…¥è‡ªèº«çš„onLayoutChild()ï¼Œå†…éƒ¨ä¾æ¬¡è¿›è¡Œå¦‚ä¸‹åˆ¤æ–­ï¼š å¦‚æœå­Viewè®¾ç½®äº†Anchorï¼Œåˆ™è°ƒç”¨layoutChildWithAnchorï¼ˆæ ¹æ®anchorè¿›è¡Œlayoutï¼‰ï¼› å¦‚æœå­Viewå«æœ‰keylineï¼Œåˆ™è°ƒç”¨layoutChildWithKeylineï¼ˆæ ¹æ®keylineè¿›è¡Œlayoutï¼‰ï¼› å¦‚æœä»¥ä¸Šåˆ¤æ–­éƒ½ä¸ç¬¦åˆï¼Œåˆ™ç›´æ¥å°†Viewæ ¹æ®padding/margin/measureç»“æœæŒ‰ç…§Gravityæ”¾ç½®ã€‚ æˆ‘ä»¬ä¸€ä¸€æ¥çœ‹ä¸€ä¸‹è¿™äº›è¿‡ç¨‹ã€‚ 2.2.1 ä½¿ç”¨Behaviorè¿›è¡Œlayout é»˜è®¤çš„Behaviorçš„onLayoutChildéƒ½æ˜¯è¿”å›falseçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹FloatingActionButtonçš„é»˜è®¤Behavioræ˜¯æ€ä¹ˆå¤„ç†çš„å§ï¼š 1234567891011121314151617181920@Overridepublic boolean onLayoutChild(CoordinatorLayout parent, FloatingActionButton child, int layoutDirection) &#123; // æ£€æŸ¥è¯¥FABæ˜¯å¦ä¾èµ–AppBarLayout final List&lt;View&gt; dependencies = parent.getDependencies(child); for (int i = 0, count = dependencies.size(); i &lt; count; i) &#123; final View dependency = dependencies.get(i); if (dependency instanceof AppBarLayout &amp;&amp; updateFabVisibility(parent, (AppBarLayout) dependency, child)) &#123; break; &#125; &#125; // è°ƒç”¨CoordinatorLayoutçš„onLayoutChildå¯¹FABè¿›è¡Œlayout parent.onLayoutChild(child, layoutDirection); // åœ¨API &lt; 21æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨offsetæ¥è®©å‡ºé˜´å½±çš„ä½ç½® offsetIfNeeded(parent, child); return true;&#125; è¿™é‡Œä¸»è¦æ˜¯å¤„ç†äº†å¦‚æœFABè®¾ç½®äº†AppBarLayoutä¸ºanchoræ—¶ï¼ˆæ­¤æ—¶ä¼šå¯¹AppBarLayoutæœ‰ä¾èµ–ï¼‰ï¼Œåˆ™å½“AppBarLayoutçš„é«˜åº¦ä¸è¶³ä»¥æ˜¾ç¤ºFABæ—¶å°†å…¶éšè—ï¼‰ã€‚ ä¹‹åå®ƒä¼šæ‰‹åŠ¨è°ƒç”¨CoordinatorLayoutè‡ªèº«çš„onLayoutChildæ–¹æ³•è¿›è¡Œlayoutï¼Œå³ä¸Šè¿°åˆ¤æ–­çš„ç¬¬äºŒæ­¥ï¼Œé‚£æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ã€‚ 2.2.2 ä½¿ç”¨Anchorè¿›è¡Œlayout å¦‚æœViewè®¾ç½®äº†anchorï¼Œé‚£ä¹ˆéƒ½ä¼šè°ƒç”¨layoutWithAnchorè¿›è¡Œlayoutï¼Œä»£ç ä¸è§£é‡Šå¦‚ä¸‹ï¼š 12345678910111213private void layoutChildWithAnchor(View child, View anchor, int layoutDirection) &#123; final LayoutParams lp = (LayoutParams) child.getLayoutParams(); final Rect anchorRect = mTempRect1; final Rect childRect = mTempRect2; /* 1. æ‰¾åˆ°è¢«anchorçš„Viewçš„å¸ƒå±€è¾¹ç•Œ */ getDescendantRect(anchor, anchorRect); /* 2. è·å–åˆ°è¢«anchorçš„Viewå¸ƒå±€è¾¹ç•Œä¹‹åï¼Œé…åˆlayout_anchorGravityä¸è‡ªèº«çš„gravityè·å–åˆ°æœ€ç»ˆè¦layoutåˆ°çš„è¾¹ç•Œ */ getDesiredAnchoredChildRect(child, layoutDirection, anchorRect, childRect); child.layout(childRect.left, childRect.top, childRect.right, childRect.bottom);&#125; è¿™é‡Œç”¨åˆ°çš„ä¸¤ä¸ªå…³é”®å‡½æ•°å°±æ˜¯getDescendantRectä¸getDesiredAnchoredChildRectï¼Œå®ƒä»¬çš„ç›®çš„åœ¨æˆ‘æ·»åŠ çš„æ³¨é‡Šä¸­è¿›è¡Œäº†è§£é‡Šï¼Œä¸ºä¿è¯æ–‡ç« çš„å¯è¯»æ€§å°±ä¸å†æŠŠä»£ç æ”¾ä¸Šæ¥äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å†è‡ªå·±å»æŒ–æ˜ç›¸åº”ä»£ç ~~ 2.2.3 ç›´æ¥layoutå¦‚æœä¹‹å‰çš„éƒ½ä¸ç¬¦åˆï¼Œå°±ä¼šèµ°åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆlayoutçš„ï¼š 12345678910111213141516private void layoutChild(View child, int layoutDirection) &#123; final LayoutParams lp = (LayoutParams) child.getLayoutParams(); final Rect parent = mTempRect1; parent.set(getPaddingLeft() lp.leftMargin, getPaddingTop() lp.topMargin, getWidth() - getPaddingRight() - lp.rightMargin, getHeight() - getPaddingBottom() - lp.bottomMargin); //...(çœç•¥ä»£ç ) å¤„ç†ç”±äºfitsSystemWindowså¸¦æ¥çš„inset // æŒ‰ç…§Gravityä¸measureå°ºå¯¸åœ¨çˆ¶æ§ä»¶é‡Œé¢æ‰¾åˆ°è‡ªå·±çš„ä½ç½®ï¼Œå¹¶è¿›è¡Œlayoutã€‚ final Rect out = mTempRect2; GravityCompat.apply(resolveGravity(lp.gravity), child.getMeasuredWidth(), child.getMeasuredHeight(), parent, out, layoutDirection); child.layout(out.left, out.top, out.right, out.bottom); &#125; ##3 æ€»ç»“ CoordinatorLayoutçš„ç‰¹æ€§æ€»ç»“ä¸‹æ¥å°±æ˜¯ä¸¤ä¸ªæ–¹é¢ï¼š å¯ä»¥è®¾ç½®anchorï¼Œè¢«ä¾èµ–çš„Viewå˜åŒ–è‡ªèº«ä¹Ÿä¼šå˜åŒ–ï¼› å¯ä»¥è®¾ç½®behaviorï¼Œå½“å†…éƒ¨æœ‰æ”¯æŒåµŒå¥—æ»‘åŠ¨çš„æ§ä»¶æ—¶å¤„ç†NestedScrolläº‹ä»¶ï¼› è¿™ä¸¤ä¸ªç‰¹æ€§å¯¼è‡´çš„å­Viewä¹‹é—´çš„ä¾èµ–å…³ç³»è®©ç•Œé¢çš„äº¤äº’æ›´æœ‰æ„æ€ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å†å»çœ‹AppBarLayoutã€FloatingActionButtonã€SnackBarçš„æºç ~~ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"CompoundButtonæºç åˆ†æ","date":"2017-07-26T11:52:49.000Z","path":"2017/07/26/CompoundButtonæºç åˆ†æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ CompoundButton æ˜¯ä¸€ä¸ªæœ‰ä¸¤ç§çŠ¶æ€ï¼ˆé€‰ä¸­å’Œæœªé€‰ä¸­ / checkd uncheckedï¼‰çš„Buttonã€‚å½“ä½ æŒ‰ä¸‹ï¼ˆpressedï¼‰æˆ–è€…ç‚¹å‡»ï¼ˆclickedï¼‰ï¼Œå®ƒçš„çŠ¶æ€ä¼šè‡ªåŠ¨æ”¹å˜ã€‚ ç‰¹ç‚¹ æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼ˆabstractï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨å®ƒï¼Œåªæœ‰è‡ªå®šä¹‰å®ç°æˆ–è€…ç³»ç»Ÿå·²ç»æä¾›çš„å®ƒçš„ä¸€ç›´å­ç±»ï¼ˆToggleButtonï¼ŒCheckboxï¼ŒRadioButton ç­‰ç­‰ï¼‰ ç»§æ‰¿è‡ªButtonï¼Œè€ŒButton ç»§æ‰¿è‡ªTextViewï¼Œæ‰€ä»¥Buttonï¼ŒTextView çš„ç‰¹æ€§CompoundButton éƒ½æ˜¯å…·å¤‡çš„ å®ç°è‡ªCheckable æ¥å£ï¼ˆinterfaceï¼‰ï¼Œåˆ©ç”¨å®ƒå¯ä»¥è®¾ç½®çŠ¶æ€ï¼ˆsetChecked(boolean checked)ï¼‰ï¼Œè·å–çŠ¶æ€ï¼ˆisChecked()ï¼‰å’Œåˆ‡æ¢çŠ¶æ€ï¼ˆtoggle()ï¼‰ æœ€åçš„æ•ˆæœå›¾å°±æ˜¯è¿™æ ·çš„ã€‚ åˆ†æ1234567891011121314151617// é€‰ä¸­å’Œæœªé€‰ä¸­çš„çŠ¶æ€private boolean mChecked;private boolean mBroadcasting;private Drawable mButtonDrawable;private ColorStateList mButtonTintList = null;// å°±æ˜¯æ°´æ³¢çº¹å’ŒèƒŒæ™¯é¢œè‰²æ··åˆçš„æ–¹å¼private PorterDuff.Mode mButtonTintMode = null;private boolean mHasButtonTint = false;private boolean mHasButtonTintMode = false;// çŠ¶æ€ç›‘å¬private OnCheckedChangeListener mOnCheckedChangeListener;private OnCheckedChangeListener mOnCheckedChangeWidgetListener; è¿™æ˜¯ä¸€äº›å±€éƒ¨å˜é‡ï¼Œåœ¨åé¢çš„åˆ†æä¼šç”¨åˆ°ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹CompoundButton è‡ªå®šä¹‰æ§ä»¶æœ‰å“ªäº›å±æ€§ \\data\\res\\values\\attrs.xml12345678910111213&lt;declare-styleable name=\"CompoundButton\"&gt; &lt;!-- è®¾ç½®çŠ¶æ€ true: é€‰ä¸­; false: æœªé€‰ä¸­ --&gt; &lt;attr name=\"checked\" format=\"boolean\" /&gt; &lt;!-- ç»˜åˆ¶æŒ‰é’®å›¾å½¢ï¼Œä¸€èˆ¬ä¸ºDrawable èµ„æº (e.g. checkbox, radio button, etc). --&gt; &lt;attr name=\"button\" format=\"reference\" /&gt; &lt;!-- å¯¹ç»˜åˆ¶çš„æŒ‰é’®å›¾å½¢ç€è‰² --&gt; &lt;attr name=\"buttonTint\" format=\"color\" /&gt; &lt;!-- å¯¹ç€è‰²è®¾ç½®æ¨¡å¼ --&gt; &lt;attr name=\"buttonTintMode\"&gt; &lt;enum name=\"src_over\" value=\"3\" /&gt; ... &lt;/attr&gt; &lt;/declare-styleable&gt; ç„¶åå†æ¥çœ‹çœ‹æ€ä¹ˆç»˜åˆ¶ï¼Œå…ˆæ¥çœ‹çœ‹æ„é€ æ–¹æ³•1234567891011121314151617181920212223242526272829303132333435public CompoundButton(Context context, AttributeSet attrs, int defStyleAttr, int defStyleRes) &#123; super(context, attrs, defStyleAttr, defStyleRes); // è¿™é‡Œçš„è·å–è‡ªå®šä¹‰çš„CompoundButton å°±æ˜¯ä¸Šé¢çš„å®šä¹‰çš„CompoundButton final TypedArray a = context.obtainStyledAttributes( attrs, com.android.internal.R.styleable.CompoundButton, defStyleAttr, defStyleRes); // ç”¨äºç»˜åˆ¶æŒ‰é’®å›¾å½¢ final Drawable d = a.getDrawable(com.android.internal.R.styleable.CompoundButton_button); if (d != null) &#123; setButtonDrawable(d); &#125; // å¯¹ç»˜åˆ¶çš„æŒ‰é’®å›¾å½¢ç€è‰²è®¾ç½®æ¨¡å¼ if (a.hasValue(R.styleable.CompoundButton_buttonTintMode)) &#123; mButtonTintMode = Drawable.parseTintMode(a.getInt( R.styleable.CompoundButton_buttonTintMode, -1), mButtonTintMode); mHasButtonTintMode = true; &#125; // å¯¹ç»˜åˆ¶çš„æŒ‰é’®å›¾å½¢ç€è‰² if (a.hasValue(R.styleable.CompoundButton_buttonTint)) &#123; mButtonTintList = a.getColorStateList(R.styleable.CompoundButton_buttonTint); mHasButtonTint = true; &#125; // è®¾ç½®çŠ¶æ€ final boolean checked = a.getBoolean( com.android.internal.R.styleable.CompoundButton_checked, false); setChecked(checked); a.re cycle(); applyButtonTint();&#125; åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œè·å–è‡ªå®šä¹‰å±æ€§çš„å„ä¸ªå±æ€§ï¼Œ buttonï¼šç”¨äºç»˜åˆ¶æŒ‰é’®å›¾å½¢ï¼Œç„¶åè°ƒç”¨setButtonDrawable() æ¥ç»˜åˆ¶ã€‚ buttonTintï¼šç»˜åˆ¶çš„æŒ‰é’®ç€è‰²ã€‚ä½¿ç”¨ä¸€ä¸ªboolean æ ‡è¯†ç¬¦æ¥è®¾ç½®çš„ï¼Œç„¶åä¼šåœ¨applyButtonTint() ä¸­ç»Ÿä¸€å¤„ç†ã€‚å®ƒä»¬ä¸¤ä¸ªåˆ†åˆ«ç”¨ä½œç»™å’Œ buttonTintModeï¼šå’Œè®¾ç½®ç€è‰²æ¨¡å¼ã€‚è®¾ç½®æ–¹å¼å’ŒbuttonTint å‡ ä¹ä¸€æ ·ã€‚ä¸è¿‡å®ƒçš„ä¸€äº›å±æ€§ï¼Œå‚è€ƒè¿™ç¯‡æ–‡ç« æ¥çœ‹çœ‹å…·ä½“ä¸åŒçš„ç€è‰²æ¨¡å¼æ•ˆæœæ˜¯æ€ä¹ˆæ ·çš„ã€‚android5.xæ–°ç‰¹æ€§ä¹‹Tinting checkedï¼šæ˜¯è®¾ç½®é€‰ä¸­çŠ¶æ€ï¼Œåœ¨setChecked() ä¸­è®¾ç½®ã€‚ ç»˜åˆ¶æŒ‰é’®å›¾å½¢123456789101112131415161718192021222324@Nullablepublic void setButtonDrawable(@Nullable Drawable drawable) &#123; if (mButtonDrawable != drawable) &#123; if (mButtonDrawable != null) &#123; // å–æ¶ˆå¯¹View çš„å¼•ç”¨ mButtonDrawable.setCallback(null); // å–æ¶ˆç»˜åˆ¶å¯¹è±¡ç›¸å…³è”çš„è°ƒåº¦,å½“æˆ‘ä»¬é‡æ–°ç»˜åˆ¶ä¸€ä¸ªDrawableï¼Œå¯ä»¥è°ƒç”¨æ­¤æ–¹æ³• unscheduleDrawable(mButtonDrawable); &#125; mButtonDrawable = drawable; if (drawable != null) &#123; drawable.setCallback(this); drawable.setLayoutDirection(getLayoutDirection()); if (drawable.isStateful()) &#123; drawable.setState(getDrawableState()); &#125; drawable.setVisible(getVisibility() == VISIBLE, false); setMinHeight(drawable.getIntrinsicHeight()); applyButtonTint(); &#125; &#125;&#125; è¿™ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯ç”¨äºç»˜åˆ¶æŒ‰é’®å›¾å½¢ï¼Œé¦–å…ˆä¼šåˆ¤æ–­æˆ‘ä»¬è®¾ç½®çš„Drawable å’Œåˆå§‹ä¼šçš„mButtonDrawable æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸ç­‰ï¼Œå°†ä¼šå¯¹åˆå§‹åŒ–çš„mButtonDrawable å¯¹è±¡ï¼Œå–æ¶ˆå¯¹View çš„å¼•ç”¨ï¼ˆsetCallback(null)ï¼‰ï¼Œå¹¶ä¸”å–æ¶ˆmButtonDrawable ç›¸å…³è”è°ƒåº¦ï¼ˆunscheduleDrawable()ï¼‰ï¼Œç„¶åå°†æˆ‘ä»¬æ–°è®¾ç½®çš„Drawable èµ‹å€¼ç»™mButtonDrawable å¯¹è±¡ï¼Œç„¶åå†è®¾ç½®å¼•ç”¨ï¼Œè®¾ç½®å¸ƒå±€çš„æ–¹å‘ï¼Œç„¶ååˆ¤æ–­å¦‚æœçŠ¶æ€æ”¹å˜æ—¶ï¼Œé‡æ–°è®¾ç½®çŠ¶æ€ã€‚æœ€åè°ƒç”¨applyButtonTint()ã€‚ ç€è‰²12345678910111213141516171819private void applyButtonTint() &#123; if (mButtonDrawable != null &amp;&amp; (mHasButtonTint || mHasButtonTintMode)) &#123; mButtonDrawable = mButtonDrawable.mutate(); if (mHasButtonTint) &#123; mButtonDrawable.setTintList(mButtonTintList); &#125; if (mHasButtonTintMode) &#123; mButtonDrawable.setTintMode(mButtonTintMode); &#125; // The drawable (or one of its children) may not have been // stateful before applying the tint, so let's try again. if (mButtonDrawable.isStateful()) &#123; mButtonDrawable.setState(getDrawableState()); &#125; &#125;&#125; è¿™ä¸ªæ–¹æ³•ä¸»è¦å°±æ˜¯è®¾ç½®mButtonDrawable çš„Tintï¼ˆç€è‰²ï¼‰å’ŒTintModeï¼ˆç€è‰²æ¨¡å¼ï¼‰ï¼Œä¹‹å‰åœ¨æ„é€ æ–¹æ³•ï¼ŒsetButtonDrawable() æ–¹æ³•ä¸­éƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªå±æ€§éƒ½æ˜¯åŸºäºmButtonDrawable æ¥è®¾ç½®çš„ï¼Œè€Œè¿™ä¸ªä¸¤ä¸ªå±æ€§æ˜¯æ ¹æ®ä¸¤ä¸ªBoolean å±æ€§mHasButtonTint å’ŒmHasButtonTintMode æ¥è¯†åˆ«çš„ï¼Œç„¶åä¸ºtrueï¼Œå°±è¡¨ç¤ºè®¾ç½®ã€‚è€Œä»–ä»¬ä¸¤ä¸ªå±æ€§ä¹Ÿæœ‰setButtonTintList å’ŒsetButtonTintMode() æ–¹æ³•æ¥è®¾ç½®ä¸¤ä¸ªå±æ€§ï¼Œå°†ä¸¤ä¸ªboolean å±æ€§è®¾ç½®ä¸ºtrueï¼Œå¹¶ä¸”è°ƒç”¨applyButtonTint() æ¥è®¾ç½®çš„ã€‚ ç»˜åˆ¶1234567891011121314151617181920212223242526272829303132333435363738394041424344protected void onDraw(Canvas canvas) &#123; final Drawable buttonDrawable = mButtonDrawable; if (buttonDrawable != null) &#123; final int verticalGravity = getGravity() &amp; Gravity.VERTICAL_GRAVITY_MASK; final int drawableHeight = buttonDrawable.getIntrinsicHeight(); final int drawableWidth = buttonDrawable.getIntrinsicWidth(); final int top; switch (verticalGravity) &#123; case Gravity.BOTTOM: top = getHeight() - drawableHeight; break; case Gravity.CENTER_VERTICAL: top = (getHeight() - drawableHeight) / 2; break; default: top = 0; &#125; final int bottom = top + drawableHeight; final int left = isLayoutRtl() ? getWidth() - drawableWidth : 0; final int right = isLayoutRtl() ? getWidth() : drawableWidth; buttonDrawable.setBounds(left, top, right, bottom); final Drawable background = getBackground(); if (background != null) &#123; background.setHotspotBounds(left, top, right, bottom); &#125; &#125; super.onDraw(canvas); if (buttonDrawable != null) &#123; final int scrollX = mScrollX; final int scrollY = mScrollY; if (scrollX == 0 &amp;&amp; scrollY == 0) &#123; buttonDrawable.draw(canvas); &#125; else &#123; canvas.translate(scrollX, scrollY); buttonDrawable.draw(canvas); canvas.translate(-scrollX, -scrollY); &#125; &#125;&#125; è¿™äº›å±æ€§éƒ½åˆå§‹åŒ–å¥½äº†ï¼Œé‚£å°±å¯ä»¥æ¥ç»˜åˆ¶äº†ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“è‡ªå®šä¹‰é‡å†™onDraw() æ–¹æ³•æ¥ç»˜åˆ¶è§†å›¾ï¼ŒCompoundButton ä¹Ÿé‡å†™äº†æ­¤æ–¹æ³•ï¼Œå°†æˆ‘ä»¬è®¾ç½®äº†å„ç§å±æ€§çš„mButtonDrawable å¤åˆ¶ç»™å±€éƒ¨å˜é‡buttonDrawableï¼Œç„¶åæ ¹æ®å¯¹å…¶æ–¹å¼ï¼ˆGravityï¼‰ å±æ€§æ¥æ¥å…·ä½“ç»˜åˆ¶buttonDrawableã€‚ç„¶åè°ƒç”¨çˆ¶ç±»çš„onDraw()ï¼Œæœ€ååœ¨æ ¹æ®æ—¶å€™æ˜¯æ»‘åŠ¨é€šè¿‡Canvas æ¥ç»˜åˆ¶ï¼Œå¦‚æœæ°´å¹³å’Œå‚ç›´æ»‘åŠ¨ä¸º0ï¼Œåˆ™ç›´æ¥ç»˜åˆ¶å³å¯ï¼Œå¦‚æœä¸ä¸ºé›¶åˆ™éœ€è¦è°ƒç”¨translate å¯¹canvas çš„é‡æ–°ç»˜åˆ¶ã€‚ è®¾ç½®é€‰ä¸­(checked)çŠ¶æ€123456789101112131415161718192021222324252627282930313233public void setChecked(boolean checked) &#123; if (mChecked != checked) &#123; mChecked = checked; refreshDrawableState(); notifyViewAccessibilityStateChangedIfNeeded( AccessibilityEvent.CONTENT_CHANGE_TYPE_UNDEFINED); // é¿å…å¤šæ¬¡è°ƒç”¨setChecked() æ¥å¤šæ¬¡è°ƒç”¨å›è°ƒç›‘å¬ if (mBroadcasting) &#123; return; &#125; mBroadcasting = true; if (mOnCheckedChangeListener != null) &#123; mOnCheckedChangeListener.onCheckedChanged(this, mChecked); &#125; if (mOnCheckedChangeWidgetListener != null) &#123; mOnCheckedChangeWidgetListener.onCheckedChanged(this, mChecked); &#125; mBroadcasting = false; &#125;&#125;// è®¾ç½®ç›‘çŠ¶æ€å¬public void setOnCheckedChangeListener(OnCheckedChangeListener listener) &#123; mOnCheckedChangeListener = listener;&#125;void setOnCheckedChangeWidgetListener(OnCheckedChangeListener listener) &#123; mOnCheckedChangeWidgetListener = listener;&#125; è®¾ç½®çŠ¶æ€ï¼Œå°±æ˜¯ä¼ å…¥ä¸€ä¸ªBoolean å€¼æ¥è®¾ç½®çŠ¶æ€ï¼Œå¦‚æœå’Œåˆå§‹åŒ–çš„mChecked ç›¸åï¼Œæ‰ä¼šè°ƒç”¨ï¼Œç„¶åè°ƒç”¨refreshDrawableState() æ¥åˆ·æ–°ç»˜åˆ¶çš„çŠ¶æ€ï¼Œç„¶åä¸‹é¢å°±æ˜¯è®¾ç½®çŠ¶æ€æ”¹å˜çš„ç›‘å¬ï¼Œé€šè¿‡mBroadcasting å±æ€§æ¥é¿å…å¤šæ¬¡è®¾ç½®å›è°ƒï¼Œæ¯æ¬¡è°ƒç”¨mBroadcastingï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™è¿”å›ã€‚å‘ç°æœ‰ä¸¤ä¸ªç›‘å¬ï¼Œæˆ‘ä»¬ä»”ç»†çœ‹ä¸‹é¢setXxxListener() çš„æ–¹æ³•ï¼Œè€Œä¸‹é¢é‚£ä¸ªsetOnCheckedChangeWidgetListener() æ–¹æ³•ä¸æ˜¯Publicï¼Œæ‰€ä»¥è¯´ä¸æ˜¯å¯¹å¤–å¼€æ”¾çš„ï¼Œæˆ‘ä»¬æ˜¯ä¸èƒ½è°ƒç”¨çš„ï¼Œæ–‡æ¡£ä¸­è¯´æ˜æ˜¯ä»…ä¾›å†…éƒ¨ä½¿ç”¨ã€‚å› æ­¤æˆ‘ä»¬æƒ³è¦ç›‘å¬é€‰ä¸­çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨setOnCheckedChangeListener()ã€‚é‡å†™onCheckedChanged(CompoundButton buttonView, boolean isChecked) å³å¯ã€‚å¯¹äº†ï¼Œé™¤äº†setChecked() å¯ä»¥è®¾ç½®çŠ¶æ€ï¼Œtoggle() æ¯æ¬¡ä¹Ÿä¼šsetChecked() æ–¹æ³•ï¼Œæ¯æ¬¡éƒ½ä¼šè®²çŠ¶æ€è®¾ç½®ä¸ºç›¸åçš„ã€‚è¿˜æœ‰isChecked() æ–¹æ³•ï¼Œåˆ¤æ–­å½“å‰çš„é€‰ä¸­çŠ¶æ€ã€‚ çŠ¶æ€ä¿å­˜123456789101112131415161718192021222324252627282930313233343536373839404142434445static class SavedState extends BaseSavedState &#123; boolean checked; SavedState(Parcelable superState) &#123; super(superState); &#125; private SavedState(Parcel in) &#123; super(in); checked = (Boolean)in.readValue(null); &#125; @Override public void writeToParcel(Parcel out, int flags) &#123; super.writeToParcel(out, flags); out.writeValue(checked); &#125; public static final Parcelable.Creator&lt;SavedState&gt; CREATOR = new Parcelable.Creator&lt;SavedState&gt;() &#123; public SavedState createFromParcel(Parcel in) &#123; return new SavedState(in); &#125; public SavedState[] newArray(int size) &#123; return new SavedState[size]; &#125; &#125;;&#125;@Overridepublic Parcelable onSaveInstanceState() &#123; Parcelable superState = super.onSaveInstanceState(); SavedState ss = new SavedState(superState); ss.checked = isChecked(); return ss;&#125;@Overridepublic void onRestoreInstanceState(Parcelable state) &#123; SavedState ss = (SavedState) state; super.onRestoreInstanceState(ss.getSuperState()); setChecked(ss.checked); requestLayout();&#125; ä¿å­˜çŠ¶æ€æ˜¯è‡ªå®šä¹‰ä¸€ä¸ªSavedStateï¼Œç»§æ‰¿è‡ªBaseSavedStateï¼Œç„¶åParcelable å°†Boobean ç±»å‹checked å±æ€§åºåˆ—åŒ–ï¼Œåˆ¤æ–­æ˜¯å¦é€‰ä¸­ï¼Œåœ¨onSaveInstanceState() ä¸­ï¼Œä¿å­˜ï¼Œç„¶ååœ¨onRestoreInstanceState() è·å–åºåˆ—åŒ–çš„å±æ€§ï¼Œé‡æ–°è°ƒç”¨setChecked() è®¾ç½®å±æ€§ã€‚ Checkbox/ToggleButtonCheckbox å’ŒToggleButton çš„å®ç°é‚£éƒ½æ˜¯ç»§æ‰¿è‡ªCompoundButtonï¼Œå¯ä»¥çœ‹ä¸‹é¢è¿™ä¸¤ç¯‡æ–‡ç« ã€‚ ToggleButton/Checkbox çš„æºç åˆ†æ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"bindServiceæºç åˆ†æ","date":"2017-07-26T11:46:44.000Z","path":"2017/07/26/bindServiceæºç åˆ†æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ bindService æºç åˆ†æ ã€è¿›è¡Œä¸­ã€‘ç®€ä»‹å®¢æˆ·ç«¯é€šè¿‡ ContextWrapper.bindService() æ–¹æ³•æ¥ç»‘å®šæœåŠ¡ï¼Œæœ¬åœ°å¯¹ bindService çš„è¿‡ç¨‹è¿›è¡Œæºç åˆ†æã€‚ æ•´ä½“æ—¶åºå›¾ æºç åˆ†æ1. å®¢æˆ·ç«¯è°ƒç”¨ bindService() ç»‘å®šæœåŠ¡ 1234567891011// MainActivity.java@Overrideprotected void onCreate(Bundle savedInstanceState) &#123; super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); Intent intent = new Intent().setComponent(new ComponentName( \"org.xdty.remoteservice\", \"org.xdty.remoteservice.RemoteService\")); bindService(intent, mConnection, Context.BIND_AUTO_CREATE);&#125; Activity.bindService() æœ€ç»ˆè°ƒç”¨çš„æ˜¯ ContextImpl.bindService() æ–¹æ³• 2. ContextImpl.bindService() 1234567891011121314151617181920212223242526272829// ContextImpl.java@Overridepublic boolean bindService(Intent service, ServiceConnection conn, int flags) &#123; warnIfCallingFromSystemProcess(); return bindServiceCommon(service, conn, flags, Process.myUserHandle());&#125;private boolean bindServiceCommon(Intent service, ServiceConnection conn, int flags, UserHandle user) &#123; IServiceConnection sd; sd = mPackageInfo.getServiceDispatcher(conn, getOuterContext(), mMainThread.getHandler(), flags); ... try &#123; IBinder token = getActivityToken(); ... int res = ActivityManagerNative.getDefault().bindService( mMainThread.getApplicationThread(), getActivityToken(), service, service.resolveTypeIfNeeded(getContentResolver()), sd, flags, getOpPackageName(), user.getIdentifier()); ... return res != 0; &#125; catch (RemoteException e) &#123; ... &#125;&#125; å¯è§æ¥ç€è°ƒç”¨äº† ActivityManagerNative.getDefault().bindService() æ–¹æ³• è¿™é‡Œçš„ mPackageInfo æ˜¯ä¸€ä¸ª LoadedApk å®ä¾‹ã€‚mMainThread åˆ™æ˜¯ä¸€ä¸ª ActivityThreadã€‚ 3. ActivityManagerNative.getDefault().bindService() æ³¨æ„ ActivityManagerNative.java æ–‡ä»¶ä¸­æœ‰ä¸¤ä¸ªç±» ActivityManagerNative ActivityManagerProxy, ä»–ä»¬éƒ½å®ç°äº† IActivityManageræ¥å£ï¼Œè€Œ ActivityManagerNative åˆ™ç»§æ‰¿äº† Binder å¯¹è±¡ï¼Œç›¸å½“äº AIDL ä¸­çš„ Stubï¼Œ`ActivityManagerProxy åˆ™ç›¸å½“äº Proxyã€‚ é¦–å…ˆçœ‹ ActivityManagerNative.getDefault() 123static public IActivityManager getDefault() &#123; return gDefault.get();&#125; å†æ‰¾ gDefault 1234567private static final Singleton&lt;IActivityManager&gt; gDefault = new Singleton&lt;IActivityManager&gt;() &#123; protected IActivityManager create() &#123; IBinder b = ServiceManager.getService(\"activity\"); IActivityManager am = asInterface(b); return am; &#125;&#125;; å†æ¥çœ‹ asInterface() æ–¹æ³• 123456789101112static public IActivityManager asInterface(IBinder obj) &#123; if (obj == null) &#123; return null; &#125; IActivityManager in = (IActivityManager)obj.queryLocalInterface(descriptor); if (in != null) &#123; return in; &#125; return new ActivityManagerProxy(obj);&#125; å¾ˆå®¹æ˜“å‘ç°å…¶è¿”å›äº†ä¸€ä¸ª ActivityManagerProxy å¯¹è±¡ï¼Œæ‰€ä»¥è°ƒç”¨çš„ bindService() æ–¹æ³•å®ç°åœ¨ ActivityManagerProxy ç±»ä¸­ã€‚æ³¨æ„è¿™é‡Œä¸è¦å’ŒæŠ½è±¡ç±» ActivityManagerNative.class ç»§æ‰¿çš„ bindService() æ–¹æ³•æ··æ·†ï¼Œå®ƒçš„å®ç°åœ¨å­ç±» ActivityManagerService ä¸­ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­çœ‹ Proxy ä¸­çš„å®ç°ï¼š 123456789101112131415161718192021222324// ActivityManagerNative.java// ActivityManagerProxy.classpublic int bindService(IApplicationThread caller, IBinder token, Intent service, String resolvedType, IServiceConnection connection, int flags, String callingPackage, int userId) throws RemoteException &#123; Parcel data = Parcel.obtain(); Parcel reply = Parcel.obtain(); data.writeInterfaceToken(IActivityManager.descriptor); data.writeStrongBinder(caller != null ? caller.asBinder() : null); data.writeStrongBinder(token); service.writeToParcel(data, 0); data.writeString(resolvedType); data.writeStrongBinder(connection.asBinder()); data.writeInt(flags); data.writeString(callingPackage); data.writeInt(userId); mRemote.transact(BIND_SERVICE_TRANSACTION, data, reply, 0); reply.readException(); int res = reply.readInt(); data.recycle(); reply.recycle(); return res;&#125; å¯è§è¿™é‡Œå°†è¦ç»‘å®šçš„æœåŠ¡ä¿¡æ¯æ‰“åŒ…ï¼Œé€šè¿‡ä¸€ä¸ª binder å¯¹è±¡ï¼Œå‘é€äº† BIND_SERVICE_TRANSACTION å‘½ä»¤ç»™ ActivityManager çš„æœåŠ¡ç«¯ã€‚è€Œ ActivityManager çš„æœåŠ¡ç«¯å°±æ˜¯ ActivityManagerNativeï¼Œæ‰€ä»¥æ¥ç€å‘½ä»¤ä¼šè¢« ActivityManagerNative.onTransact() å¤„ç† 4. ActivityManagerNative.onTransact() ActivityManagerNative å¯¹ BIND_SERVICE_TRANSACTION å‘½ä»¤é‡æ–°è§£åŒ…å¹¶é€šè¿‡å­ç±»å®ç°çš„ ActivityManagerNative.bindService() å¤„ç†ï¼Œæ³¨æ„è¿™é‡Œçš„ bindService() å’Œä¸Šæ–‡çš„ ActivityManagerProxy.bindService() ä¸åŒã€‚ 1234567891011121314151617181920212223242526 public abstract class ActivityManagerNative extends Binder implements IActivityManager&#123; @Override public boolean onTransact(int code, Parcel data, Parcel reply, int flags) throws RemoteException &#123; ... case BIND_SERVICE_TRANSACTION: &#123; data.enforceInterface(IActivityManager.descriptor); IBinder b = data.readStrongBinder(); IApplicationThread app = ApplicationThreadNative.asInterface(b); IBinder token = data.readStrongBinder(); Intent service = Intent.CREATOR.createFromParcel(data); String resolvedType = data.readString(); b = data.readStrongBinder(); int fl = data.readInt(); String callingPackage = data.readString(); int userId = data.readInt(); IServiceConnection conn = IServiceConnection.Stub.asInterface(b); int res = bindService(app, token, service, resolvedType, conn, fl, callingPackage, userId); reply.writeNoException(); reply.writeInt(res); return true; &#125; ...&#125; 5. ActivityManagerService.bindService() æˆ‘ä»¬ç»§ç»­çœ‹ ActivityManagerNative çš„å­ç±» ActivityManagerService å¯¹ bindService() æ–¹æ³•çš„å®ç°ï¼š 123456789public int bindService(IApplicationThread caller, IBinder token, Intent service, String resolvedType, IServiceConnection connection, int flags, String callingPackage, int userId) throws TransactionTooLargeException &#123; ... synchronized(this) &#123; return mServices.bindServiceLocked(caller, token, service, resolvedType, connection, flags, callingPackage, userId); &#125;&#125; å¯è§é€šè¿‡ mServices.bindServiceLocked() æ–¹æ³•åˆä¼ é€’ç»™äº†ä¸‹ä¸€å±‚ï¼Œè¿™é‡Œçš„ mServices åˆ™æ˜¯ä¸€ä¸ª ActiveServices å®ä¾‹ã€‚æˆ‘ä»¬ç»§ç»­è¿½è¸ª ActiveServices.bindServiceLocked() 6. ActiveServices.bindServiceLocked() æ¥ä¸‹æ¥çœ‹ bindServiceLocked() å…³é”®ä»£ç ç‰‡æ–­ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566int bindServiceLocked(IApplicationThread caller, IBinder token, Intent service, String resolvedType, IServiceConnection connection, int flags, String callingPackage, int userId) throws TransactionTooLargeException &#123; // è·å–å½“å‰åº”ç”¨çš„è¿›ç¨‹è®°å½• final ProcessRecord callerApp = mAm.getRecordForAppLocked(caller); // è·å–å½“å‰ Activity è®°å½• ActivityRecord activity = null; if (token != null) &#123; activity = ActivityRecord.isInStackLocked(token); &#125; ... // è·å– ServiceLookupResultï¼Œå…¶ä¸­ res.record å°±æ˜¯æˆ‘ä»¬è¦å¯åŠ¨çš„ service ServiceLookupResult res = retrieveServiceLocked(service, resolvedType, callingPackage, Binder.getCallingPid(), Binder.getCallingUid(), userId, true, callerFg); ServiceRecord s = res.record; mAm.startAssociationLocked(callerApp.uid, callerApp.processName, s.appInfo.uid, s.name, s.processName); AppBindRecord b = s.retrieveAppBindingLocked(service, callerApp); // å°è£…å®¢æˆ·ç«¯ä¼ å…¥çš„ IServiceConnectionï¼Œç”¨äºç»‘å®šåå›è°ƒ ConnectionRecord c = new ConnectionRecord(b, activity, connection, flags, clientLabel, clientIntent); // ä¿å­˜ connection è®°å½•åˆ°åˆ—è¡¨ä¸­ IBinder binder = connection.asBinder(); ArrayList&lt;ConnectionRecord&gt; clist = s.connections.get(binder); if (clist == null) &#123; clist = new ArrayList&lt;ConnectionRecord&gt;(); s.connections.put(binder, clist); &#125; clist.add(c); b.connections.add(c); if (activity != null) &#123; if (activity.connections == null) &#123; activity.connections = new HashSet&lt;ConnectionRecord&gt;(); &#125; activity.connections.add(c); &#125; b.client.connections.add(c); if ((c.flags&amp;Context.BIND_ABOVE_CLIENT) != 0) &#123; b.client.hasAboveClient = true; &#125; if (s.app != null) &#123; updateServiceClientActivitiesLocked(s.app, c, true); &#125; clist = mServiceConnections.get(binder); if (clist == null) &#123; clist = new ArrayList&lt;ConnectionRecord&gt;(); mServiceConnections.put(binder, clist); &#125; clist.add(c); // ç»§ç»­è¿›å…¥ bringUpServiceLocked() å¤„ç† if ((flags&amp;Context.BIND_AUTO_CREATE) != 0) &#123; s.lastActivity = SystemClock.uptimeMillis(); if (bringUpServiceLocked(s, service.getFlags(), callerFg, false) != null) &#123; return 0; &#125; &#125; ...&#125; 7. ActiveServices.bringUpServiceLocked() ç»§ç»­æŸ¥çœ‹ bringUpServiceLocked() æ–¹æ³• 1234567891011121314151617181920212223private final String bringUpServiceLocked(ServiceRecord r, int intentFlags, boolean execInFg, boolean whileRestarting) throws TransactionTooLargeException &#123; ... final boolean isolated = (r.serviceInfo.flags&amp;ServiceInfo.FLAG_ISOLATED_PROCESS) != 0; final String procName = r.processName; ProcessRecord app; // è·å–è¿›ç¨‹è®°å½• app = mAm.getProcessRecordLocked(procName, r.appInfo.uid, false); if (app != null &amp;&amp; app.thread != null) &#123; try &#123; app.addPackage(r.appInfo.packageName, r.appInfo.versionCode, mAm.mProcessStats); // å¯åŠ¨æœåŠ¡ realStartServiceLocked(r, app, execInFg); return null; &#125; catch (TransactionTooLargeException e) &#123; ... &#125; &#125; ...&#125; 8. ActiveServices.realStartServiceLocked() ç»§ç»­è¿½è¸ª ActiveServices.realStartServiceLocked() 123456789101112131415161718private final void realStartServiceLocked(ServiceRecord r, ProcessRecord app, boolean execInFg) throws RemoteException &#123; ... try &#123; ... // åˆ›å»ºæœåŠ¡ï¼ŒæœåŠ¡ç«¯æœ€ç»ˆä¼šå“åº” onCreate() æ–¹æ³•ã€‚ app.thread.scheduleCreateService(r, r.serviceInfo, mAm.compatibilityInfoForPackageLocked(r.serviceInfo.applicationInfo), app.repProcState); ... &#125; catch (DeadObjectException e) &#123; ... &#125; // ç»‘å®šæœåŠ¡ï¼Œ æœåŠ¡æœ€ç»ˆç«¯ä¼šå“åº” onBind() æ–¹æ³• requestServiceBindingsLocked(r, execInFg); ...&#125; å‚è€ƒAndroidåº”ç”¨ç¨‹åºç»‘å®šæœåŠ¡ï¼ˆbindServiceï¼‰çš„è¿‡ç¨‹æºä»£ç åˆ†æ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"Binderæºç åˆ†æ","date":"2017-07-26T11:44:18.000Z","path":"2017/07/26/Binderæºç åˆ†æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ æœ¬æ–‡æ˜¯åŸºäº Android 6.0.0 å’Œ kernel 3.4 æºç  åŠ Android SDK 23 å±•å¼€çš„ 1. ç®€ä»‹Binder æ˜¯ä¸€ç§ Android è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œæä¾›è¿œç¨‹è¿‡ç¨‹è°ƒç”¨(Remote Procedure Call)åŠŸèƒ½ã€‚æˆ‘ä»¬æœ€ç›´æ¥çš„ä½¿ç”¨æ˜¯è°ƒç”¨ Context.getSystemService() æ¥è·å–ç³»ç»ŸæœåŠ¡ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ AIDL æ¥å®ç°å¤šä¸ªç¨‹åº(APP)é—´æ•°æ®äº¤äº’ã€‚ Binder æ˜¯éå¸¸é‡è¦çš„ Android åŸºç¡€ç»„ä»¶ï¼Œå‡ ä¹æ‰€æœ‰çš„è¿›ç¨‹é—´é€šä¿¡éƒ½æ˜¯ä½¿ç”¨ Binder æœºåˆ¶å®ç°çš„ã€‚æœ¬æ–‡å°†ç»“åˆæºç å±•å¼€è®²è¿° Binder ï¼ŒåŒæ—¶å¯¹ä¸€äº›é‡è¦çŸ¥è¯†ç‚¹æä¾›æ‰©å±•é˜…è¯»çš„å‚è€ƒã€‚ ä¸ç®¡æ˜¯ Android ç³»ç»ŸæœåŠ¡(System services)è¿˜æ˜¯ç”¨æˆ·çš„åº”ç”¨è¿›ç¨‹(User apps)ï¼Œæœ€ç»ˆéƒ½ä¼šé€šè¿‡ binder æ¥å®ç°è¿›ç¨‹é—´é€šä¿¡ã€‚ä¸Šå±‚åº”ç”¨é¦–å…ˆé€šè¿‡ IBinder çš„ transcate æ–¹æ³•å‘é€å‘½ä»¤ç»™ libbinderï¼Œ libbinder å†é€šè¿‡ç³»ç»Ÿè°ƒç”¨(ioctl) å‘é€å‘½ä»¤åˆ°å†…æ ¸ä¸­çš„ binder é©±åŠ¨ï¼Œä¹‹åå†ç”±é©±åŠ¨å®Œæˆè¿›ç¨‹é—´æ•°æ®çš„äº¤äº’ã€‚ æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ Intentï¼ŒMessager æ•°æ®ä¼ é€’ä¹Ÿæ˜¯å¯¹ Binder æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡å’Œå°è£…ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¼šç”±å†…æ ¸ä¸­çš„ binder é©±åŠ¨å®Œæˆæ•°æ®çš„ä¼ é€’ã€‚ 2. Binder ä¸ AIDLAIDL (Android Interface definition language) æ˜¯æ¥å£æè¿°è¯­è¨€ï¼Œç”¨äºç”Ÿæˆåœ¨ä¸¤ä¸ªè¿›ç¨‹é—´è¿›è¡Œé€šä¿¡çš„ä»£ç ã€‚å…ˆçœ‹ AIDL æ¦‚å¿µå›¾ Stub.Proxy å’Œ Stub ä»£ç ç”± Android Sdk è‡ªåŠ¨ç”Ÿæˆï¼Œå®¢æˆ·ç«¯é€šè¿‡ Stub.Proxy ä¸è¿œç¨‹æœåŠ¡äº¤äº’ã€‚ Stub åŒ…å«å¯¹ IBinder å¯¹è±¡æ“ä½œçš„å°è£…ï¼Œéœ€è¦è¿œç¨‹æœåŠ¡å®ç°å…·ä½“åŠŸèƒ½ã€‚ æ¥ä¸‹æ¥å†çœ‹å…·ä½“å®ç°ï¼Œ å®Œæ•´æºä»£ç è§ AidlExampleã€‚åœ¨è¿™ä¸ªå·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ–°å»ºäº†ä¸¤ä¸ªåº”ç”¨ï¼Œ app æ˜¯å®¢æˆ·ç«¯ä»£ç ï¼Œ remoteservice åˆ™æ˜¯æœåŠ¡ç«¯ä»£ç ã€‚ 2.1 AIDL å®¢æˆ·ç«¯åœ¨ Android Studio é¡¹ç›®ä¸Šå³é”®ï¼Œ New -&gt; AIDL -&gt; AIDL File è¾“å…¥æ–‡ä»¶ååå¯ä»¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ª AIDL çš„ä»£ç ç»“æ„ã€‚ä¾‹å¦‚æˆ‘ä»¬æ–°å»ºä¸€ä¸ª IRemoteService.aidl æ–‡ä»¶ 12345678// IRemoteService.aidlpackage com.android.aidltest;interface IRemoteService &#123; void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat, double aDouble, String aString);&#125; ä»ç”Ÿæˆçš„ç¤ºä¾‹ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒAIDL çš„è¯­æ³•ç±»ä¼¼ Javaï¼Œ basicTypes() æ–¹æ³•ä¼ é€’çš„å‚æ•°åªæ˜¯åŸºæœ¬ç±»å‹ã€‚ å¦‚æœè¦ä¼ é€’è‡ªå®šä¹‰ç±»å‹å¦‚ Userï¼Œåˆ™éœ€è¦å®ç° Parcelable æ¥å£ã€‚Parcelable æ˜¯ä¸€ä¸ªä¸ Java Serializable ç±»ä¼¼çš„åºåˆ—åŒ–æ¥å£ã€‚ è¿™æ ·ç±» User çš„å®ä¾‹å°±å¯ä»¥å‚¨å­˜åˆ° Parcel ä¸­ï¼Œè€Œ Parcel åˆ™æ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡ IBinder å‘é€æ•°æ®æˆ–å¯¹è±¡å¼•ç”¨çš„å®¹å™¨ã€‚ 1234567891011121314151617181920212223242526272829303132// User.javapublic class User implements Parcelable &#123; private int uid; private String name; // ä» Parcel ä¸­è¯»å–æ•°æ®ï¼Œé¡ºåºéœ€è¦å’Œå†™å…¥ä¿æŒä¸€è‡´ protected User(Parcel in) &#123; uid = in.readInt(); name = in.readString(); &#125; // å¿…é¡»å®ç°ï¼Œç”¨äºä» Parcel å¯¹è±¡ä¸­ç”Ÿæˆç±»å®ä¾‹ public static final Creator&lt;User&gt; CREATOR = new Creator&lt;User&gt;() &#123; @Override public User createFromParcel(Parcel in) &#123; return new User(in); &#125; @Override public User[] newArray(int size) &#123; return new User[size]; &#125; &#125;; // å°†æ•°æ®å†™å…¥åˆ° Parcel ä¸­ï¼Œ é¡ºåºéœ€è¦ä¸è¯»å–ä¿æŒä¸€è‡´ @Override public void writeToParcel(Parcel dest, int flags) &#123; dest.writeInt(uid); dest.writeString(name); &#125;&#125; å†å‘ IRemoteService.aidl ä¸­æ·»åŠ ä¸€ä¸ª addUser() æ–¹æ³•ï¼ŒåŒæ—¶æ–°å»ºä¸€ä¸ª User.aidl æ–‡ä»¶ã€‚ 1234567891011121314151617// IRemoteService.aidlpackage com.android.aidltest;import com.android.aidltest.User;interface IRemoteService &#123; void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat, double aDouble, String aString); // in è¡¨ç¤ºä¼ å…¥æ•°æ®ï¼Œ out è¡¨ç¤ºä¼ å‡ºæ•°æ®ï¼Œ inout è¡¨ç¤ºåŒå‘ä¼ é€’ã€‚æ³¨æ„å«æœ‰ out æ—¶ User ç±»éœ€è¦å®ç° readFromParcel() æ–¹æ³• void addUser(in User user);&#125;// User.aidlpackage com.android.aidltest;parcelable User; è¿è¡Œç¼–è¯‘åï¼Œä¼šåœ¨ generated æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆä¸€ä¸ª IRemoteService.java æ¥å£æ–‡ä»¶ã€‚è¿™ä¸ªæ¥å£ä¸­æœ‰ä¸¤ä¸ªå†…éƒ¨ç±» Stub å’Œ Stub.Proxyã€‚æ³¨æ„å®¢æˆ·ç«¯ç”Ÿæˆçš„IRemoteService.java æ–‡ä»¶å’Œåœ¨åæ–‡æœåŠ¡ç«¯ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹æ˜¯ç›¸åŒçš„ã€‚ å®¢æˆ·ç«¯ä¼šä» Stub.asInterface() å¾—åˆ° IRemoteService (Stub.Proxy) çš„å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹å°±æ˜¯ä¸€ä¸ªé€šè¿‡ Binder ä¼ é€’å›æ¥çš„ è¿œç¨‹å¯¹è±¡ çš„åŒ…è£…ã€‚è€ŒæœåŠ¡ç«¯åˆ™éœ€è¦å®ç° IRemoteService.addUser() æ–¹æ³•ã€‚ 1234567891011// IRemoteService.javapublic static org.xdty.remoteservice.IRemoteService asInterface(android.os.IBinder obj) &#123; if ((obj == null)) &#123; return null; &#125; android.os.IInterface iin = obj.queryLocalInterface(DESCRIPTOR); if (((iin != null) &amp;&amp; (iin instanceof org.xdty.remoteservice.IRemoteService))) &#123; return ((org.xdty.remoteservice.IRemoteService) iin); &#125; return new org.xdty.remoteservice.IRemoteService.Stub.Proxy(obj);&#125; 2.2 AIDL æœåŠ¡ç«¯ä¸ºäº†æ¼”ç¤ºè¿›ç¨‹é—´é€šä¿¡ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ¨¡å—ï¼ˆåº”ç”¨ï¼‰ RemoteService æ¥å®ç°åŠŸèƒ½ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯ç»‘å®šæœåŠ¡ã€‚ æŒ‰å®¢æˆ·ç«¯çš„ç»“æ„æ–°å»º IRemoteService.aidl User.aidl User.java æ–‡ä»¶ï¼Œå¹¶æ‹·è´å†…å®¹ï¼Œæ³¨æ„å¦‚æœéœ€è¦è¯·ä¿®æ”¹åŒ…åã€‚ æ–°å»ºæœåŠ¡ RemoteService ï¼Œè¦†ç›–(Override) onBind() æ–¹æ³•å¹¶è¿”å› IRemoteService.Stub å®ä¾‹ mBinderï¼š 123456789101112131415161718192021// RemoteService.javapublic class RemoteService extends Service &#123; private static final String TAG = RemoteService.class.getSimpleName(); private IBinder mBinder = new IRemoteService.Stub() &#123; @Override public void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat, double aDouble, String aString) throws RemoteException &#123; Log.d(TAG, \"basicTypes: \"); &#125; @Override public void addUser(User user) throws RemoteException &#123; Log.d(TAG, \"addUser: \" + user.name); &#125; &#125;; @Override public IBinder onBind(Intent intent) &#123; return mBinder; &#125;&#125; è¿™æ ·æœåŠ¡ç«¯å°±å®ç°äº† addUser() æ–¹æ³•ï¼Œå½“å®¢æˆ·ç«¯é€šè¿‡è¿œç¨‹å¯¹è±¡è°ƒç”¨ IRemoteService.Stub.Proxy.addUser() æ—¶ï¼Œè¿œç¨‹å¯¹è±¡ mRemote å°±ä¼šé€šè¿‡ transact() å‘é€å‘½ä»¤ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å‘½ä»¤ååœ¨ Stub.onTransact() ä¸­è¯»å–æ•°æ®å¹¶æ‰§è¡Œ addUser() æ–¹æ³•ã€‚æ›´å¤šç»†èŠ‚æˆ‘ä»¬å°†åœ¨ 3. Binder æ¡†æ¶åŠ Native å±‚ å°èŠ‚è®²è¿°ã€‚ 123456789101112131415161718192021// IRemoteService.java@Overridepublic boolean onTransact(int code, android.os.Parcel data, android.os.Parcel reply, int flags) throws android.os.RemoteException &#123; switch (code) &#123; ... case TRANSACTION_addUser: &#123; data.enforceInterface(DESCRIPTOR); org.xdty.remoteservice.User _arg0; if ((0 != data.readInt())) &#123; _arg0 = org.xdty.remoteservice.User.CREATOR.createFromParcel(data); &#125; else &#123; _arg0 = null; &#125; this.addUser(_arg0); reply.writeNoException(); return true; &#125; &#125; return super.onTransact(code, data, reply, flags);&#125; 2.3 è¿œç¨‹æœåŠ¡çš„è·å–ä¸ä½¿ç”¨å®¢æˆ·ç«¯è¦ä½¿ç”¨è¿œç¨‹æœåŠ¡ï¼Œéœ€è¦ç»‘å®šæœåŠ¡ (bindService) å¹¶å»ºç«‹æœåŠ¡è¿æ¥ (ServiceConnection)ã€‚ 123456789101112131415161718192021222324// MainActivity.javapublic class MainActivity extends AppCompatActivity &#123; private ServiceConnection mConnection = new ServiceConnection() &#123; @Override public void onServiceConnected(ComponentName name, IBinder service) &#123; IRemoteService remoteService = IRemoteService.Stub.asInterface(service); try &#123; remoteService.addUser(new User(1, \"neo\")); &#125; catch (RemoteException e) &#123; e.printStackTrace(); &#125; &#125; ... &#125;; ... @Override protected void onCreate(Bundle savedInstanceState) &#123; ... Intent intent = new Intent().setComponent(new ComponentName( \"org.xdty.remoteservice\", \"org.xdty.remoteservice.RemoteService\")); bindService(intent, mConnection, Context.BIND_AUTO_CREATE); &#125;&#125; æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå®¢æˆ·ç«¯é€šè¿‡ binderService() æ–¹æ³•ï¼Œè·å–è¿œç¨‹æœåŠ¡å¹¶åœ¨æœåŠ¡è¿æ¥ ServiceConnection ä¸­ onServiceConnected() å›è°ƒä¸­å¾—åˆ°äº† IBinder service å®ä¾‹ï¼Œ æœ€åé€šè¿‡ä¸Šæ–‡æåˆ°çš„ IRemoteService.Stub.asInterface(service) æ–¹æ³•å¾—åˆ°è¿œç¨‹æœåŠ¡ IRemoteService çš„å®ä¾‹ã€‚é€šè¿‡ IRemoteService.addUser() æ–¹æ³•æˆ‘ä»¬å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æ–¹æ³•ã€‚åœ¨æ¥çœ‹ IRemoteService.addUser() çš„å®ç°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839// IRemoteService.javapublic static org.xdty.remoteservice.IRemoteService asInterface(android.os.IBinder obj) &#123; ... return new org.xdty.remoteservice.IRemoteService.Stub.Proxy(obj);&#125;private static class Proxy implements org.xdty.remoteservice.IRemoteService &#123; private android.os.IBinder mRemote; Proxy(android.os.IBinder remote) &#123; mRemote = remote; &#125; @Override public android.os.IBinder asBinder() &#123; return mRemote; &#125; ... @Override public void addUser(org.xdty.remoteservice.User user) throws android.os.RemoteException &#123; android.os.Parcel _data = android.os.Parcel.obtain(); android.os.Parcel _reply = android.os.Parcel.obtain(); try &#123; _data.writeInterfaceToken(DESCRIPTOR); if ((user != null)) &#123; _data.writeInt(1); user.writeToParcel(_data, 0); &#125; else &#123; _data.writeInt(0); &#125; mRemote.transact(Stub.TRANSACTION_addUser, _data, _reply, 0); _reply.readException(); &#125; finally &#123; _reply.recycle(); _data.recycle(); &#125; &#125;&#125; å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯è°ƒç”¨ remoteService.addUser(new User(1, â€œneoâ€)) æ–¹æ³•å®é™…ä¸Šæ˜¯é€šè¿‡ IBinder service å®ä¾‹çš„ transact() æ–¹æ³•ï¼Œå‘é€äº†ä¸æœåŠ¡ç«¯çº¦å®šå¥½çš„å‘½ä»¤ Stub.TRANSACTION_addUserï¼Œå¹¶å°†å‚æ•°æŒ‰æ ¼å¼æ‰“åŒ…è¿› Parcel å¯¹è±¡ã€‚ æœåŠ¡ç«¯åˆ™åœ¨ onTransact() æ–¹æ³•ä¸­æ”¶åˆ°å‘½ä»¤åä¼šå¯¹å‘½ä»¤å’Œå‚æ•°é‡æ–°è§£æï¼š 1234567891011121314151617181920// IRemoteService.javapublic boolean onTransact(int code, android.os.Parcel data, android.os.Parcel reply, int flags) throws android.os.RemoteException &#123; switch (code) &#123; ... case TRANSACTION_addUser: &#123; data.enforceInterface(DESCRIPTOR); org.xdty.remoteservice.User _arg0; if ((0 != data.readInt())) &#123; _arg0 = org.xdty.remoteservice.User.CREATOR.createFromParcel(data); &#125; else &#123; _arg0 = null; &#125; this.addUser(_arg0); reply.writeNoException(); return true; &#125; &#125; return super.onTransact(code, data, reply, flags);&#125; å¯ä»¥çœ‹åˆ°åœ¨ onTransact() ä¸­ï¼Œæœ€ç»ˆ this.addUser(_arg0) è°ƒç”¨äº†ä¸Šæ–‡æåˆ°çš„æœåŠ¡ç«¯çš„å®ç° IRemoteService.Stub.addUser() ã€‚ è¿œç¨‹ Binder å¯¹è±¡ mRemote æ˜¯ç”±å®¢æˆ·ç«¯ç»‘å®šæœåŠ¡æ—¶ onServiceConnected() è¿”å›çš„ã€‚ç»§ç»­è¿½è¸ª bindService() 1234567// ContextImpl.java@Overridepublic boolean bindService(Intent service, ServiceConnection conn, int flags) &#123; warnIfCallingFromSystemProcess(); return bindServiceCommon(service, conn, flags, Process.myUserHandle());&#125; å¯ä»¥çœ‹åˆ°æœ€åæ˜¯é€šè¿‡ ActivityManagerNative.getDefault().bindService() æ¥ç»‘å®šæœåŠ¡ 12345678910111213141516// bindServiceCommon()int res = ActivityManagerNative.getDefault().bindService( mMainThread.getApplicationThread(), getActivityToken(), service, service.resolveTypeIfNeeded(getContentResolver()), sd, flags, getOpPackageName(), user.getIdentifier());// ActivityManagerNative.getDefault().bindService()public int bindService(IApplicationThread caller, IBinder token, Intent service, String resolvedType, IServiceConnection connection, int flags, String callingPackage, int userId) throws RemoteException &#123; ... data.writeStrongBinder(connection.asBinder()); ... mRemote.transact(BIND_SERVICE_TRANSACTION, data, reply, 0); ...&#125; è¿½è¸ªåˆ° ActivityManagerNative.getDefault().bindService() ï¼Œå¯ä»¥å‘ç° ActivityManager å’Œ IServiceConnectionä¹Ÿæ˜¯ä¸€ä¸ª AIDL å®ç°ã€‚é€šè¿‡å®ƒçš„ ActivityManagerProxy.bindService() å°†ç»‘å®šè¯·æ±‚å‘é€ç»™æœ¬åœ°å±‚ã€‚ å†ä» onServiceConnected() å›è°ƒè¿½è¸ªï¼Œ onServiceConnected() æ˜¯ç”± LoadedApk.ServiceDispatcher.doConnected() å›è°ƒçš„ã€‚ å…³äºæ›´å¤šçš„ bindService() è¿œç¨‹æœåŠ¡åˆ›å»ºåŠ ServiceConnection å›è°ƒï¼Œ è¯·å‚è€ƒ Androidåº”ç”¨ç¨‹åºç»‘å®šæœåŠ¡ï¼ˆbindServiceï¼‰çš„è¿‡ç¨‹æºä»£ç åˆ†æ åˆ©ç”¨è¿›ç¨‹é—´é€šä¿¡ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ç®€å•çš„åº”ç”¨æ’ä»¶åŠŸèƒ½ã€‚å…³äº AIDL åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨ï¼Œå¯ä»¥å‚è€ƒ CallerInfo Plugin çš„å®ç° ä»ä¸Šé¢åˆ†æå¯ä»¥çœ‹å‡ºï¼Œ AIDL çš„æœ¬è´¨æ˜¯å¯¹ Binder çš„åˆä¸€æ¬¡æŠ½è±¡å’Œå°è£…ï¼Œå®é™…çš„è¿›ç¨‹é—´é€šä¿¡ä»æ˜¯ç”± Binder å®Œæˆçš„ã€‚ 3. Binder æ¡†æ¶åŠ Native å±‚Binderæœºåˆ¶ä½¿æœ¬åœ°å¯¹è±¡å¯ä»¥åƒæ“ä½œå½“å‰å¯¹è±¡ä¸€æ ·è°ƒç”¨è¿œç¨‹å¯¹è±¡ï¼Œå¯ä»¥ä½¿ä¸åŒçš„è¿›ç¨‹é—´äº’ç›¸é€šä¿¡ã€‚Binder ä½¿ç”¨ Client/Server æ¶æ„ï¼Œå®¢æˆ·ç«¯é€šè¿‡æœåŠ¡ç«¯ä»£ç†ï¼Œç»è¿‡ Binder é©±åŠ¨ä¸æœåŠ¡ç«¯äº¤äº’ã€‚ Binder æœºåˆ¶å®ç°è¿›ç¨‹é—´é€šä¿¡çš„å¥¥ç§˜åœ¨äº kernel ä¸­çš„ Binder é©±åŠ¨ï¼Œå°†åœ¨ 4. Binder é©±åŠ¨ å°èŠ‚è¯¦ç»†è®²è¿°ã€‚ JNI çš„ä»£ç ä½äº frameworks/base/core/jni ç›®å½•ä¸‹ï¼Œä¸»è¦æ˜¯ android_util_Binder.cpp æ–‡ä»¶å’Œå¤´æ–‡ä»¶ android_util_Binder.h Binder JNI ä»£ç æ˜¯ Binder Java å±‚æ“ä½œåˆ° Binder Native å±‚çš„æ¥å£å°è£…ï¼Œæœ€åä¼šè¢«ç¼–è¯‘è¿› libandroid_runtime.so ç³»ç»Ÿåº“ã€‚ Binder æœ¬åœ°å±‚çš„ä»£ç åœ¨ frameworks/native/libs/binder ç›®å½•ä¸‹ï¼Œ æ­¤ç›®å½•åœ¨ Android ç³»ç»Ÿç¼–è¯‘åä¼šç”Ÿæˆ libbinder.so æ–‡ä»¶ï¼Œä¾› JNI è°ƒç”¨ã€‚libbinder å°è£…äº†æ‰€æœ‰å¯¹ binder é©±åŠ¨çš„æ“ä½œï¼Œæ˜¯ä¸Šå±‚åº”ç”¨ä¸é©±åŠ¨äº¤äº’çš„æ¡¥æ¢ã€‚å¤´æ–‡ä»¶åˆ™åœ¨ frameworks/native/include/binder ç›®å½•ä¸‹ã€‚ 3.1 Binder Native çš„å…¥å£IInterface.cpp æ˜¯ Binder æœ¬åœ°å±‚å…¥å£ï¼Œä¸ java å±‚çš„ android.os.IInterface å¯¹åº”ï¼Œæä¾› asBinder() çš„å®ç°ï¼Œè¿”å› IBinder å¯¹è±¡ã€‚ åœ¨å¤´æ–‡ä»¶ä¸­æœ‰ä¸¤ä¸ªç±» BnInterface (Binder Native Interface) å’Œ BpInterface (Binder Proxy Interface), å¯¹åº”äº java å±‚çš„ Stub å’Œ Proxy 12345sp&lt;IBinder&gt; IInterface::asBinder(const IInterface* iface)&#123; if (iface == NULL) return NULL; return const_cast&lt;IInterface*&gt;(iface)-&gt;onAsBinder();&#125; 12345678910111213141516171819202122template&lt;typename INTERFACE&gt;class BnInterface : public INTERFACE, public BBinder&#123;public: virtual sp&lt;IInterface&gt; queryLocalInterface(const String16&amp; _descriptor); virtual const String16&amp; getInterfaceDescriptor() const;protected: virtual IBinder* onAsBinder();&#125;;// ----------------------------------------------------------------------template&lt;typename INTERFACE&gt;class BpInterface : public INTERFACE, public BpRefBase&#123;public: BpInterface(const sp&lt;IBinder&gt;&amp; remote);protected: virtual IBinder* onAsBinder();&#125;; å…¶ä¸­ BnInterface æ˜¯å®ç°StubåŠŸèƒ½çš„æ¨¡æ¿ï¼Œæ‰©å±•BBinderçš„onTransact()æ–¹æ³•å®ç°Binderå‘½ä»¤çš„è§£æå’Œæ‰§è¡Œã€‚BpInterface æ˜¯å®ç°ProxyåŠŸèƒ½çš„æ¨¡æ¿ï¼ŒBpRefBaseé‡Œæœ‰ä¸ªmRemoteå¯¹è±¡æŒ‡å‘ä¸€ä¸ªBpBinderå¯¹è±¡ã€‚ 3.2 Binder æœ¬åœ°å±‚çš„æ•´ä¸ªå‡½æ•°/æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ 1. Java å±‚ IRemoteService.Stub.Proxy è°ƒç”¨ android.os.IBinder (å®ç°åœ¨ android.os.Binder.BinderProxy) çš„ transact() å‘é€ Stub.TRANSACTION_addUser å‘½ä»¤ã€‚ 2. ç”± BinderProxy.transact() è¿›å…¥ native å±‚ã€‚ 3. ç”± jni è½¬åˆ° android_os_BinderProxy_transact() å‡½æ•°ã€‚ 4. è°ƒç”¨ IBinder-&gt;transact å‡½æ•°ã€‚ 1234567static jboolean android_os_BinderProxy_transact(JNIEnv* env, jobject obj, jint code, jobject dataObj, jobject replyObj, jint flags) // throws RemoteException&#123; IBinder* target = (IBinder*) env-&gt;GetLongField(obj, gBinderProxyOffsets.mObject); status_t err = target-&gt;transact(code, *data, reply, flags);&#125; è€Œ gBinderProxyOffsets.mObject åˆ™æ˜¯åœ¨ java å±‚è°ƒç”¨ IBinder.getContextObject() æ—¶åœ¨ javaObjectForIBinder å‡½æ•°ä¸­è®¾ç½®çš„ 123456789101112131415static jobject android_os_BinderInternal_getContextObject(JNIEnv* env, jobject clazz)&#123; sp&lt;IBinder&gt; b = ProcessState::self()-&gt;getContextObject(NULL); return javaObjectForIBinder(env, b);&#125;jobject javaObjectForIBinder(JNIEnv* env, const sp&lt;IBinder&gt;&amp; val)&#123; ... LOGDEATH(\"objectForBinder %p: created new proxy %p !\\n\", val.get(), object); // The proxy holds a reference to the native object. env-&gt;SetLongField(object, gBinderProxyOffsets.mObject, (jlong)val.get()); val-&gt;incStrong((void*)javaObjectForIBinder); ...&#125; ç»è¿‡ ProcessState::getContextObject() å’Œ ProcessState::getStrongProxyForHandle() 1234567891011121314sp&lt;IBinder&gt; ProcessState::getContextObject(const sp&lt;IBinder&gt;&amp; /*caller*/)&#123; return getStrongProxyForHandle(0);&#125;sp&lt;IBinder&gt; ProcessState::getStrongProxyForHandle(int32_t handle)&#123; sp&lt;IBinder&gt; result; ... b = new BpBinder(handle); result = b; ... return result;&#125; å¯è§ android_os_BinderProxy_transact() å‡½æ•°å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ BpBinder::transact() å‡½æ•°ã€‚ 5. BpBinder::transact() åˆ™åˆè°ƒç”¨äº† IPCThreadState::self()-&gt;transact() å‡½æ•°ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243status_t IPCThreadState::transact(int32_t handle, uint32_t code, const Parcel&amp; data, Parcel* reply, uint32_t flags)&#123; status_t err = data.errorCheck(); flags |= TF_ACCEPT_FDS; if (err == NO_ERROR) &#123; LOG_ONEWAY(\"&gt;&gt;&gt;&gt; SEND from pid %d uid %d %s\", getpid(), getuid(), (flags &amp; TF_ONE_WAY) == 0 ? \"READ REPLY\" : \"ONE WAY\"); err = writeTransactionData(BC_TRANSACTION, flags, handle, code, data, NULL); &#125; if ((flags &amp; TF_ONE_WAY) == 0) &#123; if (reply) &#123; err = waitForResponse(reply); &#125; else &#123; Parcel fakeReply; err = waitForResponse(&amp;fakeReply); &#125; &#125; else &#123; err = waitForResponse(NULL, NULL); &#125; return err;&#125;status_t IPCThreadState::writeTransactionData(int32_t cmd, uint32_t binderFlags, int32_t handle, uint32_t code, const Parcel&amp; data, status_t* statusBuffer)&#123; binder_transaction_data tr; tr.target.ptr = 0; /* Don't pass uninitialized stack data to a remote process */ tr.target.handle = handle; tr.code = code; ... mOut.writeInt32(cmd); mOut.write(&amp;tr, sizeof(tr)); return NO_ERROR;&#125; ç”±å‡½æ•°å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œ æ•°æ®å†ä¸€æ¬¡é€šè¿‡ writeTransactionData() ä¼ é€’ç»™ mOut è¿›è¡Œå†™å…¥æ“ä½œã€‚ mOut æ˜¯ä¸€ä¸ª Parcel å¯¹è±¡ï¼Œ å£°æ˜åœ¨ IPCThreadState.h æ–‡ä»¶ä¸­ã€‚ä¹‹ååˆ™è°ƒç”¨ waitForResponse() å‡½æ•°ã€‚ 6. IPCThreadState::waitForResponse() åœ¨ä¸€ä¸ª while å¾ªç¯é‡Œä¸æ–­çš„è°ƒç”¨ talkWithDriver() å¹¶æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®è¿”å›ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758status_t IPCThreadState::waitForResponse(Parcel *reply, status_t *acquireResult)&#123; uint32_t cmd; int32_t err; while (1) &#123; if ((err=talkWithDriver()) &lt; NO_ERROR) break; ... cmd = (uint32_t)mIn.readInt32(); switch (cmd) &#123; case BR_TRANSACTION_COMPLETE: ... case BR_REPLY: &#123; binder_transaction_data tr; err = mIn.read(&amp;tr, sizeof(tr)); ALOG_ASSERT(err == NO_ERROR, \"Not enough command data for brREPLY\"); if (err != NO_ERROR) goto finish; if (reply) &#123; if ((tr.flags &amp; TF_STATUS_CODE) == 0) &#123; reply-&gt;ipcSetDataReference( reinterpret_cast&lt;const uint8_t*&gt;(tr.data.ptr.buffer), tr.data_size, reinterpret_cast&lt;const binder_size_t*&gt;(tr.data.ptr.offsets), tr.offsets_size/sizeof(binder_size_t), freeBuffer, this); &#125; else &#123; err = *reinterpret_cast&lt;const status_t*&gt;(tr.data.ptr.buffer); freeBuffer(NULL, reinterpret_cast&lt;const uint8_t*&gt;(tr.data.ptr.buffer), tr.data_size, reinterpret_cast&lt;const binder_size_t*&gt;(tr.data.ptr.offsets), tr.offsets_size/sizeof(binder_size_t), this); &#125; &#125; else &#123; freeBuffer(NULL, reinterpret_cast&lt;const uint8_t*&gt;(tr.data.ptr.buffer), tr.data_size, reinterpret_cast&lt;const binder_size_t*&gt;(tr.data.ptr.offsets), tr.offsets_size/sizeof(binder_size_t), this); continue; &#125; &#125; goto finish; &#125; default: err = executeCommand(cmd); if (err != NO_ERROR) goto finish; break; &#125; &#125; ...&#125; 7. IPCThreadState::talkWithDriver() å‡½æ•°æ˜¯çœŸæ­£ä¸ binder é©±åŠ¨äº¤äº’çš„å®ç°ã€‚ioctl(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr) å°±æ˜¯ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨å‡½æ•° ioctl å‘ binder è®¾å¤‡æ–‡ä»¶ /dev/binder å‘é€ BINDER_WRITE_READ å‘½ä»¤ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667status_t IPCThreadState::talkWithDriver(bool doReceive)&#123; if (mProcess-&gt;mDriverFD &lt;= 0) &#123; return -EBADF; &#125; binder_write_read bwr; // Is the read buffer empty? const bool needRead = mIn.dataPosition() &gt;= mIn.dataSize(); // We don't want to write anything if we are still reading // from data left in the input buffer and the caller // has requested to read the next data. const size_t outAvail = (!doReceive || needRead) ? mOut.dataSize() : 0; bwr.write_size = outAvail; bwr.write_buffer = (uintptr_t)mOut.data(); // This is what we'll read. if (doReceive &amp;&amp; needRead) &#123; bwr.read_size = mIn.dataCapacity(); bwr.read_buffer = (uintptr_t)mIn.data(); &#125; else &#123; bwr.read_size = 0; bwr.read_buffer = 0; &#125; // Return immediately if there is nothing to do. if ((bwr.write_size == 0) &amp;&amp; (bwr.read_size == 0)) return NO_ERROR; bwr.write_consumed = 0; bwr.read_consumed = 0; status_t err;#if defined(HAVE_ANDROID_OS) // ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ ioctl å‘ /dev/binder å‘é€ BINDER_WRITE_READ å‘½ä»¤ if (ioctl(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr) &gt;= 0) err = NO_ERROR; else err = -errno;#else err = INVALID_OPERATION;#endif do &#123; if (mProcess-&gt;mDriverFD &lt;= 0) &#123; err = -EBADF; &#125; &#125; while (err == -EINTR); if (err &gt;= NO_ERROR) &#123; if (bwr.write_consumed &gt; 0) &#123; if (bwr.write_consumed &lt; mOut.dataSize()) mOut.remove(0, bwr.write_consumed); else mOut.setDataSize(0); &#125; if (bwr.read_consumed &gt; 0) &#123; mIn.setDataSize(bwr.read_consumed); mIn.setDataPosition(0); &#125; return NO_ERROR; &#125; return err;&#125; ç»è¿‡ IPCThreadState::talkWithDriver() ,å°±å°†æ•°æ®å‘é€ç»™äº† Binder é©±åŠ¨ã€‚ ç»§ç»­è¿½è¸ª IPCThreadState::waitForResponse() ï¼Œå¯ä»¥ä» ç¬¬6æ­¥ å‘ç° IPCThreadState ä¸æ–­çš„å¾ªç¯è¯»å– Binder é©±åŠ¨è¿”å›ï¼Œè·å–åˆ°è¿”å›å‘½ä»¤åæ‰§è¡Œäº† executeCommand(cmd) å‡½æ•°ã€‚ 8. IPCThreadState::executeCommand() å¤„ç† Binder é©±åŠ¨è¿”å›å‘½ä»¤ 123456789101112131415161718192021222324252627282930313233343536status_t IPCThreadState::executeCommand(int32_t cmd)&#123; BBinder* obj; RefBase::weakref_type* refs; status_t result = NO_ERROR; switch ((uint32_t)cmd) &#123; ... case BR_TRANSACTION: &#123; binder_transaction_data tr; result = mIn.read(&amp;tr, sizeof(tr)); ... Parcel buffer; buffer.ipcSetDataReference( reinterpret_cast&lt;const uint8_t*&gt;(tr.data.ptr.buffer), tr.data_size, reinterpret_cast&lt;const binder_size_t*&gt;(tr.data.ptr.offsets), tr.offsets_size/sizeof(binder_size_t), freeBuffer, this); ... Parcel reply; status_t error; if (tr.target.ptr) &#123; sp&lt;BBinder&gt; b((BBinder*)tr.cookie); error = b-&gt;transact(tr.code, buffer, &amp;reply, tr.flags); &#125; else &#123; error = the_context_object-&gt;transact(tr.code, buffer, &amp;reply, tr.flags); &#125; ... &#125; break; ...&#125; 9. å¯ä»¥çœ‹å‡ºå…¶è°ƒç”¨äº† BBinder::transact() å‡½æ•°ï¼Œå°†æ•°æ®è¿”å›ç»™ä¸Šå±‚ã€‚ 123456789101112131415161718192021status_t BBinder::transact( uint32_t code, const Parcel&amp; data, Parcel* reply, uint32_t flags)&#123; data.setDataPosition(0); status_t err = NO_ERROR; switch (code) &#123; case PING_TRANSACTION: reply-&gt;writeInt32(pingBinder()); break; default: err = onTransact(code, data, reply, flags); break; &#125; if (reply != NULL) &#123; reply-&gt;setDataPosition(0); &#125; return err;&#125; 10. è€Œè¿™é‡Œçš„ b-&gt;transact(tr.code, buffer, &amp;reply, tr.flags) ä¸­çš„ b (BBinder) æ˜¯ JavaBBinder çš„å®ä¾‹ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ JavaBBinder::onTransact() å‡½æ•° 12345678910111213141516// frameworks/base/core/jni/android_util_Binder.cppvirtual status_t onTransact( uint32_t code, const Parcel&amp; data, Parcel* reply, uint32_t flags = 0) &#123; JNIEnv* env = javavm_to_jnienv(mVM); ... jboolean res = env-&gt;CallBooleanMethod(mObject, gBinderOffsets.mExecTransact, code, reinterpret_cast&lt;jlong&gt;(&amp;data), reinterpret_cast&lt;jlong&gt;(reply), flags); &#125;static int int_register_android_os_Binder(JNIEnv* env)&#123; ... gBinderOffsets.mExecTransact = GetMethodIDOrDie(env, clazz, \"execTransact\", \"(IJJI)Z\"); ...&#125; 11. å¯è§ JNI é€šè¿‡ gBinderOffsets.mExecTransact æœ€åæ‰§è¡Œäº† android.os.Binder çš„ execTransact() æ–¹æ³•ã€‚ execTransact() æ–¹æ³•æ˜¯ jni å›è°ƒçš„å…¥å£ã€‚ 1234567891011// Entry point from android_util_Binder.cpp's onTransact private boolean execTransact(int code, long dataObj, long replyObj, int flags) &#123; Parcel data = Parcel.obtain(dataObj); Parcel reply = Parcel.obtain(replyObj); ... try &#123; res = onTransact(code, data, reply, flags); &#125; ... &#125; 12. è€Œæˆ‘ä»¬åˆ™åœ¨æœåŠ¡ç«¯ IRemoteService.Stub é‡è½½äº† onTransact() æ–¹æ³•ï¼Œæ‰€ä»¥æ•°æ®æœ€åä¼šå›åˆ°æˆ‘ä»¬çš„æœåŠ¡ç«¯å¹¶æ‰§è¡ŒæœåŠ¡ç«¯å®ç°çš„ addUser() æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425262728293031public static abstract class Stub extends android.os.Binder implements org.xdty.remoteservice.IRemoteService &#123; ... @Override public boolean onTransact(int code, android.os.Parcel data, android.os.Parcel reply, int flags) throws android.os.RemoteException &#123; switch (code) &#123; case INTERFACE_TRANSACTION: &#123; reply.writeString(DESCRIPTOR); return true; &#125; case TRANSACTION_basicTypes: &#123; ... return true; &#125; case TRANSACTION_addUser: &#123; data.enforceInterface(DESCRIPTOR); org.xdty.remoteservice.User _arg0; if ((0 != data.readInt())) &#123; _arg0 = org.xdty.remoteservice.User.CREATOR.createFromParcel(data); &#125; else &#123; _arg0 = null; &#125; this.addUser(_arg0); reply.writeNoException(); return true; &#125; &#125; return super.onTransact(code, data, reply, flags); &#125;&#125; ä¸Šè¿°è¿‡ç¨‹å°±æ˜¯æ‰€æœ‰çš„ Native å±‚å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„è°ƒç”¨è¿‡ç¨‹ï¼Œæ€»ç»“ä¸‹æ¥å°±æ˜¯ å®¢æˆ·ç«¯è¿›ç¨‹å‘é€ BC_TRANSACTION åˆ° Binder é©±åŠ¨ï¼ŒæœåŠ¡ç«¯è¿›ç¨‹ç›‘å¬è¿”å›çš„ BR_TRANSACTION å‘½ä»¤å¹¶å¤„ç†ã€‚å¦‚æœæ˜¯æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯è¿”å›æ•°æ®ï¼Œç±»ä¼¼çš„æ˜¯æœåŠ¡ç«¯å‘é€ BC_REPLY å‘½ä»¤ï¼Œ å®¢æˆ·ç«¯ç›‘å¬ BR_REPLY å‘½ä»¤ã€‚ 3.3 Binder è®¾å¤‡æ–‡ä»¶çš„æ‰“å¼€å’Œè¯»å†™1. è®¾å¤‡çš„æ‰“å¼€ åœ¨ä¸Šä¸€å°èŠ‚ä¸­æˆ‘ä»¬çœ‹åˆ° JNI è¿‡ç¨‹ä¸­è°ƒç”¨äº† ProcessState::getContextObject() å‡½æ•°ï¼Œ åœ¨ ProcessState åˆå§‹åŒ–æ—¶ä¼šæ‰“å¼€ binder è®¾å¤‡ 1234567// ProcessState.cppProcessState::ProcessState() : mDriverFD(open_driver()) ...&#123; ...&#125; open_driver() å‡½æ•°å†…å®¹å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132// ProcessState.cppstatic int open_driver()&#123; // æ‰“å¼€è®¾å¤‡æ–‡ä»¶ int fd = open(\"/dev/binder\", O_RDWR); if (fd &gt;= 0) &#123; fcntl(fd, F_SETFD, FD_CLOEXEC); int vers = 0; // è·å–é©±åŠ¨ç‰ˆæœ¬ status_t result = ioctl(fd, BINDER_VERSION, &amp;vers); if (result == -1) &#123; ALOGE(\"Binder ioctl to obtain version failed: %s\", strerror(errno)); close(fd); fd = -1; &#125; // æ£€æŸ¥é©±åŠ¨ç‰ˆæœ¬æ˜¯å¦ä¸€è‡´ if (result != 0 || vers != BINDER_CURRENT_PROTOCOL_VERSION) &#123; ALOGE(\"Binder driver protocol does not match user space protocol!\"); close(fd); fd = -1; &#125; // è®¾ç½®æœ€å¤š 15 ä¸ª binder çº¿ç¨‹ size_t maxThreads = DEFAULT_MAX_BINDER_THREADS; result = ioctl(fd, BINDER_SET_MAX_THREADS, &amp;maxThreads); if (result == -1) &#123; ALOGE(\"Binder ioctl to set max threads failed: %s\", strerror(errno)); &#125; &#125; else &#123; ALOGW(\"Opening '/dev/binder' failed: %s\\n\", strerror(errno)); &#125; return fd;&#125; 2. è®¾å¤‡çš„è¯»å†™ æ‰“å¼€è®¾å¤‡æ–‡ä»¶åï¼Œæ–‡ä»¶æè¿°ç¬¦è¢«ä¿å­˜åœ¨ mDriverFDï¼Œ é€šè¿‡ç³»ç»Ÿè°ƒç”¨ ioctl å‡½æ•°æ“ä½œ mDriverFD å°±å¯ä»¥å®ç°å’Œ binder é©±åŠ¨çš„äº¤äº’ã€‚ å¯¹ Binder è®¾å¤‡æ–‡ä»¶çš„æ‰€æœ‰è¯»å†™åŠå…³é—­æ“ä½œåˆ™éƒ½åœ¨ IPCThreadState ä¸­ï¼Œå¦‚ä¸Šä¸€å°èŠ‚æåŠåˆ°çš„ IPCThreadState::talkWithDriver å‡½æ•° talkWithDriver() å‡½æ•°å°è£…äº† BINDER_WRITE_READ å‘½ä»¤ï¼Œä¼šä» binder é©±åŠ¨è¯»å–æˆ–å†™å…¥å°è£…åœ¨ binder_write_read ç»“æ„ä½“ä¸­çš„æœ¬åœ°æˆ–è¿œç¨‹å¯¹è±¡ã€‚ 12345678910111213141516171819202122232425// IPCThreadState.cppstatus_t IPCThreadState::talkWithDriver(bool doReceive)&#123; binder_write_read bwr; const bool needRead = mIn.dataPosition() &gt;= mIn.dataSize(); const size_t outAvail = (!doReceive || needRead) ? mOut.dataSize() : 0; // å†™å…¥æ•°æ® bwr.write_size = outAvail; bwr.write_buffer = (uintptr_t)mOut.data(); // è¯»å–æ•°æ® if (doReceive &amp;&amp; needRead) &#123; bwr.read_size = mIn.dataCapacity(); bwr.read_buffer = (uintptr_t)mIn.data(); &#125; else &#123; bwr.read_size = 0; bwr.read_buffer = 0; &#125; ... // ä½¿ç”¨ ioctl ç³»ç»Ÿè°ƒç”¨å‘é€ BINDER_WRITE_READ å‘½ä»¤åˆ° biner é©±åŠ¨ if (ioctl(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr) &gt;= 0) err = NO_ERROR; ...&#125; å¯ä»¥çœ‹å‡ºï¼Œæœ¬åœ°å±‚æ˜¯å¯¹åº”ç”¨ä¸ binder é©±åŠ¨äº¤äº’çš„ç›´æ¥å°è£…ä¸å®ç°ï¼Œæœ€ç»ˆçš„æ•°æ®ä¼ è¾“ä»æ˜¯ç”±é©±åŠ¨æ¥å®Œæˆçš„ã€‚æœ¬åœ°å±‚å¯¹åº•å±‚é©±åŠ¨è¿›è¡Œäº†å®Œæ•´çš„å°è£…ï¼Œä¸Šå±‚åº”ç”¨åªå…³å¿ƒ transact() å’Œ onTransact() å›è°ƒï¼Œå¯Ÿè§‰ä¸åˆ° binder é©±åŠ¨çš„å­˜åœ¨ï¼Œå‡è½»äº†ä¸Šå±‚åº”ç”¨è¿›ç¨‹é—´é€šä¿¡å¼€å‘çš„å¤æ‚åº¦ã€‚ 4. Binder é©±åŠ¨å…³äº binder é©±åŠ¨å»ºè®®å‚è€ƒå¦ä¸€ç¯‡æ–‡ç«  æ·±å…¥åˆ†æAndroid Binder é©±åŠ¨ åŸæ–‡ï¼Œæœ¬å°èŠ‚ä»éœ€è¦å®Œå–„ã€‚ Binder é©±åŠ¨æ˜¯ Binder çš„æœ€ç»ˆå®ç°ï¼Œ ServiceManager å’Œ Client/Service è¿›ç¨‹é—´é€šä¿¡æœ€ç»ˆéƒ½æ˜¯ç”± Binder é©±åŠ¨æŠ•é€’çš„ã€‚ Binder é©±åŠ¨çš„ä»£ç ä½äº kernel ä»£ç çš„ drivers/staging/android ç›®å½•ä¸‹ã€‚ä¸»æ–‡ä»¶æ˜¯ binder.h å’Œ binder.c è¿›ç¨‹é—´ä¼ è¾“çš„æ•°æ®è¢«ç§°ä¸º Binder å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ª flat_binder_objectï¼Œç»“æ„å¦‚ä¸‹ 1234567891011121314struct flat_binder_object &#123; /* 8 bytes for large_flat_header. */ unsigned long type; unsigned long flags; /* 8 bytes of data. */ union &#123; void *binder; /* local object */ signed long handle; /* remote object */ &#125;; /* extra data associated with local object */ void *cookie;&#125;; å…¶ä¸­ ç±»å‹ type æè¿°äº† Binder å¯¹è±¡çš„ç±»å‹ï¼ŒåŒ…å« BINDER(æœ¬åœ°å¯¹è±¡)ã€HANDLE(è¿œç¨‹å¯¹è±¡)ã€ FD ä¸‰å¤§ç±»(äº”ç§) 1234567enum &#123; BINDER_TYPE_BINDER = B_PACK_CHARS('s', 'b', '*', B_TYPE_LARGE), BINDER_TYPE_WEAK_BINDER = B_PACK_CHARS('w', 'b', '*', B_TYPE_LARGE), BINDER_TYPE_HANDLE = B_PACK_CHARS('s', 'h', '*', B_TYPE_LARGE), BINDER_TYPE_WEAK_HANDLE = B_PACK_CHARS('w', 'h', '*', B_TYPE_LARGE), BINDER_TYPE_FD = B_PACK_CHARS('f', 'd', '*', B_TYPE_LARGE),&#125;; flags åˆ™è¡¨è¿°äº†ä¼ è¾“æ–¹å¼ï¼Œå¦‚å¼‚æ­¥ã€æ— è¿”å›ç­‰ 123456enum transaction_flags &#123; TF_ONE_WAY = 0x01, /* this is a one-way call: async, no return */ TF_ROOT_OBJECT = 0x04, /* contents are the component's root object */ TF_STATUS_CODE = 0x08, /* contents are a 32-bit status code */ TF_ACCEPT_FDS = 0x10, /* allow replies with file descriptors */&#125;; è€Œ flat_binder_object ä¸­çš„ union è”åˆä½“ å°±æ˜¯è¦ä¼ è¾“çš„æ•°æ®ï¼Œå½“ç±»å‹ä¸º BINDER æ—¶ï¼Œ æ•°æ®å°±æ˜¯ä¸€ä¸ªæœ¬åœ°å¯¹è±¡ *binderï¼Œè€Œç±»å‹ä¸º HANDLE æ—¶ï¼Œæ•°æ®åˆ™æ˜¯ä¸€ä¸ªè¿œç¨‹å¯¹è±¡ handleã€‚ å½“ flat_binder_object åœ¨è¿›ç¨‹é—´ä¼ é€’æ—¶ï¼Œ Binder é©±åŠ¨ä¼šä¿®æ”¹å®ƒçš„ç±»å‹å’Œæ•°æ®ï¼Œäº¤æ¢çš„ä»£ç å‚è€ƒ binder_transaction çš„å®ç°ã€‚ è¯¥å¦‚ä½•ç†è§£æœ¬åœ° BINDER å¯¹è±¡å’Œè¿œç¨‹ HANDLE å¯¹è±¡å‘¢ï¼Ÿå…¶å®å®ƒä»¬éƒ½ä»£è¡¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸è¿‡æ˜¯ä»ä¸åŒçš„è§’åº¦æ¥çœ‹ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå‡å¦‚è¿›ç¨‹ RemoteService æœ‰ä¸ªå¯¹è±¡ mBinderï¼Œå¯¹äº RemoteService æ¥è¯´ï¼ŒmBinder å°±æ˜¯ä¸€ä¸ªæœ¬åœ°çš„ BINDER å¯¹è±¡ï¼›å¦‚æœè¿›ç¨‹ app é€šè¿‡ Binder é©±åŠ¨è®¿é—® RemoteService çš„ mBinder å¯¹è±¡ï¼Œå¯¹äº app æ¥è¯´ï¼Œ mBinder å°±æ˜¯ä¸€ä¸ª HANDLEã€‚å› æ­¤ï¼Œä»æ ¹æœ¬ä¸Šæ¥è¯´ handle å’Œ binder éƒ½æŒ‡å‘ RemoteService çš„ mBinderã€‚æœ¬åœ°å¯¹è±¡è¿˜å¯ä»¥å¸¦æœ‰é¢å¤–çš„æ•°æ®ï¼Œä¿å­˜åœ¨ cookie ä¸­ã€‚ Binder é©±åŠ¨ç›´æ¥æ“ä½œçš„æœ€å¤–å±‚æ•°æ®ç»“æ„æ˜¯ binder_transaction_dataï¼Œ Binder å¯¹è±¡ flat_binder_object è¢«å°è£…åœ¨ binder_transaction_data ç»“æ„ä½“ä¸­ã€‚ binder_transaction_data æ•°æ®ç»“æ„æ‰æ˜¯çœŸæ­£ä¼ è¾“çš„æ•°æ®ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ 1234567891011121314151617181920212223242526272829303132struct binder_transaction_data &#123; /* The first two are only used for bcTRANSACTION and brTRANSACTION, * identifying the target and contents of the transaction. */ union &#123; size_t handle; /* target descriptor of command transaction */ void *ptr; /* target descriptor of return transaction */ &#125; target; void *cookie; /* target object cookie */ unsigned int code; /* transaction command */ /* General information about the transaction. */ unsigned int flags; pid_t sender_pid; uid_t sender_euid; size_t data_size; /* number of bytes of data */ size_t offsets_size; /* number of bytes of offsets */ /* If this transaction is inline, the data immediately * follows here; otherwise, it ends with a pointer to * the data buffer. */ union &#123; struct &#123; /* transaction data */ const void *buffer; /* offsets from buffer to flat_binder_object structs */ const void *offsets; &#125; ptr; uint8_t buf[8]; &#125; data;&#125;; flat_binder_object å°±è¢«å°è£…åœ¨ *bufferä¸­ï¼Œå…¶ä¸­çš„ unsigned int code; åˆ™æ˜¯ä¼ è¾“å‘½ä»¤ï¼Œæè¿°äº† Binder å¯¹è±¡æ‰§è¡Œçš„æ“ä½œã€‚ 4.1 binder è®¾å¤‡çš„åˆ›å»ºdevice_initcall() å‡½æ•°æ˜¯å†…æ ¸åŠ è½½é©±åŠ¨çš„å…¥å£å‡½æ•°ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ã€‚ 12345678910111213141516171819202122232425262728static struct miscdevice binder_miscdev = &#123; .minor = MISC_DYNAMIC_MINOR, // è®¾å¤‡æ–‡ä»¶ /dev/binder .name = \"binder\", // è®¾å¤‡æ–‡ä»¶æ“ä½œ .fops = &amp;binder_fops&#125;;static int __init binder_init(void)&#123; int ret; ... // æ³¨å†Œå­—ç¬¦è®¾å¤‡ ret = misc_register(&amp;binder_miscdev); ... // è°ƒè¯•æ–‡ä»¶ï¼Œ åœ¨ /sys/kernel/debug/binder ç›®å½•ä¸‹ if (binder_debugfs_dir_entry_root) &#123; debugfs_create_file(\"state\", S_IRUGO, binder_debugfs_dir_entry_root, NULL, &amp;binder_state_fops); ... &#125; return ret;&#125;device_initcall(binder_init); å¯ä»¥çœ‹å‡º binder_init() ä½¿ç”¨ misc_register() å‡½æ•°åˆ›å»ºäº† binder è®¾å¤‡ã€‚ä» misc_register(&amp;binder_miscdev); åŠ .name = â€œbinderâ€ å¯ä»¥çœ‹å‡ºï¼Œ binder å‘ kernel æ³¨å†Œäº†ä¸€ä¸ª /dev/binder çš„å­—ç¬¦è®¾å¤‡ï¼Œè€Œæ–‡ä»¶æ“ä½œéƒ½åœ¨ binder_fops ç»“æ„ä½“ä¸­å®šä¹‰ã€‚ 123456789static const struct file_operations binder_fops = &#123; .owner = THIS_MODULE, .poll = binder_poll, .unlocked_ioctl = binder_ioctl, .mmap = binder_mmap, .open = binder_open, .flush = binder_flush, .release = binder_release,&#125;; ä»ä¸Šé¢ binder_fops ç»“æ„ä½“å¯ä»¥çœ‹å‡ºï¼Œä¸»è¦çš„æ“ä½œæ˜¯ binder_ioctl() binder_mmap() binder_open() ç­‰å‡½æ•°å®ç°çš„ã€‚ 4.2 binder åè®®å’Œæ•°æ®ç»“æ„binder.h æ–‡ä»¶ä¸­å®šä¹‰äº† binder åè®®å’Œé‡è¦çš„æ•°æ®ç»“æ„ã€‚ é¦–å…ˆåœ¨ enum ä¸­å®šä¹‰äº† binder å¤„ç†çš„ç±»å‹ï¼Œå¼•ç”¨æˆ–æ˜¯å¥æŸ„ 1234567enum &#123; BINDER_TYPE_BINDER = B_PACK_CHARS('s', 'b', '*', B_TYPE_LARGE), BINDER_TYPE_WEAK_BINDER = B_PACK_CHARS('w', 'b', '*', B_TYPE_LARGE), BINDER_TYPE_HANDLE = B_PACK_CHARS('s', 'h', '*', B_TYPE_LARGE), BINDER_TYPE_WEAK_HANDLE = B_PACK_CHARS('w', 'h', '*', B_TYPE_LARGE), BINDER_TYPE_FD = B_PACK_CHARS('f', 'd', '*', B_TYPE_LARGE),&#125;; ä¸‹é¢è¿™æ®µå®å®šä¹‰åˆ™æ˜¯åœ¨ ioctl å‡½æ•°è°ƒç”¨æ—¶å¯ç”¨çš„å…·ä½“å‘½ä»¤ã€‚ 1234567#define BINDER_WRITE_READ _IOWR('b', 1, struct binder_write_read)#define BINDER_SET_IDLE_TIMEOUT _IOW('b', 3, int64_t)#define BINDER_SET_MAX_THREADS _IOW('b', 5, size_t)#define BINDER_SET_IDLE_PRIORITY _IOW('b', 6, int)#define BINDER_SET_CONTEXT_MGR _IOW('b', 7, int)#define BINDER_THREAD_EXIT _IOW('b', 8, int)#define BINDER_VERSION _IOWR('b', 9, struct binder_version) åœ¨ BinderDriverReturnProtocol å’Œ BinderDriverCommandProtocol ä¸­ åˆ™åˆ†åˆ«å®šä¹‰äº† å®¢æˆ·ç«¯è°ƒç”¨ å’Œ æœåŠ¡ç«¯ è¿”å›çš„å‘½ä»¤ã€‚ 4.3 binder é©±åŠ¨æ–‡ä»¶æ“ä½œä¸Šæ–‡å·²ç»æåˆ°ï¼Œæ‰€æœ‰çš„æ“ä½œå®šä¹‰åœ¨ binder_fops ç»“æ„ä½“ä¸­ï¼Œä¸‹é¢è®²è¿°è¿™äº›æ“ä½œã€‚ è®¾å¤‡çš„æ‰“å¼€ - binder_open() å‡½æ•° ç”¨æˆ·ç©ºé—´åœ¨æ‰“å¼€ /dev/binder è®¾å¤‡æ—¶ï¼Œé©±åŠ¨ä¼šå‡ºå‘ binder_open() å‡½æ•°çš„å“åº”ã€‚ 123456789101112131415161718192021222324252627282930313233static int binder_open(struct inode *nodp, struct file *filp)&#123; struct binder_proc *proc; // åˆ†é… binder_proc æ•°æ®ç»“æ„å†…å­˜ proc = kzalloc(sizeof(*proc), GFP_KERNEL); if (proc == NULL) return -ENOMEM; // å¢åŠ å½“å‰çº¿ç¨‹/è¿›ç¨‹çš„å¼•ç”¨è®¡æ•°å¹¶èµ‹å€¼ç»™tsk get_task_struct(current); proc-&gt;tsk = current; // åˆå§‹åŒ–é˜Ÿåˆ— INIT_LIST_HEAD(&amp;proc-&gt;todo); init_waitqueue_head(&amp;proc-&gt;wait); proc-&gt;default_priority = task_nice(current); binder_lock(__func__); // å¢åŠ BINDER_STAT_PROCçš„å¯¹è±¡è®¡æ•° binder_stats_created(BINDER_STAT_PROC); // æ·»åŠ  proc_node åˆ° binder_procs å…¨å±€åˆ—è¡¨ä¸­ï¼Œè¿™æ ·ä»»ä½•è¿›ç¨‹å°±å¯ä»¥è®¿é—®åˆ°å…¶ä»–è¿›ç¨‹çš„ binder_proc å¯¹è±¡äº† hlist_add_head(&amp;proc-&gt;proc_node, &amp;binder_procs); // ä¿å­˜è¿›ç¨‹ id proc-&gt;pid = current-&gt;group_leader-&gt;pid; INIT_LIST_HEAD(&amp;proc-&gt;delivered_death); // é©±åŠ¨æ–‡ä»¶ private_data æŒ‡å‘ proc filp-&gt;private_data = proc; binder_unlock(__func__); return 0;&#125; é©±åŠ¨æ–‡ä»¶é‡Šæ”¾ - binder_release() å‡½æ•° åœ¨ç”¨æˆ·ç©ºé—´å…³é—­é©±åŠ¨è®¾å¤‡æ–‡ä»¶æ—¶ï¼Œä¼šè°ƒç”¨ binder_release() å‡½æ•°ï¼Œæ¸…ç† binder_proc å¯¹è±¡ï¼Œé‡Šæ”¾å ç”¨çš„å†…å­˜ã€‚ 123456789101112131415161718192021static int binder_release(struct inode *nodp, struct file *filp)&#123; struct binder_proc *proc = filp-&gt;private_data; binder_defer_work(proc, BINDER_DEFERRED_RELEASE); return 0;&#125;static voidbinder_defer_work(struct binder_proc *proc, enum binder_deferred_state defer)&#123; mutex_lock(&amp;binder_deferred_lock); proc-&gt;deferred_work |= defer; if (hlist_unhashed(&amp;proc-&gt;deferred_work_node)) &#123; // æ·»åŠ åˆ°é‡Šæ”¾é˜Ÿåˆ—ä¸­ hlist_add_head(&amp;proc-&gt;deferred_work_node, &amp;binder_deferred_list); queue_work(binder_deferred_workqueue, &amp;binder_deferred_work); &#125; mutex_unlock(&amp;binder_deferred_lock);&#125; å†…å­˜æ˜ å°„ - binder_mmap() å‡½æ•° binder_mmap() å‡½æ•°æŠŠè®¾å¤‡å†…å­˜æ˜ å°„åˆ°ç”¨æˆ·è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥åƒæ“ä½œç”¨æˆ·å†…å­˜é‚£æ ·æ“ä½œè®¾å¤‡å†…å­˜ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475static int binder_mmap(struct file *filp, struct vm_area_struct *vma)&#123; int ret; struct vm_struct *area; // è·å¾— binder_proc å¯¹è±¡ struct binder_proc *proc = filp-&gt;private_data; const char *failure_string; struct binder_buffer *buffer; // æœ€å¤šåªåˆ†é… 4M çš„å†…å­˜ if ((vma-&gt;vm_end - vma-&gt;vm_start) &gt; SZ_4M) vma-&gt;vm_end = vma-&gt;vm_start + SZ_4M; // æ£€æŸ¥ flags if (vma-&gt;vm_flags &amp; FORBIDDEN_MMAP_FLAGS) &#123; ret = -EPERM; failure_string = \"bad vm_flags\"; goto err_bad_arg; &#125; vma-&gt;vm_flags = (vma-&gt;vm_flags | VM_DONTCOPY) &amp; ~VM_MAYWRITE; mutex_lock(&amp;binder_mmap_lock); // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜ å°„ if (proc-&gt;buffer) &#123; ret = -EBUSY; failure_string = \"already mapped\"; goto err_already_mapped; &#125; // ç”³è¯·å†…æ ¸è™šæ‹Ÿå†…å­˜ç©ºé—´ area = get_vm_area(vma-&gt;vm_end - vma-&gt;vm_start, VM_IOREMAP); if (area == NULL) &#123; ret = -ENOMEM; failure_string = \"get_vm_area\"; goto err_get_vm_area_failed; &#125; // å°†ç”³è¯·åˆ°çš„å†…å­˜åœ°å€ä¿å­˜åˆ° binder_proc å¯¹è±¡ä¸­ proc-&gt;buffer = area-&gt;addr; proc-&gt;user_buffer_offset = vma-&gt;vm_start - (uintptr_t)proc-&gt;buffer; mutex_unlock(&amp;binder_mmap_lock); // æ ¹æ®è¯·æ±‚åˆ°çš„å†…å­˜ç©ºé—´å¤§å°ï¼Œåˆ†é…ç»™ binder_proc å¯¹è±¡çš„ pagesï¼Œ ç”¨äºä¿å­˜æŒ‡å‘ç‰©ç†é¡µçš„æŒ‡é’ˆ proc-&gt;pages = kzalloc(sizeof(proc-&gt;pages[0]) * ((vma-&gt;vm_end - vma-&gt;vm_start) / PAGE_SIZE), GFP_KERNEL); if (proc-&gt;pages == NULL) &#123; ret = -ENOMEM; failure_string = \"alloc page array\"; goto err_alloc_pages_failed; &#125; proc-&gt;buffer_size = vma-&gt;vm_end - vma-&gt;vm_start; vma-&gt;vm_ops = &amp;binder_vm_ops; vma-&gt;vm_private_data = proc; // åˆ†é…ä¸€ä¸ªé¡µçš„ç‰©ç†å†…å­˜ if (binder_update_page_range(proc, 1, proc-&gt;buffer, proc-&gt;buffer + PAGE_SIZE, vma)) &#123; ret = -ENOMEM; failure_string = \"alloc small buf\"; goto err_alloc_small_buf_failed; &#125; // å†…å­˜æä¾›ç»™ binder_buffer buffer = proc-&gt;buffer; // åˆå§‹åŒ– proc-&gt;buffers é“¾è¡¨ INIT_LIST_HEAD(&amp;proc-&gt;buffers); // å°† binder_buffer å¯¹è±¡æ”¾å…¥åˆ° proc-&gt;buffers é“¾è¡¨ä¸­ list_add(&amp;buffer-&gt;entry, &amp;proc-&gt;buffers); buffer-&gt;free = 1; binder_insert_free_buffer(proc, buffer); proc-&gt;free_async_space = proc-&gt;buffer_size / 2; barrier(); proc-&gt;files = get_files_struct(proc-&gt;tsk); proc-&gt;vma = vma; proc-&gt;vma_vm_mm = vma-&gt;vm_mm; return 0;&#125; é©±åŠ¨å‘½ä»¤æ¥å£ - binder_ioctl() å‡½æ•° ç”¨æˆ·æ€ç¨‹åºè°ƒç”¨ ioctl ç³»ç»Ÿå‡½æ•°å‘ /dev/binder è®¾å¤‡å‘é€æ•°æ®æ—¶ï¼Œä¼šè§¦å‘ binder_ioctl() å‡½æ•°å“åº”ã€‚ ä¸Šæ–‡æ•°æ®ç»“æ„ä¸­å·²ç»æåˆ°äº† binder_ioctl å¯ä»¥å¤„ç†çš„ å‘½ä»¤ 12345678910// æ ¸å¿ƒå‘½ä»¤ï¼Œæ•°æ®çš„è¯»å†™#define BINDER_WRITE_READ _IOWR('b', 1, struct binder_write_read)// è®¾ç½®æœ€å¤§çº¿ç¨‹æ•°#define BINDER_SET_MAX_THREADS _IOW('b', 5, size_t)// è®¾ç½® context manager#define BINDER_SET_CONTEXT_MGR _IOW('b', 7, int)// çº¿ç¨‹é€€å‡ºå‘½ä»¤#define BINDER_THREAD_EXIT _IOW('b', 8, int)// binder é©±åŠ¨çš„ç‰ˆæœ¬#define BINDER_VERSION _IOWR('b', 9, struct binder_version) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117static long binder_ioctl(struct file *filp, unsigned int cmd, unsigned long arg)&#123; int ret; struct binder_proc *proc = filp-&gt;private_data; struct binder_thread *thread; unsigned int size = _IOC_SIZE(cmd); void __user *ubuf = (void __user *)arg; // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ ret = wait_event_interruptible(binder_user_error_wait, binder_stop_on_user_error &lt; 2); if (ret) goto err_unlocked; binder_lock(__func__); // è·å– binder_thread å¯¹è±¡ thread = binder_get_thread(proc); if (thread == NULL) &#123; ret = -ENOMEM; goto err; &#125; switch (cmd) &#123; case BINDER_WRITE_READ: &#123; struct binder_write_read bwr; if (size != sizeof(struct binder_write_read)) &#123; ret = -EINVAL; goto err; &#125; // ä»ç”¨æˆ·ç©ºé—´æ‹·è´ binder_write_read åˆ° binder é©±åŠ¨ï¼Œå‚¨å­˜åœ¨ bwr if (copy_from_user(&amp;bwr, ubuf, sizeof(bwr))) &#123; ret = -EFAULT; goto err; &#125; if (bwr.write_size &gt; 0) &#123; // æ‰§è¡Œå†™å…¥æ“ä½œ ret = binder_thread_write(proc, thread, (void __user *)bwr.write_buffer, bwr.write_size, &amp;bwr.write_consumed); if (ret &lt; 0) &#123; bwr.read_consumed = 0; if (copy_to_user(ubuf, &amp;bwr, sizeof(bwr))) ret = -EFAULT; goto err; &#125; &#125; if (bwr.read_size &gt; 0) &#123; // æ‰§è¡Œè¯»å–æ“ä½œ ret = binder_thread_read(proc, thread, (void __user *)bwr.read_buffer, bwr.read_size, &amp;bwr.read_consumed, filp-&gt;f_flags &amp; O_NONBLOCK); if (!list_empty(&amp;proc-&gt;todo)) wake_up_interruptible(&amp;proc-&gt;wait); if (ret &lt; 0) &#123; if (copy_to_user(ubuf, &amp;bwr, sizeof(bwr))) ret = -EFAULT; goto err; &#125; &#125; // æ“ä½œå®Œæˆåå°†æ•°æ®è¿”å›ç»™ç”¨æˆ·ç©ºé—´ if (copy_to_user(ubuf, &amp;bwr, sizeof(bwr))) &#123; ret = -EFAULT; goto err; &#125; break; &#125; case BINDER_SET_MAX_THREADS: // è®¾ç½®æœ€å¤§çº¿ç¨‹ï¼Œä»ç”¨æˆ·ç©ºé—´æ‹·è´æ•°æ®åˆ° proc-&gt;max_threads if (copy_from_user(&amp;proc-&gt;max_threads, ubuf, sizeof(proc-&gt;max_threads))) &#123; ret = -EINVAL; goto err; &#125; break; case BINDER_SET_CONTEXT_MGR: // æ£€æŸ¥æ˜¯å¦å·²ç»è®¾ç½® if (binder_context_mgr_node != NULL) &#123; ret = -EBUSY; goto err; &#125; // è®¾ç½® context manager ret = security_binder_set_context_mgr(proc-&gt;tsk); if (ret &lt; 0) goto err; if (binder_context_mgr_uid != -1) &#123; if (binder_context_mgr_uid != current-&gt;cred-&gt;euid) &#123; ret = -EPERM; goto err; &#125; &#125; else binder_context_mgr_uid = current-&gt;cred-&gt;euid; // åˆ›å»º binder_context_mgr_node èŠ‚ç‚¹ binder_context_mgr_node = binder_new_node(proc, NULL, NULL); if (binder_context_mgr_node == NULL) &#123; ret = -ENOMEM; goto err; &#125; // åˆå§‹åŒ–èŠ‚ç‚¹æ•°æ® binder_context_mgr_node-&gt;local_weak_refs++; binder_context_mgr_node-&gt;local_strong_refs++; binder_context_mgr_node-&gt;has_strong_ref = 1; binder_context_mgr_node-&gt;has_weak_ref = 1; break; case BINDER_THREAD_EXIT: // çº¿ç¨‹é€€å‡ºï¼Œé‡Šæ”¾èµ„æº binder_free_thread(proc, thread); thread = NULL; break; case BINDER_VERSION: // å°† binder é©±åŠ¨ç‰ˆæœ¬å·å†™å…¥åˆ°ç”¨æˆ·ç©ºé—´ ubuf-&gt;protocol_version ä¸­ if (put_user(BINDER_CURRENT_PROTOCOL_VERSION, &amp;((struct binder_version *)ubuf)-&gt;protocol_version)) &#123; ret = -EINVAL; goto err; &#125; break; default: ret = -EINVAL; goto err; &#125; ret = 0;...&#125; 123456789101112131415161718192021222324252627282930313233343536373839static struct binder_node *binder_new_node(struct binder_proc *proc, void __user *ptr, void __user *cookie)&#123; struct rb_node **p = &amp;proc-&gt;nodes.rb_node; struct rb_node *parent = NULL; struct binder_node *node; // æŸ¥æ‰¾è¦æ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ while (*p) &#123; parent = *p; node = rb_entry(parent, struct binder_node, rb_node); if (ptr &lt; node-&gt;ptr) p = &amp;(*p)-&gt;rb_left; else if (ptr &gt; node-&gt;ptr) p = &amp;(*p)-&gt;rb_right; else return NULL; &#125; // ä¸ºè¦æ’å…¥èŠ‚ç‚¹åˆ†é…å†…å­˜ç©ºé—´ node = kzalloc(sizeof(*node), GFP_KERNEL); if (node == NULL) return NULL; binder_stats_created(BINDER_STAT_NODE); // æ’å…¥èŠ‚ç‚¹ rb_link_node(&amp;node-&gt;rb_node, parent, p); rb_insert_color(&amp;node-&gt;rb_node, &amp;proc-&gt;nodes); // åˆå§‹åŒ– node-&gt;debug_id = ++binder_last_id; node-&gt;proc = proc; node-&gt;ptr = ptr; node-&gt;cookie = cookie; node-&gt;work.type = BINDER_WORK_NODE; INIT_LIST_HEAD(&amp;node-&gt;work.entry); INIT_LIST_HEAD(&amp;node-&gt;async_todo); return node;&#125; BINDER_WRITE_READ å¤„ç†è¿‡ç¨‹ åœ¨ binder æœ¬åœ°å±‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨ IPCThreadState::talkWithDriver() å‡½æ•°ä¸­ï¼Œ binder æœ¬åœ°å±‚é€šè¿‡ ioctl()(mProcess-&gt;mDriverFD, BINDER_WRITE_READ, &amp;bwr) å‘½ä»¤çš„å½¢å¼ï¼Œä¸ binder é©±åŠ¨äº¤äº’ã€‚ å¯ä»¥çœ‹å‡º ioctl() çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª binder_write_read ç»“æ„ä½“ binder.h å¤´æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ•°æ®ç±»å‹, ä¸€ä¸ªæ˜¯ binder_write_read 12345678struct binder_write_read &#123; signed long write_size; /* bytes to write */ signed long write_consumed; /* bytes consumed by driver */ unsigned long write_buffer; signed long read_size; /* bytes to read */ signed long read_consumed; /* bytes consumed by driver */ unsigned long read_buffer;&#125;; å…¶ä¸­ write_size å’Œ read_size è¡¨ç¤ºéœ€è¦è¢«è¯»å†™çš„å­—èŠ‚æ•°ï¼Œ write_consumed å’Œ read_consumed è¡¨ç¤ºå·²ç»è¢« binder é©±åŠ¨è¯»å†™çš„å­—èŠ‚æ•°ï¼Œ write_buffer å’Œ read_buffer åˆ™æ˜¯æŒ‡å‘è¢«è¯»å†™æ•°æ®çš„æŒ‡é’ˆã€‚ å…·ä½“çš„è¯»å†™æ“ä½œè¢« binder_thread_write å’Œ binder_thread_read å®ç°ã€‚ æ•°æ®å†™å…¥ - binder_thread_write() å‡½æ•° å°†ç”¨æˆ·ç©ºé—´æ•°æ®å†™å…¥åˆ° binder é©±åŠ¨ï¼Œä»é©±åŠ¨è§’åº¦æ¥çœ‹æ˜¯è¯»å–çš„æ“ä½œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353int binder_thread_write(struct binder_proc *proc, struct binder_thread *thread, void __user *buffer, int size, signed long *consumed)&#123; uint32_t cmd; // ç”¨æˆ·ç©ºé—´æ•°æ®ï¼Œèµ·å§‹åœ°å€å’Œç»“æŸåœ°å€ void __user *ptr = buffer + *consumed; void __user *end = buffer + size; // å¾ªç¯è¯»å– while (ptr &lt; end &amp;&amp; thread-&gt;return_error == BR_OK) &#123; // ä»ç”¨æˆ·ç©ºé—´è·å–æ“ä½œå‘½ä»¤ if (get_user(cmd, (uint32_t __user *)ptr)) return -EFAULT; ptr += sizeof(uint32_t); if (_IOC_NR(cmd) &lt; ARRAY_SIZE(binder_stats.bc)) &#123; // å¢åŠ å‘½ä»¤è®¡æ•°å™¨ binder_stats.bc[_IOC_NR(cmd)]++; proc-&gt;stats.bc[_IOC_NR(cmd)]++; thread-&gt;stats.bc[_IOC_NR(cmd)]++; &#125; switch (cmd) &#123; // è¿™å››ä¸ªå‘½ä»¤ç”¨æ¥å¢åŠ æˆ–å‡å°‘å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œ æ“ä½œç›®æ ‡ binder_ref case BC_INCREFS: case BC_ACQUIRE: case BC_RELEASE: case BC_DECREFS: &#123; uint32_t target; struct binder_ref *ref; const char *debug_string; // è·å–ç›®æ ‡è¿›ç¨‹èŠ‚ç‚¹æè¿° desc if (get_user(target, (uint32_t __user *)ptr)) return -EFAULT; ptr += sizeof(uint32_t); // ç´¢æè¿°ä¸º 0 è¡¨ç¤º context manager è¿›ç¨‹ if (target == 0 &amp;&amp; binder_context_mgr_node &amp;&amp; (cmd == BC_INCREFS || cmd == BC_ACQUIRE)) &#123; // åœ¨ proc-&gt;refs_by_node.rb_node çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾å¼•ç”¨ ref = binder_get_ref_for_node(proc, binder_context_mgr_node); &#125; else // åœ¨ proc-&gt;refs_by_desc.rb_node çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾å¼•ç”¨ ref = binder_get_ref(proc, target); switch (cmd) &#123; case BC_INCREFS: debug_string = \"IncRefs\"; // å¢åŠ å¼±å¼•ç”¨è®¡æ•° binder_inc_ref(ref, 0, NULL); break; case BC_ACQUIRE: debug_string = \"Acquire\"; // å¢åŠ å¼ºå¼•ç”¨è®¡æ•° binder_inc_ref(ref, 1, NULL); break; case BC_RELEASE: debug_string = \"Release\"; // å‡å°‘å¼ºå¼•ç”¨è®¡æ•° binder_dec_ref(ref, 1); break; case BC_DECREFS: default: debug_string = \"DecRefs\"; // å‡å°‘å¼±å¼•ç”¨è®¡æ•° binder_dec_ref(ref, 0); break; &#125; break; &#125; case BC_INCREFS_DONE: case BC_ACQUIRE_DONE: &#123; void __user *node_ptr; void *cookie; struct binder_node *node; // ä»ç”¨æˆ·ç©ºé—´è¯»å– node_ptr if (get_user(node_ptr, (void * __user *)ptr)) return -EFAULT; ptr += sizeof(void *); // ä»ç”¨æˆ·ç©ºé—´è¯»å– cookie if (get_user(cookie, (void * __user *)ptr)) return -EFAULT; ptr += sizeof(void *); // è·å¾—èŠ‚ç‚¹ node = binder_get_node(proc, node_ptr); // æ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å› if (node == NULL) &#123; binder_user_error(\"binder: %d:%d \" \"%s u%p no match\\n\", proc-&gt;pid, thread-&gt;pid, cmd == BC_INCREFS_DONE ? \"BC_INCREFS_DONE\" : \"BC_ACQUIRE_DONE\", node_ptr); break; &#125; // cookie ä¸åŒ¹é…åˆ™è¿”å› if (cookie != node-&gt;cookie) &#123; binder_user_error(\"binder: %d:%d %s u%p node %d\" \" cookie mismatch %p != %p\\n\", proc-&gt;pid, thread-&gt;pid, cmd == BC_INCREFS_DONE ? \"BC_INCREFS_DONE\" : \"BC_ACQUIRE_DONE\", node_ptr, node-&gt;debug_id, cookie, node-&gt;cookie); break; &#125; if (cmd == BC_ACQUIRE_DONE) &#123; node-&gt;pending_strong_ref = 0; &#125; else &#123; node-&gt;pending_weak_ref = 0; &#125; // å‡å°‘èŠ‚ç‚¹ä½¿ç”¨è®¡æ•° binder_dec_node(node, cmd == BC_ACQUIRE_DONE, 0); break; &#125; // é‡Šæ”¾ binder_bffer case BC_FREE_BUFFER: &#123; void __user *data_ptr; struct binder_buffer *buffer; // ä»ç”¨æˆ·ç©ºé—´è·å– data_ptr if (get_user(data_ptr, (void * __user *)ptr)) return -EFAULT; ptr += sizeof(void *); // æŸ¥æ‰¾ binder_buffer buffer = binder_buffer_lookup(proc, data_ptr); // æ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å› if (buffer == NULL) &#123; binder_user_error(\"binder: %d:%d \" \"BC_FREE_BUFFER u%p no match\\n\", proc-&gt;pid, thread-&gt;pid, data_ptr); break; &#125; // ä¸å…è®¸ç”¨æˆ·é‡Šæ”¾åˆ™è¿”å› if (!buffer-&gt;allow_user_free) &#123; binder_user_error(\"binder: %d:%d \" \"BC_FREE_BUFFER u%p matched \" \"unreturned buffer\\n\", proc-&gt;pid, thread-&gt;pid, data_ptr); break; &#125; // å°† buffer-&gt;transaction ç½®ç©º if (buffer-&gt;transaction) &#123; buffer-&gt;transaction-&gt;buffer = NULL; buffer-&gt;transaction = NULL; &#125; if (buffer-&gt;async_transaction &amp;&amp; buffer-&gt;target_node) &#123; if (list_empty(&amp;buffer-&gt;target_node-&gt;async_todo)) buffer-&gt;target_node-&gt;has_async_transaction = 0; else list_move_tail(buffer-&gt;target_node-&gt;async_todo.next, &amp;thread-&gt;todo); &#125; // é‡Šæ”¾ binder_buffer å¯¹è±¡ trace_binder_transaction_buffer_release(buffer); binder_transaction_buffer_release(proc, buffer, NULL); binder_free_buf(proc, buffer); break; &#125; // binder æ•°æ®ä¼ é€’å¤„ç† case BC_TRANSACTION: case BC_REPLY: &#123; struct binder_transaction_data tr; // ä»ç”¨æˆ·ç©ºé—´æ‹·è´ binder_transaction_data å¯¹è±¡ if (copy_from_user(&amp;tr, ptr, sizeof(tr))) return -EFAULT; ptr += sizeof(tr); // å®é™…çš„ä¼ è¾“å‡½æ•°ï¼Œåœ¨ä¸‹æ–‡è®²è§£ binder_transaction(proc, thread, &amp;tr, cmd == BC_REPLY); break; &#125; // è®¾ç½® looper ä¸º BINDER_LOOPER_STATE_REGISTERED çŠ¶æ€ case BC_REGISTER_LOOPER: if (thread-&gt;looper &amp; BINDER_LOOPER_STATE_ENTERED) &#123; thread-&gt;looper |= BINDER_LOOPER_STATE_INVALID; binder_user_error(\"binder: %d:%d ERROR:\" \" BC_REGISTER_LOOPER called \" \"after BC_ENTER_LOOPER\\n\", proc-&gt;pid, thread-&gt;pid); &#125; else if (proc-&gt;requested_threads == 0) &#123; thread-&gt;looper |= BINDER_LOOPER_STATE_INVALID; binder_user_error(\"binder: %d:%d ERROR:\" \" BC_REGISTER_LOOPER called \" \"without request\\n\", proc-&gt;pid, thread-&gt;pid); &#125; else &#123; proc-&gt;requested_threads--; proc-&gt;requested_threads_started++; &#125; thread-&gt;looper |= BINDER_LOOPER_STATE_REGISTERED; break; // è®¾ç½® looper ä¸º BINDER_LOOPER_STATE_ENTERED çŠ¶æ€ case BC_ENTER_LOOPER: if (thread-&gt;looper &amp; BINDER_LOOPER_STATE_REGISTERED) &#123; thread-&gt;looper |= BINDER_LOOPER_STATE_INVALID; binder_user_error(\"binder: %d:%d ERROR:\" \" BC_ENTER_LOOPER called after \" \"BC_REGISTER_LOOPER\\n\", proc-&gt;pid, thread-&gt;pid); &#125; thread-&gt;looper |= BINDER_LOOPER_STATE_ENTERED; break; // è®¾ç½® looper ä¸º BINDER_LOOPER_STATE_EXITED çŠ¶æ€ case BC_EXIT_LOOPER: thread-&gt;looper |= BINDER_LOOPER_STATE_EXITED; break; // å‘é€ REQUEST_DEATH æˆ– CLEAR_DEATH é€šçŸ¥ case BC_REQUEST_DEATH_NOTIFICATION: case BC_CLEAR_DEATH_NOTIFICATION: &#123; uint32_t target; void __user *cookie; struct binder_ref *ref; struct binder_ref_death *death; // ä»ç”¨æˆ·ç©ºé—´è·å– binder_ref æè¿° desc if (get_user(target, (uint32_t __user *)ptr)) return -EFAULT; ptr += sizeof(uint32_t); // ä»ç”¨æˆ·ç©ºé—´è·å– cookie if (get_user(cookie, (void __user * __user *)ptr)) return -EFAULT; ptr += sizeof(void *); // è·å– binder_ref å¼•ç”¨ ref = binder_get_ref(proc, target); if (ref == NULL) &#123; binder_user_error(\"binder: %d:%d %s \" \"invalid ref %d\\n\", proc-&gt;pid, thread-&gt;pid, cmd == BC_REQUEST_DEATH_NOTIFICATION ? \"BC_REQUEST_DEATH_NOTIFICATION\" : \"BC_CLEAR_DEATH_NOTIFICATION\", target); break; &#125; if (cmd == BC_REQUEST_DEATH_NOTIFICATION) &#123; if (ref-&gt;death) &#123; binder_user_error(\"binder: %d:%\" \"d BC_REQUEST_DEATH_NOTI\" \"FICATION death notific\" \"ation already set\\n\", proc-&gt;pid, thread-&gt;pid); break; &#125; // ä¸º binder_ref_death å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´ death = kzalloc(sizeof(*death), GFP_KERNEL); if (death == NULL) &#123; thread-&gt;return_error = BR_ERROR; break; &#125; // åˆå§‹åŒ– binder_ref_death å¯¹è±¡ binder_stats_created(BINDER_STAT_DEATH); INIT_LIST_HEAD(&amp;death-&gt;work.entry); death-&gt;cookie = cookie; ref-&gt;death = death; if (ref-&gt;node-&gt;proc == NULL) &#123; ref-&gt;death-&gt;work.type = BINDER_WORK_DEAD_BINDER; if (thread-&gt;looper &amp; (BINDER_LOOPER_STATE_REGISTERED | BINDER_LOOPER_STATE_ENTERED)) &#123; list_add_tail(&amp;ref-&gt;death-&gt;work.entry, &amp;thread-&gt;todo); &#125; else &#123; list_add_tail(&amp;ref-&gt;death-&gt;work.entry, &amp;proc-&gt;todo); // å”¤é†’ç›®æ ‡è¿›ç¨‹ wake_up_interruptible(&amp;proc-&gt;wait); &#125; &#125; &#125; else &#123; if (ref-&gt;death == NULL) &#123; binder_user_error(\"binder: %d:%\" \"d BC_CLEAR_DEATH_NOTIFI\" \"CATION death notificat\" \"ion not active\\n\", proc-&gt;pid, thread-&gt;pid); break; &#125; death = ref-&gt;death; if (death-&gt;cookie != cookie) &#123; binder_user_error(\"binder: %d:%\" \"d BC_CLEAR_DEATH_NOTIFI\" \"CATION death notificat\" \"ion cookie mismatch \" \"%p != %p\\n\", proc-&gt;pid, thread-&gt;pid, death-&gt;cookie, cookie); break; &#125; // å°† ref-&gt;death ç½®ç©º ref-&gt;death = NULL; if (list_empty(&amp;death-&gt;work.entry)) &#123; death-&gt;work.type = BINDER_WORK_CLEAR_DEATH_NOTIFICATION; if (thread-&gt;looper &amp; (BINDER_LOOPER_STATE_REGISTERED | BINDER_LOOPER_STATE_ENTERED)) &#123; list_add_tail(&amp;death-&gt;work.entry, &amp;thread-&gt;todo); &#125; else &#123; list_add_tail(&amp;death-&gt;work.entry, &amp;proc-&gt;todo); // å”¤é†’ç›®æ ‡è¿›ç¨‹ wake_up_interruptible(&amp;proc-&gt;wait); &#125; &#125; else &#123; BUG_ON(death-&gt;work.type != BINDER_WORK_DEAD_BINDER); death-&gt;work.type = BINDER_WORK_DEAD_BINDER_AND_CLEAR; &#125; &#125; &#125; break; case BC_DEAD_BINDER_DONE: &#123; struct binder_work *w; void __user *cookie; struct binder_ref_death *death = NULL; // ä»ç”¨æˆ·ç©ºé—´è·å– cookie if (get_user(cookie, (void __user * __user *)ptr)) return -EFAULT; ptr += sizeof(void *); list_for_each_entry(w, &amp;proc-&gt;delivered_death, entry) &#123; struct binder_ref_death *tmp_death = container_of(w, struct binder_ref_death, work); if (tmp_death-&gt;cookie == cookie) &#123; death = tmp_death; break; &#125; &#125; if (death == NULL) &#123; binder_user_error(\"binder: %d:%d BC_DEAD\" \"_BINDER_DONE %p not found\\n\", proc-&gt;pid, thread-&gt;pid, cookie); break; &#125; list_del_init(&amp;death-&gt;work.entry); // å¦‚æœ death-&gt;work.t ä¸º BINDER_WORK_DEAD_BINDER_AND_CLEAR åˆ™ä¿®æ”¹ä¸º BINDER_WORK_CLEAR_DEATH_NOTIFICATION if (death-&gt;work.t == BINDER_WORK_DEAD_BINDER_AND_CLEAR ) &#123; death-&gt;work.type = BINDER_WORK_CLEAR_DEATH_NOTIFICATION; if (thread-&gt;looper &amp; (BINDER_LOOPER_STATE_REGISTERED | BINDER_LOOPER_STATE_ENTERED)) &#123; list_add_tail(&amp;death-&gt;work.entry, &amp;thread-&gt;todo); &#125; else &#123; list_add_tail(&amp;death-&gt;work.entry, &amp;proc-&gt;todo); // å”¤é†’ç›®æ ‡è¿›ç¨‹ wake_up_interruptible(&amp;proc-&gt;wait); &#125; &#125; &#125; break; default: return -EINVAL; &#125; *consumed = ptr - buffer; &#125; return 0;&#125; binder_transaction() å‡½æ•° åœ¨ä¸Šæ–‡å¤„ç† BC_TRANSACTION å’Œ BC_REPLY æ—¶ï¼Œè°ƒç”¨äº† binder_transaction() å‡½æ•°ã€‚æˆ‘ä»¬ç»§ç»­è¿½è¸ª 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202static void binder_transaction(struct binder_proc *proc, struct binder_thread *thread, struct binder_transaction_data *tr, int reply)&#123; struct binder_transaction *t; struct binder_work *tcomplete; size_t *offp, *off_end; struct binder_proc *target_proc; struct binder_thread *target_thread = NULL; struct binder_node *target_node = NULL; struct list_head *target_list; wait_queue_head_t *target_wait; struct binder_transaction *in_reply_to = NULL; if (reply) &#123; // BC_REPLY å¤„ç†æµç¨‹ // å¾—åˆ° binder_transaction å¯¹è±¡ in_reply_to = thread-&gt;transaction_stack; if (in_reply_to == NULL) &#123; return_error = BR_FAILED_REPLY; goto err_empty_call_stack; &#125; binder_set_nice(in_reply_to-&gt;saved_priority); thread-&gt;transaction_stack = in_reply_to-&gt;to_parent; // è·å–ç›®æ ‡çº¿ç¨‹ target_thread = in_reply_to-&gt;from; target_proc = target_thread-&gt;proc; &#125; else &#123; // BC_TRANSACTION å¤„ç†æµç¨‹ // æŸ¥æ‰¾ç›®æ ‡èŠ‚ç‚¹ if (tr-&gt;target.handle) &#123; struct binder_ref *ref; // è·å– binder_ref å¯¹è±¡ ref = binder_get_ref(proc, tr-&gt;target.handle); target_node = ref-&gt;node; &#125; else &#123; // ç´¢å¼•ä¸º 0 åˆ™è¿”å› context manager target_node = binder_context_mgr_node; &#125; // å¾—åˆ°ç›®æ ‡è¿›ç¨‹ target_proc = target_node-&gt;proc; if (!(tr-&gt;flags &amp; TF_ONE_WAY) &amp;&amp; thread-&gt;transaction_stack) &#123; struct binder_transaction *tmp; tmp = thread-&gt;transaction_stack; while (tmp) &#123; if (tmp-&gt;from &amp;&amp; tmp-&gt;from-&gt;proc == target_proc) // è·å¾—ç›®æ ‡çº¿ç¨‹ target_thread = tmp-&gt;from; tmp = tmp-&gt;from_parent; &#125; &#125; &#125; // è®¾ç½®è¦å¤„ç†çš„ç›®æ ‡è¿›ç¨‹æˆ–ç›®æ ‡çº¿ç¨‹ä»»åŠ¡ if (target_thread) &#123; target_list = &amp;target_thread-&gt;todo; target_wait = &amp;target_thread-&gt;wait; &#125; else &#123; target_list = &amp;target_proc-&gt;todo; target_wait = &amp;target_proc-&gt;wait; &#125; // ä¸º binder_transaction å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´ t = kzalloc(sizeof(*t), GFP_KERNEL); binder_stats_created(BINDER_STAT_TRANSACTION); tcomplete = kzalloc(sizeof(*tcomplete), GFP_KERNEL); binder_stats_created(BINDER_STAT_TRANSACTION_COMPLETE); // å¦‚æœæ˜¯åŒæ­¥ä¼ è¾“(åŒå‘)ï¼Œåˆ™å°†å½“å‰çš„ binder_thread å¯¹è±¡ä¿å­˜åœ¨ binder_transaction å¯¹è±¡çš„ from ä¸­ã€‚ if (!reply &amp;&amp; !(tr-&gt;flags &amp; TF_ONE_WAY)) t-&gt;from = thread; else t-&gt;from = NULL; // è®¾ç½® binder_transaction å¯¹è±¡ t-&gt;sender_euid = proc-&gt;tsk-&gt;cred-&gt;euid; t-&gt;to_proc = target_proc; t-&gt;to_thread = target_thread; t-&gt;code = tr-&gt;code; t-&gt;flags = tr-&gt;flags; t-&gt;priority = task_nice(current); // ä¸º binder_buffer åˆ†é…å†…å­˜ç©ºé—´ t-&gt;buffer = binder_alloc_buf(target_proc, tr-&gt;data_size, tr-&gt;offsets_size, !reply &amp;&amp; (t-&gt;flags &amp; TF_ONE_WAY)); // è®¾ç½® binder_buffer t-&gt;buffer-&gt;allow_user_free = 0; t-&gt;buffer-&gt;debug_id = t-&gt;debug_id; t-&gt;buffer-&gt;transaction = t; t-&gt;buffer-&gt;target_node = target_node; if (target_node) binder_inc_node(target_node, 1, 0, NULL); offp = (size_t *)(t-&gt;buffer-&gt;data + ALIGN(tr-&gt;data_size, sizeof(void *))); // ä»ç”¨æˆ·ç©ºé—´æ‹·è´æ•°æ®åˆ° binder_buffer if (copy_from_user(t-&gt;buffer-&gt;data, tr-&gt;data.ptr.buffer, tr-&gt;data_size)) &#123; return_error = BR_FAILED_REPLY; goto err_copy_data_failed; &#125; if (copy_from_user(offp, tr-&gt;data.ptr.offsets, tr-&gt;offsets_size)) &#123; return_error = BR_FAILED_REPLY; goto err_copy_data_failed; &#125; off_end = (void *)offp + tr-&gt;offsets_size; for (; offp &lt; off_end; offp++) &#123; struct flat_binder_object *fp; // ä¸º flat_binder_object èµ‹å€¼ fp = (struct flat_binder_object *)(t-&gt;buffer-&gt;data + *offp); // è½¬æ¢ binder ç±»å‹ï¼Œå¦‚æœæ˜¯ BINDER åˆ™è½¬æ¢ä¸º HANDLEï¼Œ å¦‚æœæ˜¯ HANDLE åˆ™è½¬ä¸º BANDLE switch (fp-&gt;type) &#123; case BINDER_TYPE_BINDER: case BINDER_TYPE_WEAK_BINDER: &#123; struct binder_ref *ref; // è·å– binder_node èŠ‚ç‚¹ struct binder_node *node = binder_get_node(proc, fp-&gt;binder); if (node == NULL) &#123; node = binder_new_node(proc, fp-&gt;binder, fp-&gt;cookie); if (node == NULL) &#123; return_error = BR_FAILED_REPLY; goto err_binder_new_node_failed; &#125; node-&gt;min_priority = fp-&gt;flags &amp; FLAT_BINDER_FLAG_PRIORITY_MASK; node-&gt;accept_fds = !!(fp-&gt;flags &amp; FLAT_BINDER_FLAG_ACCEPTS_FDS); &#125; if (fp-&gt;cookie != node-&gt;cookie) &#123; goto err_binder_get_ref_for_node_failed; &#125; // è·å– binder_ref å¯¹è±¡ ref = binder_get_ref_for_node(target_proc, node); // è½¬æ¢ç±»å‹ if (fp-&gt;type == BINDER_TYPE_BINDER) fp-&gt;type = BINDER_TYPE_HANDLE; else fp-&gt;type = BINDER_TYPE_WEAK_HANDLE; fp-&gt;handle = ref-&gt;desc; binder_inc_ref(ref, fp-&gt;type == BINDER_TYPE_HANDLE, &amp;thread-&gt;todo); &#125; break; case BINDER_TYPE_HANDLE: case BINDER_TYPE_WEAK_HANDLE: &#123; // è·å– binder_ref å¯¹è±¡ struct binder_ref*ref = binder_get_ref(proc, fp-&gt;handle); // è½¬æ¢ç±»å‹ if (ref-&gt;node-&gt;proc == target_proc) &#123; if (fp-&gt;type == BINDER_TYPE_HANDLE) fp-&gt;type = BINDER_TYPE_BINDER; else fp-&gt;type = BINDER_TYPE_WEAK_BINDER; fp-&gt;binder = ref-&gt;node-&gt;ptr; fp-&gt;cookie = ref-&gt;node-&gt;cookie; binder_inc_node(ref-&gt;node, fp-&gt;type == BINDER_TYPE_BINDER, 0, NULL); &#125; else &#123; struct binder_ref *new_ref; new_ref = binder_get_ref_for_node(target_proc, ref-&gt;node); fp-&gt;handle = new_ref-&gt;desc; binder_inc_ref(new_ref, fp-&gt;type == BINDER_TYPE_HANDLE, NULL); &#125; &#125; break; // æ–‡ä»¶ç±»å‹ case BINDER_TYPE_FD: &#123; int target_fd; struct file *file; // è·å¾—æ–‡ä»¶å¯¹è±¡ file = fget(fp-&gt;handle); // åˆ†é…ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ target_fd = task_get_unused_fd_flags(target_proc, O_CLOEXEC); task_fd_install(target_proc, target_fd, file); fp-&gt;handle = target_fd; &#125; break; default: return_error = BR_FAILED_REPLY; goto err_bad_object_type; &#125; &#125; if (reply) &#123; // BC_REPLY å¤„ç†æµç¨‹, binder_transaction ä¸­é‡Šæ”¾ binder_transaction å¯¹è±¡ binder_pop_transaction(target_thread, in_reply_to); &#125; else if (!(t-&gt;flags &amp; TF_ONE_WAY)) &#123; // åŒæ­¥çŠ¶æ€(åŒå‘)éœ€è¦è®¾ç½®å›å¤ t-&gt;need_reply = 1; t-&gt;from_parent = thread-&gt;transaction_stack; thread-&gt;transaction_stack = t; &#125; else &#123; // å¼‚æ­¥ä¼ è¾“ä¸éœ€è¦è®¾ç½®å›å¤ if (target_node-&gt;has_async_transaction) &#123; target_list = &amp;target_node-&gt;async_todo; target_wait = NULL; &#125; else target_node-&gt;has_async_transaction = 1; &#125; t-&gt;work.type = BINDER_WORK_TRANSACTION; list_add_tail(&amp;t-&gt;work.entry, target_list); tcomplete-&gt;type = BINDER_WORK_TRANSACTION_COMPLETE; list_add_tail(&amp;tcomplete-&gt;entry, &amp;thread-&gt;todo); if (target_wait) // å”¤é†’ç›®æ ‡çº¿ç¨‹ wake_up_interruptible(target_wait); return;&#125; æ•°æ®è¯»å– - binder_thread_read() å‡½æ•° ç”¨æˆ·ç©ºé—´ä» binder é©±åŠ¨è¯»å–æ•°æ®ï¼Œä»é©±åŠ¨è§’åº¦æ¥çœ‹æ˜¯å†™å‡ºçš„æ“ä½œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251static int binder_thread_read(struct binder_proc *proc, struct binder_thread *thread, void __user *buffer, int size, signed long *consumed, int non_block)&#123; void __user *ptr = buffer + *consumed; void __user *end = buffer + size; int ret = 0; int wait_for_proc_work; if (*consumed == 0) &#123; // ç¬¬ä¸€æ¬¡æ“ä½œæ—¶å‘ç”¨æˆ·ç©ºé—´è¿”å› BR_NOOP å‘½ä»¤ if (put_user(BR_NOOP, (uint32_t __user *)ptr)) return -EFAULT; ptr += sizeof(uint32_t); &#125;retry: // è·å–å°†è¦å¤„ç†çš„ä»»åŠ¡ wait_for_proc_work = thread-&gt;transaction_stack == NULL &amp;&amp; list_empty(&amp;thread-&gt;todo); if (wait_for_proc_work) &#123; if (!(thread-&gt;looper &amp; (BINDER_LOOPER_STATE_REGISTERED | BINDER_LOOPER_STATE_ENTERED))) &#123; binder_user_error(\"binder: %d:%d ERROR: Thread waiting \" \"for process work before calling BC_REGISTER_\" \"LOOPER or BC_ENTER_LOOPER (state %x)\\n\", proc-&gt;pid, thread-&gt;pid, thread-&gt;looper); wait_event_interruptible(binder_user_error_wait, binder_stop_on_user_error &lt; 2); &#125; binder_set_nice(proc-&gt;default_priority); if (non_block) &#123; // éé˜»å¡ä¸”æ²¡æœ‰æ•°æ®åˆ™è¿”å› EAGAIN if (!binder_has_proc_work(proc, thread)) ret = -EAGAIN; &#125; else // é˜»å¡åˆ™è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç­‰å¾…å¯æ“ä½œçš„ä»»åŠ¡ ret = wait_event_freezable_exclusive(proc-&gt;wait, binder_has_proc_work(proc, thread)); &#125; else &#123; if (non_block) &#123; if (!binder_has_thread_work(thread)) ret = -EAGAIN; &#125; else ret = wait_event_freezable(thread-&gt;wait, binder_has_thread_work(thread)); &#125; binder_lock(__func__); if (wait_for_proc_work) proc-&gt;ready_threads--; thread-&gt;looper &amp;= ~BINDER_LOOPER_STATE_WAITING; if (ret) return ret; while (1) &#123; uint32_t cmd; struct binder_transaction_data tr; struct binder_work *w; struct binder_transaction *t = NULL; // è·å– binder_work å¯¹è±¡ if (!list_empty(&amp;thread-&gt;todo)) w = list_first_entry(&amp;thread-&gt;todo, struct binder_work, entry); else if (!list_empty(&amp;proc-&gt;todo) &amp;&amp; wait_for_proc_work) w = list_first_entry(&amp;proc-&gt;todo, struct binder_work, entry); else &#123; if (ptr - buffer == 4 &amp;&amp; !(thread-&gt;looper &amp; BINDER_LOOPER_STATE_NEED_RETURN)) /* no data added */ goto retry; break; &#125; if (end - ptr &lt; sizeof(tr) + 4) break; switch (w-&gt;type) &#123; case BINDER_WORK_TRANSACTION: &#123; // è·å– binder_transaction å¯¹è±¡ t = container_of(w, struct binder_transaction, work); &#125; break; case BINDER_WORK_TRANSACTION_COMPLETE: &#123; cmd = BR_TRANSACTION_COMPLETE; // è¿”å› BR_TRANSACTION_COMPLETE å‘½ä»¤ if (put_user(cmd, (uint32_t __user *)ptr)) return -EFAULT; ptr += sizeof(uint32_t); binder_stat_br(proc, thread, cmd); // ä» work é“¾è¡¨ä¸­åˆ é™¤å¹¶é‡Šæ”¾å†…å­˜ list_del(&amp;w-&gt;entry); kfree(w); binder_stats_deleted(BINDER_STAT_TRANSACTION_COMPLETE); &#125; break; case BINDER_WORK_NODE: &#123; // è·å¾— binder_node èŠ‚ç‚¹ struct binder_node *node = container_of(w, struct binder_node, work); uint32_t cmd = BR_NOOP; const char *cmd_name; // æ ¹æ®èŠ‚ç‚¹ç±»å‹ï¼Œå¢åŠ /è·å–ã€å‡å°‘/é‡Šæ”¾èŠ‚ç‚¹ç´¢å¼• int strong = node-&gt;internal_strong_refs || node-&gt;local_strong_refs; int weak = !hlist_empty(&amp;node-&gt;refs) || node-&gt;local_weak_refs || strong; // æ„é€  BR_* å‘½ä»¤ if (weak &amp;&amp; !node-&gt;has_weak_ref) &#123; cmd = BR_INCREFS; cmd_name = \"BR_INCREFS\"; node-&gt;has_weak_ref = 1; node-&gt;pending_weak_ref = 1; node-&gt;local_weak_refs++; &#125; else if (strong &amp;&amp; !node-&gt;has_strong_ref) &#123; cmd = BR_ACQUIRE; cmd_name = \"BR_ACQUIRE\"; node-&gt;has_strong_ref = 1; node-&gt;pending_strong_ref = 1; node-&gt;local_strong_refs++; &#125; else if (!strong &amp;&amp; node-&gt;has_strong_ref) &#123; cmd = BR_RELEASE; cmd_name = \"BR_RELEASE\"; node-&gt;has_strong_ref = 0; &#125; else if (!weak &amp;&amp; node-&gt;has_weak_ref) &#123; cmd = BR_DECREFS; cmd_name = \"BR_DECREFS\"; node-&gt;has_weak_ref = 0; &#125; // å‘ç”¨æˆ·ç©ºé—´è¿”å›å‘½ä»¤ if (cmd != BR_NOOP) &#123; if (put_user(cmd, (uint32_t __user *)ptr)) return -EFAULT; ptr += sizeof(uint32_t); if (put_user(node-&gt;ptr, (void * __user *)ptr)) return -EFAULT; ptr += sizeof(void *); if (put_user(node-&gt;cookie, (void * __user *)ptr)) return -EFAULT; ptr += sizeof(void *); binder_stat_br(proc, thread, cmd); &#125; else &#123; list_del_init(&amp;w-&gt;entry); if (!weak &amp;&amp; !strong) &#123; rb_erase(&amp;node-&gt;rb_node, &amp;proc-&gt;nodes); kfree(node); binder_stats_deleted(BINDER_STAT_NODE); &#125; &#125; &#125; break; case BINDER_WORK_DEAD_BINDER: case BINDER_WORK_DEAD_BINDER_AND_CLEAR: case BINDER_WORK_CLEAR_DEATH_NOTIFICATION: &#123; struct binder_ref_death *death; uint32_t cmd; // è·å– binder_ref_death å¯¹è±¡ death = container_of(w, struct binder_ref_death, work); // æ„é€ è¿”å›å‘½ä»¤ if (w-&gt;type == BINDER_WORK_CLEAR_DEATH_NOTIFICATION) cmd = BR_CLEAR_DEATH_NOTIFICATION_DONE; else cmd = BR_DEAD_BINDER; // å‘ç”¨æˆ·ç©ºé—´è¿”å›å‘½ä»¤ if (put_user(cmd, (uint32_t __user *)ptr)) return -EFAULT; ptr += sizeof(uint32_t); // å°† cookie è¿”å›ç»™ç”¨æˆ·ç©ºé—´ if (put_user(death-&gt;cookie, (void * __user *)ptr)) return -EFAULT; ptr += sizeof(void *); binder_stat_br(proc, thread, cmd); if (w-&gt;type == BINDER_WORK_CLEAR_DEATH_NOTIFICATION) &#123; list_del(&amp;w-&gt;entry); kfree(death); binder_stats_deleted(BINDER_STAT_DEATH); &#125; else list_move(&amp;w-&gt;entry, &amp;proc-&gt;delivered_death); if (cmd == BR_DEAD_BINDER) goto done; /* DEAD_BINDER notifications can cause transactions */ &#125; break; &#125; if (!t) continue; if (t-&gt;buffer-&gt;target_node) &#123; // è·å¾— binder_node èŠ‚ç‚¹ struct binder_node *target_node = t-&gt;buffer-&gt;target_node; // å°†æ•°æ®å°è£…åˆ° binder_transaction_data å¯¹è±¡ tr.target.ptr = target_node-&gt;ptr; tr.cookie = target_node-&gt;cookie; t-&gt;saved_priority = task_nice(current); if (t-&gt;priority &lt; target_node-&gt;min_priority &amp;&amp; !(t-&gt;flags &amp; TF_ONE_WAY)) binder_set_nice(t-&gt;priority); else if (!(t-&gt;flags &amp; TF_ONE_WAY) || t-&gt;saved_priority &gt; target_node-&gt;min_priority) binder_set_nice(target_node-&gt;min_priority); // è®¾ç½®è¿”å›çš„å‘½ä»¤ç±»å‹ cmd = BR_TRANSACTION; &#125; else &#123; tr.target.ptr = NULL; tr.cookie = NULL; cmd = BR_REPLY; &#125; tr.code = t-&gt;code; tr.flags = t-&gt;flags; tr.sender_euid = t-&gt;sender_euid; if (t-&gt;from) &#123; struct task_struct *sender = t-&gt;from-&gt;proc-&gt;tsk; tr.sender_pid = task_tgid_nr_ns(sender, current-&gt;nsproxy-&gt;pid_ns); &#125; else &#123; tr.sender_pid = 0; &#125; tr.data_size = t-&gt;buffer-&gt;data_size; tr.offsets_size = t-&gt;buffer-&gt;offsets_size; tr.data.ptr.buffer = (void *)t-&gt;buffer-&gt;data + proc-&gt;user_buffer_offset; tr.data.ptr.offsets = tr.data.ptr.buffer + ALIGN(t-&gt;buffer-&gt;data_size, sizeof(void *)); if (put_user(cmd, (uint32_t __user *)ptr)) return -EFAULT; ptr += sizeof(uint32_t); // æ‹·è´ binder_transaction_data å¯¹è±¡åˆ°ç”¨æˆ·ç©ºé—´ if (copy_to_user(ptr, &amp;tr, sizeof(tr))) return -EFAULT; ptr += sizeof(tr); binder_stat_br(proc, thread, cmd); // ç§»é™¤ binder_transaction å¹¶é‡Šæ”¾ç©ºé—´ list_del(&amp;t-&gt;work.entry); t-&gt;buffer-&gt;allow_user_free = 1; // å¦‚æœæ˜¯åŒæ­¥æ“ä½œï¼Œåˆ™å°† thread å¯¹è±¡ä¿å­˜åœ¨ binder_transaction ä¸­ï¼Œè¿”å›ç»™å‘é€æ–¹è¿›ç¨‹, å¦åˆ™é‡Šæ”¾ binder_transaction å¯¹è±¡ if (cmd == BR_TRANSACTION &amp;&amp; !(t-&gt;flags &amp; TF_ONE_WAY)) &#123; t-&gt;to_parent = thread-&gt;transaction_stack; t-&gt;to_thread = thread; thread-&gt;transaction_stack = t; &#125; else &#123; t-&gt;buffer-&gt;transaction = NULL; kfree(t); binder_stats_deleted(BINDER_STAT_TRANSACTION); &#125; break; &#125;&#125; ä»ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡º binder é©±åŠ¨çš„å…·ä½“å®ç°ï¼Œä»¥åŠæ˜¯å¦‚ä½•å‘é€å’Œæ¥æ”¶æ•°æ®çš„ã€‚ 5. Binder ä¸ç³»ç»ŸæœåŠ¡5.1 Context.getSystemService()Android ç³»ç»Ÿåœ¨å¯åŠ¨åä¼šåœ¨åå°è¿è¡Œå¾ˆå¤šç³»ç»ŸæœåŠ¡æä¾›ç»™åº”ç”¨ä½¿ç”¨ï¼Œè¿™äº› æœåŠ¡) ä¸»è¦æœ‰ WindowManager, LayoutInflater, ActivityManager, PowerManager, AlarmManager, NotificationManager, KeyguardManager, LocationManager, SearchManager, Vibrator, ConnectivityManager, WifiManager, AudioManager, MediaRouter, TelephonyManager, SubscriptionManager, InputMethodManager, UiModeManager, DownloadManager, BatteryManager, JobScheduler, NetworkStatsManager æˆ‘ä»¬å¯ä»¥é€šè¿‡ Context.getSystemService(String name) æ¥è·å– æœåŠ¡)ã€‚ ä¾‹å¦‚ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•ä» xml ä¸­æ’å…¥æ–°çš„è§†å›¾ LayoutInflater inflater = (LayoutInflater) getSystemService(LAYOUT_INFLATER_SERVICE); inflater.inflate(R.layout.view, root, true); 5.2 Context.getSystemService() æºç åˆ†æè¿½è¸ª ContextImpl getSystemService() æºä»£ç  1234@Overridepublic Object getSystemService(String name) &#123; return SystemServiceRegistry.getSystemService(this, name);&#125; ç»§ç»­è¿½è¸ª SystemServiceRegistry æºä»£ç  1234567/** * Gets a system service from a given context. */public static Object getSystemService(ContextImpl ctx, String name) &#123; ServiceFetcher&lt;?&gt; fetcher = SYSTEM_SERVICE_FETCHERS.get(name); return fetcher != null ? fetcher.getService(ctx) : null;&#125; è¿½è¸ª SYSTEM_SERVICE_FETCHERS å¯ä»¥å‘ç°åœ¨ SystemServiceRegistry é™æ€åŒºä¸­æ³¨å†Œäº†å‡ ä¹æ‰€æœ‰çš„ç³»ç»ŸæœåŠ¡ 1234567891011121314registerService(Context.LAYOUT_INFLATER_SERVICE, LayoutInflater.class, new CachedServiceFetcher&lt;LayoutInflater&gt;() &#123; @Override public LayoutInflater createService(ContextImpl ctx) &#123; return new PhoneLayoutInflater(ctx.getOuterContext()); &#125;&#125;);registerService(Context.LOCATION_SERVICE, LocationManager.class, new CachedServiceFetcher&lt;LocationManager&gt;() &#123; @Override public LocationManager createService(ContextImpl ctx) &#123; IBinder b = ServiceManager.getService(Context.LOCATION_SERVICE); return new LocationManager(ctx, ILocationManager.Stub.asInterface(b)); &#125;&#125;); ä¸Šé¢ä»£ç ç‰‡æ–­ä¸­ï¼ŒPhoneLayoutInflater æœ€ç»ˆå›åˆ°äº† LayoutInflaterã€‚è€Œ LocationManager åˆ™æ˜¯å¯¹ ILocationManager çš„å°è£…ã€‚å¯ä»¥å‘ç°ï¼Œåœ¨ frameworks/base/location/java/android/location åŒ…ä¸‹å«æœ‰å¤§é‡çš„ AIDL æ–‡ä»¶ã€‚ ç»§ç»­è¿½è¸ª ServiceManager.getService(Context.LOCATION_SERVICE) 1234567891011121314151617181920212223242526272829private static IServiceManager getIServiceManager() &#123; if (sServiceManager != null) &#123; return sServiceManager; &#125; // Find the service manager sServiceManager = ServiceManagerNative.asInterface(BinderInternal.getContextObject()); return sServiceManager;&#125;/** * Returns a reference to a service with the given name. * * @param name the name of the service to get * @return a reference to the service, or &lt;code&gt;null&lt;/code&gt; if the service doesn't exist */public static IBinder getService(String name) &#123; try &#123; IBinder service = sCache.get(name); if (service != null) &#123; return service; &#125; else &#123; return getIServiceManager().getService(name); &#125; &#125; catch (RemoteException e) &#123; Log.e(TAG, \"error in getService\", e); &#125; return null;&#125; ä»ä¸Šé¢ä»£ç ç‰‡æ–­å¯ä»¥çœ‹å‡ºï¼ŒServiceManager ä¼šä» sCache ç¼“å­˜æˆ– IServiceManager ä¸­æŸ¥æ‰¾æœåŠ¡å¹¶è¿”å›ä¸€ä¸ª IBinder å¯¹è±¡ã€‚è¿™ä¸ª IBinder å°±æ˜¯ä¸€ä¸ªè¿œç¨‹å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å®ƒä¸å…¶ä»–è¿›ç¨‹äº¤äº’ã€‚ ç»§ç»­æ·±å…¥ getIServiceManager().getService(name) , è¿›å…¥ ServiceManagerNative 1234567891011121314151617181920212223242526272829303132333435363738394041/** * Cast a Binder object into a service manager interface, generating * a proxy if needed. */static public IServiceManager asInterface(IBinder obj)&#123; if (obj == null) &#123; return null; &#125; IServiceManager in = (IServiceManager)obj.queryLocalInterface(descriptor); if (in != null) &#123; return in; &#125; return new ServiceManagerProxy(obj);&#125;class ServiceManagerProxy implements IServiceManager &#123; public ServiceManagerProxy(IBinder remote) &#123; mRemote = remote; &#125; public IBinder asBinder() &#123; return mRemote; &#125; public IBinder getService(String name) throws RemoteException &#123; Parcel data = Parcel.obtain(); Parcel reply = Parcel.obtain(); data.writeInterfaceToken(IServiceManager.descriptor); data.writeString(name); mRemote.transact(GET_SERVICE_TRANSACTION, data, reply, 0); IBinder binder = reply.readStrongBinder(); reply.recycle(); data.recycle(); return binder; &#125; private IBinder mRemote;&#125; ä»ä¸Šè¾¹ä»£ç ç‰‡æ–­å¯ä»¥çœ‹åˆ°ï¼ŒServiceManager.getIServiceManager() è¿”å›çš„æ˜¯ä¸€ä¸ª ServiceManagerProxy, è€Œ ServiceManager.getService() åˆ™æ˜¯åœ¨ ServiceManagerProxy ä¸­é€šè¿‡ ServiceManager çš„è¿œç¨‹ Binder å¯¹è±¡ mRemoteï¼Œæ“ä½œ Parcel æ•°æ®ï¼Œè°ƒç”¨ IBinder.transact(int code, Parcel data, Parcel reply, int flags) æ–¹æ³•æ¥å‘é€è¯·æ±‚ï¼Œå¹¶é€šè¿‡ reply.readStrongBinder() è¿”å›äº†è¦æŸ¥æ‰¾çš„æœåŠ¡çš„è¿œç¨‹å¯¹è±¡ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»ŸæœåŠ¡çš„è·å–æ–¹å¼ä¹Ÿæ˜¯é€šè¿‡ AIDL çš„æ–¹å¼å®ç°çš„ã€‚ 6. ç»“è®º1. Binder çš„å®ç°æ¶‰åŠåˆ° kernel é©±åŠ¨ï¼Œæœ¬åœ°å±‚ï¼ŒJNI å’Œåº”ç”¨å±‚ï¼Œè´¯ç©¿äº†æ•´ä¸ª ï¼¡ndroid ç³»ç»Ÿã€‚ç³»ç»ŸæœåŠ¡è·å–ã€Activity/Service å¯åŠ¨ã€Intentçš„ä¼ é€’ç­‰éƒ½ç¦»ä¸å¼€ binder,è¦æŒæ¡ binder çš„åŸç†éœ€è¦æ·±å…¥åˆ°ç³»ç»Ÿçš„æ¯ä¸€å±‚ä»£ç ã€‚ 2. ä¸Šå±‚çš„ android.os.Binder åªæ˜¯å¯¹ binder çš„åˆä¸€æ¬¡æŠ½è±¡å°è£…ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ä¸­ä¸€èˆ¬ä¹Ÿä¸ä¼šç›´æ¥ä½¿ç”¨ã€‚ 3. AIDL æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”¨äºå°è£… Binder æ“ä½œçš„å·¥å…·ï¼Œæœ€ç»ˆçš„è¿›ç¨‹é—´é€šä¿¡ç”± Binder çš„ transact å’Œ onTransact å®Œæˆã€‚æˆ‘ä»¬åœ¨åº”ç”¨ä¸­å®ç° AIDL æ¥å£ï¼Œå¯ä»¥å¿«é€Ÿå®ç°è¿›ç¨‹é—´é€šä¿¡ã€‚ 7. å‚è€ƒAndroid Binderæœºåˆ¶ Androidè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰æœºåˆ¶Binder Android Binder Android Architecture Binder AIDLä¸Binderæ¡†æ¶æµ…è°ˆ Binderæ¡†æ¶è§£æ Deep Dive into Android IPC/Binder Framework at Android Builders Summit 2013 Android Builders Summit 2013 - Deep Dive into Android IPC/Binder Framework (video) Binderæºç åˆ†æä¹‹é©±åŠ¨å±‚ï¼ˆåŸï¼‰ æ·±å…¥åˆ†æAndroid Binder é©±åŠ¨ æ„é€ IOCTLå‘½ä»¤çš„å­¦ä¹ å¿ƒå¾—â€”â€“_IO, _IOR, _IOW, _IOWR å¹»æ•°çš„ç†è§£ Serviceä¸Androidç³»ç»Ÿè®¾è®¡ï¼ˆ7ï¼‰â€” Binderé©±åŠ¨ Android Binder Binderæœºåˆ¶ï¼Œä»Javaåˆ°C ï¼ˆ7. Native Serviceï¼‰ å¾…è¡¥å……çš„å†…å®¹ 1. å®¢æˆ·ç«¯ bindService() æµç¨‹åŠæºç åˆ†æ 2. Binder Native å±‚å…¶ä»–æºç æ–‡ä»¶åˆ†æ 3. ç³»ç»ŸæœåŠ¡ï¼ˆSystemServiceï¼‰è¯¦ç»†åˆ—è¡¨åŠåœ¨æœ¬åœ°å±‚çš„æºç åˆ†æ 4. SystemManager æºç åˆ†æ 5. å®Œå–„ binder é©±åŠ¨å†…å®¹ï¼Œè¡¥å……å…³ç³»å›¾ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"AsyncTaskæºç åˆ†æ","date":"2017-07-26T11:36:58.000Z","path":"2017/07/26/AsyncTaskæºç åˆ†æ.html","text":"é¡¹ç›®åœ°å€ï¼š https://github.com/itgoyo/AndroidSource-Analysis ç®€ä»‹ï¼š Androidæºç åˆ†æï¼Œè®©ä½ æ›´æ¸…æ¥šçš„ç†è§£æ¯ä¸€ä¸ªç»„ä»¶çš„åŠŸèƒ½ä¸ç”¨æ³•ã€‚ 1. ç®€ä»‹AsyncTaskæ˜¯androidæä¾›çš„ä¸€ç§å¼‚æ­¥æ¶ˆæ¯å¤„ç†çš„è§£å†³æ–¹æ¡ˆï¼Œèƒ½ç®€åŒ–æˆ‘ä»¬åœ¨å­çº¿ç¨‹ä¸­æ›´æ–°UIæ§ä»¶ï¼Œä½¿ç”¨AsyncTaskä½ å°†çœ‹ä¸åˆ°ä»»ä½•å…³äºæ“ä½œçº¿ç¨‹çš„ä»£ç  2. ç‰ˆæœ¬å·®åˆ«2.1 çº¿ç¨‹æ± é…ç½® android3.0ä»¥å‰çº¿ç¨‹æ± é…ç½®ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º 12345678private static final int CORE_POOL_SIZE = 5;//æ ¸å¿ƒçº¿ç¨‹æ•°é‡private static final int MAXIMUM_POOL_SIZE = 128;//çº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ç›®//å½“çº¿ç¨‹æ•°ç›®å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ç›®æ—¶ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªkeepAliveTimeæ—¶é—´ï¼Œé‚£ä¹ˆç©ºé—²çš„çº¿ç¨‹ä¼šè¢«ç»ˆæ­¢private static final it KEEP_ALIVE = 10;â€¦â€¦ private static final ThreadPoolExecutor sExecutor = new ThreadPoolExecutor(CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE, TimeUnit.SECONDS, sWorkQueue, sThreadFactory); android3.0ä»¥åæ›´åŠ çµæ´»ï¼Œæ ¹æ®cpuæ ¸æ•°é…ç½®CORE_POOL_SIZEå’ŒMAXIMUM_POOL_SIZE 123456//æ ¹æ®cpuçš„å¤§å°æ¥é…ç½®æ ¸å¿ƒçš„çº¿ç¨‹private static final int CPU_COUNT = Runtime.getRuntime().availableProcessors();private static final int CORE_POOL_SIZE = CPU_COUNT + 1;//æ ¸å¿ƒçº¿ç¨‹æ•°é‡//çº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ç›®private static final int MAXIMUM_POOL_SIZE = CPU_COUNT * 2 + 1;private static final int KEEP_ALIVE = 1;//ç©ºé—²çº¿ç¨‹çš„è¶…æ—¶æ—¶é—´ 2.2 ä¸²è¡Œå’Œå¹¶è¡Œï¼Œå¼•ç”¨æ¥è‡ªè¿™ç¯‡æ–‡ç«  android 1.5ä»¥å‰çš„æ—¶å€™executeæ˜¯ä¸²è¡Œæ‰§è¡Œçš„ android 1.6ç›´åˆ°android 2.3.2è¢«ä¿®æ”¹ä¸ºå¹¶è¡Œæ‰§è¡Œï¼Œæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± å°±æ˜¯THREAD_POOL_EXECUTOR android 3.0ä»¥åï¼Œé»˜è®¤ä»»åŠ¡æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Œå¦‚æœæƒ³è¦å¹¶è¡Œæ‰§è¡Œä»»åŠ¡å¯è°ƒç”¨executeOnExecutor(Executor exec, Params.. params) å…·ä½“ç”¨æ³•å¯å‚ç…§Android AsyncTaskçš„éª—æœ¯ 3. åŸºæœ¬ç”¨æ³•3.1 ç»§æ‰¿AsyncTaskï¼Œè®¾ç½®å­ç±»ä¸‰ä¸ªæ³›å‹çš„å‚æ•° 1public abstract class AsyncTask&lt;Params, Progress, Result&gt; Params å¼‚æ­¥ä»»åŠ¡å¤„ç†çš„å‚æ•° Progress å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­è¿”å›ç»™ä¸»çº¿ç¨‹çš„è¿›åº¦å€¼ï¼Œé€šè¿‡publishProgress()æ–¹æ³•å‘é€å‡ºå» Result å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æŸè¿”å›çš„ç»“æœçš„ç»“æœç±»å‹ï¼Œå¯ä»¥ä¸ºbooleanï¼Œæˆ–è€…bitmapç­‰ç±»å‹ 3.2 å­ç±»å¿…é¡»å®ç°çš„æŠ½è±¡æ–¹æ³• onPreExecute æ‰§è¡Œåå°è€—æ—¶æ“ä½œå‰è¢«è°ƒç”¨ï¼Œé€šå¸¸ç”¨äºå®Œæˆä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œæ¯”å¦‚2.3ä¾‹å­ä¸­åˆå§‹åŒ–dialogçš„æ“ä½œï¼Œæˆ–è€…ä¸€äº›é›†åˆå®¹å™¨ doInBackGround å¿…é¡»å®ç°ï¼Œå¼‚æ­¥æ‰§è¡Œåå°çº¿ç¨‹å°†è¦å®Œæˆçš„ä»»åŠ¡(è¯¥æ–¹æ³•åœ¨å­çº¿ç¨‹è¿è¡Œï¼Œä¸‹é¢æºç ä¼šåˆ†æåˆ°) onProgressUpdate åœ¨doInBackGroundæ–¹æ³•ä¸­è°ƒç”¨publishProgressæ–¹æ³•ï¼ŒAsyncTaskå°±ä¼šä¸»åŠ¨è°ƒç”¨onProgressUpdateå®ç°æ›´æ–° ä»»åŠ¡çš„æ‰§è¡Œè¿›åº¦ onPostExecute å½“doInBackGroundå®Œæˆåï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œé”€æ¯ä¸€äº›dialogçš„æ“ä½œï¼Œå¹¶å°†doInBackGroundæ–¹æ³•è¿”å›çš„å€¼ä¼ ç»™è¯¥æ–¹æ³• æ‰§è¡Œçš„å¤§è‡´æµç¨‹æ˜¯ï¼š onPreExecute-&gt; doInBackGround-&gt;onProgressUpdate(è°ƒç”¨publishProgressçš„æ—¶å€™)-&gt;onPostExecute 3.3 ç”¨æ³•æ¡ˆä¾‹1ã€å®ä¾‹åŒ–å­ç±»1234//ä¸²è¡Œå®ä¾‹åŒ–new DownAsyncTask().extcute();//å¹¶è¡Œå®ä¾‹åŒ–new DownAsyncTask().executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR,\"\"); 2ã€ç‚¹å‡»æŸ¥çœ‹ï¼Œä»£ç æ¡ˆä¾‹ 3.4 å–æ¶ˆå¼‚æ­¥ä»»åŠ¡1AsyncTask.cancel(mayInterruptIfRunning); mayInterruptIfRunningæ˜¯booleanç±»å‹çš„(æ³¨æ„è¿™é‡Œtrueå’Œfalseçš„åŒºåˆ«)ï¼Œå…¶è°ƒç”¨æµç¨‹ï¼šAsyncTask.cancel() -&gt; FutureTask.cancel()ã€‚FutureTask.cancel()çš„æºç å¦‚ä¸‹ï¼š123456789101112131415161718192021222324public boolean cancel(boolean mayInterruptIfRunning) &#123; //æ£€æµ‹å½“å‰çŠ¶æ€æ˜¯å¦æ˜¯NEW,å¦‚æœä¸æ˜¯ï¼Œè¯´æ˜ä»»åŠ¡å·²ç»å®Œæˆæˆ–å–æ¶ˆæˆ–ä¸­æ–­ï¼Œæ‰€ä»¥ç›´æ¥è¿”å›ã€‚ if (!(state == NEW &amp;&amp; U.compareAndSwapInt(this, STATE, NEW, mayInterruptIfRunning ? INTERRUPTING : CANCELLED))) return false; try &#123; // in case call to interrupt throws exception //å¦‚æœmayInterruptIfRunningä¸ºtrueçš„æ—¶å€™ï¼Œçº¿ç¨‹å°±ä¼šè°ƒç”¨interrupt()æ–¹æ³•ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚ if (mayInterruptIfRunning) &#123; try &#123; Thread t = runner; if (t != null) //è°ƒç”¨interruptæ–¹æ³•ï¼ŒçŠ¶æ€è®¾ç½®ä¸ºINTERRUPTINGï¼Œç„¶åè¯•ç€ä¸­æ–­çº¿ç¨‹ï¼Œå®Œæˆåè®¾ç½®çŠ¶æ€ä¸ºINTERRUPTED t.interrupt(); &#125; finally &#123; // final state U.putOrderedInt(this, STATE, INTERRUPTED); &#125; &#125; &#125; finally &#123; //é€šçŸ¥ç­‰å¾…çº¿ç¨‹çš„ç»“æœï¼ˆå› ä¸ºFutureTask.get()æ³•è·å¾—è®¡ç®—ç»“æœçš„å”¯ä¸€æ–¹æ³•ï¼Œå¦‚æœè®¡ç®—æ²¡æœ‰å®Œæˆï¼Œæ­¤æ–¹æ³•ä¼šå µå¡ç›´åˆ°è®¡ç®—å®Œæˆï¼‰ finishCompletion(); &#125; return true; &#125; ä»¥ä¸‹æ˜¯æˆ‘ä»£ç ä¾‹å­ä¸­doInBackground()ä¸­æ³¨é‡Šçš„ï¼Œè¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†å¼ºè°ƒtrueå’Œfalseçš„åŒºåˆ« 123456try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; å¦‚æœçº¿ç¨‹å¤„äºä¼‘çœ çŠ¶æ€ï¼Œä¸ºtrueåˆ™æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å°†ä¼šä¸­æ–­ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ‰§è¡Œçš„ä»»åŠ¡çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œå®Œæ¯•è°ƒç”¨onCanceled()ã€‚ä¸ºfalseåˆ™æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ä¸ä¼šä¸­æ–­ï¼Œä»»åŠ¡çº¿ç¨‹æ‰§è¡Œå®Œæ¯•è°ƒç”¨onCanceled() å¦‚æœçº¿ç¨‹ä¸å¤„äºä¼‘çœ çŠ¶æ€ï¼Œä¸ºtrueå’Œfalseéƒ½æ²¡æœ‰åŒºåˆ«ï¼Œä»»åŠ¡çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åè°ƒç”¨onCanceled()æ­£ç¡®åœ°å–æ¶ˆè¦åœ¨doInBackground(Void... params)ä½¿ç”¨isCancelled()æ¥åˆ¤æ–­ï¼Œé€€å‡ºå¾ªç¯æ“ä½œã€‚å¦‚ä¸‹é¢çš„ 1234567891011121314@Overrideprotected Boolean doInBackground(Void... params) &#123; while (progress &lt; 10000) &#123; progress = progress + 2; Log.i(\"å½“å‰çš„è¿›åº¦\", \"progress==\" + progress); publishProgress(progress); //åˆ¤æ–­æ˜¯ä¸æ˜¯è°ƒç”¨äº†AsyncTask.cancel(mayInterruptIfRunning)ï¼Œå¦‚æœå·²ç»è°ƒç”¨äº†ï¼Œ if(isCancelled()) &#123; break;//è·³å‡ºå¾ªç¯ï¼Œé©¬ä¸Šè°ƒç”¨onCancelled()æ–¹æ³•ï¼Œä¸éœ€è¦ç­‰doInBackgroundæ‰§è¡Œå®Œä»»åŠ¡ &#125; &#125; return true;&#125; 4. AsyncTaskæºç åˆ†æ(åŸºäºandroid3.0ä»¥ååˆ†æ)4.1 AsyncTaskæ„é€ å‡½æ•°12345678910111213141516171819202122232425262728293031323334/**AsyncTaskçš„æ„é€ å‡½æ•°æºç ç‰‡æ®µ**/public AsyncTask() &#123; mWorker = new WorkerRunnable&lt;Params, Result&gt;() &#123; //å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„æ—¶å€™å›è°ƒcallæ–¹æ³• public Result call() throws Exception &#123; mTaskInvoked.set(true); //è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND); //noinspection unchecked Result result = doInBackground(mParams); Binder.flushPendingCommands(); //å°†ç»“æœå‘é€å‡ºå» return postResult(result); &#125; &#125;; mFuture = new FutureTask&lt;Result&gt;(mWorker) &#123; //ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åä¼šè°ƒç”¨doneæ–¹æ³• @Override protected void done() &#123; try &#123; //get()è¡¨ç¤ºè·å–mWorkerçš„callçš„è¿”å›å€¼ï¼Œå³Result.ç„¶åçœ‹postResultIfNotInvokedæ–¹æ³• postResultIfNotInvoked(get()); &#125; catch (InterruptedException e) &#123; android.util.Log.w(LOG_TAG, e); &#125; catch (ExecutionException e) &#123; throw new RuntimeException(\"An error occurred while executing doInBackground()\", e.getCause()); &#125; catch (CancellationException e) &#123; postResultIfNotInvoked(null); &#125; &#125; &#125;; &#125; AsyncTaskçš„å®ä¾‹åŒ–æ˜¯åœ¨UIçº¿ç¨‹ä¸­ã€‚12345//@MainThreadè¡¨ç¤ºè¿™ä¸ªåŠ¨ä½œæ˜¯åœ¨UIçº¿ç¨‹ä¸­å®Œæˆ@MainThread public final AsyncTask&lt;Params, Progress, Result&gt; execute(Params... params) &#123; return executeOnExecutor(sDefaultExecutor, params); &#125; æ„é€ å‡½æ•°åˆå§‹åŒ–äº†ä¸¤ä¸ªæˆå‘˜å˜é‡mWorkerå’ŒmFutureã€‚mWorkerä¸ºWorkerRunnableç±»å‹çš„åŒ¿åå†…éƒ¨ç±»å®ä¾‹å¯¹è±¡ï¼ˆå®ç°äº†Callableæ¥å£ï¼‰ï¼ŒmFutureä¸ºFutureTaskç±»å‹çš„åŒ¿åå†…éƒ¨ç±»å®ä¾‹å¯¹è±¡ï¼Œå°†mWorkerä½œä¸ºmFutureçš„å½¢å‚ï¼ˆé‡å†™äº†FutureTaskç±»çš„doneæ–¹æ³•ï¼‰ã€‚ WorkerRunnableæ˜¯ä¸€ä¸ªå®ç°äº†Callableçš„æŠ½è±¡ç±»ï¼Œæ‰©å±•äº†Callableå¤šäº†ä¸€ä¸ªParamså‚æ•° 1234private static abstract class WorkerRunnable&lt;Params, Result&gt; implements Callable&lt;Result&gt;&#123; Params[] mParams;&#125; ä¸‹é¢è®²è¿°ä¸‹Callableå’ŒRunnableçš„åŒºåˆ« Callableçš„æ¥å£æ–¹æ³•æ˜¯callï¼ŒRunnableæ˜¯run Callableå¯ä»¥å¸¦è¿”å›å€¼ï¼ŒRunnableä¸è¡Œï¼Œç»“æœé€šè¿‡Future.get()è·å– Callableå¯ä»¥æ•è·å¼‚å¸¸ï¼ŒRunnableä¸è¡Œ 123456789101112131415161718192021public class CallableAndFuture &#123; public static void main(String[] args) &#123; Callable&lt;Integer&gt; callable = new Callable&lt;Integer&gt;() &#123; public Integer call() throws Exception &#123; return new Random().nextInt(100); &#125; &#125;; //é‚£WorkerRunnableçš„å›è°ƒæ–¹æ³•callè‚¯å®šæ˜¯åœ¨FutureTaskä¸­è°ƒç”¨çš„ FutureTask&lt;Integer&gt; future = new FutureTask&lt;Integer&gt;(callable) ); new Thread(future).start(); try &#123; Thread.sleep(5000);// å¯èƒ½åšä¸€äº›äº‹æƒ… System.out.println(future.get()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125; &#125;&#125; FutureTaskçš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼Œ1234567public FutureTask(Callable&lt;V&gt; callable) &#123; if (callable == null) throw new NullPointerException(); //å°†AsyncTaské‡Œé¢åˆå§‹åŒ–çš„callableèµ‹å€¼ç»™FutureTaské‡Œé¢çš„callableï¼Œè¯å®äº†WorkerRunnableçš„å›è°ƒæ–¹æ³•callè‚¯å®šæ˜¯åœ¨FutureTaskä¸­è°ƒç”¨çš„ this.callable = callable; this.state = NEW; // ensure visibility of callable&#125; æŸ¥çœ‹FutureTaskç±»ï¼Œå®ƒå®ç°äº†æ¥å£Runnable1public class FutureTask&lt;V&gt; implements RunnableFuture&lt;V&gt; // å®ç°äº†RunnableFutureæ¥å£ ä½œä¸ºRunnableè¢«çº¿ç¨‹æ‰§è¡Œï¼ŒåŒæ—¶å°†Callableä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°ä¼ å…¥ï¼Œè¿™æ ·ç»„åˆçš„å¥½å¤„æ˜¯ï¼Œå‡è®¾æœ‰ä¸€ä¸ªå¾ˆè€—æ—¶çš„è¿”å›å€¼éœ€è¦è®¡ç®—ï¼Œå¹¶ä¸”è¿™ä¸ªè¿”å›å€¼ä¸æ˜¯ç«‹åˆ»éœ€è¦çš„è¯ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç»„åˆï¼Œç”¨å¦ä¸€ä¸ªçº¿ç¨‹å»è®¡ç®—è¿”å›å€¼ï¼Œè€Œå½“å‰çº¿ç¨‹åœ¨ä½¿ç”¨è¿™ä¸ªè¿”å›å€¼ä¹‹å‰å¯ä»¥åšå…¶å®ƒçš„æ“ä½œï¼Œç­‰åˆ°éœ€è¦è¿™ä¸ªè¿”å›å€¼æ—¶ï¼Œå†é€šè¿‡Futureå¾—åˆ°ã€‚FutureTaskçš„runæ–¹æ³•è¦å¼€å§‹å›è°ƒWorkerRunableçš„callæ–¹æ³•äº†ï¼Œcallé‡Œé¢è°ƒç”¨doInBackground(mParams)ï¼Œç»ˆäºå›åˆ°æˆ‘ä»¬åå°ä»»åŠ¡äº†ï¼Œè°ƒç”¨æˆ‘ä»¬AsyncTaskå­ç±»çš„doInBackground()ï¼Œç”±æ­¤å¯ä»¥çœ‹å‡ºdoInBackground()æ˜¯åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º 4.2 æ ¸å¿ƒæ–¹æ³•1ã€execute()æ–¹æ³•12345678private static volatile Executor sDefaultExecutor = SERIAL_EXECUTOR;public static final Executor SERIAL_EXECUTOR = new SerialExecutor(); /** AsyncTaskç±»çš„executeæ–¹æ³•**/ public final AsyncTask&lt;Params, Progress, Result&gt; execute(Params... params) &#123; //è°ƒç”¨executeOnExecutoræ–¹æ³• return executeOnExecutor(sDefaultExecutor, params);&#125; å½“æ‰§è¡Œexecuteæ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†executeOnExecutoræ–¹æ³•ã€‚è¿™é‡Œä¼ é€’äº†ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯sDefaultExecutorï¼Œä¸€ä¸ªæ˜¯paramsã€‚ä»ä¸Šé¢çš„æºç å¯ä»¥çœ‹å‡ºï¼ŒsDefaultExecutorå…¶å®æ˜¯ä¸€ä¸ªSerialExecutorå¯¹è±¡ï¼Œå®ç°äº†ä¸²è¡Œçº¿ç¨‹é˜Ÿåˆ—ã€‚paramså…¶å®æœ€ç»ˆä¼šèµ‹ç»™doInBackgroundæ–¹æ³•å»å¤„ç†ã€‚ 2ã€executeOnExecutor()æ–¹æ³•1234567891011121314151617181920212223242526//execæ‰§è¡ŒAsyncTask.execute()æ–¹æ³•æ—¶ä¼ é€’è¿›æ¥çš„å‚æ•°sDefaultExecutorï¼Œè¿™ä¸ªsDefaultExecutorå…¶å®å°±æ˜¯SerialExecutorå¯¹è±¡ã€‚é»˜è®¤æ˜¯ä¸²è¡Œæ‰§è¡Œçš„//è‹¥æƒ³å˜æˆå¹¶å‘æ‰§è¡Œexecå¯ä»¥ä¼ å…¥AsyncTask.THREAD_POOL_EXECUTORã€‚public final AsyncTask&lt;Params, Progress, Result&gt; executeOnExecutor(Executor exec, Params... params) &#123; //å¦‚æœä¸€ä¸ªä»»åŠ¡å·²ç»è¿›å…¥æ‰§è¡Œçš„çŠ¶æ€ï¼Œå†æ‰§è¡Œå°±ä¼šæŠ›å¼‚å¸¸ã€‚è¿™å°±å†³å®šäº†ä¸€ä¸ªAsyncTaskåªèƒ½æ‰§è¡Œä¸€æ¬¡ if (mStatus != Status.PENDING) &#123; switch (mStatus) &#123; case RUNNING: throw new IllegalStateException(\"Cannot execute task:\" + \" the task is already running.\"); case FINISHED: throw new IllegalStateException(\"Cannot execute task:\" + \" the task has already been executed \" + \"(a task can be executed only once)\"); &#125; &#125; //ä¸€æ—¦executeOnExecutorè°ƒç”¨äº†å°±æ ‡è®°ä¸ºè¿è¡ŒçŠ¶æ€ mStatus = Status.RUNNING; //å®é™…æ˜¯è°ƒç”¨å­ç±»é‡Œé¢çš„onPreExecute onPreExecute(); //å°†å¤„ç†çš„å‚æ•°ç±»å‹èµ‹å€¼ç»™mWorker mWorker.mParams = params; //executeæ˜¯è°ƒç”¨SERIAL_EXECUTORçš„executeï¼ŒmFutureå°±æ˜¯ä¹‹å‰AsyncTaskæ„é€ åˆå§‹åŒ–èµ‹å€¼çš„FutureTaskã€‚ exec.execute(mFuture); return this; &#125; è¿™é‡Œè¦è¯´æ˜ä¸€ä¸‹ï¼ŒAsyncTaskçš„å¼‚æ­¥ä»»åŠ¡æœ‰ä¸‰ç§çŠ¶æ€ PENDING å¾…æ‰§è¡ŒçŠ¶æ€ã€‚å½“AsyncTaskè¢«åˆ›å»ºæ—¶ï¼Œå°±è¿›å…¥äº†PENDINGçŠ¶æ€ã€‚ RUNNING è¿è¡ŒçŠ¶æ€ã€‚å½“è°ƒç”¨executeOnExecutorï¼Œå°±è¿›å…¥äº†RUNNINGçŠ¶æ€ã€‚ FINISHED ç»“æŸçŠ¶æ€ã€‚å½“AsyncTaskå®Œæˆ(ç”¨æˆ·cancel()æˆ–ä»»åŠ¡æ‰§è¡Œå®Œæ¯•)æ—¶ï¼Œå°±è¿›å…¥äº†FINISHEDçŠ¶æ€ã€‚ 3ã€SerialExecutorçš„executeæ–¹æ³•1234567891011121314151617181920212223242526272829303132333435private static class SerialExecutor implements Executor &#123; //å¾ªç¯æ•°ç»„å®ç°çš„åŒå‘Queueã€‚å¤§å°æ˜¯2çš„å€æ•°ï¼Œé»˜è®¤æ˜¯16ã€‚æœ‰é˜Ÿå¤´é˜Ÿå°¾ä¸¤ä¸ªä¸‹æ ‡ final ArrayDeque&lt;Runnable&gt; mTasks = new ArrayDeque&lt;Runnable&gt;(); //å½“å‰æ­£åœ¨è¿è¡Œçš„runnable Runnable mActive; public synchronized void execute(final Runnable r) &#123; //æ·»åŠ åˆ°åŒç«¯é˜Ÿåˆ—é‡Œé¢å» mTasks.offer(new Runnable() &#123; public void run() &#123; try &#123; //æ‰§è¡Œçš„æ˜¯mFutureå°±æ˜¯ä¹‹å‰AsyncTaskæ„é€ åˆå§‹åŒ–èµ‹å€¼çš„FutureTaskçš„run()æ–¹æ³• r.run(); &#125; finally &#123; //æ— è®ºæ‰§è¡Œç»“æœå¦‚ä½•éƒ½ä¼šå–å‡ºä¸‹ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œ scheduleNext(); &#125; &#125; &#125;); //å¦‚æœæ²¡æœ‰æ´»åŠ¨çš„runnableï¼Œä»åŒç«¯é˜Ÿåˆ—é‡Œé¢å–å‡ºä¸€ä¸ªrunnableæ”¾åˆ°çº¿ç¨‹æ± ä¸­è¿è¡Œ //ç¬¬ä¸€ä¸ªè¯·æ±‚ä»»åŠ¡è¿‡æ¥çš„æ—¶å€™mActiveæ˜¯ç©ºçš„ if (mActive == null) &#123; //å–å‡ºä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œ scheduleNext(); &#125; &#125; protected synchronized void scheduleNext() &#123; //ä»åŒç«¯é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªä»»åŠ¡ if ((mActive = mTasks.poll()) != null) &#123; //çº¿ç¨‹æ± æ‰§è¡Œå–å‡ºæ¥çš„ä»»åŠ¡ï¼ŒçœŸæ­£æ‰§è¡Œä»»åŠ¡çš„ THREAD_POOL_EXECUTOR.execute(mActive); &#125; &#125; &#125;//java exec.execute(mFuture)æ‰§è¡Œæ—¶ï¼ŒSerialExecutorå°†FutureTaskä½œä¸ºå‚æ•°æ‰§è¡Œexecuteæ–¹æ³•ã€‚åœ¨executeæ–¹æ³•ä¸­ï¼Œå‡è®¾FutureTaskæ’å…¥è¿›äº†ä¸¤ä¸ªä»¥ä¸Šçš„ä»»åŠ¡é˜Ÿåˆ—åˆ°mTasksä¸­ï¼Œç¬¬ä¸€æ¬¡è¿‡æ¥mActive==nullï¼Œé€šè¿‡mTasks.poll()å–å‡ºä¸€ä¸ªä»»åŠ¡ä¸¢ç»™çº¿ç¨‹æ± è¿è¡Œï¼Œçº¿ç¨‹æ± æ‰§è¡Œr.runï¼Œå…¶å®å°±æ˜¯æ‰§è¡ŒFutureTaskçš„runæ–¹æ³•ï¼Œå› ä¸ºä¼ é€’è¿›æ¥çš„rå‚æ•°å°±æ˜¯mFutureã€‚ç­‰åˆ°ä¸Šä¸€ä¸ªçº¿ç¨‹æ‰§å®Œr.run()å®Œä¹‹åï¼Œè¿™é‡Œæ˜¯é€šè¿‡ä¸€ä¸ªtry-finallyä»£ç å—ï¼Œå¹¶åœ¨finallyä¸­è°ƒç”¨äº†scheduleNext()æ–¹æ³•ï¼Œä¿è¯æ— è®ºå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼ŒscheduleNext()éƒ½ä¼šå–å‡ºä¸‹ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œã€‚æ¥ç€å› ä¸ºmActiveä¸ä¸ºç©ºäº†ï¼Œä¸ä¼šå†æ‰§è¡Œ`scheduleNext()ï¼Œç”±äºå­˜åœ¨ä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—ï¼Œæ¯ä¸ª Runnable è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œéƒ½è¿›å…¥å»é˜Ÿåˆ—ï¼Œç„¶ååœ¨æ‰§è¡Œå®Œåå‡ºé˜Ÿï¼Œæ‰ä¼šè¿›å…¥ä¸‹ä¸€ä¸ª Runnable çš„æ‰§è¡Œæµç¨‹ã€‚ç”±æ­¤å¯çŸ¥é“è¿™æ˜¯ä¸€ä¸ªä¸²è¡Œçš„æ‰§è¡Œè¿‡ç¨‹ï¼ŒåŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œï¼Œå…¶ä½™çš„å‡å¤„äºç­‰å¾…çŠ¶æ€ã€‚ 1234567891011mWorker = new WorkerRunnable&lt;Params, Result&gt;() &#123; public Result call() throws Exception &#123; mTaskInvoked.set(true); Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND); //noinspection unchecked Result result = doInBackground(mParams);//è°ƒç”¨å­ç±»çš„doInBackground Binder.flushPendingCommands(); return postResult(result);//æ‰§è¡Œå®Œåé€šè¿‡postResultç»“æœä¼ é€’å‡ºå» &#125; &#125;; ä¸Šæ–‡ä¸­æåˆ°è°ƒç”¨call()çš„æµç¨‹ï¼šSerialExecutor.execute() -&gt; FutureTask.run() -&gt; WorkerRunnable.call() å¦‚æœå›è°ƒäº†call()æ–¹æ³•ï¼Œå°±ä¼šè°ƒç”¨äº†doInBackground(mParams)æ–¹æ³•ï¼Œè¿™éƒ½æ˜¯åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œçš„ã€‚æ‰§è¡Œå®Œåï¼Œå°†ç»“æœé€šè¿‡postResult(result)å‘é€å‡ºå»ã€‚ 4ã€AsyncTaskçš„postResultæ–¹æ³•123456789private Result postResult(Result result) &#123; @SuppressWarnings(\"unchecked\") //è·å–ä¸€ä¸ªhandlerï¼Œç­‰åˆ°ä¸€ä¸ªæ¶ˆæ¯ï¼Œå°†ç»“æœå°è£…åœ¨Message Message message = getHandler().obtainMessage(MESSAGE_POST_RESULT, new AsyncTaskResult&lt;Result&gt;(this, result));//new AsyncTaskResult&lt;Result&gt;(this, result)å°†å¾—åˆ°çš„ç»“æœå†åšäº†ä¸€å±‚å°è£… //å°†æ¶ˆæ¯å‘é€åˆ°ä¸»çº¿ç¨‹ï¼Œä¼šå›è°ƒhandleMessage()æ–¹æ³• message.sendToTarget(); return result;&#125; å› ä¸ºpostResult(Result result)è¿˜æ˜¯åœ¨å­çº¿ç¨‹ä¸­è°ƒç”¨çš„ï¼Œå¦‚æœè¦å‘é€ç»™ä¸»çº¿ç¨‹ï¼Œå¿…é¡»é€šè¿‡Handlerã€‚æºç ä¸­ä½¿ç”¨sHandlerå¹¶å¸¦ç€MESSAGE_POST_RESULTå’Œå°è£…äº†ä»»åŠ¡æ‰§è¡Œç»“æœçš„å¯¹è±¡AsyncTaskResultï¼Œç„¶åmessage.sendToTarget()å¼€å§‹å‘æ¶ˆæ¯ã€‚123456789private static Handler getHandler() &#123; synchronized (AsyncTask.class) &#123; if (sHandler == null) &#123; //åˆå§‹åŒ–ä¸€ä¸ªInternalHandlerï¼Œç”¨ä¸å°†ç»“æœå‘é€ç»™ä¸»çº¿ç¨‹ sHandler = new InternalHandler(); &#125; return sHandler; &#125; &#125; å¹¶åœ¨InternalHandlerçš„handleMessageä¸­å¼€å§‹å¤„ç†æ¶ˆæ¯ï¼ŒInternalHandlerçš„æºç å¦‚ä¸‹æ‰€ç¤ºï¼š123456789101112131415161718192021 private static class InternalHandler extends Handler &#123; public InternalHandler() &#123; // è¿™ä¸ªhandleræ˜¯å…³è”åˆ°ä¸»çº¿ç¨‹çš„ super(Looper.getMainLooper()); &#125; @SuppressWarnings(&#123;\"unchecked\", \"RawUseOfParameterizedType\"&#125;) @Override public void handleMessage(Message msg) &#123; AsyncTaskResult&lt;?&gt; result = (AsyncTaskResult&lt;?&gt;) msg.obj; switch (msg.what) &#123; case MESSAGE_POST_RESULT: // There is only one result result.mTask.finish(result.mData[0]); break; case MESSAGE_POST_PROGRESS: result.mTask.onProgressUpdate(result.mData); break; &#125; &#125;&#125; è¿™é‡Œæ ¹æ®æ¶ˆæ¯çš„ç±»å‹è¿›è¡Œäº†åˆ¤æ–­ï¼Œå¦‚æœæ˜¯MESSAGE_POST_RESULTæ¶ˆæ¯ï¼Œå°±ä¼šå»æ‰§è¡Œfinish()æ–¹æ³•ï¼Œfinish()æºç å¦‚ä¸‹æ–‡æ‰€ç¤ºï¼š12345678private void finish(Result result) &#123; if (isCancelled()) &#123; onCancelled(result); &#125; else &#123; onPostExecute(result); &#125; mStatus = Status.FINISHED; &#125; å¦‚æœä»»åŠ¡å·²ç»å–æ¶ˆäº†ï¼Œè°ƒç”¨onCancelledæ–¹æ³•ï¼Œå¦‚æœæ²¡è¢«å–æ¶ˆï¼Œåˆ™è°ƒç”¨onPostExecute()æ–¹æ³•ã€‚ å¦‚æœdoInBackground(Void... params)è°ƒç”¨publishProgress()æ–¹æ³•ï¼Œå®é™…å°±æ˜¯å‘é€ä¸€æ¡MESSAGE_POST_PROGRESSæ¶ˆæ¯ï¼Œå°±ä¼šå»æ‰§è¡ŒonProgressUpdate()æ–¹æ³•ã€‚publishProgress()çš„æºç å¦‚ä¸‹æ–‡æ‰€ç¤ºï¼š 1234567@WorkerThreadprotected final void publishProgress(Progress... values) &#123; if (!isCancelled()) &#123; getHandler().obtainMessage(MESSAGE_POST_PROGRESS, new AsyncTaskResult&lt;Progress&gt;(this, values)).sendToTarget(); &#125;&#125; å¦‚æœä½ è¿˜ä¸å¤Ÿæ¸…æ™°ï¼Œè¯·çœ‹ä¸‹é¢çš„è¿™ä¸ªæµç¨‹å›¾ 5. AsyncTaskéœ€è¦æ³¨æ„çš„å‘ AsyncTaskçš„å¯¹è±¡å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­å®ä¾‹åŒ–ï¼Œexecuteæ–¹æ³•ä¹Ÿè¦åœ¨ä¸»çº¿ç¨‹è°ƒç”¨(æŸ¥çœ‹3.1èŠ‚-AsyncTaskæ„é€ å‡½æ•°) åŒä¸€ä¸ªAsyncTaskä»»åŠ¡åªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå³åªèƒ½è°ƒç”¨ä¸€æ¬¡executeæ–¹æ³•ï¼Œå¤šæ¬¡è°ƒç”¨æ—¶å°†ä¼šæŠ›å¼‚å¸¸ï¼ˆæŸ¥çœ‹3.2é‡Œé¢çš„ç¬¬äºŒå°èŠ‚ï¼‰ cancel()æ–¹æ³•æ— æ³•ç›´æ¥ä¸­æ–­å­çº¿ç¨‹ï¼Œåªæ˜¯æ›´æ”¹äº†ä¸­æ–­çš„æ ‡å¿—ä½ã€‚æ§åˆ¶å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æŸåä¸ä¼šå›è°ƒonPostExecute()ã€‚æ­£ç¡®çš„å–æ¶ˆå¼‚æ­¥ä»»åŠ¡è¦cancel()æ–¹æ³•+doInbacground()åšåˆ¤æ–­è·³å‡ºå¾ªç¯ AsyncTaskåœ¨Activityé€šå¸¸ä½œä¸ºåŒ¿åçš„å†…éƒ¨ç±»æ¥ä½¿ç”¨ï¼Œå¦‚æœ AsyncTask ä¸­çš„å¼‚æ­¥ä»»åŠ¡åœ¨ Activity é€€å‡ºæ—¶è¿˜æ²¡æ‰§è¡Œå®Œæˆ–è€…é˜»å¡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªä¿æŒçš„å¤–éƒ¨çš„ Activity å®ä¾‹å¾—ä¸åˆ°é‡Šæ”¾ï¼ˆå†…éƒ¨ç±»ä¿æŒéšå¼å¤–éƒ¨ç±»çš„å®ä¾‹çš„å¼•ç”¨ï¼‰ï¼Œæœ€åå¯¼è‡´ä¼šå¼•èµ·OOMï¼Œè§£å†³åŠæ³•æ˜¯ï¼šåœ¨ AsyncTask ä½¿ç”¨å¼±å¼•ç”¨å¤–éƒ¨å®ä¾‹ï¼Œæˆ–è€…ä¿è¯åœ¨ Activity é€€å‡ºæ—¶ï¼Œæ‰€æœ‰çš„ AsyncTask å·²æ‰§è¡Œå®Œæˆæˆ–è¢«å–æ¶ˆ ä¼šäº§ç”Ÿé˜»å¡é—®é¢˜ï¼Œå°¤å…¶æ˜¯å•ä»»åŠ¡é¡ºåºæ‰§è¡Œçš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ä¼šé˜»å¡å…¶ä»–ä»»åŠ¡çš„æ‰§è¡Œ ä¸å»ºè®®ä½¿ç”¨AsyncTaskè¿›è¡Œç½‘ç»œæ“ä½œ AsyncTasks should ideally be used for short operations (a few seconds at the most.) If you need to keep threads running for long periods of time, it is highly recommended you use the various APIsã€‚ Androidæ–‡æ¡£ä¸­æœ‰å†™åˆ°AsyncTaskåº”è¯¥å¤„ç†å‡ ç§’é’Ÿçš„æ“ä½œï¼ˆé€šå¸¸ä¸ºè½»é‡çš„æœ¬åœ°IOæ“ä½œï¼‰ï¼Œç”±äºç½‘ç»œæ“ä½œå­˜åœ¨ä¸ç¡®å®šæ€§ï¼Œå¯èƒ½è¾¾åˆ°å‡ ç§’ä»¥ä¸Šï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨ã€‚ 6. ç‰ˆæœ¬å…¼å®¹AsyncTaskCompatæœ‰å…´è¶£çš„å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç«  7. æ€»ç»“å°½ç®¡AsyncTaskç°åœ¨å·²ç»å¾ˆå°‘ä½¿ç”¨äº†ï¼Œä½†æ˜¯å®ƒçš„ä¸€äº›è®¾è®¡æ€è·¯å¯ä»¥å€Ÿé‰´åˆ°æˆ‘ä»¬çš„æ¡†æ¶ä¸­ã€‚æ¯”å¦‚æˆ‘ä»¬çš„ä»£ç ä¸­å°½é‡è®¾è®¡çµæ´»ä¸€äº›ï¼Œå°±åƒAysnTaské‡Œé¢å­˜åœ¨ä¸²è¡Œã€å¹¶è¡Œçš„æ“ä½œä¸€æ ·ï¼Œæä¾›ç”¨æˆ·åŒçš„apiï¼Œè®©ç”¨æˆ·åœ¨ä¸åŒçš„åœºæ™¯ä¸‹é€‰æ‹©ä¸åŒçš„ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"AndroidStudioæ’ä»¶å¤§å…¨","date":"2017-07-25T13:30:45.000Z","path":"2017/07/25/AndroidStudioæ’ä»¶å¤§å…¨.html","text":"#1.GsonFormatå¿«é€Ÿå°†jsonå­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ªJava Beanï¼Œå…å»æˆ‘ä»¬æ ¹æ®jsonå­—ç¬¦ä¸²æ‰‹å†™å¯¹åº”Java Beançš„è¿‡ç¨‹ã€‚ ä½¿ç”¨æ–¹æ³•ï¼šå¿«æ·é”®Alt+Sä¹Ÿå¯ä»¥ä½¿ç”¨Alt+Inserté€‰æ‹©GsonFormat 2.Android ButterKnife Zeleznyé…åˆButterKnifeå®ç°æ³¨è§£ï¼Œä»æ­¤ä¸ç”¨å†™findViewByIdï¼Œæƒ³ç€å°±çˆ½å•Šã€‚åœ¨Activityï¼ŒFragmentï¼ŒAdapterä¸­é€‰ä¸­å¸ƒå±€xmlçš„èµ„æºidè‡ªåŠ¨ç”Ÿæˆbutterknifeæ³¨è§£ã€‚ ä½¿ç”¨æ–¹æ³•ï¼šCtrl+Shift+Bé€‰æ‹©å›¾ä¸Šæ‰€ç¤ºé€‰é¡¹ 3.Android Code Generatoræ ¹æ®å¸ƒå±€æ–‡ä»¶å¿«é€Ÿç”Ÿæˆå¯¹åº”çš„Activityï¼ŒFragmentï¼ŒAdapterï¼ŒMenuã€‚ 4.Android Parcelable code generatorJavaBeanåºåˆ—åŒ–ï¼Œå¿«é€Ÿå®ç°Parcelableæ¥å£ã€‚ 5.Android Methods Countæ˜¾ç¤ºä¾èµ–åº“ä¸­å¾—æ–¹æ³•æ•° 6.Lifecycle Sorterå¯ä»¥æ ¹æ®Activityæˆ–è€…fragmentçš„ç”Ÿå‘½å‘¨æœŸå¯¹å…¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä½ç½®è¿›è¡Œå…ˆåæ’åºï¼Œå¿«æ·é”®Ctrl + alt + K 7.CodeGlanceåœ¨å³è¾¹å¯ä»¥é¢„è§ˆä»£ç ï¼Œå®ç°å¿«é€Ÿå®šä½ 8.findBugs-IDEAæŸ¥æ‰¾bugçš„æ’ä»¶ï¼ŒAndroid Studioä¹Ÿæä¾›äº†ä»£ç å®¡æŸ¥çš„åŠŸèƒ½ï¼ˆAnalyze-Inspect Codeâ€¦ï¼‰ 9.ADB WIFIä½¿ç”¨wifiæ— çº¿è°ƒè¯•ä½ çš„appï¼Œæ— éœ€rootæƒé™ä¹Ÿå¯å‚è€ƒä»¥ä¸‹æ–‡ç« ï¼šAndroid wifiæ— çº¿è°ƒè¯•Appæ–°ç©æ³•ADB WIFI 10.AndroidPixelDimenGeneratorAndroid Studioè‡ªåŠ¨ç”Ÿæˆdimen.xmlæ–‡ä»¶æ’ä»¶ 11.JsonOnlineVieweråœ¨Android Studioä¸­è¯·æ±‚ã€è°ƒè¯•æ¥å£ 12.Android Styleræ ¹æ®xmlè‡ªåŠ¨ç”Ÿæˆstyleä»£ç çš„æ’ä»¶ Usage:a. copy lines with future style from your layout.xml fileb. paste it to styles.xml file with Ctrl+Shift+D (or context menu)c. enter name of new style in the modal windowd. your style is prepared! 13.Android Drawable Importerè¿™æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å›¾ç‰‡å¯¼å…¥æ’ä»¶ã€‚å®ƒå¯¼å…¥Androidå›¾æ ‡ä¸Materialå›¾æ ‡çš„Drawable ï¼Œæ‰¹é‡å¯¼å…¥Drawable ï¼Œå¤šæºå¯¼å…¥Drawableï¼ˆå³å¯¼å…¥æŸå¼ å›¾ç‰‡å„ç§dpiå¯¹åº”çš„å›¾ç‰‡ï¼‰ 14.SelectorChapek for Androidé€šè¿‡èµ„æºæ–‡ä»¶å‘½åè‡ªåŠ¨ç”ŸæˆSelectoræ–‡ä»¶ã€‚ 15.GenerateSerialVersionUIDå®ç°Serializableåºåˆ—åŒ–bean Adds a new action â€˜SerialVersionUIDâ€™ in the generate menu (alt + ins). The action adds an serialVersionUID field in the current class or updates it if it already exists, and assigns it the same value the standard â€˜serialverâ€™ JDK tool would return. The action is only visible when IDEA is not rebuilding its indexes, the class is serializable and either no serialVersionUID field exists or its value is different from the one the â€˜serialverâ€™ tool would return. 16.genymotioné€Ÿåº¦è¾ƒå¿«çš„androidæ¨¡æ‹Ÿå™¨ 17.LeakCanaryå¸®åŠ©ä½ åœ¨å¼€å‘é˜¶æ®µæ–¹ä¾¿çš„æ£€æµ‹å‡ºå†…å­˜æ³„éœ²çš„é—®é¢˜ï¼Œä½¿ç”¨èµ·æ¥æ›´ç®€å•æ–¹ä¾¿ã€‚å¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡ç« ï¼šLeakCanary ä¸­æ–‡ä½¿ç”¨è¯´æ˜ 18.Android Postfix Completionå¯æ ¹æ®åç¼€å¿«é€Ÿå®Œæˆä»£ç ï¼Œè¿™ä¸ªå±äºæ‹“å±•å§ï¼Œç³»ç»Ÿå·²ç»æœ‰è¿™äº›åŠŸèƒ½ï¼Œå¦‚soutã€notnullç­‰ï¼Œè¿™ä¸ªæ’ä»¶åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šå¢æ·»äº†ä¸€äº›æ–°çš„åŠŸèƒ½ï¼Œæˆ‘æ›´æƒ³åšçš„æ˜¯é€šè¿‡åŸä½œè€…çš„ä»£ç è‡ªå·±å®šåˆ¶åŠŸèƒ½ï¼Œé‚£å°±æ›´çˆ½äº† 19.Android Holo Colors Generatoré€šè¿‡è‡ªå®šä¹‰Holoä¸»é¢˜é¢œè‰²ç”Ÿæˆå¯¹åº”çš„Drawableå’Œå¸ƒå±€æ–‡ä»¶ 20.dagger-intellij-plugindaggerå¯è§†åŒ–è¾…åŠ©å·¥å…· 21.GradleDependenciesHelperPluginmaven gradle ä¾èµ–æ”¯æŒè‡ªåŠ¨è¡¥å…¨ 22.RemoveButterKnifeButterKnifeè¿™ä¸ªç¬¬ä¸‰æ–¹åº“æ¯æ¬¡æ›´æ–°ä¹‹åï¼Œç»‘å®šviewçš„æ³¨è§£éƒ½ä¼šæ”¹å˜ï¼Œä»bind,åˆ°injectï¼Œå†åˆ°bindviewï¼Œæå¾—å¾ˆå¤šäººéƒ½ä¸æ•¢å‡çº§ï¼Œä¸€æ—¦å‡çº§ï¼Œå°±ä¼šæœ‰å·¨é‡çš„ä»£ç éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ï¼Œéå¸¸ç—›è‹¦å½“æˆ‘ä»¬æœ‰ä¸€äº›éå¸¸æ£’çš„ä»£ç éœ€è¦æ‹¿åˆ°å…¶ä»–é¡¹ç›®ä½¿ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œé‚£ä¸ªé¡¹ç›®å¯¹ç¬¬ä¸‰æ–¹åº“çš„ä½¿ç”¨æ˜¯æœ‰é™åˆ¶çš„ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨butterknifeï¼Œè¿™æ—¶å€™ï¼Œæˆ‘ä»¬åˆå¾—ä»æ³¨è§£æ”¹å›findviewbyidé’ˆå¯¹ä¸Šé¢çš„ä¸¤ç§æƒ…å†µï¼Œå¦‚æœviewæ¯”è¾ƒå°‘è¿˜å¥½è¯´ï¼Œå¦‚æœæœ‰å‡ åä¸ªviewï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸€ä¸ªä¸ªçš„æ‰‹åŠ¨åˆ é™¤æ³¨è§£ï¼Œå†™findviewbyidè¯­å¥ï¼Œç®€ç›´æ˜¯ä¸€åœºå™©æ¢¦ï¼ˆåˆ«é—®æˆ‘ä¸ºä»€ä¹ˆçŸ¥é“è¿™æ˜¯å™©æ¢¦ï¼‰æ‰€ä»¥ï¼Œè¿™ç§æœ‰è§„å¾‹åˆé‡å¤ç®€å•çš„å·¥ä½œä¸ºä»€ä¹ˆä¸èƒ½ç”¨ä¸€ä¸ªæ’ä»¶æ¥å®ç°å‘¢ï¼Ÿäºæ˜¯RemoveButterKnifeçš„æƒ³æ³•å°±å‡ºç°äº†ã€‚ å…·ä½“ä»‹ç» 23.AndroidProguardPluginä¸€é”®ç”Ÿæˆé¡¹ç›®æ··æ·†ä»£ç æ’ä»¶ï¼Œå€¼å¾—ä½ å®‰è£…~(ä¸è¿‡ç›®å‰å¯èƒ½æœ‰äº›ç¬¬ä¸‰æ–¹é¡¹ç›®çš„æ··æ·†è¿˜æœªæ·»åŠ å®Œå…¨) 24.otto-intellij-pluginottoäº‹ä»¶å¯¼èˆªå·¥å…·ã€‚ 25.eventbus-intellij-plugineventbuså¯¼èˆªæ’ä»¶(å¯¹äºæœ€æ–°ç‰ˆçš„ EventBus 3.0.0 å¥½åƒæ— æ•ˆ,è¯·æ›¿æ¢ä¸ºeventbus3-intellij-pluginæ­¤æ’ä»¶åœ°å€åœ¨æœ¬æ–‡ç¬¬51ä¸ª) 26.idea-markdownmarkdownæ’ä»¶ 27.Sexy Editorè®¾ç½®ASä»£ç ç¼–è¾‘åŒºçš„èƒŒæ™¯å›¾ é¦–å…ˆç‚¹å‡»ç•Œé¢çš„è®¾ç½®æŒ‰é’® è¿›å…¥è®¾ç½®ç•Œé¢ï¼Œé€‰ä¸­Plugins,å³è¾¹é€‰æ‹© Browser â€¦ ï¼Œè¾“å…¥Sexy â€¦ ä¸‹é¢è‡ªåŠ¨å¼¹å‡ºå€™é€‰æ’ä»¶ï¼Œå³è¾¹ç‚¹å‡»Install å®‰è£…å®‰è£…æˆåŠŸ åéœ€è¦é‡å¯ASé‡å¯å®Œæˆä¹‹å è¿›å…¥è®¾ç½®ç•Œé¢ é€‰æ‹©other Setting ä¸‹çš„Sexy Editor ï¼Œ å³ä¾§ insert ä¸€å¼ æˆ–å¤šå¼ å›¾ç‰‡å³å¯ï¼Œä¸Šé¢çš„å…¶ä»–è®¾ç½®å¯ä»¥è®¾ç½®æ–¹ä½ é—´éš”æ—¶é—´ é€æ˜åº¦ç­‰ç­‰ï¼Œè®¾ç½®å®Œæˆåï¼Œè¦å…³é—­æ‰“å¼€çš„æ–‡ä»¶ï¼Œé‡æ–°æ‰“å¼€é¡¹ç›®æ–‡ä»¶å³å¯åœ¨ä»£ç ç¼–è¾‘åŒºæ˜¾ç¤ºæ’å…¥çš„å›¾ç‰‡ï¼Œä½œä¸ºä»£ç ç¼–è¾‘åŒºçš„èƒŒæ™¯å›¾ã€‚ 28.folding-pluginå¸ƒå±€æ–‡ä»¶åˆ†ç»„çš„æ’ä»¶ 29.Android-DPI-CalculatorDPIè®¡ç®—æ’ä»¶ ä½¿ç”¨ï¼šæˆ–è€… 30.gradle-retrolambdaåœ¨java 6 7ä¸­ä½¿ç”¨ lambdaè¡¨è¾¾å¼æ’ä»¶ ä¿®æ”¹ç¼–è¯‘çš„jdkä¸ºjava8: 31.Android Studio Prettifyå¯ä»¥å°†ä»£ç ä¸­çš„å­—ç¬¦ä¸²å†™åœ¨string.xmlæ–‡ä»¶ä¸­ é€‰ä¸­å­—ç¬¦ä¸²é¼ æ ‡å³é”®é€‰æ‹©å›¾ä¸­æ‰€ç¤º è¿™ä¸ªæ’ä»¶è¿˜å¯ä»¥è‡ªåŠ¨ä¹¦å†™findViewById 32.Material Theme UIæ·»åŠ Materialä¸»é¢˜åˆ°ä½ çš„AS 33..ignoreæˆ‘ä»¬éƒ½çŸ¥é“åœ¨Git ä¸­æƒ³è¦è¿‡æ»¤æ‰ä¸€äº›ä¸æƒ³æäº¤çš„æ–‡ä»¶ï¼Œå¯ä»¥æŠŠç›¸åº”çš„æ–‡ä»¶æ·»åŠ åˆ°.gitignore ä¸­ï¼Œè€Œ.gitignore è¿™ä¸ªAndroid Studio æ’ä»¶æ ¹æ®ä¸åŒçš„è¯­è¨€æ¥é€‰æ‹©æ¨¡æ¿ï¼Œå°±ä¸ç”¨è‡ªå·±åœ¨è´¹äº‹æ·»åŠ ä¸€äº›æ–‡ä»¶äº†ï¼Œè€Œä¸”è¿˜æœ‰è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè¿‡æ»¤æ–‡ä»¶å†ä¹Ÿä¸è¦å¤åˆ¶æ–‡ä»¶åäº†ã€‚æˆ‘ä»¬åšé¡¹ç›®çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯è¦æäº¤çš„ï¼Œæ¯”å¦‚æ„å»ºçš„build æ–‡ä»¶å¤¹ï¼Œæœ¬åœ°é…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªModule ç”Ÿæˆçš„iml æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬æ¯æ¬¡addï¼Œcommit éƒ½ä¼šä¸å°å¿ƒæŠŠå®ƒä»¬æ·»åŠ ä¸Šå»ï¼Œè€Œgitignore å°±æ˜¯è§£å†³è¿™ç§ç—›ç‚¹çš„ï¼Œå¦‚æœä½ ä¸æƒ³æäº¤çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™å°†è¿™ä¸ªæ–‡ä»¶ä¸­æ·»åŠ å³å¯ï¼Œå°†ä¸€äº›é€šç”¨çš„ä¸œè¥¿å±è”½æ‰ã€‚ 34.CheckStyle-IDEACheckStyle-IDEA æ˜¯ä¸€ä¸ªæ£€æŸ¥ä»£ç é£æ ¼çš„æ’ä»¶ï¼Œæ¯”å¦‚åƒå‘½åçº¦å®šï¼ŒJavadocï¼Œç±»è®¾è®¡ç­‰æ–¹é¢è¿›è¡Œä»£ç è§„èŒƒå’Œé£æ ¼çš„æ£€æŸ¥ï¼Œä½ ä»¬å¯ä»¥éµä»åƒGoogle Oracle çš„Java ä»£ç æŒ‡å— ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„è§„åˆ™æ¥è®¾ç½®é…ç½®æ–‡ä»¶ï¼Œä»è€Œæœ‰æ•ˆçº¦æŸä½ è‡ªå·±æ›´å¥½åœ°éµå¾ªä»£ç ç¼–å†™è§„èŒƒã€‚ 35.Markdown Navigatorgithub:Markdown NavigatorMarkdownæ’ä»¶ 36.ECTranslationAndroid Studio Plugin,Translate English to Chinese. Android Studio ç¿»è¯‘æ’ä»¶,å¯ä»¥å°†è‹±æ–‡ç¿»è¯‘ä¸ºä¸­æ–‡ã€‚ 37.PermissionsDispatcher plugingithub:PermissionsDispatcher pluginè‡ªåŠ¨ç”Ÿæˆ6.0æƒé™çš„ä»£ç  38.WakaTimegithub:WakaTimeè®°å½•ä½ åœ¨IDEä¸Šçš„å·¥ä½œæ—¶é—´ 39.AndroidWiFiADBæ— çº¿è°ƒè¯•åº”ç”¨ 40.AndroidLocalizationerå¯ç”¨äºå°†é¡¹ç›®ä¸­çš„ string èµ„æºè‡ªåŠ¨ç¿»è¯‘ä¸ºå…¶ä»–è¯­è¨€çš„ Android Studio/IntelliJ IDEA æ’ä»¶ 41.TranslationPluginåˆä¸€ç¿»è¯‘æ’ä»¶,å¯ä¸­è‹±äº’è¯‘ã€‚ 42.SingletonTestå¿«é€Ÿç”Ÿæˆå•ä¾‹æ¨¡å¼çš„é¢„è®¾ 43.BorePluginAndroid Studio è‡ªåŠ¨ç”Ÿæˆå¸ƒå±€ä»£ç æ’ä»¶ ä»£ç ç”Ÿæˆè§„åˆ™a.è‡ªåŠ¨éå†ç›®æ ‡å¸ƒå±€ä¸­æ‰€æœ‰å¸¦idçš„æ–‡ä»¶, æ— idçš„ä¸ä¼šè¯†åˆ«å¤„ç†b.æ§ä»¶ç”Ÿæˆçš„å˜é‡åé»˜è®¤ä¸ºidåç§°, å¯ä»¥åœ¨å¼¹å‡ºç¡®è®¤æ¡†å³ä¾§çš„åç§°è¾“å…¥æ ä¸­è‡ªè¡Œä¿®æ”¹c.æ‰€æœ‰çš„Buttonæˆ–è€…å¸¦clickable=trueçš„æ§ä»¶, éƒ½ä¼šè‡ªåŠ¨åœ¨ä»£ç ä¸­ç”ŸæˆsetOnClickListenerç›¸å…³ä»£ç d.æ‰€æœ‰EditTextæ§ä»¶, éƒ½ä¼šåœ¨ä»£ç ä¸­ç”Ÿæˆéç©ºåˆ¤æ–­ä»£ç , å¦‚æœä¸ºç©ºä¼šæç¤ºEditTextçš„hintå†…å®¹, å¦‚æœhintä¸ºç©ºåˆ™æç¤ºxxxå­—ç¬¦ä¸²ä¸èƒ½ä¸ºç©ºå­—æ ·, æœ€åä¼šæŠŠæ‰€æœ‰è¾“å…¥æ¡†çš„éªŒè¯åˆå¹¶åˆ°ä¸€ä¸ªsubmitæ–¹æ³•ä¸­e.ä¼šè‡ªåŠ¨è¯†åˆ«å¸ƒå±€ä¸­çš„includeæ ‡ç­¾, å¹¶è¯»å–å¯¹åº”å¸ƒå±€ä¸­çš„æ§ä»¶ 44.jimu Mirrorèƒ½å¤Ÿå®æ—¶é¢„è§ˆAndroidå¸ƒå±€ï¼Œå®ƒä¼šç›‘å¬å¸ƒå±€æ–‡ä»¶çš„æ”¹åŠ¨ï¼Œå¦‚æœæœ‰ä»£ç å˜åŒ–ï¼Œå°±ä¼šç«‹å³åˆ·æ–°UIã€‚ 45.jRebel For Androidä¸ä»…èƒ½å¤Ÿåšåˆ°UIå¸ƒå±€çš„å®æ—¶é¢„è§ˆï¼Œå®ƒç”šè‡³åšåˆ°äº†è®©ä½ æ›´æ”¹javaä»£ç åå°±èƒ½å®æ—¶æ›¿æ¢apkä¸­çš„ç±»æ–‡ä»¶ï¼Œè¾¾åˆ°åº”ç”¨å®æ—¶åˆ·æ–°ï¼Œå®˜ç½‘çš„ä»‹ç»æ˜¯ï¼šSkip build, install and runï¼Œå› æ­¤å®ƒå¯ä»¥èŠ‚çº¦æˆ‘ä»¬å¾ˆå¤šå¾ˆå¤šçš„æ—¶é—´ï¼Œå®ƒçš„æ•ˆæœä¹Ÿååˆ†ä¸é”™ã€‚ 46.sdk-manager-pluginSDKç®¡ç†æ’ä»¶ï¼Œè‡ªåŠ¨æ£€æµ‹æ›´æ–°å¹¶ä¸‹è½½ã€‚(å›¾ç‰‡ä¸æ’ä»¶æ— å…³å“ˆ) 47.Codotaæœç´¢æœ€å¥½çš„Androidä»£ç ã€‚(Studioé‡Œé¢ç›´æ¥å¯ä»¥æœåˆ°æ­¤æ’ä»¶) 48.LayoutFormatterdrakeet å¼€å‘ä¸€ä¸ªä¸€é”®æ ¼å¼åŒ–ä½ çš„ XML æ–‡ä»¶çš„ Android Studio æ’ä»¶ï¼Œè‡³äºä¸ºä»€ä¹ˆä¸ç”¨ Android Studio è‡ªå¸¦çš„æ ¼å¼åŒ–åŠŸèƒ½è€Œç”¨è¿™ä¸ªæ’ä»¶ï¼Œå¯ä»¥çœ‹ä¸‹ä½œè€…çš„ä¸€ç¯‡ Blog -&gt; å½“æˆ‘ä»¬è°ˆ XML å¸ƒå±€æ–‡ä»¶ä»£ç çš„ä¼˜é›…æ€§ 49.android-strings-search-pluginä¸€ä¸ªå¯ä»¥é€šè¿‡è¾“å…¥æ–‡å­—æ‰¾åˆ°strings.xmlèµ„æºçš„æ’ä»¶ 50.ideaVimvim æœ¬èº«å°±æ˜¯ä¸€æ¬¾å¾ˆä¼˜ç§€çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œè€ŒAndroid Studio æ›´æ˜¯ä¸€æ¬¾ç¼–å†™APPåº”ç”¨çš„ç¥å™¨ã€‚å¦‚æœä¸¤ä¸ªæ¬¾ä¼˜ç§€çš„è½¯ä»¶ç»“åˆåœ¨ä¸€èµ·æ„Ÿè§‰ä¼šæ€æ ·å‘¢ï¼Ÿè¯¦ç»†è¯·çœ‹æ–‡ç« :Android Studio ï¼‹Vim 51.eventbus3-intellij-pluginå¼•å¯¼ EventBus çš„ post å’Œ event(å¯¹äºæœ€æ–°ç‰ˆçš„ EventBus 3.0.0 æœ‰æ•ˆ)ä¸»è¦Bugä¿®å¤å·¥ä½œï¼šä¿®æ”¹åŒ…åå’Œæ–¹æ³•åä»¥é€‚åº” EventBus 3.Xæ›¿æ¢ä¸€ä¸ªåœ¨æ–°ç‰ˆçš„ intellij plugin SDK å·²ç»ä¸å­˜åœ¨çš„ç±»å¢åŠ è‹¥å¹² try-catch ï¼Œé˜²æ­¢æ’ä»¶å´©æºƒ 52.ExynapExynap ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…è‡ªåŠ¨ç”Ÿæˆæ ·æ¿ä»£ç çš„ AndroidStudio æ’ä»¶ 53.gradle-cleaner-intellij-pluginForce clear delaying &amp; no longer needed Gradle tasks. 54.MVPHelperä¸€æ¬¾Intellj IDEA å’ŒAndroid Studioçš„æ’ä»¶ï¼Œå¯ä»¥ä¸ºMVPç”Ÿæˆæ¥å£ä»¥åŠå®ç°ç±»ï¼Œè§£æ”¾åŒæ‰‹ã€‚å…·ä½“è¯·æŸ¥çœ‹Android Studioæ’ä»¶ä¹‹MVPHelperï¼Œä¸€é”®ç”ŸæˆMVPä»£ç ä¸€æ–‡ å¦‚æœè¿˜æœ‰æ›´å¥½ç©æ›´å¥½ç”¨çš„æ’ä»¶æ¬¢è¿fork + pull request å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"Androidè¿›é˜¶èµ„æ–™å¤§å…¨","date":"2017-07-22T09:29:25.000Z","path":"2017/07/22/Androidè¿›é˜¶èµ„æ–™å¤§å…¨.html","text":"ç›®å½• ä¹¦ç± å¼€å‘ç¯å¢ƒ/å·¥å…· åšå®¢ ç¤¾åŒº å¼€æºé¡¹ç›®å­¦ä¹  Android å¼€å‘è€…æ‚å¿—å‘¨åˆŠ Awesome ç³»åˆ— åŠ¨ç”»ç³»åˆ— Material Design è®¾è®¡ ç´ æ å¼€æºåº“æ”¶é›† è®¾è®¡æ¨¡å¼ å®è·µç¯‡ Git æ•™ç¨‹ æ–‡æ¡£ å…¶å®ƒèµ„æ–™æ”¶é›† çŸ¥ä¹ä¸Šçš„è®¨è®º è´¡çŒ®è€… License ============================================================= ä¹¦ç± ä¹¦ç±åç§° æ¨èç†ç”± Thinking In Java ä¸­æ–‡ç‰ˆ å­¦ä¹  Android å¼€å‘, é¦–å…ˆéœ€è¦ Java åŸºç¡€, è¿™é‡Œæ¨è Thinking In Java, Thinking In Java æ˜¯ Java çš„ç»å…¸ä¹¦ç±, æ˜¯å­¦ä¹  Java è¯­è¨€å¿…å¤‡ä¹¦ç± ç¬¬ä¸€è¡Œä»£ç  éƒ­éœ–å¤§ç¥çš„æ°ä½œ, éƒ­ç¥åœ¨CSDNä¸­çš„åšå®¢æ–‡ç« éå¸¸ä¸é”™, ä¹¦æˆ‘çœ‹äº†, éå¸¸é€‚åˆæ–°æ‰‹, é‡Œé¢çš„å†…å®¹éå¸¸æ£’, å»ºè®®ç»“åˆéƒ­ç¥åšå®¢æ–‡ç« ä¸€èµ·æ¥å­¦ä¹  ç–¯ç‹‚Androidè®²ä¹‰ç¬¬ä¸‰ç‰ˆ ä½œè€…æ˜¯æåˆš, è¿™æœ¬ä¹¦æ˜¯åŸºäº Android 5.0 æ¥è®²çš„, æˆ‘çœ‹è¿‡ç¬¬äºŒç‰ˆ, è¿™æœ¬ä¹¦ç»™æˆ‘ç¬¬ä¸€æ„Ÿè§‰å°±æ˜¯å¾ˆåš, ä½†é‡Œé¢å†…å®¹å†™çš„è¿˜æ˜¯å¾ˆè¯¦ç»†çš„, ä»£ç å¾ˆå¤š, å¯ä»¥è·Ÿç€ä»£ç ä¸€æ­¥æ­¥æ•² Androidç¾¤è‹±ä¼  æœ¬ä¹¦ä½œè€… @Tomcat çš„çŒ«, æ›¾å°±èŒäºä¸Šæµ· TCL é€šè®¯, ä»äº‹ Alcatel(é˜¿å°”å¡ç‰¹) Android æ‰‹æœºç³»ç»Ÿçš„å®šåˆ¶å·¥ä½œ, æ´»è·ƒäº CSDN, ç›®å‰å°±èŒäºä¸Šæµ·æ²ªæ±Ÿç½‘ Android å¼€å‘éƒ¨RDé¡¹ç›®ç»„, è´Ÿè´£æ²ªæ±Ÿ App çš„åŠŸèƒ½é¢„ç ” Androidå¼€å‘è‰ºæœ¯æ¢ç´¢ ç”±@ä»»ç‰åˆšCoderæ‰€è‘—, æ˜¯ä¸€æœ¬ Android è¿›é˜¶ç±»ä¹¦ç±, é‡‡ç”¨ç†è®º, æºç å’Œå®è·µç›¸ç»“åˆçš„æ–¹å¼æ¥é˜è¿°é«˜æ°´å‡†çš„ Android åº”ç”¨å¼€å‘è¦ç‚¹. æœ¬ä¹¦ä»ä¸‰ä¸ªæ–¹é¢æ¥ç»„ç»‡å†…å®¹: ç¬¬ä¸€, ä»‹ç» Android å¼€å‘è€…ä¸å®¹æ˜“æŒæ¡çš„ä¸€äº›çŸ¥è¯†ç‚¹: ç¬¬äºŒ,ç»“åˆAndroidæºä»£ç å’Œåº”ç”¨å±‚å¼€å‘è¿‡ç¨‹, èä¼šè´¯é€š, ä»‹ç»ä¸€äº›æ¯”è¾ƒæ·±å…¥çš„çŸ¥è¯†ç‚¹: ç¬¬ä¸‰, ä»‹ç»ä¸€äº›æ ¸å¿ƒæŠ€æœ¯å’ŒAndroidçš„æ€§èƒ½ä¼˜åŒ–æ€æƒ³. App ç ”å‘å½• æœ¬ä¹¦ä½œè€…æ˜¯åŒ…å»ºå¼º, æœ¬ä¹¦æ˜¯ä½œè€…å¤šå¹´ App å¼€å‘çš„ç»éªŒæ€»ç»“, ä» App æ¶æ„çš„è§’åº¦, é‡ç‚¹æ€»ç»“äº† Android åº”ç”¨å¼€å‘ä¸­å¸¸è§çš„å®ç”¨æŠ€å·§å’Œç–‘éš¾é—®é¢˜è§£å†³æ–¹æ³•, ä¸ºæ‰“é€ é«˜è´¨é‡ App æä¾›æœ‰ä»·å€¼çš„å®è·µæŒ‡å¯¼, è¿…é€Ÿæå‡åº”ç”¨å¼€å‘èƒ½åŠ›å’Œè§£å†³ç–‘éš¾é—®é¢˜çš„èƒ½åŠ›. è¿™æœ¬ä¹¦éå¸¸æœ‰åˆ©äº Android å¼€å‘è€…è¿›é˜¶. Android è®¾è®¡æ¨¡å¼æºç åˆ†æ æœ¬ä¹¦ä½œè€…æ˜¯å¼€å‘æŠ€æœ¯å‰çº¿åˆ›ç«‹è€…ä¹‹ä¸€ Mr.Simple, è¯¥ä¹¦ä» Android æºç çš„è§’åº¦ç”±æµ…å…¥æ·±åœ°å‰–æè®¾è®¡æ¨¡å¼çš„è¿ç”¨, è®©å·¥ç¨‹å¸ˆä»¬æŠŠè®¾è®¡ä¸æ¨¡å¼é‡è§†èµ·æ¥, æå‡è‡ªå·±çš„è®¾è®¡èƒ½åŠ›ä¸ä»£ç è´¨é‡ å¼€å‘ç¯å¢ƒ/å·¥å…·(é™„ä¸Š: ç”± @è„‰è„‰ä¸å¾—è¯­ æ”¶é›†ç»´æŠ¤è¶…å¤šå¼€å‘å·¥å…·ä¸‹è½½åœ°å€ AndroidDevTools, åäº”ä¸ªå·¥å…·èµ„æ–™åœ¨ stormzhang åšå®¢ä¸­æ‰¾åˆ°çš„,åœ°å€) ç¯å¢ƒ/å·¥å…· ç®€è¿° Android Studio è¿™ä¸ªå¼€å‘å·¥å…·ä¸Šæ‰‹éœ€è¦ä¸€å®šçš„æ—¶é—´, è‡ªä» Google æ¨å‡º1.0æ­£å¼ç‰ˆ, è¿™ä¸ªå·¥å…·ä¸€ç›´ç«çˆ†, ç›®å‰ github ä¸Šé¢çš„ç»å¤§å¤šæ•°å¼€æºé¡¹ç›®éƒ½æ˜¯ä½¿ç”¨ Android Studio å·¥å…·, è¿™å°±æ˜¯ Android å¼€å‘å·¥å…·çš„æœªæ¥, æ‰€ä»¥æåŠ›æ¨è Android å¼€å‘äººå‘˜ä½¿ç”¨è¿™ä¸ªå·¥å…·, è¯¥å·¥å…·å·²æ›´æ–°åˆ° 2.0 é¢„è§ˆç‰ˆ, æ€§èƒ½é€æ¸ç¨³å®šæé«˜, æ²¡æœ‰ä¹‹å‰é‚£ä¹ˆå¡äº† Genymotion å¼ºå¤§å¥½ç”¨é«˜æ€§èƒ½çš„ Android æ¨¡æ‹Ÿå™¨, è‡ªå¸¦çš„é‚£ä¸ªæ¨¡æ‹Ÿå™¨ç®€ç›´ä¸å¿ç›´è§†, å¯åŠ¨è¶…æ…¢çš„, è·Ÿè¿™ä¸ªæ²¡æ³•æ¯”, æ— è®ºä½ æ˜¯ç”¨ Eclipse è¿˜æ˜¯ Android Studio é‡Œé¢éƒ½æœ‰ Genymotion æ’ä»¶ jadx ä¸€ä¸ª Android åç¼–è¯‘ç¥å™¨, ä¸åŒäºå¸¸è§çš„ dex2jar, è¿™ä¸ªåç¼–è¯‘å™¨ç”Ÿæˆä»£ç çš„ try/catch æ¬¡æ•°æ›´å°‘, Viewä¹Ÿä¸å†æ˜¯æ•°å­— id äº†, å¯è¯»æ€§æ›´é«˜ android-selector å¯ä»¥æ ¹æ®æŒ‡å®šé¢œè‰²ç”Ÿæˆ Selector Drawable çš„æ’ä»¶ GradleDependenciesHelperPlugin Gradle ä¾èµ–è‡ªåŠ¨è¡¥å…¨æ’ä»¶ Smali Viewer sv æ˜¯ä¸€æ¬¾å…è´¹ APK åˆ†æè½¯ä»¶, å¯¹ä½ æ„Ÿå…´è¶£çš„ APP åˆ†æçœ‹çœ‹å®ƒä»¬éƒ½ç”¨äº†äº›ä»€ä¹ˆ, å¯¹ä½ å­¦ä¹ å€Ÿé‰´æœ‰ä¸€å®šå¸®åŠ© folding-plugin layout æ–‡ä»¶å¤¹é‡Œçš„å¸ƒå±€æ–‡ä»¶ä¸€èˆ¬å¾ˆé•¿å¾ˆé•¿æ²¡æœ‰ç›®å½•, è¿™ä¸ªæ’ä»¶å°±å¯ä»¥æŠŠ layout åˆ†å¥½å±‚çº§ç»“æ„, ç±»ä¼¼ src ä¸‹ç›®å½•ç»“æ„ CodeGlance åœ¨ç¼–è¾‘ä»£ç æœ€å³ä¾§, æ˜¾ç¤ºä¸€å—ä»£ç å°åœ°å›¾ Statistic ç»Ÿè®¡æ•´ä¸ªé¡¹ç›®è¡Œæ•°çš„æ’ä»¶, è¿™å¯è¡¨ç¤ºæˆ‘ä»¬æ—¥æ—¥å¤œå¤œè¾›è¾›è‹¦è‹¦å¿…å¤‡æ’ä»¶ idea-markdown åœ¨ AS ä¸­ç¼–å†™ Markdown æ–‡ä»¶, å¯ä»¥ç›´æ¥é¢„è§ˆç½‘é¡µæ˜¾ç¤ºæ•ˆæœ, å¯¹äºä½ ç»å¸¸ç¼–å†™ Markdown æ–‡ä»¶çš„ä½ å€¼å¾—æ‹¥æœ‰è¿™ä¸ªæ’ä»¶ Stetho Stetho æ˜¯ Facebook å‡ºå“çš„ä¸€ä¸ªå¼ºå¤§çš„ Android è°ƒè¯•å·¥å…·,ä½¿ç”¨è¯¥å·¥å…·ä½ å¯ä»¥åœ¨ Chrome Developer Tools æŸ¥çœ‹ App çš„å¸ƒå±€, ç½‘ç»œè¯·æ±‚(ä»…é™ä½¿ç”¨ Volley, okhttp çš„ç½‘ç»œè¯·æ±‚åº“), sqlite, preference, ä¸€åˆ‡éƒ½æ˜¯å¯è§†åŒ–çš„æ“ä½œ,æ— é¡»è‡ªå·±åœ¨å»ä½¿ç”¨ adb, ä¹Ÿä¸éœ€è¦ root ä½ çš„è®¾å¤‡ ClassyShark ClassyShark æ˜¯ Google å‘å¸ƒçš„ä¸€æ¬¾å¯ä»¥æŸ¥çœ‹ Android å¯æ‰§è¡Œæ–‡ä»¶çš„æµè§ˆå·¥å…·, æ”¯æŒ.dex, .aar, .so, .apk, .jar, .class, .xml ç­‰æ–‡ä»¶æ ¼å¼, åˆ†æé‡Œé¢çš„å†…å®¹åŒ…æ‹¬ classes.dex æ–‡ä»¶, åŒ…æ–¹æ³•æ•°é‡, ç±», å­—ç¬¦ä¸², ä½¿ç”¨çš„ NativeLibrary ç­‰ AndroidWiFiADB ä½¿ç”¨ WiFi è¿æ¥è€Œä¸éœ€è¦ USB è¿æ¥ Android è®¾å¤‡è¾¾åˆ°å®‰è£…, è¿è¡Œ, è°ƒè¯•åº”ç”¨çš„ç›®çš„ checkstyle-idea Checkstyle-idea æ˜¯ä¸€æ¬¾æ£€æŸ¥è‡ªå·±å†™çš„ä»£ç æ˜¯å¦ç¬¦åˆè§„èŒƒçš„æ’ä»¶, è¯¥æ’ä»¶æ˜¯æ ¹æ® checkstyle.xml æ–‡ä»¶æ¥æ£€æŸ¥çš„, checkstyle.xml æ–‡ä»¶å¯ä»¥ç”±è‡ªå·±è‡ªå·±å®šä¹‰, ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº›å¤§å…¬å¸å®šä¹‰çš„è§„èŒƒ, å¦‚æœä¸æ‡‚å¾—å¦‚ä½•å®šä¹‰, å¯ä»¥æŸ¥çœ‹ å®˜æ–¹æ–‡æ¡£, è¯¥æ’ä»¶çš„è¯¦ç»†ä»‹ç»ä»¥åŠä½¿ç”¨, å¯ä»¥çœ‹ä¸€ä¸‹å’•å’šå¤§ä¾ å†™çš„ æ–‡ç«  ECTranslation ECTranslation æ˜¯ Android Studio å¼€å‘å·¥å…·çš„ä¸€ä¸ªç¿»è¯‘æ’ä»¶, å¯ä»¥å°†è‹±æ–‡ç¿»è¯‘ä¸ºä¸­æ–‡, è‹±è¯­åŸºç¡€å·®çš„ç«¥é‹è£…ä¸Šå®ƒå°±å¯ä»¥è½»æ¾é˜…è¯» Android æºç å•¦ Android Methods Count ç»Ÿè®¡ Android ä¾èµ–åº“ä¸­æ–¹æ³•çš„æ€»ä¸ªæ•°, é¿å…åº”ç”¨æ–¹æ³•æ•°è¶…è¿‡ 65K é—®é¢˜ AndroidLocalizationer å¯ç”¨äºå°†é¡¹ç›®ä¸­çš„ string èµ„æºè‡ªåŠ¨ç¿»è¯‘ä¸ºå…¶ä»–è¯­è¨€çš„æ’ä»¶, å…¶ç¿»è¯‘æ”¯æŒä½¿ç”¨ Microsoft Translator æˆ– Google Translation ButterKnife Zelezny ButterKnife ç”Ÿæˆå™¨, ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•æ–¹ä¾¿, ä¸ºä½ ç®€å†™äº†å¾ˆå¤š findViewId ä»£ç , å¦‚æœä½ ä¸äº†è§£ ButterKnife çš„å¯ä»¥åˆ°è¿™é‡Œçœ‹çœ‹ SelectorChapek è®¾è®¡å¸ˆç»™æˆ‘ä»¬æä¾›å¥½äº†å„ç§èµ„æº, æ¯ä¸ªæŒ‰é’®éƒ½è¦å†™ä¸€ä¸ªselectoræ˜¯ä¸æ˜¯å¾ˆéº»çƒ¦? è¿™ä¹ˆè¿™ä¸ªæ’ä»¶å°±ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜è€Œç”Ÿ, ä½ åªéœ€è¦åšçš„æ˜¯å‘Šè¯‰è®¾è®¡å¸ˆä»¬æŒ‰ç…§è§„èŒƒå‘½åå°±å¥½äº†, å…¶ä»–ä¸€é”®æå®š GsonFormat ç°åœ¨å¤§å¤šæ•°æœåŠ¡ç«¯ api éƒ½ä»¥ json æ•°æ®æ ¼å¼è¿”å›, è€Œå®¢æˆ·ç«¯éœ€è¦æ ¹æ® api æ¥å£ç”Ÿæˆç›¸åº”çš„å®ä½“ç±», è¿™ä¸ªæ’ä»¶æŠŠè¿™ä¸ªè¿‡ç¨‹è‡ªåŠ¨åŒ–äº†, èµ¶ç´§ä½¿ç”¨èµ·æ¥å§ ParcelableGenerator Androidä¸­çš„åºåˆ—åŒ–æœ‰ä¸¤ç§æ–¹å¼, åˆ†åˆ«æ˜¯å®ç° Serializable æ¥å£å’Œ Parcelable æ¥å£, ä½†åœ¨ Android ä¸­æ˜¯æ¨èä½¿ç”¨ Parcelable, åªä¸è¿‡æˆ‘ä»¬è¿™ç§æ–¹å¼è¦æ¯”Serializableæ–¹å¼è¦ç¹ç, é‚£ä¹ˆæœ‰äº†è¿™ä¸ªæ’ä»¶ä¸€åˆ‡å°±okäº† LeakCanary è‰¯å¿ƒä¼ä¸š Square æœ€è¿‘åˆšå¼€æºçš„ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·, å¼ºçƒˆæ¨è, å¸®åŠ©ä½ åœ¨å¼€å‘é˜¶æ®µæ–¹ä¾¿çš„æ£€æµ‹å‡ºå†…å­˜æ³„éœ²çš„é—®é¢˜, ä½¿ç”¨èµ·æ¥æ›´ç®€å•æ–¹ä¾¿, è€Œä¸”æˆ‘ä»¬å›¢é˜Ÿç¬¬ä¸€æ—¶é—´ä½¿ç”¨å¸®åŠ©æˆ‘ä»¬å‘ç°äº†ä¸å°‘é—®é¢˜, è‹±æ–‡ä¸å¥½çš„è¿™é‡Œæœ‰é›·é”‹åŒå¿—ç¿»è¯‘çš„ä¸­æ–‡ç‰ˆ LeakCanary ä¸­æ–‡ä½¿ç”¨è¯´æ˜ æ›´å¤š è¯¥ä½œè€…æ”¶é›†æ•´ç†äº† 40 ä¸ªæ’ä»¶, å¯ä»¥è¯´æ˜¯å²ä¸Šæœ€å…¨çš„äº† åšå®¢ åšå®¢åœ°å€ åšä¸»ä¿¡æ¯ Android Developers Blog Androidå®˜ç½‘åšå®¢, åœ¨ä¸Šé¢å¯ä»¥å…³æ³¨ Android æœ€æ–°çš„è¿›å±•ä¸æœ€æƒå¨çš„åšå®¢(éœ€ç¿»å¢™) stormzhang åšä¸»æ˜¯ä¸Šæµ·è–„è·ç§‘æŠ€å¼€å‘ä¸»ç®¡, ä»–çš„åšå®¢åˆ†äº«äº†ä»–ä»ç¼–ç¨‹ç™½ç—´åˆ°è‡ªå­¦ Android ä¸€è·¯èµ°è¿‡çš„ç»éªŒ, å†™äº†ä¸€ç¯‡ Androidå­¦ä¹ ä¹‹è·¯ å¸®åŠ©äº†æ— æ•°äºº, é‡Œé¢è¿˜æœ‰å¾ˆå¤šå¥½çš„æ–‡ç« éå¸¸é€‚åˆæ–°æ‰‹å…¥é—¨, å¹¶ä¸”æ˜¯å¾®ä¿¡å…¬ä¼—å·ã€ŒAndroidDeveloperã€çš„è¿è¥è€…, å¯ä»¥ç®—æ˜¯ Android ç•Œæœ€æœ‰å½±å“åŠ›çš„å…¬ä¼—å·ä¹‹ä¸€äº†, å¼ºçƒˆæ¨èå…³æ³¨ èƒ¡å‡¯ ç›®å‰å°±èŒäºè…¾è®¯ä¸Šæµ·ä»äº‹ Android å¼€å‘çš„å·¥ä½œ, å‘èµ· Google Android å®˜æ–¹åŸ¹è®­è¯¾ç¨‹ä¸­æ–‡ç‰ˆç¿»è¯‘, è¿™è¯¾ç¨‹æ˜¯å­¦ä¹  Android åº”ç”¨å¼€å‘çš„ç»ä½³èµ„æ–™ Trinea ç›®å‰åœ¨æ»´æ»´è´Ÿè´£ Android å®¢æˆ·ç«¯æŠ€æœ¯, ä»–æ˜¯å¼€æºåº“é¡¹ç›®æ”¶é›†è¾¾äºº, ä½ æƒ³è¦çš„å¼€æºåº“ä¸Šé¢éƒ½æœ‰, å¹¶ä¸”å‘èµ· Android å¼€æºé¡¹ç›®æºç è§£æ, åœ¨ä½¿ç”¨å¼€æºåº“çš„åŒæ—¶ä¹Ÿå¯ä»¥çŸ¥é“å…¶ä¸­åŸç†, å¤§å®¶å¯ä»¥å»å…³æ³¨ä¸€ä¸‹, åœ°å€ éƒ­éœ– åšä¸»éƒ­éœ–æ˜¯å¤§ç¥, äººäººéƒ½ç§°â€éƒ­ç¥â€, æ˜¯ç¬¬ä¸€è¡Œä»£ç çš„ä½œè€…, åšä¸»åœ¨ CSDN ä¸Šæ‰€å†™çš„æ–‡ç« éƒ½éå¸¸å€¼å¾—å­¦ä¹  ä»£ç å®¶ 90å Android å¤§ç¥, ç§°ä½œåº“è¾¾äºº, åšä¸»æ”¶é›†äº†å¾ˆå¤š Android å¼€æºåº“, åšä¸»è‡ªå·±ä¹Ÿåšäº†å¾ˆå¤šå¼€æºåº“, éå¸¸å€¼å¾—å­¦ä¹  light_sky Android å¼€å‘å·¥ç¨‹å¸ˆ, ç›®å‰åœ¨åŒ—äº¬å·¥ä½œ. Google big fan, çƒ­çˆ±å¼€æº, çƒ­çˆ±åˆ†äº«, æ´»è·ƒäº GitHub, G+, Twitter, æ•æ‰Androidæœ€æ–°èµ„è®¯å’ŒæŠ€æœ¯, ViewPagerIndicator å¼€æºé¡¹ç›®åˆ†æè€… å¼ é¸¿æ´‹ å¼ é´»æ´‹æ˜¯ CSDN åšå®¢ä¸“å®¶, åšä¸»åœ¨ CSDN æ‰€å‘å¸ƒçš„æ¯ä¸€ç¯‡æ–‡ç« éƒ½æ˜¯å¹²è´§, éƒ½å¾ˆå€¼å¾—å¤§å®¶å»å­¦ä¹  å¼ å…´ä¸š å¼ å…´ä¸šåŒæ ·ä¹Ÿæ˜¯ CSDN åšå®¢ä¸“å®¶, åšä¸»ä¸“æ³¨ç§»åŠ¨äº’è”ç½‘å¼€å‘, å…³æ³¨ç§»åŠ¨æ”¯ä»˜ä¸šåŠ¡ hiå¤§å¤´é¬¼hi hiå¤§å¤´é¬¼hi æ˜¯é˜¿é‡Œå·´å·´é›†å›¢çš„ä¸€å Android å·¥ç¨‹å¸ˆ, æ“…é•¿ Android, RxJava, RxAndroid, ReactNative, Node.js, å¤§å‰ç«¯, å¯è°“æ˜¯å…¨æ ˆå·¥ç¨‹å¸ˆ, å¦‚æœä½ å¯¹ RxJava æŠ€æœ¯æ„Ÿå…´è¶£, ä¸å¦¨åˆ°ä»–çš„åšå®¢çœ‹çœ‹, ä»–å†™äº†ä¸€ç³»åˆ—æœ‰å…³ RxJava çš„ä»‹ç» æ›´å¤š è¿™é‡Œé¢æ”¶é›†äº†å¾ˆå¤šå›½å†…å¤–å¼€å‘è€…çš„ä¿¡æ¯, å¤§å®¶å¯ä»¥å»çœ‹çœ‹ ç¤¾åŒº åç§° ç®€ä»‹ StackOverFlow IT ç•Œçš„é—®ç­”ç¤¾åŒº, ä½ å¼€å‘å½“ä¸­æ‰€é‡åˆ°çš„é—®é¢˜åŸºæœ¬ä¸Šéƒ½èƒ½åœ¨è¿™é‡Œèƒ½å¯»æ‰¾åˆ°ä½ æƒ³è¦çš„ç­”æ¡ˆ SegmentFault SegmentFault æ˜¯ä¸€ä¸ªä¸“æ³¨äºè§£å†³ç¼–ç¨‹é—®é¢˜, æé«˜å¼€å‘æŠ€èƒ½çš„ç¤¾åŒº CSDN CSDN æ˜¯å…¨çƒæœ€å¤§ä¸­æ–‡ITæŠ€æœ¯ç¤¾åŒº ç¨€åœŸæ˜é‡‘ é«˜è´¨é‡çš„æŠ€æœ¯åˆ†äº«ç¤¾åŒº è°·æ­Œå¼€å‘è€…ç¤¾åŒº(GDG) GDG æ˜¯ Google Developer Groups çš„ç¼©å†™, ä¸­æ–‡åç§°æ˜¯è°·æ­Œå¼€å‘è€…ç¤¾åŒº å¼€æºé¡¹ç›®å­¦ä¹  é¡¹ç›®åç§° é¡¹ç›®ç®€ä»‹ Google I/O 2014 Google I/O Android App ä½¿ç”¨äº†å½“æ—¶æœ€æ–°æ¨å‡ºçš„ Material Design è®¾è®¡ Google play music ä¸€ä¸ªè·¨å¤šä¸ªå¹³å°éŸ³ä¹æ’­æ”¾å™¨ Google Santa Tracker for Android Google å¼€æºçš„ä¸€ä¸ªå„¿ç«¥æ•™è‚²å’Œå¨±ä¹çš„ App githubå®¢æˆ·ç«¯ å¼€æºè€… github å›¢é˜Ÿ, æ”¯æŒé¡¹ç›®çš„ lssues å’Œ Gists å¹¶é›†æˆäº†æ–°é—» feed ä»¥ä¾¿åŠæ—¶è·å–æ¥è‡ªç»„ç»‡å¥½å‹å’Œèµ„æ–™åº“çš„æ›´æ–°ä¿¡æ¯, è¿˜æä¾›äº†ä¸€ä¸ªç”¨äºå¿«é€Ÿè®¿é—®ä½ åˆ›å»º,ç›‘æ§ä»¥åŠå‘å¸ƒ issue é¢æ¿, å¯æŸ¥çœ‹å¹¶å°†é—®é¢˜åŠ åˆ°æ”¶è—å¤¹ Talon-for-Twitter ä¸€ä¸ªå®Œæ•´ç‰ˆ Twitter ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯, å±äºé¡¶çº§æ°´å¹³, è€Œä¸”åœ¨æºä»£ç  100% å¼€æº, å­¦ä¹ èµ„æºè®©ä½ å–ä¹‹ä¸å°½ Anime Taste å¼€å‘è€…æ˜¯ä»£ç å®¶ä¸º AnimeTaste å…¨çƒåŠ¨ç”»ç²¾é€‰å¼€å‘çš„ Android å®¢æˆ·ç«¯, å›½å†…å¾ˆå°‘è§çš„ç²¾å½©è€Œä¸”å¼€æºçš„ APP, è·å¾—è±Œè±†èš110æœŸè®¾è®¡å¥– EverMemo å¼€å‘è€…æ˜¯ä»£ç å®¶, EverMemo æ˜¯ä¸€æ¬¾è®©ä½ å¿«é€Ÿè®°å½•ä¸åˆ†äº«çµæ„Ÿçš„éšèº«ä¾¿ç­¾, æç®€çš„ç•Œé¢ä¸å¡ç‰‡å¼å¸ƒå±€, è®©ä½ è®°å½•ä¸æŸ¥æ‰¾ä¾¿ç­¾æ›´æœ‰æ•ˆç‡ 9GAG å¼€å‘è€…æ˜¯ stormzhang åšä¸»,è¿™ä¸ªå¼€æºé¡¹ç›®æ•™ä½ ä½¿ç”¨ Studio, Gradle ä»¥åŠä¸€äº›æµè¡Œçš„å¼€æºåº“å¿«é€Ÿå¼€å‘ä¸€ä¸ªä¸é”™çš„ Android å®¢æˆ·ç«¯ MIUI ä¾¿ç­¾ MiCode ä¾¿ç­¾æ˜¯å°ç±³ä¾¿ç­¾çš„ç¤¾åŒºå¼€æºç‰ˆ, ç”± MIUI å›¢é˜Ÿï¼ˆww.miui.comï¼‰å‘èµ·å¹¶è´¡çŒ®ç¬¬ä¸€æ‰¹ä»£ç , éµå¾ª NOTICE æ–‡ä»¶æ‰€æè¿°çš„å¼€æºåè®® è´å£³å•è¯ å¼€å‘è€…æ˜¯è®¸æ™“å³°(Drakeet), è·å¾—è±Œè±†èšè®¾è®¡å¥–, è¿™ä¸ªæ˜¯åˆæœŸç‰ˆæœ¬, æ–°ç‰ˆæ²¡æœ‰å¼€æº, ä½†æ˜¯åœ¨åšä¸»çš„åšå®¢å½“ä¸­å°†ä¸€äº›æ–°ç‰ˆçš„å†…å®¹éƒ½å‰¥ç¦»å‡ºæ¥å†™æˆäº†æ–‡ç« ,å¯ä»¥å»å­¦ä¹ ä¸€ä¸‹ Muzei Live Wallpaper å¼€å‘è€…æ˜¯ Ian Lake , å°±èŒäº Google, è¿™æ¬¾æ˜¯å®šæ—¶æ›´æ¢æ¡Œé¢ç²¾ç¾å£çº¸ App å››æ¬¡å…ƒ-æ–°æµªå¾®åšå®¢æˆ·ç«¯ ä¸€ä¸ªä»¿æ–°æµªå¾®åšå®¢æˆ·ç«¯ App, åŸºæœ¬éƒ½å«æœ‰æ–°æµªå¾®åšçš„åŠŸèƒ½, å¼€æºå›¢é˜Ÿå†™äº†ä¸€ä»½ wiki æ–‡æ¡£, å¯ä»¥å»å­¦ä¹ ä¸€ä¸‹è¯¥ App æ˜¯å¦‚ä½•å®ç°çš„ çŸ¥ä¹ä¸“æ  å¼€å‘è€…æ˜¯ç™½ç“¦åŠ›, é¡¹ç›®ç»“æ„æ¸…æ™°, ä»£ç åˆ†åŒ…åˆç†, å¾ˆæ£’. å¾ˆé€‚åˆæ–°æ‰‹å»å­¦ä¹ å¦‚ä½•æ­å»ºä¸€ä¸ª App ç»“æ„, ç†Ÿæ‚‰å¼€å‘ä¸€ä¸ªå®Œæ•´ App çš„æµç¨‹ eoe å®¢æˆ·ç«¯ eoe ç¤¾åŒºAndroidå®¢æˆ·ç«¯ oschina å¼€æºä¸­å›½ç¤¾åŒº Android å®¢æˆ·ç«¯, æ­¤å¼€æºçš„æ˜¯ v1 ç‰ˆæœ¬, v2 ç‰ˆæœ¬å°†åœ¨ 2015 å¹´å¹´ä¸­å¼€æº v2ex å¼€å‘è€…æ˜¯æ¨è¾‰, è¿™ä¸ªæ˜¯ v2ex Android ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ Tweet Lanes åŠŸèƒ½æ¯”è¾ƒå®Œæ•´çš„ Twitter å®¢æˆ·ç«¯ Financius ä¸€æ¬¾ç®€å•æ˜“ç”¨ä¸ªäººç†è´¢ Android ç¨‹åº Coding Coding ç±»ä¼¼äº github ä¸€ä¸ªä»£ç æ‰˜ç®¡å¹³å°, è¿™ä¸ªæ˜¯ Coding çš„ Android ç‰ˆå®¢æˆ·ç«¯ ZXing äºŒç»´ç æ‰«æå·¥å…·,å¸‚åœºä¸Šè®¸å¤šåº”ç”¨çš„äºŒç»´ç æ‰«æå·¥å…·éƒ½æ˜¯ä»è¿™ä¸ªä¿®æ”¹å¾—åˆ°çš„ photup ç¼–è¾‘æœºæ‰¹é‡ä¸Šä¼ ç…§ç‰‡åˆ° facebook ä¸Š,ä»£ç åˆ†åŒ…åˆç†,å¾ˆæ£’,ä¸è¿‡è¿™ä¸ªé¡¹ç›®ä¾èµ–çš„å¼€æºé¡¹ç›®æ¯”è¾ƒå¤š, æ¯”è¾ƒéš¾ç¼–è¯‘ todo.txt-android todo.txt å®˜æ–¹ Android åº”ç”¨, ä¸€ä¸ªæç®€çš„å°†å¾…åŠäº‹ä»¶è®°å½•åœ¨ .txt æ–‡ä»¶ä¸­ æ‰«æ‰«å›¾ä¹¦ ä¸€ä¸ªè®©ä½ æ‡‚å¾—å¦‚ä½•å»é€‰æ‹©ä¸€æœ¬ä¹¦çš„ APP, å…·æœ‰æ‰«ææœç´¢æŸ¥è¯¢å›¾ä¹¦çš„ä¿¡æ¯åŠŸèƒ½ ChaseWhisplyProject å¼€å¯æ‘„åƒå¤´åœ¨ä½ æ‰€åœ¨ä½ç½®å¯»æ‰¾é¬¼é­‚, è¿›è¡Œæ‰“é¬¼æ¸¸æˆ AntennaPod AntennaPod æ˜¯ä¸€ä¸ªè‡ªç”±, å¼€æºçš„æ’­å®¢å®¢æˆ·ç«¯, æ”¯æŒ Atom å’Œ RSS Feed å¹²æŸ´ å¼€å‘è€…æ˜¯å†¯å»º, ä¸€ä¸ªä¸“æ³¨æ”¶é›† android ç›¸å…³å¹²è´§(æ–‡æ‘˜,ååš,githubç­‰ç­‰)èµ„æº App Hacker News ä¸€ä¸ªæŸ¥çœ‹é»‘å®¢æ–°é—»æŠ¥é“å’Œè¯„è®ºçš„ App proxydroid ProxyDroid æ˜¯ä¸€ä¸ªå¸®åŠ©ä½ åœ¨ä½ çš„ Android è®¾å¤‡ä¸Šè®¾ç½®ä»£ç† (HTTP / SOCKS4 / SOCKS5) AliGesture Androidå¹³å°æ‰‹åŠ¿è¯†åˆ«åº”ç”¨, ç®€å•çš„æ‰‹åŠ¿å°±å¯ä»¥è¿›å…¥é¢„ç½®çš„åº”ç”¨, æ–¹ä¾¿å¿«æ· æŒ‡è¯» æŒ‡è¯»é¡¾åæ€ä¹‰å°±æ˜¯ç”¨æ‰‹æŒ‡å»é˜…è¯»æµ©ç€šçš„ä¹¦æµ· KJ éŸ³ä¹ å¼€å‘è€…æ˜¯å¼ æ¶›, å¿«æ·éŸ³ä¹ä½¿ç”¨åˆ°KJFrameForAndroidå¼€å‘æ¡†æ¶, æ‹¥æœ‰ç•Œé¢ç»šä¸½, æ“ä½œç®€å•, æ’­æ”¾æ‰‹æœºæœ¬åœ°éŸ³ä¹, åœ¨çº¿æ”¶å¬éŸ³ä¹ç­‰åŠŸèƒ½, è¿˜æ”¯æŒ: æ–°æµªå¾®åš, ç™¾åº¦è´¦å·, QQ è´¦å·çš„ä¸€é”®ç™»å½• å“å˜› OSCHINA ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯, è¿™ä¸ªç‰ˆæœ¬ç•Œé¢æ¯”å®˜æ–¹ç‰ˆæœ¬ç•Œé¢å¥½çœ‹å¤šäº†, ä½¿ç”¨çš„æ˜¯ Material Design, ç•Œé¢çœ‹ä¸Šå»éå¸¸æ¸…çˆ½èˆ’æœ ç å© åšå®¢å›­ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯, ä½¿ç”¨åˆ°ç¼“å­˜æŠ€æœ¯, å½“ä½ æ‰“å¼€ä¸€æ¬¡ä¹‹åçš„åšå®¢å†…å®¹, ä¼šè‡ªåŠ¨ä¿å­˜åˆ°è®¾å¤‡ä¸­, ä¸‹æ¬¡æ‰“å¼€é˜…è¯»åŒä¸€æ–‡ç« æ—¶ä¸éœ€è¦å†åˆ©ç”¨ç½‘ç»œåŠ è½½, å¤§å®¶å¦‚æœæƒ³ä¸ºè‡ªå·± App æç¼“å­˜çš„, å¯ä»¥ç ”ç©¶ä¸€ä¸‹è¯¥ App æ˜¯å¦‚ä½•å®ç°çš„å–” cnBeta ç¬¬ä¸‰æ–¹é˜…è¯»å™¨ è¯¥ App æ˜¯ cnBeta(ä¸­æ–‡ä¸šç•Œèµ„è®¯ç«™) ç¬¬ä¸‰æ–¹é˜…è¯»å®¢æˆ·ç«¯, ç•Œé¢ä¹Ÿæ˜¯ä½¿ç”¨ Material Design, è¿˜åŠ ä¸Šä¸€äº›åŠ¨ç”»æ•ˆæœ, è®©äººé˜…è¯»æ–‡ç« èµ·æ¥ä¸ä¼šæ„Ÿè§‰æ¯ç‡¥, å€¼å¾—å»ç ”ç©¶å­¦ä¹ ä¸€ä¸‹ BlackLight BlackLightæ˜¯ç”±çº¸é£æœºå¼€å‘å›¢é˜Ÿå¼€å‘çš„ä¸€æ¬¾Androidä¸Šçš„æ–°æµªå¾®åšç¬¬ä¸‰æ–¹è½»é‡çº§å®¢æˆ·ç«¯ Actor Actor(ä¼˜è†) æ˜¯ä¸€æ¬¾å³æ—¶é€šè®¯ App, è§£å†³ç½‘ç»œé€šè®¯å·®çš„æƒ…å†µ, æ”¯æŒç¦»çº¿æ¶ˆæ¯å’Œæ–‡ä»¶å­˜å‚¨, è‡ªåŠ¨ä¸æ‰‹æœºè”ç³»äººå»ºç«‹è”ç³»ç­‰ç­‰ Plaid ä¸€ä¸ªéµå¾ª Material Design çš„ä¸€ä¸ªè®¾è®¡æ–°é—»å®¢æˆ·ç«¯ï¼Œé‡Œé¢çš„ä¸€äº›å®Œå…¨MDçš„ä¸€äº›ç‰¹æ•ˆå¾ˆæ£’ï¼ŒåŒæ—¶æ•´ä¸ªå®¢æˆ·ç«¯çš„æ¡†æ¶è®¾è®¡ä¹Ÿå¾ˆæœ‰å‚è€ƒæ„ä¹‰ SimplifyReader ä¸€æ¬¾åŸºäº Google Material Design è®¾è®¡å¼€å‘çš„ Android å®¢æˆ·ç«¯, åŒ…æ‹¬æ–°é—»ç®€è¯», å›¾ç‰‡æµè§ˆ, è§†é¢‘çˆ½çœ‹, éŸ³ä¹è½»å¬ä»¥åŠäºŒç»´ç æ‰«æäº”ä¸ªå­æ¨¡å—, é¡¹ç›®é‡‡å–çš„æ˜¯MVPæ¶æ„å¼€å‘ PHPHub-Android PHPHub Android å®¢æˆ·ç«¯, é¡¹ç›®æ¶æ„ä½¿ç”¨ nucleus ç®€åŒ– MVP æ¶æ„, API è¯·æ±‚è¿”å›æ•°æ®ä½¿ç”¨ RxJava è¿›è¡Œå¤„ç†, å®¢æˆ·ç«¯ä½¿ç”¨äº†ç‹¬ç‰¹çš„äºŒç»´ç æ‰«ç ç™»å½•, æœ‰å…´è¶£çš„å¯ä»¥å»ç ”ç©¶ä¸€ä¸‹ Leisure é—²æš‡(Leisure)æ˜¯ä¸€æ¬¾é›†â€çŸ¥ä¹æ—¥æŠ¥â€, â€œæœå£³ç§‘å­¦äººâ€, â€œæ–°åç½‘æ–°é—»â€ä»¥åŠâ€è±†ç“£å›¾ä¹¦â€äºä¸€ä½“çš„é˜…è¯»ç±» Android åº”ç”¨, é¡¹ç›®é‡Œé¢æœ‰å¤šè¯­è¨€åˆ‡æ¢ã€å¤œé—´æ¨¡å¼ä»¥åŠæ— å›¾æ¨¡å¼, å¦‚æœä½ è¿˜ä¸çŸ¥é“è¿™äº›æŠ€æœ¯æ€ä¹ˆå®ç°, ä¸å¦¨å‚è€ƒä¸€ä¸‹è¿™ä¸ªé¡¹ç›® Meizhi å¼€å‘è€…æ˜¯è®¸æ™“å³°(Drakeet), è¯¥ app æ˜¯æ•°æ®æ¥è‡ªä»£ç å®¶å¹²è´§ç½‘ç«™ gank.io, æœ‰å¾ˆå¤šå¼€å‘è€…éƒ½çº·çº·ä¸ºè¿™ç½‘ç«™åšå®¢æˆ·ç«¯ app, å› ä¸ºä»£ç å®¶å¤§ç¥å¼€æ”¾è¯¥ç½‘ç«™çš„ Api, æ›´é‡è¦çš„æ˜¯è¯¥ç½‘ç«™æ¯å¤©é™¤äº†æœ‰å¹²è´§è¿˜æœ‰æ¼‚äº®å¦¹å­çœ‹å‘¢, è¯¥ App ä½¿ç”¨åˆ°çš„æŠ€æœ¯æœ‰ RxJava + Retrofit, ä»£ç ç»“æ„éå¸¸æ¸…æ™°, å€¼å¾—ä¸€çœ‹çš„å¼€æº App. Bingo å¼€å‘è€…æ˜¯å­™ç¦ç”Ÿ, Bingo æ˜¯ä¸€æ¬¾ IT é˜…è¯»å­¦ä¹ ç±»çš„å¼€æºè½¯ä»¶, ä½œè€…æ”¶é›†ä¸€äº›å¹²è´§å­¦ä¹ å†…å®¹, ä½ ä¹Ÿå¯ä»¥åœ¨ App ä¸Šåˆ†äº«ä½ çš„è®¤ä¸ºå¹²è´§æ–‡ç« , è¯¥é¡¹ç›®ä½¿ç”¨åŠ¨æ€ä»£ç† AOP ç¼–ç¨‹æ¡†æ¶, ä½¿å¼€å‘èµ·æ¥æ›´ç®€æ´, æ›´é«˜æ•ˆ. é‡Œé¢æœ‰ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯å¤šç§ä¸»é¢˜åˆ‡æ¢, æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹æ€ä¹ˆå®ç° Android å¼€å‘è€…æ‚å¿—å‘¨åˆŠ( å‰äº”ä¸ªèµ„æ–™æ¥è‡ª Drakeet æ”¶é›†æ•´ç†çš„, èµ„æ–™åŸé“¾æ¥ åœ°å€ ) å‘¨åˆŠå å‘¨åˆŠç®€ä»‹ Android Weekly Android Weekly æ˜¯ç”±Android å›¢é˜Ÿçš„æˆå‘˜å’Œå›½å¤–çŸ¥åçš„ Android å¼€å‘è€…ç»´æŠ¤, åˆ†äº«çš„å†…å®¹ä¸ä»…ä»…åªæœ‰å¹²è´§, è€Œä¸”è¿˜æœ‰æœ€æ–°çš„æŠ€æœ¯åˆ†äº«, ä¹Ÿæ˜¯Android å¼€å‘åœˆå­æœ€æ—©, æœ€æœ‰åçš„å‘¨æŠ¥ Android å¼€å‘æŠ€æœ¯å‘¨æŠ¥ Android å¼€å‘æŠ€æœ¯å‘¨æŠ¥æ˜¯ç”±@è„‰è„‰ä¸å˜šèª ç»´æŠ¤æ›´æ–°, æˆªæ­¢åˆ°ç°åœ¨, å·²ç»å‘å¸ƒäº†28 æœŸ, åˆ†äº«çš„éƒ½æ˜¯é«˜è´¨é‡çš„æ–‡ç« æ•™ç¨‹, ä»£ç åº“, å·¥å…·, æ–°é—»è§†é¢‘, è®¾è®¡ç­‰ Android ç§‘å­¦é™¢ ç”± @duguguiyuå’Œè±Œè±†èšä¸€å°æ’®å·¥ç¨‹å¸ˆç»„æˆ, åˆ†äº«çš„éƒ½æ˜¯æœ€æ–°çš„ Android æŠ€æœ¯: è™½ç„¶æ›´æ–°é¢‘ç‡ä¸æ˜¯å¾ˆé«˜, ä½†æ˜¯è´¨é‡ç¡®æ˜¯å¾ˆé«˜çš„, å€¼å¾—ä¸€çœ‹çš„ å¼€å‘æŠ€æœ¯å‰çº¿ å¼€å‘æŠ€æœ¯å‰çº¿æ˜¯ä¸€ä¸ªé«˜è´¨é‡æŠ€æœ¯æ–‡ç« çš„èšåˆç½‘ç«™, ä¸»è¦åˆ†äº« Android, iOS, ä»¥åŠæ‹›è˜ç­‰å†…å®¹ App å¼€å‘æ—¥æŠ¥ App å¼€å‘æ—¥æŠ¥ä¸»è¦å…³æ³¨ç§»åŠ¨åº”ç”¨çš„å¼€å‘, å®ƒæ¯å¤©ä¸€åˆŠ, åˆ†äº«çš„å†…å®¹ä¸»è¦æ¥è‡ªå¾®åšä¸ŠçŸ¥åçš„å¼€å‘è€…æ¨èçš„å†…å®¹, å› æ­¤è´¨é‡åŸºæœ¬ä¸Šæ˜¯æœ‰ä¿è¯çš„ Android å¼€å‘å‘¨æŠ¥ Android å¼€å‘å‘¨æŠ¥æ˜¯éƒ­äº®åœ¨è¿è½½æ›´æ–°åœ¨ Infoq çš„å‘¨åˆŠ, å®ƒä¸ä»…åˆ†äº« Android çš„ç›¸å…³æ–°é—», æ–°å·¥å…·, è€Œä¸”è¿˜æœ‰æ›´åŠ æ·±å…¥çš„, æ‰€ä»¥å¯¹äºæ–°ç”Ÿè€äººéƒ½å¾ˆé€‚åˆ å¹²è´§é›†ä¸­è¥ ç”± ä»£ç å®¶ ç»´æŠ¤æ›´æ–°, å‘¨ä¸€åˆ°å‘¨äº”æ¯å¤©ä¸­åˆåˆ†äº«, åˆ†äº«å†…å®¹æœ‰æ¼‚äº®å¦¹å­, Android å¹²è´§, iOS å¹²è´§, App, æŠ€æœ¯ä»¥å¤–æ¨è, è¿˜æœ‰ä¼‘æ¯è§†é¢‘ Android Blog å‘¨åˆŠ AndroidBlog æ˜¯ç”± Jomeslu æ”¶å½•çš„, ç›®å‰å°±èŒäºæœç‹, è¯¥å‘¨åˆŠåˆ†äº«å†…å®¹ä¸»è¦æœ‰ä¸€å‘¨å›½å†…å¤–çƒ­é—¨æŠ€æœ¯åšå®¢, ä¼˜ç§€çš„ç±»åº“, ä»¥åŠä¸€äº›æœ‰è¶£çš„æ–°é—», çœ‹äº†å‰å‡ æœŸåˆ†äº«çš„å†…å®¹è´¨é‡éƒ½æ˜¯å¾ˆé«˜çš„, å› æ­¤å€¼å¾—æ¨èç»™å¤§å®¶ Awesome ç³»åˆ— awesome android(1) awesome_android(2) awesome_android_UI awesome_android_libraries awesome_java awesome_materialdesign awesome ç³»åˆ—ä¹‹ç»ˆæç‰ˆ android-dynamic-load-awesome åŠ¨ç”»ç³»åˆ— animate awesome-animation Material-Animations AndroidViewAnimations Material Design è®¾è®¡ Material Design æ•™ç¨‹ Material Design æ•™ç¨‹(ä¸­æ–‡ç‰ˆ) Material Design Android Library (Material Design å¼€æºåº“, å¾ˆå¤šæ•ˆæœå¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨) åå¤§Material Designå¼€æºé¡¹ç›® ç´ æ å¸¸ç”¨è‰²å½©æ­é…è¡¨ ColorHunt-è‰²å½©æ­é… åœ¨çº¿ Material Design ç•Œé¢è°ƒè‰²æ¿ Material Designè®¾è®¡æ¨¡æ¿ä¸ç´ æ App Icon å›¾æ ‡ Icon Store Material icons Iconfont å¼€æºåº“æ”¶é›† Android Libraries and Resources Android Arsenal (ä¸€ä¸ªä¸“é—¨æ”¶é›† android å¼€æºåº“çš„ç½‘ç«™, ç½‘ç«™ç»å¸¸æ›´æ–°) Android å¼€æºé¡¹ç›®æ±‡æ€» (Trinea å¤§ç¥æ”¶é›†çš„) Android å¼€æºé¡¹ç›®æºç åˆ†æ (åœ¨æ‡‚å¾—ä½¿ç”¨è¿™äº›å¼€æºé¡¹ç›®åŒæ—¶, ä¹Ÿåº”è¯¥äº†è§£å½“ä¸­çš„åŸç†) æ³¡åœ¨ç½‘ä¸Šçš„æ—¥å­ android-gems(å›½å†…å¤–å¾ˆå¤šå¼€å‘è€…éƒ½åœ¨è¿™é‡Œä¸Šä¼ ä»–ä»¬æœ€æ–°çš„é¡¹ç›®, è¿˜å¸¦æœ‰ apk ä¸‹è½½) è®¾è®¡æ¨¡å¼ java-design-patterns Androidæºç è®¾è®¡æ¨¡å¼åˆ†æé¡¹ç›® Javaä¹‹ç¾[ä»èœé¸Ÿåˆ°é«˜æ‰‹æ¼”å˜]ä¹‹è®¾è®¡æ¨¡å¼ å®è·µç¯‡ Android å¼€å‘æœ€ä½³å®è·µ Android å¼€å‘æœ€ä½³å®è·µ (æ¥è‡ªèƒ¡å‡¯æ€»ç»“) Android æœ€ä½³å®è·µä¹‹ UI ç¯‡ Android å±å¹•é€‚é…å…¨æ”»ç•¥ ç»™åŠæ–°äººçš„appå¼€å‘æŒ‡å— Android ä¸€äº›é‡è¦çŸ¥è¯†ç‚¹è§£ææ•´ç† Android å¼€å‘äººå‘˜åº”é¿å…çš„ 10 ä¸ªè¯¯åŒº Java åå°„æœ€ä½³å®è·µ Android å†…å­˜ä¼˜åŒ–ä¹‹ OOM Android å‘½åè§„èŒƒ Adapter ä¼˜åŒ–æ–¹æ¡ˆçš„æ¢ç´¢ Android-Tips æœ€å…¨ Android ADB Shell AndroidNote Android å¸¸ç”¨å·¥å…·ç±» åˆ›å»ºå®‰å“ app çš„ 30 ä¸ªç»éªŒæ•™è®­ Android ä¸‰å¤§å›¾ç‰‡ç¼“å­˜åŸç†ã€ç‰¹æ€§å¯¹æ¯” Android æ€§èƒ½ä¼˜åŒ–æ€»ç»“ Android å®ç”¨ä»£ç ç‰‡æ®µæ•´åˆ 36 ä¸ª Android å¼€å‘å¸¸ç”¨ä»£ç ç‰‡æ®µ æ”¶é›†äº†å¤§å®¶å¸¸ç”¨çš„ä¸€äº› Android çš„æ¨¡æ¿ä»£ç  Android æŠ€æœ¯ç§¯ç´¯: å¼€å‘è§„èŒƒ App æ¶æ„è®¾è®¡ç»éªŒè°ˆ å…³äº Android å¼€å‘çš„ 40 æ¡ä¼˜åŒ–å»ºè®® å¦‚ä½•æé«˜å®‰å“ä»£ç çš„è´¨é‡å’Œè¯­æ³• æˆ‘çš„ Android å¼€å‘å®æˆ˜ç»éªŒæ€»ç»“ Android Tips ç³»åˆ— å¦‚ä½•è‡ªå­¦ Android å›½å†…ä¸€çº¿äº’è”ç½‘å…¬å¸å†…éƒ¨é¢è¯•é¢˜åº“ Git æ•™ç¨‹æ–°æ‰‹çœ‹å®Œè¿™å‡ ä»½æ•™ç¨‹åŸºæœ¬ä¸ŠçŸ¥é“æ€ä¹ˆä½¿ç”¨ Git äº† GitHub å›¢é˜Ÿç¾å¥³å†™çš„ä¸€å¥— Git ä½¿ç”¨æ•™ç¨‹ ProGit ä¸­æ–‡ç‰ˆ å»–é›ªå³°çš„ Git æ•™ç¨‹ Git ç®€æ˜“æŒ‡å— æ–‡æ¡£ Android å®˜æ–¹ API æ–‡æ¡£(ç½‘ç«™éœ€è¦ç¿»å¢™ï¼Œä¸ç¿»å¢™å¯ä»¥ä¸‹è½½ç¦»çº¿æ–‡ä»¶) Android å®˜æ–¹åŸ¹è®­è¯¾ç¨‹ä¸­æ–‡ç‰ˆ(ç”±èƒ¡å‡¯å‘èµ·å¯¹ Google Android å®˜æ–¹åŸ¹è®­è¯¾ç¨‹ç¿»è¯‘çš„ä¸­æ–‡ç‰ˆ) å…¶å®ƒèµ„æ–™æ”¶é›† 10 ä¸ªå¾ˆæ£’çš„å­¦ä¹  Android å¼€å‘çš„ç½‘ç«™ Android å¼€å‘, ä½ åº”è¯¥çŸ¥é“çš„å­¦ä¹ èµ„æº AndroidCat å®‰å“ä¹¦ç­¾ç½‘ æ¯ä¸ª Android å¼€å‘è€…éƒ½åº”è¯¥äº†è§£çš„èµ„æºåˆ—è¡¨ Android å¼€å‘è€…ç½‘å€å¯¼èˆª Android å¼€å‘æ”¶è—å¤¹ TimLiu-Android(TimLiu æ€»ç»“çš„ Android å¼€æºé¡¹ç›®åŠåº“) AndroidTips çŸ¥ä¹ä¸Šçš„è®¨è®º æœ‰å“ªäº› Android å¤§ç‰›çš„ blog å€¼å¾—æ¨è? GitHub ä¸Šéƒ½æœ‰å“ªäº›å€¼å¾—å…³æ³¨å­¦ä¹ çš„ Androidé¡¹ç›®? GitHub ä¸Šæœ‰å“ªäº›é€‚åˆæ–°äººå›´è§‚çš„ Android é¡¹ç›®? 2015 å¹´ç§»åŠ¨è®¾å¤‡ç•Œé¢è®¾è®¡æœ‰å“ªäº›è¶‹åŠ¿? Androidå¼€å‘ä¸­, æœ‰å“ªäº›è®©ä½ è§‰å¾—ç›¸è§æ¨æ™šçš„æ–¹æ³•,ç±»æˆ–æ¥å£? Android Studioæœ‰å“ªäº›éå¸¸å¥½ç”¨çš„æ’ä»¶? Android å¼€å‘æœ‰å“ªäº›æ–°æŠ€æœ¯å‡ºç°? æœ‰å“ªäº›ä¼˜ç§€çš„ Android åº”ç”¨å¼€æºé¡¹ç›®, ç‰¹æ•ˆ, è®¾è®¡èµ„æ–™æ¨è? æœ‰æ²¡æœ‰é€‚åˆ Android å¼€å‘åˆå­¦è€…çš„ App æºç æ¨è? Androidæœ‰ä»€ä¹ˆå¥½çš„æŠ€æœ¯ç‚¹é€‚åˆè¿›è¡ŒæŠ€æœ¯åˆ†äº«? Android Studioæœ‰ä»€ä¹ˆå¥‡æŠ€æ·«å·§? Android å¼€å‘: å¼€å§‹ä¸€ä¸ªé¡¹ç›®å‰, åšå¥½å“ªäº›å‡†å¤‡å¯ä»¥äº‹åŠåŠŸå€? è´¡çŒ®è€…ç‚¹å‡»è¯¥é“¾æ¥æŸ¥çœ‹è¯¥é¡¹ç›®æ‰€æœ‰è´¡çŒ®è€… Licenseä»¥ä¸Šå†…å®¹é‡‡ç”¨ CC BY-NC-SA 3.0 è¿›è¡Œè®¸å¯, è½¬è½½è¯·æ³¨æ˜å‡ºå¤„, ç‰ˆæƒå½’æœ¬äººåŠæ‰€æœ‰è´¡çŒ®è€…æ‰€æœ‰ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«","date":"2017-07-06T15:45:01.000Z","path":"2017/07/06/Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«.html","text":"ä¸€ã€åŒºåˆ«String ï¼šå­—ç¬¦ä¸²å¸¸é‡StringBuffer ï¼šå­—ç¬¦ä¸²å˜é‡StringBuilder ï¼šå­—ç¬¦ä¸²å˜é‡ äºŒã€é€Ÿåº¦StringBuilder &gt; StringBuffer &gt; String åˆ†æåŸå› ï¼š Stringç±»æ˜¯ä¸å¯å˜ç±»ï¼Œä»»ä½•å¯¹Stringçš„æ”¹å˜éƒ½ ä¼šå¼•å‘æ–°çš„Stringå¯¹è±¡çš„ç”Ÿæˆï¼› Stringç±»å‹è¿›è¡Œæ”¹å˜çš„æ—¶å€™å…¶å®éƒ½ç­‰åŒäºç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„ String å¯¹è±¡ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„ String å¯¹è±¡ï¼Œæ‰€ä»¥ç»å¸¸æ”¹å˜å†…å®¹çš„å­—ç¬¦ä¸²æœ€å¥½ä¸è¦ç”¨ Stringã€‚ è€ŒStringBufferä¸StringBuilderå°±ä¸ä¸€æ ·äº†ï¼Œä»–ä»¬æ˜¯å­—ç¬¦ä¸²å˜é‡ï¼Œæ˜¯å¯æ”¹å˜çš„å¯¹è±¡ï¼Œæ¯å½“æˆ‘ä»¬ç”¨å®ƒä»¬å¯¹å­—ç¬¦ä¸²åšæ“ä½œæ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šæ“ä½œçš„ï¼Œè¿™æ ·å°±ä¸ä¼šåƒStringä¸€æ ·åˆ›å»ºä¸€äº›è€Œå¤–çš„å¯¹è±¡è¿›è¡Œæ“ä½œäº†ï¼Œå½“ç„¶é€Ÿåº¦å°±å¿«äº†ã€‚ åˆå› ä¸ºStringBuilderæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼ŒStringBufferæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥StringBuilderæ¯”StringBufferè¦å¿«ã€‚ å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"}]},{"title":"Kotlin","date":"2017-06-23T12:13:26.000Z","path":"2017/06/23/Kotlin.html","text":"é¡¹ç›®åœ°å€ï¼šhttps://github.com/JetBrains/kotlin ç®€ä»‹ï¼šKotlinæ˜¯ä¸€ç§åœ¨Javaè™šæ‹Ÿæœºä¸Šè¿è¡Œçš„é™æ€ç±»å‹ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒä¹Ÿå¯ä»¥è¢«ç¼–è¯‘æˆä¸ºJavaScriptæºä»£ç ã€‚å®ƒä¸»è¦æ˜¯ç”±ä¿„ç½—æ–¯åœ£å½¼å¾—å ¡çš„JetBrainså¼€å‘å›¢é˜Ÿæ‰€å‘å±•å‡ºæ¥çš„ç¼–ç¨‹è¯­è¨€ï¼Œå…¶åç§°æ¥è‡ªäºåœ£å½¼å¾—å ¡é™„è¿‘çš„ç§‘ç‰¹æ—å²›ã€‚[2]2012å¹´1æœˆï¼Œè‘—åæœŸåˆŠã€ŠDr. Dobbâ€™s Journalï¼ˆè‹±è¯­ï¼šDr. Dobbâ€™s Journalï¼‰ã€‹ä¸­Kotlinè¢«è®¤å®šä¸ºè¯¥æœˆçš„æœ€ä½³è¯­è¨€ã€‚[3]è™½ç„¶ä¸Javaè¯­æ³•å¹¶ä¸å…¼å®¹ï¼Œä½†Kotlinè¢«è®¾è®¡æˆå¯ä»¥å’ŒJavaä»£ç ç›¸äº’è¿ä½œï¼Œå¹¶å¯ä»¥é‡å¤ä½¿ç”¨å¦‚Javaé›†åˆæ¡†æ¶ç­‰çš„ç°æœ‰Javaç±»åº“ã€‚ æ›´å¤šï¼šThe Kotlin Programming Language http://kotlinlang.org/ Kotlin Programming LanguageWelcome to Kotlin! Some handy links: Kotlin Site Getting Started Guide Try Kotlin Kotlin Standard Library Issue Tracker Forum Kotlin Blog Follow Kotlin on Twitter Public Slack channel TeamCity CI build Editing Kotlin Kotlin IntelliJ IDEA Plugin Kotlin Eclipse Plugin Kotlin TextMate Bundle Build environment requirementsIn order to build Kotlin distribution you need to have: Apache Ant 1.9.4 and higher JDK 1.6, 1.7 and 1.8 Setup environment variables as following: JAVA_HOME=&quot;path to JDK 1.8&quot; JDK_16=&quot;path to JDK 1.6&quot; JDK_17=&quot;path to JDK 1.7&quot; JDK_18=&quot;path to JDK 1.8&quot; BuildingTo build this project, first time you try to build you need to run this: ant -f update_dependencies.xml which will setup the dependencies on intellij-core is a part of command line compiler and contains only necessary APIs. idea-full is a full blown IntelliJ IDEA Community Edition to be used in the plugin module. Then, you need to run ant -f build.xml which will build the binaries of the compiler and put them into the dist directory. You may need to increase the heap size for Ant usingANT_OPTS. OPTIONAL: Maven artifact distribution is built separately, go into libraries directory after building the compiler and run: ./gradlew build install mvn install Note: on Windows type gradlew without the leading ./ Refer to libraries/ReadMe.md for details. Working with the project in IntelliJ IDEAThe root kotlin project already has an IntelliJ IDEA project, you can just open it in IntelliJ IDEA. You may need to set the Project SDK (File -&gt; Project Structure -&gt; Project).You may also need to add tools.jar to your SDK: File -&gt; Project Structure -&gt; SDKs -&gt; &lt;Your JDK&gt; -&gt; Classpath then choose the tools.jar in the JDKâ€™s lib directory. If you are not dealing with Android, you may need to disable the Android Plugin in order to compile the project. Installing the latest Kotlin pluginSince Kotlin project contains code written in Kotlin itself, you will also need a Kotlin plugin to build the project in IntelliJ IDEA. You probably want to have locally the same version of plugin that build server is using for building.As this version is constantly moving, the best way to always be updated is to let IntelliJ IDEA notify you when it is time to renew your plugin. To keep the plugin version in sync with the rest of the team and our Continuous Integration serveryou should setup IDEA to update the plugin directly from the build server. Open: Preferences -&gt; Plugins -&gt; Browse Repositories -&gt; Manage Repositories... and add the following URL to your repositories: https://teamcity.jetbrains.com/guestAuth/repository/download/bt345/bootstrap.tcbuildtag/updatePlugins.xml Then update the list of plugins in â€œBrowse Repositoriesâ€, youâ€™ll see two versions of Kotlin there, install the one with the higher version number. If you want to keep an IntelliJ IDEA installation with that bleeding edge Kotlin plugin for working Kotlin project sources only separate to your default IntelliJ IDEA installation with the stable Kotlinplugin see this document, which describes how to have multiple IntelliJ IDEA installations using different configurations and plugin directories. Compiling and runningFrom this root project there are Run/Debug Configurations for running IDEA or the Compiler Tests for example; so if you want to try out the latest and greatest IDEA plugin VCS -&gt; Git -&gt; Pull Run IntelliJ IDEA a child IntelliJ IDEA with the Kotlin plugin will then startup you can now open the kotlin libraries project to then work with the various kotlin libraries etc. ContributingWe love contributions! Thereâ€™s lots to do on Kotlin and on thestandard library) so why not chat with usabout what youâ€™re interested in doing? Please join the #kontributors channel in our Slack chatand let us know about your plans. If you want to find some issues to start off with, try this query which should find all Kotlin issues that marked as â€œup-for-grabsâ€. Currently only committers can assign issues to themselves so just add a comment if youâ€™re starting work on it. A nice gentle way to contribute would be to review the standard library docsand find classes or functions which are not documented very well and submit a patch. In particular itâ€™d be great if all functions included a nice example of how to use it such as for thehashMapOf() function.This is implemented using the @samplemacro to include code from a test function. The benefits of this approach are twofold; First, the APIâ€™s documentation is improved via beneficial examples that help new users and second, the code coverage is increased. Also the JavaScript translation could really use your help. See the JavaScript contribution section for more details. If you want to work on the compilerThe Kotlin compiler is written in Java and Kotlin (we gradually migrate more and more of it to pure Kotlin). So the easiest way to work on the compiler or IntelliJ IDEA plugin is download a recent IntelliJ IDEA, Community edition is enough install the Kotlin plugin open the root kotlin project in IDEA (opening the kotlin directory) You can now run the various Run/Debug Configurations such as IDEA All Compiler Tests All IDEA Plugin Tests If you want to work on the Kotlin libraries download a recent IntelliJ IDEA, Community edition is enough install the Kotlin plugin open the kotlin libraries project Then build via cd libraries ./gradlew build install mvn install Note: on Windows type gradlew without the leading ./ Some of the code in the standard library is created by generating code from templates. See the README in the stdlib section for how run the code generator. The existing templates can be used as examples for creating new ones. Submitting patchesThe best way to submit a patch is to fork the project on github then send us apull request via github. If you create your own fork, it might help to enable rebase by defaultwhen you pull by executing1git config --global pull.rebase true This will avoid your local repo having too many merge commitswhich will help keep your pull request simple and easy to apply. Commit commentsIf you include in your comment this text (where KT-1234 is the Issue ID in the Issue Tracker, the issue will get automatically marked as fixed. #KT-1234 Fixed å¦‚æœä½ æœ‰å…´è¶£åŠ å…¥æˆ‘ä»¬ï¼Œè¯·ç›´æ¥å…³æ³¨å…¬ä¼—å· Kotlinandroid ï¼Œæˆ–è€…åŠ  QQ ç¾¤ï¼š465280882","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"[è¯‘]Kotlin 1.1.2 is out","date":"2017-04-25T13:19:00.000Z","path":"2017/04/25/Kotlin 1.1.2 is out.html","text":"æˆ‘ä»¬å¾ˆé«˜å…´å®£å¸ƒKotlin 1.1.2æ­£å¼å‘å¸ƒäº†ï¼Œè¿™ä¹Ÿæ˜¯Kotlin 1.1çš„ç¬¬äºŒæ¬¡ Bug ä¿®å¤å’Œå·¥å…·æ›´æ–°ã€‚æ­¤æ¬¡æ›´æ–°ä¸ä»…æå‡äº†ç¼–è¯‘å™¨å’Œ IntelliJ IDEA æ’ä»¶çš„æ€§èƒ½ï¼ŒåŒæ—¶ä¹Ÿåœ¨å·¥å…·ä¸­å¢åŠ äº†æ–°çš„ç‰¹æ€§ï¼Œå½“ç„¶è¿˜æœ‰å„æ–¹é¢çš„é—®é¢˜ä¿®å¤ã€‚ æ­¤å¤–ï¼ŒKotlin 1.1.2ä¹Ÿæå‡äº†ä¸Android Gradleæ’ä»¶ç‰ˆæœ¬2.4.0-alphaçš„å…¼å®¹æ€§ã€‚æœ¬æ¬¡å‘å¸ƒç‰ˆæœ¬çš„æ‰€æœ‰æ›´æ–°å¯åœ¨æ›´æ–°æ—¥å¿—ä¸­æŸ¥çœ‹ã€‚åœ¨è¿™é‡Œè¦æ„Ÿè°¢æ‰€æœ‰å¤–éƒ¨çš„è´¡çŒ®è€…ï¼Œä»–ä»¬æäº¤çš„pull requestä¹ŸåŒ…å«äºè¯¥ç‰ˆæœ¬ä¸­ï¼šYoshinori Isogaiï¼ŒJonathan Leitschuhå’ŒKirill Rakhman ã€‚æ„Ÿè°¢æ‰€æœ‰å°è¯•EAPæ„å»ºå¹¶å‘æˆ‘ä»¬å‘é€åé¦ˆæ„è§çš„äººï¼ è¿ç§»è¯´æ˜Kotlinç¼–è¯‘å™¨ç°åœ¨ä¹Ÿéœ€è¦åŸºäºJDK 8è¿è¡Œã€‚ä½†æ‚¨åº”è¯¥ä¸éœ€è¦åœ¨æ„è¿™ä¸€ç‚¹æ”¹å˜ï¼Œå› ä¸ºå¤§å¤šæ•°å…¶ä»–Javaå¼€å‘å·¥å…·ï¼ˆæ¯”å¦‚Gradleå’ŒAndroidå·¥å…·ï¼‰ä¹Ÿéœ€è¦JDK 8ï¼Œå› æ­¤æ‚¨è‚¯å®šå·²ç»å®‰è£…äº†JDK 8ã€‚å¯¹äºç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ï¼Œä»ç„¶é»˜è®¤å…¼å®¹Java 1.6ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿæ²¡æœ‰è®¡åˆ’è¦æ”¾å¼ƒå¯¹ç”Ÿæˆçš„Java 1.6å…¼å®¹æ€§å­—èŠ‚ç çš„æ”¯æŒã€‚ å†…éƒ¨ç±»å½“ä¸­ä¸èƒ½å†å£°æ˜ objectï¼Œå› ä¸ºè¿™ä¸ª object å°†èƒ½å¤Ÿè®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“ object å§‹ç»ˆæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œå› æ­¤è¿™åœ¨ç†è®ºä¸Šæ˜¯è¡Œä¸é€šçš„ã€‚åŒæ ·çš„ï¼Œå†…éƒ¨å¯†å°ç±»ä¹Ÿæ˜¯ä¸è¢«å…è®¸çš„ã€‚ç„¶è€Œè¿™åªæ˜¯ä¸´æ—¶æ–¹æ¡ˆï¼Œåœ¨æˆ‘ä»¬æ·»åŠ äº†åœ¨å…¶å¤–éƒ¨ç±»è€Œéå†…éƒ¨ç±»ä¸­å£°æ˜å†…éƒ¨å¯†å°ç±»çš„å­ç±»çš„å¯èƒ½æ€§æ—¶ï¼Œå°†ä¼šåˆ é™¤è¯¥é™åˆ¶ã€‚(KT-16232ï¼ŒKT-16233ï¼‰ ç°åœ¨ä½¿ç”¨ä¸€ä¸ªåç§°å®Œå…¨ç”±ä¸‹åˆ’çº¿å­—ç¬¦ç»„æˆçš„å£°æ˜æ—¶å°†å¿…é¡»ä½¿ç”¨åå¼•å·ã€‚(KT-16264ï¼‰ Mavenå¢é‡ç¼–è¯‘ä»Kotlin 1.1.2å¼€å§‹ï¼Œä»¥å‰ç”¨äºIntelliJ IDEAå’ŒGradleæ„å»ºçš„å¢é‡ç¼–è¯‘ç°åœ¨ä¹Ÿæ”¯æŒMavenã€‚å¯ç”¨è¯¥åŠŸèƒ½æ—¶ï¼Œéœ€è¦ä½¿ç”¨-Då‘½ä»¤è¡Œå‚æ•°æˆ–protertiesæ ‡è®°è®¾ç½®kotlin.compiler.incrementalå±æ€§ä¸ºtrueï¼š 123&lt;properties&gt; &lt;kotlin.compiler.incremental&gt;true&lt;/kotlin.compiler.incremental&gt;&lt;/properties&gt; Mavenæ³¨è§£å¤„ç†ç°åœ¨å¯ä»¥ä»Mavenæ„å»ºä¸­è°ƒç”¨Kotlinçš„æ³¨è§£å¤„ç†å·¥å…·kaptäº†ï¼Œåªéœ€è¦åœ¨compileå‰ï¼Œä»kotlin-maven-pluginä¸­æ·»åŠ kaptçš„æ‰§è¡Œç›®æ ‡ï¼š 1234567891011121314151617181920&lt;execution&gt; &lt;id&gt;kapt&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;kapt&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;sourceDirs&gt; &lt;sourceDir&gt;src/main/kotlin&lt;/sourceDir&gt; &lt;sourceDir&gt;src/main/java&lt;/sourceDir&gt; &lt;/sourceDirs&gt; &lt;annotationProcessorPaths&gt; &lt;!-- Specify your annotation processors here. --&gt; &lt;annotationProcessorPath&gt; &lt;groupId&gt;com.google.dagger&lt;/groupId&gt; &lt;artifactId&gt;dagger-compiler&lt;/artifactId&gt; &lt;version&gt;2.9&lt;/version&gt; &lt;/annotationProcessorPath&gt; &lt;/annotationProcessorPaths&gt; &lt;/configuration&gt;&lt;/execution&gt; åœ¨è¿™é‡ŒæŸ¥çœ‹å…·æœ‰Java-Kotlinä»£ç æ”¯æŒå’Œæµ‹è¯•çš„POMæ–‡ä»¶å®Œæ•´ç¤ºä¾‹ã€‚ è¯·æ³¨æ„ï¼ŒIntelliJ IDEAè‡ªå·±çš„æ„å»ºç³»ç»Ÿä»ç„¶ä¸æ”¯æŒkaptã€‚å½“æ‚¨è¦é‡æ–°è¿è¡Œæ³¨è§£å¤„ç†æ—¶ï¼Œéœ€è¦ä»â€œMaven Projectsâ€å·¥å…·æ ä¸­å¯åŠ¨æ„å»ºã€‚ å†…è”æ–¹æ³•é‡æ„æˆ‘ä»¬ç»ˆäºåœ¨Kotlinä»£ç ä¸­å®ç°äº†Inlineæ–¹æ³•ï¼ˆFunctionï¼‰çš„æ”¯æŒã€‚ å…¶ä»–IDEæ”¹è¿›åœ¨1.1.xæ—¶é—´èŒƒå›´å†…ï¼Œæˆ‘ä»¬å¾ˆå¤§ä¸€éƒ¨åˆ†çš„å·¥ä½œæ˜¯è‡´åŠ›äºæé«˜IntelliJ IDEAæ’ä»¶çš„æ€§èƒ½ã€‚åœ¨æ­¤æ¬¡å‘å¸ƒçš„1.1.2ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¯¹å‡ é¡¹ä¸»è¦æ€§èƒ½è¿›è¡Œäº†æ”¹è¿›ï¼Œä¸»è¦æ¶‰åŠè¾“å…¥å“åº”ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå·²ç»ä¸ºåç»­1.1.3ç‰ˆæœ¬è¿›è¡Œäº†é¢å¤–çš„é‡å¤§æ”¹è¿›ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜åœ¨æ­¤ç‰ˆæœ¬ä¸­è¿›è¡Œäº†å¤§é‡æ–°çš„æ£€æµ‹ï¼Œå¿«é€Ÿè§£å†³æ–¹æ¡ˆå’Œå°å‹IDEåŠŸèƒ½ã€‚ç‰¹åˆ«å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨ç¼–è¾‘å™¨ä¸­æ”¯æŒæŠ˜å Android Stringèµ„æºå¼•ç”¨ï¼Œä»¥åŠæ–°çš„ç”¨äºå¤„ç†Android APIç‰ˆæœ¬é—®é¢˜çš„é—®é¢˜è§£å†³æ–¹æ¡ˆã€‚ å¦‚ä½•æ›´æ–°è¦æ›´æ–°IDEAæ’ä»¶ï¼Œåœ¨èœå•æ ä¸­ä¾æ¬¡é€‰æ‹© Tools | Kotlin | Configure Kotlin Plugin Updateï¼Œç„¶åç‚¹å‡»â€œCheck for updates nowâ€æŒ‰é’®ã€‚å¦å¤–ï¼Œä¸è¦å¿˜è®°åœ¨Mavenå’ŒGradleæ„å»ºè„šæœ¬ä¸­æ›´æ–°ç¼–è¯‘å™¨å’Œæ ‡å‡†åº“ç‰ˆæœ¬ å‘½ä»¤è¡Œç¼–è¯‘å™¨å¯ä»¥ä» Githubå‘å¸ƒé¡µé¢ é¡µé¢ä¸‹è½½ã€‚åƒå¾€å¸¸ä¸€æ ·ï¼Œå¦‚æœæ‚¨åœ¨æ–°ç‰ˆæœ¬ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ è®ºå› ä¸­å¯»æ±‚å¸®åŠ©ï¼Œåœ¨Slack(è·å–é‚€è¯·)ã€æˆ–è€…åœ¨é—®é¢˜è¿½è¸ªå™¨æå‡ºé—®é¢˜ ã€‚è®©æˆ‘ä»¬æ¥å§ï¼","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"[è¯‘]Kotlin 1.1 Event Report","date":"2017-04-06T15:21:00.000Z","path":"2017/04/06/Kotlin 1.1 Event Report.html","text":"Kotlin 1.1 ç‰ˆæœ¬å‘å¸ƒåœ¨ç¤¾åŒºåå“å¾ˆå¥½ã€‚ä¸ºäº†æ¼”ç¤º Kotlin 1.1 çš„æ–°åŠŸèƒ½ï¼ŒJetBrains æä¾›äº†ä¸€ä¸ªåœ¨çº¿æ´»åŠ¨ã€‚æ‰€æœ‰æ„Ÿå…´è¶£çš„äººéƒ½å¯ä»¥è§‚çœ‹ Andrey Breslav çš„åœ¨çº¿ç›´æ’­æ¼”ç¤ºï¼Œå¹¶åœ¨ Q&amp;A ç¯èŠ‚è·å¾—ä»–ä»¬å…³å¿ƒçš„é—®é¢˜çš„ç­”æ¡ˆã€‚è¿™æ¿€å‘äº†è®¸å¤šå½“åœ°ç¤¾åŒºç»„ç»‡è§é¢ä¼šï¼šè¶…è¿‡ 30 ä¸ªç”¨æˆ·ç»„åœ¨ 21 ä¸ªå›½å®¶ä¸¾åŠäº†çº¿ä¸‹æ´»åŠ¨ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å®Œæ•´çš„æ´»åŠ¨åˆ—è¡¨ Kotlinç¤¾åŒºç½‘é¡µ ã€‚æ´»åŠ¨å½“å¤©æœ‰ 3000 å¤šäººå‚åŠ äº†çº¿ä¸Šç›´æ’­ã€‚æ¼”ç¤ºå’Œ Q&amp;A è§†é¢‘å¯ä»¥åœ¨ YouTube ä¸ŠæŸ¥çœ‹ï¼š Kotlin 1.1 æ´»åŠ¨åé¦ˆå¦‚æœä½ çœ‹äº†ç›´æ’­ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“ä½ çš„æƒ³æ³•ï¼è¯· å¡«å†™æ­¤è¡¨æ ¼ åˆ†äº«æ‚¨çš„åé¦ˆã€‚å®ƒåªéœ€è¦å¤§çº¦7-10åˆ†é’Ÿã€‚æ‚¨çš„æŠ•å…¥å¯¹äºå¸®åŠ©æˆ‘ä»¬æ”¹è¿›æœªæ¥çš„ Kotlin æ´»åŠ¨éå¸¸é‡è¦ã€‚ Kotlin æœªæ¥ç‰¹æ€§è°ƒæŸ¥ æˆ‘ä»¬è¿˜å‘æ‰€æœ‰ç¤¾åŒºæä¾›äº†å¯¹ Kotlin æœªæ¥çš„å½±å“ã€‚æ´»åŠ¨ç»„ç»‡è€…æ”¶åˆ°äº†è°ƒæŸ¥è¡¨ï¼Œæ´»åŠ¨å‚ä¸è€…å¯ä»¥åœ¨çº¿ä¸‹å¯¹æœ€æœŸæœ›çš„åŠŸèƒ½å‘è¡¨çœ‹æ³•ã€‚è°ƒæŸ¥å¾—åˆ°å¾ˆå¤šå…³æ³¨ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»æŠŠå®ƒæ”¾åœ¨ç½‘ä¸Šï¼Œä»¥å¬å–æ›´å¹¿æ³›çš„ç¤¾åŒºå»ºè®®ã€‚ç°åœ¨ä½ å¯ä»¥åœ¨çº¿ç»™ Kotlin çš„æœªæ¥æä¾›ä½ çš„å»ºè®® ï¼è¯·æ³¨æ„ï¼Œä½ åœ¨ v1.2 ä¸­æœ‰å¾ˆå¤§å¯èƒ½çœ‹ä¸åˆ°è¿™äº›åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬ä¼šåœ¨ç¡®å®šå·¥ä½œä¼˜å…ˆçº§æ—¶è€ƒè™‘æ‚¨çš„æ„è§ã€‚","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"[è¯‘]Kotlin 1.1 ä¹Ÿé€‚ç”¨äº Android å¼€å‘è€…","date":"2017-04-05T08:13:00.000Z","path":"2017/04/05/Kotlin 1.1 is also for Android Developers.html","text":"Kotlin 1.1çš„å‘å¸ƒä»¤äººä»¬æ„Ÿåˆ°éå¸¸å…´å¥‹ã€‚æ­¤ç‰ˆæœ¬åŒ…å«çš„æ–°åŠŸèƒ½å¯¹ Java å¼€å‘è€…éå¸¸æœ‰ç”¨ï¼Œå¹¶å°† å¼•é¢† JVM èµ°å‘ä¸€ä¸ªå……æ»¡å‘å±•æ½œåŠ›çš„æ–°ä¸–ç•Œã€‚ ä½†æœ‰äº›æ–°åŠŸèƒ½ï¼Œå¦‚ coroutine å’Œ type aliasï¼ˆä¸‹æ–‡æœ‰å‡ ä¸ªä¾‹å­ï¼‰å¯¹äº Android å¼€å‘è€…æ¥è¯´å°±åƒç§‘å¹»å°è¯´ã€‚ æˆ‘ä»¬ä»ç„¶åœç•™åœ¨å‡ ä¹æ²¡æœ‰ä»€ä¹ˆæ”¹è¿›çš„å¤è€ Java 6 ä¸­ï¼Œè¿«ä½¿æˆ‘ä»¬ä»¥å…¶ä»–å¹³å°å·²ç»è¢«è¢«é—å¿˜çš„æ–¹å¼è¿›è¡Œå¼€å‘ã€‚ æ‰€ä»¥ä¸€ä¸ªç†æ‰€å½“ç„¶çš„é—®é¢˜æ˜¯ï¼šKotlin å›¢é˜Ÿèƒ½å¤Ÿä¿æŒä¸ Java 6 çš„å…¼å®¹æ€§ï¼ŒåŒæ—¶ä¿ç•™æ‰€æœ‰è¿™äº›æ–°åŠŸèƒ½å—ï¼Ÿç­”æ¡ˆæ˜¯ï¼šå½“ç„¶ï¼ æ‰€æœ‰æ–°ç‰¹æ€§ä»ç„¶å…¼å®¹ Java 6 ä¸º Android å¼€å‘è€…æ‰€ç”¨ã€‚ ä»Šå¤©æˆ‘æƒ³å‘æ‚¨å±•ç¤ºå…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•ä½¿ä½ æ›´å®¹æ˜“çš„å¼€å‘ Android åº”ç”¨ç¨‹å¼ã€‚ type alias ä½¿ä½ çš„ listener æ›´æ˜“è¯»å½“ç„¶ type alias æœ‰å¾ˆå¤šä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œä¸è¿‡æˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯ä½¿ç”¨ lambda ä½œä¸º listener çš„ç±»å‹æ—¶ä¼šä½¿ä»£ç æ›´æ˜“è¯»ã€‚ å¦‚æœæ²¡æ¥è§¦è¿‡ type alias çš„è¯ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºç»™å¤æ‚çš„ç±»å‹åèµ·ä¸ªåˆ«åï¼Œä½¿å…¶æ›´ä¸ºå¯è¯»ã€‚ ä¾‹å¦‚ä½ æœ‰ä¸ªæ¥æ”¶ listener çš„ RecyclerViewAdapterã€‚RecyclerView æ²¡æœ‰ ListView é‚£æ · æ ‡å‡†çš„æ–¹å¼æ¥å¤„ç†æ¡ç›®ç‚¹å‡»äº‹ä»¶ï¼Œå¿…é¡»ç”±å¼€å‘è€…è‡ªå·±å®ç°ã€‚ å‡å¦‚æˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªå¯ä»¥è®¿é—® view çš„ listenerï¼Œé‚£ adapter å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š 123class MyAdapter(val items: List&lt;Item&gt;, val listener: (View) -&gt; Unit) : RecyclerView.Adapter&lt;MyAdapter.ViewHolder&gt;() &#123; ...&#125; è€Œä½ çš„ ViewHolder å¯èƒ½éœ€è¦æ¥æ”¶è¯¥ listenerï¼Œæ‰èƒ½å°†å…¶åˆ†é…ç»™ viewï¼š 12345class ViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) &#123; fun bind(item: Item, listener: (View) -&gt; Unit) &#123; itemView.setOnClickListener(listener) &#125;&#125; è¿™ä¸æ˜¯ä¸€ä¸ªå¤æ‚çš„ä¾‹å­ï¼Œä½†æ˜¯æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„æˆ‘ä»¬éœ€è¦é‡å¤å®šä¹‰è¿™ä¸ª lambda ï¼Œä¼šå¯¼è‡´è¿™æ®µä»£ç ä¸å¤ªå¥½é˜…è¯»ã€‚ ä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä»£è¡¨ç‚¹å‡» listener çš„ type aliasï¼štypealias ClickListener = (View) -&gt; Unitç„¶ååœ¨éœ€è¦çš„æ¯ä¸€ä¸ªåœ°æ–¹ä½¿ç”¨å®ƒï¼šclass MyAdapter(val items: List&lt;Item&gt;, val listener: ClickListener)æˆ–è€…fun bind(item: Item, listener: ClickListener) { ... } data class æ›´å¼ºå¤§äº†data class å¯ä»¥ä¸ºæˆ‘ä»¬é¿å…å¤§é‡çš„æ ·æ¿ä»£ç ï¼Œä½†æ˜¯å®ƒä¸èƒ½ç»§æ‰¿å…¶å®ƒç±»æ‰€ä»¥æŸäº›æƒ…å†µä¸‹ä¸å¯ç”¨ã€‚ Kotlin 1.1 å–æ¶ˆäº†è¿™ä¸ªé™åˆ¶ï¼Œä¾‹å¦‚ data class å¯ä»¥å®šä¹‰ä¸º sealed class çš„å­ç±»äº†ï¼š 12345sealed class UiOp &#123; object Show : UiOp() object Hide : UiOp() data class Translate(val axis: Axis, val amount: Int): UiOp()&#125; åŒæ—¶ sealed class å¯ä»¥åœ¨çˆ¶ç±»ä¹‹å¤–å®šä¹‰ï¼Œå°±åƒè¿™æ ·çš„ï¼š 1234sealed class UiOpobject Show : UiOp()object Hide : UiOp()data class Translate(val axis: Axis, val amount: Int) : UiOp() åœ¨ lambda ä¸­ä½¿ç”¨ destructuringä» Kotlin æœ€æ—©çš„ç‰ˆæœ¬å¼€å§‹ data class å°±èƒ½å¤Ÿä½¿ç”¨ destructuring declarations äº†ï¼Œå› ä¸ºå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆ componentX() æ–¹æ³•ï¼Œå€ŸåŠ©è¿™äº›æ–¹æ³•å¯ä»¥å°† data class å¯¹è±¡æ‹†åˆ†æˆè‹¥å¹²å˜é‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123data class Item(val text: String, val url: String) val (text, url) = item å¯æ˜¯åœ¨ Kotlin 1.1 ä¹‹å‰ä½ å¹¶ä¸èƒ½åœ¨ lambda ä¸Šè¿™ä¹ˆåšã€‚ä¸è¿‡ç­‰å¾…ç»“æŸäº†ï¼ç°åœ¨å¯ä»¥è¿™ä¹ˆå†™ï¼š 1234fun bind(item: Item) = item.let &#123; (text, url) -&gt; textView.text = text imageView.loadUrl(url)&#125; è¿™ä¸ªæ”¹è¿›ååˆ†é€‚ç”¨äºæ“ä½œ Pair å’Œ Map ç­‰ç±»å‹çš„å¯¹è±¡ é€‚ç”¨ä¸å±€éƒ¨å˜é‡çš„ delegated propertydelegated property å·²è¢«è¯æ˜æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå¯ä»¥ä¸ºç±»ä¸­çš„ property æä¾›é™„åŠ çš„èƒ½åŠ›ã€‚ ä¾‹å¦‚æœ€æœ‰ç”¨çš„ä¸€ä¸ªæ˜¯ lazy propertyï¼Œå®ƒä¼šæ¨è¿Ÿèµ‹å€¼æ“ä½œï¼Œç›´åˆ°å˜é‡ç¬¬ä¸€æ¬¡ä½¿ç”¨ã€‚ ä½†å…¶å® lazy å¯¹äºå±€éƒ¨å˜é‡æ¥è¯´ä¹Ÿæ˜¯ååˆ†æœ‰ç”¨çš„ï¼Œè€Œä¹‹å‰ Kotlin ç¼ºä¹è¿™ä¸ªåŠŸèƒ½ã€‚ ç°åœ¨é€šè¿‡ delegated propertyï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°ï¼š 12345678910fun testLocalDelegation() &#123; val database by lazy &#123; createDatabase() &#125; val cache by lazy &#123; createMemoryCache() &#125; if (mustUseDatabase()) &#123; database.use &#123; ... &#125; &#125; else &#123; cache.use &#123; ... &#125; &#125;&#125; è™½ç„¶è¿™ä¸ªä¾‹å­å¯ä»¥åœ¨æ²¡æœ‰ä½¿ç”¨ lazy çš„æƒ…å†µä¸‹è§£å†³ï¼Œä½†å®ƒæœ‰åŠ©äºç†è§£è¿™ä¸ªæ¦‚å¿µã€‚ æœ‰ä¸€äº›å ç”¨æ¯”è¾ƒå¤šçš„å¯¹è±¡ä¸ä¸€å®šä¼šè¢«ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ lazy å»¶è¿Ÿå®ä¾‹åŒ–ï¼Œç›´åˆ°æˆ‘ä»¬åˆæ¬¡ä½¿ç”¨å®ƒã€‚ è¿™æ—¶å¤§æ‹¬å·å†…çš„ä»£ç ä¼šè¢«æ‰§è¡Œï¼Œå¹¶ä¸”å°†ç»“æœç¼“å­˜ä¸‹æ¥ä»¥å¤‡ç¨åå†æ¬¡ä½¿ç”¨ã€‚ å†ä¹Ÿä¸ç”¨åœ¨ lambda ä¸­å®šä¹‰æœªä½¿ç”¨çš„å˜é‡äº†åœ¨ lambda ä¸­å®šä¹‰äº†å˜é‡ä½†æœ€ç»ˆæ²¡ä½¿ç”¨æƒ…å†µå¾ˆå¸¸è§ã€‚ è¿™æ˜¯å› ä¸ºåœ¨ Kotlin 1.0 ä¸­æ²¡æœ‰åŠæ³•ä¸¢å¼ƒ lambda ä¸­æœªä½¿ç”¨çš„å‚æ•°ã€‚ ä¾‹å¦‚ä½¿ç”¨ delegated property æ›´æ–° RecyclerView adapterï¼Œæˆ‘ä½¿ç”¨äº†ä»¥ä¸‹ä»£ç ï¼š 1234var items: List&lt;Content&gt; by Delegates.observable(emptyList()) &#123; prop, old, new -&gt; autoNotify(old, new) &#123; o, n -&gt; o.id == n.id &#125;&#125; prop å˜é‡ä»æœªè¢«ä½¿ç”¨è¿‡ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿æ¥æ›¿æ¢å®ƒï¼š 1234var items: List&lt;Content&gt; by Delegates.observable(emptyList()) &#123; _, old, new -&gt; autoNotify(old, new) &#123; o, n -&gt; o.id == n.id &#125;&#125; è¿˜æœ‰ç§æ›´ç³Ÿçš„æƒ…å†µï¼Œå¦‚æœ lambda æœ‰å¤šä¸ªå‚æ•°ï¼Œå³ä½¿ä½ ä¸€ä¸ªä¹Ÿä¸ç”¨è¿˜æ˜¯éœ€è¦å†™ä¸Šæ‰€æœ‰å‚æ•°ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å¿½ç•¥å®ƒä»¬äº†ï¼š 1234var items: List&lt;Item&gt; by Delegates.observable(emptyList()) &#123; _, _, _ -&gt; notifyDataSetChanged()&#125; ä¸ä»…å¯ä»¥å®šä¹‰è¾ƒå°‘çš„å˜é‡ï¼Œè€Œä¸”ä»£ç è¿˜å˜å¾—æ›´æ˜“è¯»äº†ï¼Œé‚£äº›æœ‰ç”¨çš„å˜é‡ä¸€çœ¼å°±èƒ½çœ‹åˆ°ã€‚ Coroutinecoroutine æ˜¯ Kotlin 1.1 ä¸­æœ€ä»¤äººå…´å¥‹çš„ç‰¹æ€§ã€‚å°½ç®¡åœ¨æ­¤ç‰ˆæœ¬ä¸­å¸¦ç€â€œå®éªŒæ€§â€çš„æ ‡ç­¾ï¼Œä½† coroutine åŠŸèƒ½é½å…¨ï¼Œä½ å®Œå…¨å¯ä»¥å¼€å§‹åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å®ƒä»¬ã€‚ coroutine èƒ½è®©ä½ ä»¥åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥ä»£ç ï¼Œå…è®¸ä½ åœ¨æŸäº›æ—¶å€™æš‚åœæ‰§è¡Œå¹¶ç­‰å¾…ç»“æœï¼ŒåŒæ—¶å†™ä¸‹é¡ºåºç›¸è¿ä»£ç ã€‚ æ‚¨å¯èƒ½å·²ç»çŸ¥é“åœ¨ Kotlin ä¸­ coroutine å¹¶ä¸æ˜¯æŒ‡ä¸€ä¸ªåº“æˆ–è€…å…·ä½“çš„å®ç°ï¼Œè€Œæ˜¯ä¸€ç§èƒ½åŠ›ï¼Œé€šè¿‡å®ƒèƒ½å¤Ÿåˆ›å»ºå…·æœ‰ coroutine ç‰¹æ€§çš„åº“ã€‚ å› æ­¤å°½ç®¡æŸäº›ä»£ç çœ‹èµ·æ¥å¯èƒ½ç›¸ä¼¼ï¼Œä½†é‡è¦çš„æ˜¯è¦çŸ¥é“åˆ›å»ºè¿™äº›è¾…åŠ©çº¿ç¨‹å¹¶è¿”å›ä¸»çº¿ç¨‹çš„â€œé½¿è½®â€æ˜¯ä»€ä¹ˆï¼Œè¿™åœ¨ Android ä¸­éå¸¸é‡è¦ã€‚ å¹¸è¿çš„æ˜¯ Kotlin ç¤¾åŒºçš„åŠ¨ä½œå¾ˆå¿«ï¼Œå·²ç»æœ‰å‡ ä¸ªåº“å¼•å…¥äº† coroutine æ–¹ä¾¿æˆ‘ä»¬åœ¨ Android ä¸Šä½¿ç”¨ã€‚ é¦–å…ˆæ¥çœ‹çœ‹ Jetbrains å®˜æ–¹æä¾›çš„ï¼š kotlinx-coroutines-android æä¾›äº†åœ¨ Android ä¸Šä½¿ç”¨ coroutine çš„å®ç°ã€‚ Anko åœ¨å…¶æœ€æ–°çš„ beta ç‰ˆä¸­æ”¹å†™äº†éƒ¨åˆ†æ¡†æ¶å¼•å…¥ coroutineã€‚ è¿˜æœ‰è®¸å¤šå…¶ä»–ç¬¬ä¸‰æ–¹åº“å®ç°äº†è‡ªå·±çš„ coroutine ç‰ˆæœ¬ï¼š AsyncAwait-Android by Niek Haarman Async / Await by Metalab å¦‚æœä½ åœ¨å¯»æ‰¾ Retrofit çš„ coroutine ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¯ä»¥è¯•è¯• kotlin-coroutines-retrofit by Andrey Mischenko å»ºè®®ä½ ä»¬ä½¿ç”¨çš„æ—¶å€™çœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•å®ç°çš„ï¼Œè¿™å°±æ˜¯å¼€æºçš„å¥½å¤„ã€‚ å…¶å®ƒå¯¹ Android å¼€å‘è€…æœ‰ç”¨çš„ä¸œè¥¿è¿™ä¸ªç‰ˆæœ¬è¿˜æœ‰æ›´å¤šçš„æ”¹è¿›ï¼Œä½†æ˜¯æˆ‘æ›´æƒ³å¼ºè°ƒä¸€äº›ä¾§é‡äº Android å¼€å‘çš„å†…å®¹ã€‚ é¦–å…ˆï¼Œç°åœ¨å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹é…ç½®æ¥å¯ç”¨ Jack ç¼–è¯‘å™¨çš„æ”¯æŒäº†ï¼šjackOptions {true}ã€‚è™½ç„¶ Google å·²ç»å®£å¸ƒæ”¾å¼ƒ Jack å·¥å…·é“¾äº†ï¼Œä½†æ˜¯å¦‚æœä½ å¯¹ Java 8 æœ‰éœ€æ±‚é‚£ä¹ˆä¼šæœ‰ä¸€ç‚¹ç”¨å¤„ï¼Œç„¶åç­‰åˆ° Android Studio 2.4 çš„æ­£å¼ç‰ˆå‘å¸ƒå°±å¯ä»¥å½»åº•å¼ƒç”¨ Jack äº†ã€‚ï¼ˆä» Android Studio 2.4 Preview 4 ç‰ˆæœ¬å¼€å§‹æ”¯æŒæ‰€æœ‰ Java 7 è¯­è¨€ç‰¹æ€§ï¼Œéƒ¨åˆ† Java 8 è¯­è¨€ç‰¹æ€§ï¼‰ å¦å¤–ä»‹ç»ä¸€ä¸ªå°æŠ€å·§ï¼Œå°±æ˜¯ç”¨ @JvmOverloads æ¥å®ç°è‡ªå®šä¹‰ View çš„æ„é€ å‡½æ•°ï¼Œåœ¨ Kotlin ä¸­å€ŸåŠ©å‚æ•°é»˜è®¤å€¼ä¸€ä¸ªæ„é€ å‡½æ•°å°±èƒ½æ»¡è¶³è‡ªå®šä¹‰ View çš„å¤šç§æ„é€ éœ€æ±‚ï¼ˆå—¯ï¼Œå¾ˆé•¿çš„ä¸€ä¸ªæ„é€ å‡½æ•°ï¼‰ 12345class CustomView @JvmOverloads constructor( context: Context, attrs: AttributeSet? = null, defStyleAttr: Int = 0) : View(context, attrs, defStyleAttr) &#123; ...&#125; ç»“è®ºKotlin 1.1 å¸¦æ¥äº†å¤§é‡çš„æ–°åŠŸèƒ½ï¼Œä¸ç¦è®©äººäº§ç”Ÿä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨ Java çš„æƒ³æ³•ã€‚ Kotlin ä¸º Android å¼€å‘è€…å¸¦æ¥çš„å¥½å¤„æ˜¯æ¯‹åº¸ç½®ç–‘çš„ï¼Œä»ç°åœ¨å¼€å§‹ä½¿ç”¨ Kotlin ç¼–å†™ä½ çš„ Android åº”ç”¨å§ã€‚ å¦‚æœä½ æƒ³ä»å¤´å¼€å§‹å­¦ä¹ ä½¿ç”¨ Kotlin å¼€å‘ Android åº”ç”¨ï¼Œé‚£ä¹ˆä½ åº”è¯¥ä¼šå¯¹ Kotlin for Android Developers è¿™æœ¬ä¹¦æ„Ÿå…´è¶£ã€‚","tags":[{"name":"Android","slug":"Android","permalink":"https://github.com/itgoyo/tags/Android/"},{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"[è¯‘]Kotlin 1.1 Event in Your City","date":"2017-03-21T13:51:00.000Z","path":"2017/03/21/Kotlin 1.1 Event in Your City.html","text":"æˆ‘ä»¬å°†äº2017å¹´3æœˆ23æ—¥è¿›è¡ŒKotlin 1.1æ´»åŠ¨ çº¿ä¸Šç›´æ’­ã€‚æ‚¨å¯ä»¥é€šè¿‡JetBrains TVè§‚çœ‹Andrey Breslavçš„æ¼”è®²ï¼Œäº†è§£Kotlin 1.1çš„å…³é”®ç‰¹æ€§ï¼ŒåŒ…æ‹¬åç¨‹(coroutines)ï¼ŒJavaScriptåç«¯ç­‰ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨#kotlinqaåœ¨twitterä¸Šæå‡ºé—®é¢˜ï¼Œæˆ‘ä»¬å°†åœ¨3æœˆ23æ—¥ç›´æ’­ä¸­çš„Q&amp;Aç¯èŠ‚è¿›è¡Œè§£ç­”ã€‚ä¸ºé€‚åº”ä¸åŒçš„æ—¶åŒºæˆ‘ä»¬å…±å‡†å¤‡äº†2ä¸ªç›´æ’­æµï¼Œè¯¦æƒ…å¯åœ¨åšå®¢æ—¥å¿—ä¸­å‚é˜…è¯¦ç»†è®¡åˆ’ä¸æŒ‡å¯¼ ã€‚ä»ä¸‹å›¾ä¸­äº†è§£æ‚¨æ‰€åœ¨çš„åŸå¸‚æ˜¯å¦æœ‰Kotlin 1.1æ´»åŠ¨ï¼Œå¦‚æœæ‚¨æ‰€åœ¨çš„åŸå¸‚å°šæœªå‡ºç°åœ¨ä¸‹å›¾ä¸­ï¼Œè¯·å•ç‹¬åŠ å…¥ç›´æ’­ã€‚ è¯·æ³¨æ„ï¼Œç¾å›½çš„ç›´æ’­æ—¶é—´å·²ç»æ›´æ”¹ä¸ºPDT(å¤ªå¹³æ´‹å¤å­£æ—¶é—´)æ—¶é—´ã€‚ç¬¬ä¸€ä¸ªç›´æ’­æµå°†äºä¸Šåˆ9ç‚¹å¼€å§‹ï¼Œç¬¬äºŒä¸ªä¸Šåˆ11ç‚¹å¼€å§‹ã€‚","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"[è¯‘]Kotlin 1.0.7 is out","date":"2017-03-15T14:21:00.000Z","path":"2017/03/15/Kotlin 1.0.7 is out.html","text":"æˆ‘ä»¬å¾ˆé«˜å…´åœ°å®£å¸ƒKotlin 1.0.xç³»åˆ—çš„æœ€åä¸€ä¸ªæ›´æ–°ï¼ŒKotlin 1.0.7å·²ç»å‘å¸ƒäº†ã€‚éœ€è¦é‡ç‚¹å…³æ³¨çš„æ˜¯è¯¥è¡¥ä¸é’ˆå¯¹Gradleå’Œannotation processingè¿›è¡Œä¿®å¤ï¼Œæ­¤å‰æ— æ³•å‡çº§åˆ°1.1ç‰ˆæœ¬çš„ç”¨æˆ·ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚å®Œæ•´çš„ä¿®å¤åˆ—è¡¨å¯ä»¥åœ¨æ›´æ–°æ—¥å¿—æŸ¥çœ‹ã€‚è¦åœ¨Mavenæˆ–Gradleç‰ˆæœ¬ä¸­æ›´æ–°ç‰ˆæœ¬ï¼Œåªéœ€åœ¨æ„å»ºè„šæœ¬ä¸­æ›´æ”¹Kotlinç‰ˆæœ¬å·ã€‚å‘½ä»¤è¡Œç¼–è¯‘å™¨ä¼šåœ¨Githubå‘è¡Œé¡µé¢ä¸­ä¸‹è½½ã€‚åœ¨IntelliJ IDEAå’ŒAndroid Studioä¸­ï¼Œå¦‚æœæ‚¨ä½¿ç”¨Kotlin 1.0.7æ„å»ºé¡¹ç›®ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨1.1ç‰ˆæœ¬çš„æ’ä»¶ï¼Œå¹¶å°†è¯­è¨€ç‰ˆæœ¬åˆ‡æ¢ä¸º1.0ã€‚å¦‚æœæ‚¨ç¡®å®æƒ³è¦å®‰è£…1.0.7ç‰ˆæœ¬çš„æ’ä»¶ï¼Œå¯ä»¥åœ¨Kotlinæ’ä»¶é¡µé¢ä¸‹è½½ç›¸åº”ç‰ˆæœ¬ï¼Œå¹¶é€šè¿‡IDEçš„â€œä»ç£ç›˜å®‰è£…æ’ä»¶â€¦â€æŒ‰é’®è¿›è¡Œå®‰è£…ã€‚ä¸€å¦‚æ—¢å¾€ï¼Œå¦‚æœæ‚¨åœ¨æ–°ç‰ˆæœ¬ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿æ‚¨åœ¨è®¨è®ºç»„æˆ–è€…Slackï¼ˆåœ¨è¿™é‡Œè·å¾—é‚€è¯·ï¼‰é‡Œå¯»æ±‚å¸®åŠ©ï¼Œæˆ–åœ¨è¿™é‡Œæäº¤issueã€‚è®©æˆ‘ä»¬æ¥äº«å—Kotlinå§ï¼","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"[è¯‘]Kotlin 1.1.1 is out","date":"2017-03-14T12:29:00.000Z","path":"2017/03/14/Kotlin 1.1.1 is out.html","text":"ä»Šå¤©æˆ‘ä»¬å‘å¸ƒäº†é’ˆå¯¹ Kotlin 1.1 çš„ç¬¬ä¸€ä¸ªbugä¿®å¤æ›´æ–°ã€‚æ­¤æ›´æ–°çš„é‡ç‚¹æ˜¯è§£å†³å¯¼è‡´é”™è¯¯ä»£ç ç”Ÿæˆçš„å›å½’ï¼›æˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½å¿«åœ°ä¿®å¤æ­¤é—®é¢˜ã€‚è¯¦ç»†å†…å®¹è¯·æŸ¥çœ‹æ›´æ–°æ—¥å¿— ã€‚é‡ç‚¹æ›´æ–°å¦‚ä¸‹ï¼š é»˜è®¤æƒ…å†µä¸‹ï¼Œå·²å¯ç”¨Gradleå¢é‡ç¼–è¯‘ã€‚å¦‚æœéœ€è¦ï¼Œæ‚¨ä»ç„¶å¯ä»¥æŒ‰ç…§æ–‡æ¡£æè¿°ç¦ç”¨æ­¤åŠŸèƒ½ã€‚ Kotlinæ’ä»¶ç°å·²å¯ä»¥é€šè¿‡Gradleæ’ä»¶ä¾èµ–æ·»åŠ ä½¿ç”¨ã€‚è¯¦æƒ…å¯å‚é˜…ç›¸å…³æ–‡æ¡£ã€‚ ç¦ç”¨ä½¿ç”¨å¸¦æœ‰æ¥æ”¶å™¨çš„å‡½æ•°ç±»å‹ä½œä¸ºJavaScriptå¤–éƒ¨å£°æ˜çš„å‚æ•°ç±»å‹ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œä¼ é€’ç»™è¿™äº›å‚æ•°çš„lambdasæ²¡æœ‰è¢«æ­£ç¡®çš„å‚æ•°è°ƒç”¨ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªé—®é¢˜ä¸Šæ²¡æœ‰ç®€å•çš„è§£å†³æ–¹æ³•ï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬å†³å®šç¦ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚ æ›´æ–°åçš„Kotlin Eclipse å’Œ NetBeans æ’ä»¶å°†æ”¯æŒKotlin 1.1.1ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥å°½æƒ…äº«å—Kotlinæ–°ç‰ˆæœ¬çš„ä¼˜ç‚¹è€Œæ— éœ€å…³æ³¨IDEã€‚ å¦‚ä½•æ›´æ–°è¦æ›´æ–°IDEAæ’ä»¶ï¼Œåœ¨èœå•æ ä¸­ä¾æ¬¡é€‰æ‹© Tools | Kotlin | Configure Kotlin Plugin Updateï¼Œç„¶åç‚¹å‡»â€œCheck for updates nowâ€æŒ‰é’®ã€‚å¦å¤–ï¼Œä¸è¦å¿˜è®°åœ¨Mavenå’ŒGradleæ„å»ºè„šæœ¬ä¸­æ›´æ–°ç¼–è¯‘å™¨å’Œæ ‡å‡†åº“ç‰ˆæœ¬ å‘½ä»¤è¡Œç¼–è¯‘å™¨å¯ä»¥ä» Githubå‘å¸ƒé¡µé¢ é¡µé¢ä¸‹è½½ã€‚åƒå¾€å¸¸ä¸€æ ·ï¼Œå¦‚æœæ‚¨åœ¨æ–°ç‰ˆæœ¬ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ è®ºå› ä¸­å¯»æ±‚å¸®åŠ©ï¼Œåœ¨Slack(è·å–é‚€è¯·)ã€æˆ–è€…åœ¨é—®é¢˜è¿½è¸ªå™¨æå‡ºé—®é¢˜ ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"[è¯‘]Kotlin 1.1 Event","date":"2017-03-06T09:43:00.000Z","path":"2017/03/06/Kotlin 1.1 Event.html","text":"Kotlin 1.1é™¤äº†ä¸ºæ‚¨çš„é¡¹ç›®å¸¦æ¥æ–°ç‰¹æ€§ä¹‹å¤–ï¼Œè¿˜æ˜¯æ‚¨ä¸å½“åœ°ç¤¾åŒºè¿›è¡Œçº¿ä¸‹äº¤æµå­¦ä¹ ã€äº†è§£Kotlinçš„æœªæ¥ä¸å‘å±•çš„ç»å¥½æœºä¼šã€‚æ‚¨å¯ä»¥ç»„ç»‡ç¤¾åŒºçš„å°ä¼™ä¼´ä»¬ï¼Œä¸€èµ·å‚ä¸Jetbrainså›¢é˜Ÿåœ¨3æœˆ23æ—¥ä¸¾åŠçš„Kotlinç›´æ’­æ´»åŠ¨ã€‚ä¸ºäº†é€‚åº”ä¸åŒæ—¶åŒºï¼Œæˆ‘ä»¬å‡†å¤‡äº†ä¸¤ä¸ªç›´æ’­æµï¼Œåˆ†åˆ«æ˜¯æ¬§æ´²ä¸­éƒ¨æ—¶é—´[CET]ä¸‹åˆ5ç‚¹/7ç‚¹(å¤ªå¹³æ´‹å¤å­£æ—¶é—´[PDT]ä¸Šåˆ9ç‚¹/11ç‚¹)ã€‚ å‘Šè¯‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬å°†åœ¨åšå®¢ä¸Šå…¬å¸ƒã€‚ Kotlin 1.1æ´»åŠ¨æ—¶é—´ï¼š CETæ—¶é—´ä¸‹åˆ5ç‚¹/7ç‚¹(PDTæ—¶é—´ä¸Šåˆ9ç‚¹/11ç‚¹) - Andrey Breslavæ¼”è®²(Youtubeä¸Šç›´æ’­30åˆ†é’Ÿ)ï¼Œé“¾æ¥å°†ç¨å€™æ”¾å‡ºã€‚ CETæ—¶é—´ä¸‹åˆ5ç‚¹30åˆ†/7ç‚¹30åˆ†(PDTæ—¶é—´ä¸Šåˆ9ç‚¹30åˆ†/11ç‚¹30åˆ†) - ä¼‘æ¯30åˆ†é’Ÿï¼ŒæœŸé—´å¯ä»¥è‡ªç”±è®¨è®ºå…³äºåœ¨Kotlinæœªæ¥ç‰ˆæœ¬ä¸­æ‚¨æœ€å¸Œæœ›åŠ å…¥çš„åŠŸèƒ½æˆ–ç‰¹æ€§ï¼Œå¹¶åœ¨Twitterä¸Šåˆ†äº«å’Œè¯„è®ºã€‚ CETæ—¶é—´ä¸‹åˆ6ç‚¹/8ç‚¹(PDTæ—¶é—´ä¸Šåˆ10ç‚¹/12ç‚¹) - ä¸Kotlinå›¢é˜Ÿçš„äº’åŠ¨é—®ç­”ç¯èŠ‚(45åˆ†é’Ÿï¼Œç›´æ’­); æ¬¢è¿å„ä½å‚ä¸è®¨è®ºä¸å‘è¨€ã€‚ äº’åŠ¨é—®ç­”ç¯èŠ‚ ä»3æœˆ21æ—¥å¼€å§‹ï¼Œè‡³3æœˆ23æ—¥äº’åŠ¨ç¯èŠ‚ç»“æŸæœŸé—´ï¼Œæ‚¨å¯ä»¥åœ¨Twitterä¸Šä½¿ç”¨#kotlinQAæ ‡ç­¾å‘æˆ‘ä»¬æå‡ºä»»ä½•æ‚¨æƒ³è¦é—®çš„é—®é¢˜ï¼› Kotlinå›¢é˜Ÿå°†å¯¹é—®é¢˜è¿›è¡Œåˆ†ç±»; å›¢é˜Ÿå°†åœ¨Qï¼†Aç¯èŠ‚ç°åœºå›ç­”é—®é¢˜; å¦‚æœåœ¨ä¼šè®®æœŸé—´æœ‰é—®é¢˜æ²¡æœ‰ç­”å¤ï¼Œæˆ‘ä»¬ä»å°†é€šè¿‡Twitterè¿›è¡Œå›å¤ ä¼˜å…ˆå›ç­”æé—®é¢‘ç‡æœ€é«˜çš„é—®é¢˜ Future Features kitæœ¬æ¬¡è°ƒæŸ¥çš„ç›®çš„æ˜¯æ”¶é›†ç¤¾åŒºç”¨æˆ·å¯¹è¯­è¨€ç‰¹å¾çš„åå¥½å’Œéœ€æ±‚ã€‚æ‚¨å¯ä»¥æå‡ºåœ¨Kotlinåç»­ç‰ˆæœ¬ä¸­æœ€å¸Œæœ›çœ‹åˆ°çš„ç‰¹å¾æˆ–åŠŸèƒ½ï¼›ä¸è¿‡è¿™äº›å†…å®¹å¹¶ä¸ä¿è¯èƒ½åœ¨1.2ç‰ˆæœ¬ä¸­å‘å¸ƒï¼Œä½†æˆ‘ä»¬ä¼šåœ¨ç¡®å®šå·¥ä½œä¼˜å…ˆçº§æ—¶è€ƒè™‘æ‚¨çš„æ„è§ã€‚ Kotlin Future Feature KitåŒ…å«20å¼ å†™æœ‰åŠŸèƒ½åç§°å’Œæè¿°çš„å¡ç‰‡ä»¥åŠç”¨äºæŠ•ç¥¨çš„è´´çº¸; å°†åŠŸèƒ½å¡ç‰‡ç²˜è´´åˆ°ç™½æ¿ï¼ˆæˆ–å¢™å£ï¼‰ä¸Š; æ¯ä½å‚åŠ è€…å¯è·å¾—3å¼ ï¼ˆ3å¼ ï¼‰è´´çº¸ï¼Œå¯ä»¥åœ¨åŠŸèƒ½ä¸­è‡ªç”±åˆ†é…ï¼šæœ€å¤šä¸ºä¸‰ç§ä¸åŒçš„åŠŸèƒ½è¿›è¡ŒæŠ•ç¥¨ï¼Œæˆ–è€…å¯¹æŸä¸€åŠŸèƒ½æŠ•å‡ºä¸¤ç¥¨ç”šè‡³ä¸‰ç¥¨; å‚åŠ è€…å¯ä»¥é€šè¿‡é˜…è¯»å¡ç‰‡çš„è¯´æ˜äº†è§£åŠŸèƒ½ï¼Œç„¶åæŒ‰ä¸Šæ‰€è¿°è§„åˆ™è¿›è¡ŒæŠ•ç¥¨; å°†ç»“æœè¿›è¡Œæ‹ç…§; ä½¿ç”¨#kotlineventæ ‡ç­¾åœ¨Twitterä¸Šå‘å¸ƒ åœ¨è¿™é‡Œæäº¤ä½ çš„ç­”æ¡ˆå§","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"Kotlin 1.1","date":"2017-03-04T00:46:34.000Z","path":"2017/03/04/Kotlin 1.1.html","text":"ä¸Šå‘¨ä¸€çš„æ–‡ç« é‡Œé¢æåˆ° Kotlin 1.1 rcäº†ï¼Œè¿˜æ²¡æ­£å¼å‘å¸ƒï¼Œæˆ‘åœ¨å‘¨ä¸‰çš„æ—¶å€™æŠŠæ–‡ç« è½¬åˆ°æ˜é‡‘ä»¥åï¼Œå¥½å¤šå°ä¼™ä¼´å‘Šè¯‰æˆ‘ï¼Œ1.1 å·²ç»å‘å¸ƒäº†~ tips: æœ¬æ–‡æœ‰è¾ƒå¤šå¤–é“¾ï¼Œå…¬ä¼—å·é˜…è¯»æ—¶æ— æ³•è·³è½¬ï¼Œå¦‚æœ‰éœ€è¦ï¼Œè¯·å¤§å®¶ç‚¹å‡»â€é˜…è¯»åŸæ–‡â€ã€‚ 1ã€æ›´æ–°è¦ç‚¹1.1 Coroutine1.1 æœ€å¤§çš„æ›´æ–°ä¸€å®šå¿…é¡»æ¯«æ— ç–‘é—®çš„è¦æ•° Coroutine äº†ï¼Œå°½ç®¡åœ¨æ­£å¼å‘ç‰ˆä¹‹å‰ï¼ŒKotlin Team çªç„¶è™šäº†ï¼Œå†³å®šæŠŠè¿™ä¸ªç‰¹æ€§å®šä¸º Experimentalï¼Œä¸è¿‡è¿™ä¼¼ä¹å¹¶æ²¡æœ‰æ”¹å˜ä»€ä¹ˆã€‚ä¸å°±æ˜¯æ”¹ä¸ªåŒ…åä¹ˆï¼ï¼ æ—©åœ¨æ˜¥èŠ‚æ”¾å‡é‚£å‡ å¤©ï¼Œæˆ‘å°±åœ¨å…¬ä¼—å·è¿ç»­ä¸¤å‘¨å‘æ–‡ä»‹ç» Coroutineï¼Œæœ¬æ¥è¿˜è®¡åˆ’æœ‰ç¬¬ä¸‰ç¯‡çš„ï¼Œä¸è¿‡å¼€å·¥ä»¥åä¸ªé¡¹ç›®æœ‰ç‚¹å„¿ç´¯ï¼Œæ¯å¤©ç¿» Android ç³»ç»Ÿ C++ å±‚çš„ä»£ç ç¿»åˆ°åï¼Œä¹Ÿæ²¡ç²¾åŠ›å»å†™ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼ŒçœŸæ˜¯æŠ±æ­‰ï¼Œå¦‚æœå¤§å®¶æœ‰å…´è¶£ï¼Œå¯ä»¥å‚è€ƒå‰ä¸¤ç¯‡ï¼š æ·±å…¥ç†è§£ Kotlin Coroutine (ä¸€) æ·±å…¥ç†è§£ Kotlin Coroutine (äºŒï¼‰ å…¶ä¸­ï¼Œç¬¬ä¸€ç¯‡æ–‡ç« å†™äº experimental ä¹‹å‰ï¼Œä¸è¿‡å¤§å®¶åªè¦åœ¨åŒ…åå½“ä¸­åŠ ä¸Š experimental å°±æ²¡é—®é¢˜äº†ã€‚ Kotlin çš„ Coroutine å®ç°ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªå±‚é¢ï¼Œç¬¬ä¸€ä¸ªå±‚é¢å°±æ˜¯æ ‡å‡†åº“ä»¥åŠè¯­è¨€ç‰¹æ€§çš„æ”¯æŒï¼Œè¿™é‡Œé¢ä¸»è¦åŒ…æ‹¬æœ€åŸºæœ¬çš„ suspend å…³é”®å­—ä»¥åŠè¯¸å¦‚ startCoroutine è¿™æ ·çš„æ–¹æ³•æ‰©å±•ï¼Œä¸Šè¿°ç¬¬ä¸€ç¯‡æ–‡ç« å¯¹æ­¤åšäº†è¯¦ç»†çš„ä»‹ç»ã€‚ç¬¬äºŒå±‚é¢åˆ™ä¸»è¦æ˜¯åŸºäºå‰é¢çš„åŸºç¡€å°è£…çš„åº“ï¼Œç›®å‰ä¸»è¦æ˜¯ kotlinx.coroutine ï¼Œå…¶ä¸­å°è£…äº† runBlockã€launch è¿™æ ·æ–¹ä¾¿çš„æ“ä½œ Coroutine çš„ apiï¼Œè¿™åœ¨ç¬¬äºŒç¯‡æ–‡ç« åšäº†è¯¦ç»†åœ°ä»‹ç»ã€‚æ‰€ä»¥å¤§å®¶åœ¨äº†è§£ Coroutine çš„æ—¶å€™ï¼Œå¯ä»¥ä»è¿™ä¸¤ä¸ªè§’åº¦æ¥å…¥æ‰‹ï¼Œä»¥å…æ²¡æœ‰å¤´ç»ªã€‚ æˆ‘ä»¬å†æ¥ç®€å•è¯´è¯´ Coroutine çš„è¿è¡Œæœºåˆ¶ã€‚Coroutine æ˜¯ç”¨æ¥è§£å†³å¹¶å‘é—®é¢˜çš„ï¼Œå®ƒç”šè‡³æœ‰ä¸ªä¸­æ–‡åå«â€œåç¨‹â€ï¼Œå®ƒçœ‹ä¸Šå»è·Ÿçº¿ç¨‹ä¼¼ä¹æ˜¯å¹¶å‘é—®é¢˜çš„ä¸¤ç§ç‹¬ç«‹çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶å®ä¸ç„¶ã€‚è¦å¹¶å‘çš„æ‰§è¡Œä»»åŠ¡ï¼Œä»æ ¹æœ¬ä¸Šè¯´ï¼Œå°±æ˜¯è¦è§£å†³ Cpu çš„è°ƒåº¦é—®é¢˜ï¼ŒCpu ç©¶ç«Ÿæ˜¯å¦‚ä½•è°ƒåº¦ï¼Œå–å†³äºæ“ä½œç³»ç»Ÿï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºç¼–å†™çš„è¿‡ç¨‹ä¸­ç”¨åˆ°çš„ Thread ä¹Ÿå¥½ï¼ŒCoroutine ä¹Ÿå¥½ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯å¯¹æ“ä½œç³»ç»Ÿå¹¶å‘ api çš„å°è£…ã€‚çŸ¥é“äº†è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å†æ¥æƒ³æƒ³ Thread æ˜¯å¦‚ä½•åšåˆ°ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„å‘¢ï¼ŸJava è™šæ‹Ÿæœºçš„å®ç°ä¸»è¦é‡‡ç”¨äº†å¯¹å†…æ ¸çº¿ç¨‹æ˜ å°„çš„æ–¹å¼ï¼Œæ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨åˆ°çš„ Thread çš„çœŸæ­£ç›´æ¥è°ƒåº¦è€…å¯ä»¥ç†è§£ä¸ºæ˜¯æ“ä½œç³»ç»Ÿæœ¬èº«ã€‚é‚£æˆ‘ä»¬åœ¨ Kotlin å½“ä¸­æ”¯æŒ Coroutine æ˜¯ä¸æ˜¯ä¹Ÿè¦æŠŠæ¯ä¸€ä¸ª Coroutine æ˜ å°„åˆ°å†…æ ¸å‘¢ï¼Ÿæ˜¾ç„¶ä¸èƒ½ï¼Œä¸ç„¶é‚£è·Ÿ Thread è¿˜æœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿå†è€…ï¼ŒCoroutine çš„æ ¸å¿ƒåœ¨ Co ä¸Šï¼Œå³å„ä¸ª Coroutine æ˜¯åä½œè¿è¡Œçš„ï¼Œæœ‰ä¸€ç§â€œä½ å”±ç½¢æ¥æˆ‘ç™»åœºâ€çš„æ„Ÿè§‰ï¼Œå°±æ˜¯è¯´ï¼ŒCoroutine çš„è°ƒåº¦æƒæ˜¯è¦æŒæ¡åœ¨ç¨‹åºè‡ªå·±æ‰‹ä¸­çš„ã€‚äºæ˜¯ï¼Œå¦‚æœä½ å»äº†è§£ kotlinx.coroutine çš„å®ç°ï¼Œä½ å°±ä¼šå‘ç° CommonPool è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œå®ƒä¸æ˜¯åˆ«çš„ï¼Œå®ƒçš„èƒŒåæ­£æ˜¯çº¿ç¨‹æ± ã€‚ çº¿ç¨‹æ˜¯è½»é‡çº§è¿›ç¨‹ï¼Œè€Œåç¨‹åˆ™æ˜¯è½»é‡çº§çº¿ç¨‹ã€‚ Coroutine çš„å‡ºç°è®© Kotlin å¦‚è™æ·»ç¿¼ï¼Œå¦‚æœä½ ä¹‹å‰åœ¨å†™ Goï¼ŒLuaï¼Œpythonï¼Œæˆ–è€… C#ï¼Œè¿™å› Java è™šæ‹Ÿæœºå®¶æ—å¯ä¸ä¼šè®©ä½ å¤±æœ›äº†ã€‚è‡ªä»æœ‰äº†åç¨‹ï¼Œä½ ä¹Ÿå¯ä»¥å†™å‡ºè¿™æ ·çš„ä»£ç ï¼š 12345678910111213141516val fibonacci = buildSequence &#123; yield(1) // first Fibonacci number var cur = 1 var next = 1 while (true) &#123; yield(next) // next Fibonacci number val tmp = cur + next cur = next next = tmp &#125; &#125; ... for (i in fibonacci)&#123; println(i) if(i &gt; 100) break //å¤§äº100å°±åœæ­¢å¾ªç¯ &#125; åºåˆ—ç”Ÿæˆå™¨ï¼Œè®°å¾—æˆ‘åˆšå­¦ python é‚£ä¼šå„¿çœ‹åˆ°è¿™æ ·çš„è¯­æ³•ï¼Œç®€ç›´æƒŠå‘†äº†ã€‚ 123val imageA = loadImage(urlA) val imageB = loadImage(urlB) onImageGet(imageA, imageB) è¿™æ ·çš„ä»£ç ä¹Ÿæ˜¯æ²¡æœ‰å‹åŠ›çš„ï¼Œçœ‹ä¸Šå»å°±å¦‚åŒæ­¥ä»£ç ä¸€èˆ¬ï¼Œæ®Šä¸çŸ¥äººå®¶åšçš„å¯æ˜¯å¼‚æ­¥çš„äº‹æƒ…å‘ã€‚ åç¨‹çš„å‡ºç°ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç”¨çœ‹ä¼¼åŒæ­¥çš„ä»£ç åšç€å¼‚æ­¥çš„äº‹æƒ…ã€‚ è¿™ç¯‡æ–‡ç« æˆ‘ä»¬ä¸»è¦è¯´è¯´ 1.1 çš„å‘ç‰ˆï¼ŒCoroutine çš„æ›´å¤šå†…å®¹ï¼Œå»ºè®®å¤§å®¶ç›´æ¥ç‚¹å‡»å‰é¢çš„é“¾æ¥å»è¯»æˆ‘çš„å¦å¤–ä¸¤ç¯‡æ–‡ç« ~ 1.2 JavaScript æ”¯æŒçœŸæ˜¯åª³å¦‡å„¿ç»ˆäºç†¬æˆå©†ï¼ŒJs ç»ˆäºè¢«æ­£å¼æ”¯æŒäº†ã€‚çœ‹å®˜æ–¹çš„æ„æ€ï¼Œä»–ä»¬å·²ç»ç”¨è¿™ä¸€ç‰¹æ€§åšäº†ä¸å°‘å°è¯•ï¼Œä» Kotlin ä»å¤´åˆ°å°¾å†™ä¸€ä¸ªç«™ç‚¹ï¼Œä¼¼ä¹æ¯«æ— å‹åŠ›ï¼Œå°½ç®¡ç±»ä¼¼åå°„è¿™ä¸€çš„ç‰¹æ€§è¿˜æ²¡æœ‰æ”¯æŒï¼Œä¸è¿‡é¢åŒ…ä¼šæœ‰çš„å˜›ã€‚ ä»æˆ‘ä¸ªäººçš„è§’åº¦æ¥è¯´ï¼Œä¹Ÿå¯èƒ½æˆ‘å¯¹å‰ç«¯äº†è§£å¤ªå°‘å§ï¼Œæˆ‘è§‰å¾—åº”ç”¨åœ¨å‰ç«¯æ¯”èµ·ç§»åŠ¨ç«¯ã€æœåŠ¡ç«¯æ¥è¯´ï¼ŒKotlin çš„å‰æ™¯ç›¸å¯¹ä¸æ˜æœ—ã€‚æˆ‘ç”¨ JavaScript ç”¨å¾—å¥½å¥½çš„ï¼Œä¸ºå•¥è¦åˆ‡æ¢ Kotlin å‘¢ï¼ŸåŠ¨æ€ç‰¹æ€§ç©èµ·æ¥æŒºçˆ½çš„ï¼Œè™½ç„¶å›è°ƒå†™å¤šäº†å®¹æ˜“è›‹ç–¼ï¼Œä½†è¿™ä¹Ÿä¸æ˜¯ä¸å¯ä»¥è§„é¿çš„ã€‚å…³äº Kotlin å¼€å‘å‰ç«¯è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘éœ€è¦å¤šäº†è§£ä¸€ä¸‹å‰ç«¯å¼€å‘è€…çš„çœ‹æ³•ï¼Œç›¸æ¯”ä»–ä»¬æ˜¯å¦æ„¿æ„æ¥è§¦ Kotlinï¼Œæˆ‘æ›´å…³å¿ƒæœ‰å‡ ä¸ªåšå‰ç«¯çš„äººçŸ¥é“è¿™é—¨è¯­è¨€ã€‚ä¸ç’å„ä½è¯´ï¼Œå‰å‡ å¤©è·Ÿä¸€ä¸ªæ”¯ä»˜å®å®¢æˆ·ç«¯çš„å¤§å“¥èŠäº†ä¸€ä¼šå„¿ï¼Œä»–é—®æˆ‘è¿™ä¸ª k o t ä»€ä¹ˆçš„ï¼Œæ˜¯å¹²å•¥çš„ã€‚ã€‚ã€‚æˆ‘å½“æ—¶åœ¨æƒ³ï¼Œçœ‹æ¥é˜¿é‡Œäººå¯¹ Kotlin è¿˜ä¸æ˜¯å¾ˆç†Ÿæ‚‰å•Šã€‚ Whateverï¼ŒKotlin ç°åœ¨éƒ½å¯ä»¥æ”¯æŒ node.js äº†ï¼Œè¿˜æœ‰ä»€ä¹ˆä¸å¯èƒ½çš„å‘¢ï¼Ÿä½œä¸ºåƒç“œç¾¤ä¼—ï¼Œä¸”è®©æˆ‘è§‚æœ›ä¸€é˜µå­ã€‚ 1.3 ä¸­æ–‡æ”¯æŒä½ æ”¾å¿ƒï¼Œè¿™ä¸€æ®µå†…å®¹ä½ ç»å¯¹åœ¨å…¶ä»–äººé‚£é‡Œçœ‹ä¸åˆ°ï¼Œå› ä¸ºæ²¡äººä¼šè¿™ä¹ˆè›‹ç–¼ã€‚æˆ‘å‰å‡ å¤©ä¸ºäº†åšä¸€ä¸ªæ¡ˆä¾‹ç”¨ä¸­æ–‡å†™äº†æ®µä»£ç ï¼Œæƒ³ç€ Java æ”¯æŒä¸­æ–‡æ ‡è¯†ç¬¦ï¼ŒKotlin åº”è¯¥ä¹Ÿé—®é¢˜ä¸å¤§ã€‚æ²¡æ›¾æƒ³ï¼Œå†™çš„æ—¶å€™ä¸€ç‚¹å„¿é—®é¢˜çš„æ²¡ï¼Œå¯ç¼–è¯‘çš„æ—¶å€™å´ç›´æ¥ç‹—å¸¦äº†ã€‚ 123456789101112package ä¸­å›½.åŒ—äº¬.å›é¾™è§‚ class G6å‡ºå£&#123; fun ä¸‹é«˜é€Ÿ()&#123; println(\"å‰æ–¹å µæ­», è¯·å¼€å¯é£è¡Œæ¨¡å¼ :)\") &#125;&#125; fun main(args: Array&lt;String&gt;) &#123; val å›é¾™è§‚å‡ºå£ = G6å‡ºå£() å›é¾™è§‚å‡ºå£.ä¸‹é«˜é€Ÿ()&#125; æ³¨æ„ï¼ŒåŒ…åã€ä»£ç æ–‡ä»¶åéƒ½æ˜¯ä¸­æ–‡çš„ï¼Œå¦‚æœç”¨ 1.0.6 ç‰ˆç¼–è¯‘ï¼Œç»“æœå°±æ˜¯ä¸‡é‡Œæ±Ÿå±±ä¸€ç‰‡çº¢å“‡ã€‚ 1234567Error:Kotlin: [Internal Error] java.io.FileNotFoundException: /Users/benny/temp/testKotlin/out/production/testKotlin/??/??/???/G6??.class (No such file or directory) at java.io.FileInputStream.open0(Native Method) at java.io.FileInputStream.open(FileInputStream.java:195) at java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:138) at kotlin.io.FilesKt__FileReadWriteKt.readBytes(FileReadWrite.kt:52) at org.jetbrains.kotlin.incremental.LocalFileKotlinClass ... æ³¨æ„åˆ°ï¼Œæ±‰å­—éƒ½å˜æˆäº† ??ï¼Œç§ç§ç¼–è¯‘å™¨é‚£å°çœ¼ç¥ï¼ŒçœŸæ˜¯çœ‹å¾—æˆ‘éƒ½é†‰äº†ã€‚ å¦‚æœæˆ‘ä»¬ç”¨ 1.1 çš„ç¼–è¯‘å™¨æ¥ç¼–è¯‘è¿™æ®µä»£ç ï¼Œç»“æœå°±å¯ä»¥æ­£å¸¸è¾“å‡ºï¼š 1å‰æ–¹å µæ­», è¯·å¼€å¯é£è¡Œæ¨¡å¼ã€‚ 1.4 å…¶ä»–ç‰¹æ€§1.1 è¿˜æ–°å¢äº†ä¸å°‘ç‰¹æ€§ï¼Œæˆ‘åœ¨ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« å°±åšè¿‡ä»‹ç»ï¼šå–œå¤§æ™®å¥”ï¼Kotlin 1.1 Beta é™ä¸´~ tpyealias ç»‘å®šè°ƒç”¨è€…çš„å‡½æ•°å¼•ç”¨ data class å¯ä»¥ç»§æ‰¿å…¶ä»–ç±» sealed class å­ç±»å®šä¹‰çš„ä½ç½®æ”¾å®½ _ ä½œä¸ºå ä½ï¼Œæ›¿ä»£ä¸éœ€è¦çš„å˜é‡ provideDelegate 2ã€Kotlin å…ƒå¹´2016 å¹´æ˜¯ Kotlin â€œå…ƒå¹´ï¼ˆFirst year of Kotlinï¼‰â€ï¼Œå®˜ç½‘ç»™å‡ºäº†è¿™æ ·ä¸€å¹…å›¾æ¥å±•ç¤ºå®ƒä¸€å¹´æ¥çš„æˆç»©ï¼š Github ä¸Šé¢çš„ä»£ç é‡éƒ½ç ´åƒä¸‡äº†ï¼Œä½¿ç”¨ Kotlin çš„å…¬å¸ä¹Ÿé€æ¸å¢å¤šï¼Œé™¤äº† JetBrains è‡ªå·±ä»¥å¤–ï¼Œæˆ‘è§‰å¾—åœ¨ Java ç•Œæ¯”è¾ƒæœ‰åˆ†é‡çš„å°±æ˜¯ Square äº†ï¼Œå¦‚æœ Google èƒ½å¤Ÿç¨å¾®æä¸€å¥ Kotlin ï¼Œæ˜¾ç„¶è¿™ä¸ªæ•…äº‹å°±ä¼šæœ‰å¦å¤–ä¸€ä¸ªä»¤äººå…´å¥‹çš„ç‰ˆæœ¬â€”â€”å¥½å•¦ï¼Œä¸è¦ yy å•¦ã€‚ æ®è¯´ï¼Œæ¯”è¾ƒè‘—åçš„ä¸»è¦æœ‰Amazon Web Services, Pinterest, Coursera, Netflix, Uber, Square, Trello, Basecamp è¿™äº›å…¬å¸å°† Kotlin æŠ•å…¥äº†ç”Ÿäº§å®è·µå½“ä¸­ã€‚å›½å†…èµ„æ–™è¾ƒå°‘ï¼Œä¼°è®¡æ¥è§¦çš„äººä¹Ÿä¸æ˜¯å¾ˆå¤šï¼Œåƒç™¾åº¦ã€è…¾è®¯ã€é˜¿é‡Œå·´å·´ã€æ»´æ»´ã€æ–°ç¾å¤§ã€å°ç±³ã€äº¬ä¸œè¿™æ ·çš„å…¬å¸å¯èƒ½è¿˜æ²¡æœ‰å¤ªå¤šçš„åŠ¨åŠ›å»å°† Kotlin åº”ç”¨åˆ°å¼€å‘ä¸­ï¼Œå°±ç®—å¼€å§‹å°è¯•ï¼Œä¹Ÿå¤šæ˜¯åœ¨ Android å¼€å‘ä¸Šé¢è¯•æ°´ï¼›è€Œæ•¢äºå°è¯• Kotlin çš„ï¼Œæ›´å¤šæ˜¯æ²¡æœ‰ä»€ä¹ˆå†å²åŒ…è¢±ä¸”å¯Œäºåˆ›æ–°å’ŒæŒ‘æˆ˜ç²¾ç¥çš„åˆ›ä¸šå›¢é˜Ÿï¼Œå¯¹äºä»–ä»¬è€Œè¨€ Kotlin ä¸ºå¼€å‘å¸¦æ¥çš„æ•ˆç‡æ˜¯éå¸¸è¯±äººçš„ã€‚ è¯´åˆ°è¿™é‡Œï¼Œæœ‰ä¸¤ä¸ªä»¤äººå…´å¥‹çš„æ¶ˆæ¯éœ€è¦åŒæ­¥ç»™å¤§å®¶ï¼š Gradle å¼€å§‹å°è¯•ç”¨ Kotlin ä½œä¸ºå…¶è„šæœ¬è¯­è¨€ï¼Œç›®å‰å·²ç»å‘åˆ°äº† 0.4.0ã€‚è¿™ä¸ªçœŸçš„å¯ä»¥æœ‰ï¼Œgroovy è™½ç„¶æ˜¯ä¸€é—¨å¾ˆçµæ´»çš„è¯­è¨€ï¼Œä¸è¿‡å†™é…ç½®çš„æ—¶å€™å¦‚æœæ²¡æœ‰ IDE çš„æç¤ºï¼Œå®åœ¨æ˜¯å¤ªç—›è‹¦äº†ã€‚å¤§å®¶æœ‰å…´è¶£ä¹Ÿå¯ä»¥å…³æ³¨ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼šgradle-script-kotlin Spring 5.0 åŠ å…¥ Kotlin æ”¯æŒï¼ŒSpring çš„åœ°ä½å¯æƒ³è€ŒçŸ¥ï¼ŒSpring ä¸º Kotlin ç«™å°ï¼Œè¿™åˆ†é‡è¿˜æ˜¯å¾ˆé‡çš„ã€‚ ä¸çŸ¥é“ 2017 å¹´ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä¸”è®©æˆ‘ä»¬å‡†å¤‡å¥½çˆ†ç±³èŠ±é¥®æ–™ï¼Œæ‹­ç›®ä»¥å¾…å§ã€‚ å…³äº Kotlin çš„èµ„æ–™ï¼Œè‹±æ–‡ç‰ˆçš„å›¾ä¹¦å·²ç»å‡ºç‰ˆäº†å‡ æœ¬ï¼Œä¸»è¦æœ‰ï¼š Kotlin in Actionï¼šè¿™éƒ¨ä¹¦å·²ç»æœ‰äº†çº¸è´¨ç‰ˆï¼Œæ˜¯å®˜æ–¹è‡ªå·±äººå†™çš„ï¼Œç®—æ˜¯ä¸€æœ¬æ¯”è¾ƒæƒå¨çš„å‚è€ƒä¹¦äº†ã€‚ Kotlin for Android Developersï¼šè¿™æœ¬ä¹¦ä¹Ÿç®—æ˜¯è€èµ„å†äº†ï¼Œç¨å¾®çœ‹å‡ çœ¼ä½ å°±ä¼šä¸º Kotlin æœ‰è¶£çš„ç‰¹æ€§æ‰€å¸å¼•ã€‚å¦å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªä¸­æ–‡çš„ç¿»è¯‘ç‰ˆæœ¬ Modern Web Development with Kotlinï¼šè¿™æœ¬ä¹¦æˆ‘æ²¡æœ‰è¯»è¿‡ï¼Œå¦‚æœä½ éœ€è¦ç”¨ Kotlin å¼€å‘ web åº”ç”¨ï¼Œå®ƒåº”è¯¥ä¼šç»™äºˆä½ ä¸€äº›å¸®åŠ©ã€‚ Programming Kotlinï¼šè¿™æœ¬ä¹¦æ¶‰åŠå†…å®¹éå¸¸å…¨é¢ï¼Œå†…å®¹ä¹Ÿç®—æ˜¯è¨€ç®€æ„èµ…ï¼Œå¿«é€Ÿå…¥é—¨ Kotlin å¯ä»¥é€‰æ‹©å®ƒã€‚ é™¤äº†å›¾ä¹¦ä»¥å¤–ï¼Œ Kotlin çš„é¦–å¸­å¸ƒé“å¸ˆ Hadi Hariri å·²ç»åœ¨ Oâ€™Reilly ä¸Šé¢å‘å¸ƒäº†ä¸¤å¥—è§†é¢‘æ•™ç¨‹ï¼š Introduction to Kotlin Programming Advanced Kotlin Programming é‡Œé¢æœ‰å…è´¹çš„å‡ æ®µï¼Œä¸”ä¸è¯´å†…å®¹æ€ä¹ˆæ ·ï¼Œåæ­£è€ƒéªŒå¤§å®¶è‹±è¯­å¬åŠ›çš„æ—¶å€™åˆ°äº†ï¼Œå—¯ï¼Œè€çˆ·å­è®²å¾—è¿˜æ˜¯å¾ˆæ¸…æ¥šçš„ã€‚ å›½å†…çš„èµ„æ–™ï¼Œå¾ˆå°‘ã€‚é™¤äº†æœ‰ä¸ªåˆ«å°ä¼™ä¼´å†™çš„ä¸€äº›åšå®¢ä¹‹å¤–ï¼Œè¾ƒä¸ºç³»ç»Ÿçš„å­¦ä¹ èµ„æ–™å‡ ä¹æ²¡æœ‰ã€‚ä¹Ÿéš¾æ€ªå¤§å®¶éƒ½ä¸çŸ¥é“å®ƒå‘¢ã€‚ä¹Ÿæ­£æ˜¯ä¸ºäº†å¼¥è¡¥è¿™ä¸€ç©ºç™½ï¼Œæˆ‘åœ¨ 16 å¹´ 10 æœˆçš„æ—¶å€™å¼€å§‹æ¯å‘¨ 10 åˆ†é’Ÿçš„èŠ‚å¥è¿ç»­å½•äº† 15 æœŸè§†é¢‘ï¼Œå¦‚æœä½ æœ‰ Java åŸºç¡€ï¼Œé‚£ä¹ˆçœ‹è¿™äº›è§†é¢‘åŸºæœ¬ä¸Šå¯ä»¥è®©ä½ çŸ¥é“ Kotlin æ˜¯æ€ä¹ˆä¸€å›äº‹äº†ã€‚ Kotlin ä¸­æ–‡è§†é¢‘æ•™ç¨‹ å¦å¤–ï¼Œå¦‚æœä½ æƒ³è¦å¯¹ Kotlin æŒç»­äº†è§£ï¼Œå»ºè®®ä½ å…³æ³¨å¾®ä¿¡å…¬ä¼—å· Kotlinï¼Œæ¯å‘¨ä¸€æ¨é€çš„ Kotlin çš„ç›¸å…³æ–‡ç« ï¼ŒåŸºæœ¬ä¸Šä¼šè¦†ç›–äº† Kotlin çš„å„ç§æœ€æ–°åŠ¨æ€ã€‚ä¹Ÿæ¬¢è¿å¤§å®¶è·Ÿæˆ‘äº¤æµå¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜~ 3ã€Kotlin æ—¶ä»£1.1 çš„é‡è¦çš„æ›´æ–°å…¶å®å°± Coroutine ä»¥åŠ JavaScript æ”¯æŒï¼Œæ¯•ç«Ÿ Kotlin å¯¹ Java çš„å…¼å®¹æ”¯æŒå·²ç»åšå¾—éå¸¸ä¸é”™äº†ï¼ˆåˆ«è€æ apt çš„äº‹å„¿ï¼Œ1.0.4 ä¹‹åçš„ kapt ä¸å°±åŸºæœ¬ä¸Šå¾ˆå¥½ç”¨äº†ä¹ˆï¼‰ã€‚åˆ«äººé—®æˆ‘ï¼ŒKotlin åˆ°åº•æ˜¯å†™å•¥çš„ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘é€šå¸¸è¯´å¾ˆå®˜æ–¹çš„è¯´ï¼ŒKotlin æ˜¯ä¸€é—¨è¿è¡Œåœ¨ Javaè™šæ‹Ÿæœºã€Androidã€æµè§ˆå™¨ä¸Šçš„é™æ€è¯­è¨€ï¼Œå¯æ˜¯ï¼ŒKotlin Team çš„èŠ‚å¥å·²ç»è®©è¿™å¥è¯æ˜¾å¾—è¦è¿‡æ—¶äº†ã€‚ä»–ä»¬ç”¨çŸ­çŸ­å‡ å¹´æ—¶é—´æå‡ºè¿™ä¹ˆä¸ªå…¨æ ˆçš„è¯­è¨€ï¼Œå„æ–¹é¢ç‰¹æ€§éƒ½è¿˜å¾ˆæ£’ï¼Œç„¶è€Œä»–ä»¬å¹¶ä¸èƒ½æ„Ÿåˆ°æ»¡è¶³ï¼Œä»–ä»¬å·²ç»å¼€å§‹èµ° C++ çš„è·¯çº¿ï¼Œä¹Ÿè®¸ Kotlin Native è¦ä¸äº†å¤šä¹…å°±ä¼šå‡ºç°äº†ã€‚ ç¬¬ä¸€æ¬¡å¬åˆ°è¿™æ¶ˆæ¯çš„æ—¶å€™ï¼Œæˆ‘ç¬é—´å°±å‡Œä¹±äº†ï¼Œé‚£æ„Ÿè§‰å°±å¥½åƒç‹è€…è£è€€é‡Œé¢é˜Ÿå‹é€‰äº†å¤§ä¹”ä¸€æ ·ï¼Œç§’å›æ³‰æ°´åŠ æ»¡è¡€ï¼Œç§’å›æˆ˜åœºæ”¶äººå¤´å•Šã€‚ å‰ä¸ä¹…ï¼Œæˆ‘å¾ˆè£å¹¸åœ°è·Ÿä¸€ä½åˆ›ä¸šå…¬å¸ CEO åä¸‹æ¥èŠç†æƒ³ï¼Œä»–é—®æˆ‘çš„ç¬¬ä¸€å¥è¯å°±æ˜¯ï¼šä½ è§‰å¾— Kotlin æ˜¯æœªæ¥ä¹ˆï¼Ÿæˆ‘å½“æ—¶å°±è’™äº†ï¼Œä¸å¾—ä¸è¯´ï¼Œä»–å¯¹ Kotlin çš„æœŸå¾…è·Ÿ Kotlin Team å¦‚å‡ºä¸€è¾™å‘€ã€‚æˆ‘å½“æ—¶å®åœ¨ä¸çŸ¥é“è¯¥æ€ä¹ˆå›ç­”ä»–ï¼Œå›æ¥ä»”ç»†æƒ³äº†æƒ³ï¼Œç­”æ¡ˆå…¶å®ä¹Ÿæ˜¯æœ‰çš„ã€‚ åå‡ å¹´å‰ï¼Œä¸œå®¶ç¼ºé’±ï¼Œæ€¥éœ€æŠ•èµ„ï¼ŒæŠ•èµ„äººåä¸‹æ¥â€œæ‹·é—®â€å°é©¬å“¥ï¼šâ€œè¿™ä¸ªä¸œè¥¿ï¼ˆæŒ‡å½“æ—¶çš„ OICQï¼‰æ€ä¹ˆèµšé’±ï¼Ÿâ€ å°é©¬å“¥è¯´è‡ªå·±åªçŸ¥é“è¿™ä¸ªä¸œè¥¿å¤§å®¶å–œæ¬¢ï¼Œä½†ä¸çŸ¥é“å‘è°æ”¶é’±ã€‚å¯¹äº Kotlin æ¥è¯´ï¼Œæˆ‘åªçŸ¥é“å®ƒå¥½ç”¨ï¼Œå°½ç®¡å¤§å®¶éƒ½è¿˜çœ‹ä¸å¤ªæ‡‚ï¼Œä¸è¿‡å®ƒçš„æ—¶ä»£æ­£åœ¨æ‚„æ‚„çš„åˆ°æ¥ã€‚","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"[è¯‘]Kotlin 1.1 å‘å¸ƒå•¦ï¼JavaScriptï¼ŒCoroutine è¿˜æœ‰æ›´å¤šä½ æƒ³è¦çš„","date":"2017-03-01T09:12:00.000Z","path":"2017/03/01/Kotlin 1.1 Released with JavaScript Support, Coroutines and more.html","text":"Kotlin 1.1 ä»Šå¤©æ­£å¼å‘å¸ƒäº†ï¼Œè¿™è®© Kotlin æœ‰èƒ½åŠ›é€‚ç”¨äºæ›´å¤šçš„åº”ç”¨åœºæ™¯ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤Ÿå–œæ¬¢ã€‚ æˆ‘ä»¬å¸Œæœ› Kotlin èƒ½å¤Ÿåœ¨åº”ç”¨çš„ä»»ä½•ç»„ä»¶ä¸­æˆä¸ºç‹¬ç«‹çš„ã€å¯Œæœ‰è¡¨ç°åŠ›ä¸”æ€§èƒ½å¼ºå¤§çš„å¼ºç±»å‹è¯­è¨€ï¼ŒKotlin1.1 ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡è¿ˆå‡ºäº†å·¨å¤§çš„ä¸¤æ­¥ã€‚ é¦–å…ˆï¼ŒJavaScript æ”¯æŒçš„â€œè¯•éªŒæ€§â€æ ‡ç­¾å·²è¢«ç§»é™¤ï¼Œå¹¶ä¸”æ”¯æŒæ‰€æœ‰ Kotlin è¯­è¨€ç‰¹æ€§ã€æ ‡å‡†åº“çš„å¤§éƒ¨åˆ†å†…å®¹ä»¥åŠ JavaScript äº’æ“ä½œæ€§ã€‚è¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥å®Œå…¨ä½¿ç”¨ Kotlin æ¥ç¼–å†™æ•´ä¸ª WEB åº”ç”¨ï¼ŒåŒæ—¶ç»§ç»­ä½¿ç”¨ JavaScript çš„å¼€å‘æ¡†æ¶ï¼ˆæ¯”å¦‚ Reactï¼‰ã€‚ å…¶æ¬¡ï¼Œæˆ‘ä»¬å¼•å…¥äº†åç¨‹(coroutines)çš„æ¦‚å¿µã€‚ä½œä¸ºçº¿ç¨‹çš„è½»é‡çº§æ›¿ä»£æ–¹æ¡ˆï¼Œåç¨‹åœ¨åº”ç”¨ç¨‹åºåç«¯å¯ä»¥å…·æœ‰æ›´å¤§å¯æ‰©å±•æ€§ï¼Œä»è€Œæ”¯æŒå•ä¸ª JVM å®ä¾‹ä¸Šçš„å¤§é‡å·¥ä½œè´Ÿè½½ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåç¨‹å¯¹äºå®ç°å¼‚æ­¥è¡Œä¸ºå…·æœ‰å¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œè¿™å¯¹äºåœ¨ä»»ä½•å¹³å°ä¸Šæ„å»ºå“åº”å¼ç”¨æˆ·äº¤äº’ç•Œé¢è€Œè¨€æå…¶é‡è¦ã€‚ ä¸‹é¢æˆ‘ä»¬å°†è¿›ä¸€æ­¥ä»‹ç»è¿™ä¸¤å¤§åŠŸèƒ½ã€‚å…¶ä»–éƒ¨åˆ†å¦‚type aliasesï¼Œcallable referencesï¼Œdestructuring in lambdasç­‰è¯¦æƒ…å¯åœ¨æœ€æ–°æ¶ˆæ¯æŸ¥çœ‹ï¼Œè¯•è¯•å®Œæ•´çš„å¯è¿è¡Œç¤ºä¾‹ä»£ç ï¼ åç¨‹(Coroutines)åœ¨ Kotlin ä¸­åç¨‹ä½¿éé˜»å¡å¼å¼‚æ­¥ä»£ç ä¸åŒæ­¥ä»£ç ä¸€æ ·æ˜“äºç†è§£ã€‚ å¼‚æ­¥ç¼–ç¨‹æ­£å½“é£é¡ï¼Œå”¯ä¸€è®©æˆ‘ä»¬æ€è™‘çš„æ˜¯ï¼Œéé˜»å¡å¼ä»£ç å¤§é‡å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚ è€Œ Kotlin ç°åœ¨æä¾›äº†ç®€åŒ–è¿™ç§å¤æ‚æ€§çš„æ–¹æ³•ï¼Œé€šè¿‡å•åŸå­è®©åç¨‹åœ¨è¯­è¨€ä¸­æˆä¸ºä¸€ç­‰å…¬æ°‘ï¼šæŒ‚èµ·å‡½æ•°ã€‚è¿™ç§ç±»å‹çš„å‡½æ•°ï¼ˆæˆ– lambdaï¼‰è¡¨ç¤ºåœ¨è®¡ç®—è¿è¡Œä¸­å¯ä»¥è¢«æŒ‚èµ·ï¼ˆä¸é˜»å¡ä»»ä½•çº¿ç¨‹ï¼‰ï¼Œè€Œåä¹Ÿèƒ½ç»§ç»­æ¢å¤è¿è¡Œã€‚ ä»æŠ€æœ¯ä¸Šè¯´ï¼Œåç¨‹æ˜¯å¤šä»»åŠ¡åä½œçš„è½»é‡çº§è§£å†³æ–¹æ¡ˆï¼ˆç±»ä¼¼äºfibers)ï¼‰ã€‚æ¢è¨€ä¹‹ï¼Œä»–ä»¬åªæ˜¯æ›´å¥½çš„çº¿ç¨‹ï¼šå¯ä»¥ä»»æ„çš„å¯åŠ¨å’Œä¿ç•™ï¼Œä¸”æŒ‚èµ·çš„æ¶ˆè€—æå…¶ä¹‹ä½ï¼ˆæŒ‚èµ·ä¹‹äºåç¨‹ï¼Œå¦‚é˜»å¡ä¹‹äºçº¿ç¨‹ï¼‰ï¼Œéå¸¸æ˜“äºç»„åˆä¸è®¢åˆ¶ã€‚ æˆ‘ä»¬å¯¹äºåç¨‹çš„è®¾è®¡ä»¥å®ç°æœ€å¤§çš„çµæ´»æ€§ä¸ºç›®æ ‡ï¼šåœ¨è¯­è¨€ä¸­å›ºåŒ–çš„éƒ¨åˆ†å°‘ï¼Œè€Œä¸”å¯ä»¥ä½œä¸ºåº“æ¥å®ç°å¾ˆå¤šåŠŸèƒ½ã€‚kotlinx.coroutinesé¡¹ç›®åœ¨ Rxï¼ŒCompletableFutureï¼ŒNIOï¼ŒJavaFx å’Œ Swing ä¸Šå‡æœ‰è®¾è®¡åŠŸèƒ½åº“ï¼Œç”šè‡³å¯ä»¥ä¸º Android å’Œ JavaScript ç¼–å†™ç±»ä¼¼çš„åº“ã€‚å³ä½¿åœ¨å…¶â€‹â€‹ä»–è¯­è¨€ä¸­è®¸å¤šå†…ç½®æ„å»ºç°åœ¨ä¹Ÿå¯ä»¥ç”¨ Kotlin åº“æ¥ç¼–å†™ã€‚åŒ…æ‹¬ Python çš„ generators/yieldï¼Œæ¥è‡ª Go çš„ channels/select ä»¥åŠ Cï¼ƒçš„ async/await: 12345678910111213141516// runs the code in the background thread poolfun asyncOverlay() = async(CommonPool) &#123; // start two async operations val original = asyncLoadImage(\"original\") val overlay = asyncLoadImage(\"overlay\") // and then apply overlay to both results applyOverlay(original.await(), overlay.await())&#125; // launches new coroutine in UI contextlaunch(UI) &#123; // wait for async overlay to complete val image = asyncOverlay().await() // and then show it in UI showImage(image)&#125; æŸ¥çœ‹å®Œæ•´å†…å®¹ã€‚ é‡è¦æç¤ºï¼šå‡­å€Ÿä¸Šè¿°çš„è¿™äº›ä¼˜åŠ¿ï¼ŒKotlin åç¨‹è¿‘ä¹å…¨æ–°çš„è®¾è®¡ï¼Œåœ¨æˆ‘ä»¬èƒ½ç¡®å®šè¿™æ˜¯ 100ï¼…æ­£ç¡®å’Œå®Œæ•´ä¹‹å‰ï¼Œä»ç„¶éœ€è¦å¤§é‡çš„å®è·µå’Œæµ‹è¯•ã€‚å› æ­¤æˆ‘ä»¬æ‰é€‰æ‹©åœ¨â€œå®éªŒæ€§â€æ ‡å¿—ä¸‹å‘å¸ƒã€‚æˆ‘ä»¬ä¸å¸Œæœ›è¯­è¨€è§„åˆ™å‘ç”Ÿå˜åŒ–ï¼Œä½† API å¯èƒ½éœ€è¦åœ¨ Kotlin 1.2 ä¸­è¿›è¡Œè°ƒæ•´ã€‚ JavaScript æ”¯æŒå¦‚ä¸Šæ‰€è¿°ï¼ŒKotlin 1.1 ä¸­çš„æ‰€æœ‰è¯­è¨€ç‰¹æ€§ï¼ˆåŒ…æ‹¬åç¨‹ï¼‰éƒ½é€‚ç”¨äº JVM / Android å’Œ JavaScriptï¼ˆJavaScript çš„åå°„ç›®å‰ä¸å¯ç”¨ï¼Œä½†æˆ‘ä»¬æ­£åœ¨è¿™æ–¹é¢åŠªåŠ›ï¼‰ã€‚è¿™æ„å‘³ç€ Web åº”ç”¨ç¨‹åºå¯ä»¥å®Œå…¨ä½¿ç”¨ Kotlin ç¼–å†™ï¼Œè€Œä¸”æˆ‘ä»¬å·²ç»åœ¨ JetBrains å†…éƒ¨æœ‰ä¸€äº›å°è¯•ï¼Œç›¸ä¿¡å¾ˆå¿«å°±ä¼šå‘å¸ƒæ•™ç¨‹å’Œå…¶ä»–èµ„æ–™ã€‚ Kotlin for JavaScript å…·æœ‰ä¸â€œæºç”Ÿâ€JavaScript ä»£ç è¿›è¡Œäº’ç›¸æ“ä½œçš„åŠ¨æ€ç±»å‹ï¼Œé€šè¿‡ç±»å‹ API å¯ä»¥ä½¿ç”¨ts2kt converterä»¥åŠDefinitelyTypedç­‰çŸ¥ååº“ã€‚ æˆ‘ä»¬æ”¯æŒ Node.js å’Œæµè§ˆå™¨ã€‚ Kotlin æ ‡å‡†åº“å¯é€šè¿‡npmä½¿ç”¨ã€‚æ–‡æ¡£é“¾æ¥ ã€‚ å·¥å…·Kotlin 1.1 å¹¶ä¸æ˜¯ Kotlin å·¥å…·å‘å¸ƒçš„ä¸»ç‰ˆæœ¬ï¼šæˆ‘ä»¬æ›´å–œæ¬¢å…·æœ‰è¿™äº›åŠŸèƒ½çš„å·¥å…·å°±ç»ªåï¼Œä¸ä¼šå¯¹è¯­è¨€æœ¬èº«äº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ Kotlin 1.0.x ç‰ˆæœ¬ä¸­çš„æœ‰è®¸å¤šè¿™æ ·çš„æ”¹è¿›ï¼š ä¸»æµ IDE çš„ Kotlin æ’ä»¶ï¼šIntelliJ IDEAï¼ŒAndroid Studioï¼ŒEclipse å’Œ NetBeans IntelliJ IDEA å’Œ Gradle ä¸­çš„å¢é‡ç¼–è¯‘ Springï¼ŒJPA å’Œ Mockito çš„ç¼–è¯‘å™¨æ’ä»¶ï¼ˆall-open ä¸ no-argï¼‰ æ³¨è§£å¤„ç†å™¨ kapt å¯¹ Android é¡¹ç›®çš„æ”¯æŒ Lint æ£€æŸ¥ å¤§é‡çš„ IDE ä»£ç é¢„æµ‹ï¼Œæ£€æŸ¥ï¼Œå¿«é€Ÿä¿®å¤ï¼Œé‡æ„å’Œè‡ªåŠ¨å®Œæˆæå‡ æˆ‘ä»¬å°†ç»§ç»­åœ¨ 1.1.x ç‰ˆæœ¬ä¸­è¿›è¡Œæ›´æ–°ï¼ŒåŠªåŠ›ä¸ºå¼€å‘è€…ä»¬æä¾›æ›´å¥½çš„å·¥å…·ã€‚ Kotlin å…ƒå¹´ï¼šè¿ç§»ä¸ç¤¾åŒºæ€»è€Œè¨€ä¹‹ï¼ŒKotlin æ­£åœ¨é€æ¸å£®å¤§ã€‚å»å¹´ï¼Œæˆ‘ä»¬çœ‹åˆ°æœ‰è¶…è¿‡ 160,000 äººä½¿ç”¨ï¼ŒGithub ä¸Šçš„ Kotlin å¼€æºé¡¹ç›®ä» 2.4M å¢åŠ åˆ° 10Mï¼ˆçº¦ 4 å€ï¼‰ã€‚æˆ‘ä»¬çš„ Slack ç¤¾åŒºå·²ç»ä» 1,400 äººå¢é•¿åˆ°è¶…è¿‡ 5,700 äººï¼ˆè¶…è¿‡ 4 å€ï¼‰ã€‚ä¸–ç•Œå„åœ°å‡æœ‰ç¤¾åŒºç»„ç»‡äº†ä¼—å¤šçš„çº¿ä¸‹äº¤æµä»¥åŠç”¨æˆ·ç¾¤ç»„ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ°è¶Šæ¥è¶Šå¤šçš„ Kotlin ä¹¦ç±å’Œåœ¨çº¿è¯¾ç¨‹å‘å¸ƒã€‚ Kotlin åœ¨æœåŠ¡å™¨ç«¯å’Œ Android ç«¯ï¼ˆå¼€å‘äººå‘˜æ•°é‡å‡ç­‰ï¼‰è¡¨ç°å¼‚å¸¸å¼ºå¤§ã€‚ Spring æ¡†æ¶ 5.0å’Œvert.x 3.4å‡å¼•å…¥äº†å¯¹ Kotlin çš„æ”¯æŒã€‚ Gradleå’ŒTeamCityæ­£åœ¨ä½¿ç”¨ Kotlin æ„å»ºè„šæœ¬ã€‚æ›´å¤šä½¿ç”¨ Kotlin çš„é¡¹ç›®å¯ä»¥åœ¨kotlin.linkæŸ¥çœ‹ã€‚ è®¸å¤šçŸ¥åå…¬å¸ä¹Ÿæ­£åœ¨ä½¿ç”¨ Kotlinï¼šPinterestï¼ŒCourseraï¼ŒNetflixï¼ŒUberï¼ŒSquareï¼ŒTrelloï¼ŒBasecampï¼›é™¤æ­¤ä¹‹å¤–ï¼Œ ç”±çŸ¥åé“¶è¡Œï¼ˆå¦‚é«˜ç››ï¼Œå¯Œå›½é“¶è¡Œï¼Œæ‘©æ ¹å¤§é€šï¼Œå¾·æ„å¿—é“¶è¡Œï¼Œç‘é“¶ï¼Œæ±‡ä¸°é“¶è¡Œï¼Œæ³•å›½å·´é»é“¶è¡Œï¼ŒSociÃ©tÃ©GÃ©nÃ©raleï¼‰è”ç›Ÿå¼€å‘çš„åˆ†é”€è´¦æˆ·åˆ†ç±»è´¦æˆ·Cordaï¼Œå…¶ä»£ç åº“ä¸­æœ‰è¶…è¿‡ 90ï¼…çš„éƒ¨åˆ†ä½¿ç”¨ Kotlinã€‚æˆ‘ä»¬æ„Ÿè°¢ä¸–ç•Œå„åœ°çš„æ‰€æœ‰ç”¨æˆ·ï¼Œè´¡çŒ®è€…å’Œå€¡å¯¼è€…ã€‚æ‚¨çš„æ”¯æŒå¯¹æˆ‘ä»¬éå¸¸é‡è¦ï¼ ç»„ç»‡æ‚¨è‡ªå·±çš„ Kotlin 1.1 æ´»åŠ¨Kotlin 1.1 çš„å‘å¸ƒæ˜¯ä¸å½“åœ°ç¤¾åŒºå¥½å‹çº¿ä¸‹èšä¼šçš„å¥½è¯é¢˜ã€‚æˆ‘ä»¬å·²ç»å‡†å¤‡äº†ä¸€äº›èµ„æ–™æ¥å¸®åŠ©å¼€å‘è€…ä»¬ä¸¾åŠæ­¤ç±»æ´»åŠ¨ã€‚3 æœˆ 23 æ—¥ï¼Œæˆ‘ä»¬å°†ä»¥ Kotlin å›¢é˜Ÿæˆå‘˜çš„å½¢å¼è¿›è¡Œç°åœºç›´æ’­ï¼Œå‘èµ·äººå‡å¯è·å¾—ä¸€ä¸ªèƒŒåŒ…ï¼Œé‡Œé¢æœ‰ä¸€ä»½å…³äºæœªæ¥ç‰¹æ€§çš„è°ƒæŸ¥é—®å·å’Œä¸€äº›å°ç¤¼ç‰©ï¼Œç‚¹å‡»æ³¨å†Œå³å¯å‚ä¸ã€‚ åç»­ä¸ºäº†ä½¿ Kotlin æˆä¸ºçœŸæ­£çš„å…¨æ ˆè¯­è¨€ï¼Œæˆ‘ä»¬å°†ä¸ºå¤šä¸ªå¹³å°ç¼–è¯‘ç›¸åŒçš„ä»£ç æä¾›å·¥å…·å’Œè¯­è¨€æ”¯æŒã€‚è¿™å°†æœ‰åŠ©äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œæ¨¡å—å…±äº«ã€‚æˆ‘ä»¬å°†ç»§ç»­è‡´åŠ›äºæ”¹è¿› JavaScript å·¥å…·å’Œåº“çš„æ”¯æŒã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJavaScript å¹³å°çš„å¢é‡ç¼–è¯‘æ­£åœ¨è¿›è¡Œä¸­ã€‚è¯·ç»§ç»­å…³æ³¨ 1.1.x æ›´æ–°ã€‚ Java 9 å³å°†æ¨å‡ºï¼Œæˆ‘ä»¬å°†åœ¨å‘å¸ƒä¹‹å‰ä¸ºå…¶æ–°åŠŸèƒ½æä¾›æ”¯æŒã€‚ æˆ‘ä»¬æœŸæœ›åœ¨æœªæ¥å‡ ä¸ªæœˆå†…èƒ½å¤Ÿæ”¶åˆ°è®¸å¤šå…³äºåç¨‹åé¦ˆæ„è§ï¼Œæ”¹è¿›è¿™ä¸€é¢†åŸŸï¼ˆåœ¨æ€§èƒ½å’ŒåŠŸèƒ½æ–¹é¢ï¼‰å¯¹äºæˆ‘ä»¬ä¼˜å…ˆçº§æœ€é«˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸‹ä¸€ç‰ˆæœ¬çš„ä¸»è¦å·¥ä½œå°†é›†ä¸­åœ¨ç»´æŠ¤ï¼Œæ€§èƒ½æ”¹è¿›ï¼ŒåŸºç¡€æ¶æ„å’Œé”™è¯¯ä¿®å¤æ–¹é¢ã€‚P.S è·¨å¹³å°è¿è¡Œæ˜¯ Kotlin çš„æˆ˜ç•¥æ–¹å‘ï¼Œä¼´éšç€ 1.1 çš„å‘å¸ƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ï¼Œå°å¼æœºï¼ŒAndroid è®¾å¤‡å’Œæµè§ˆå™¨ä¸Šè¿è¡Œï¼Œä½†æ˜¯æœªæ¥æˆ‘ä»¬å°†æŠŠ Kotlin ç¼–è¯‘ä¸ºæœ¬åœ°ä»£ç ï¼Œå¹¶ä½¿ä¹‹èƒ½å¤Ÿåœ¨æ›´å¤šå¹³å°ï¼ˆä¾‹å¦‚ iOS å’ŒåµŒå…¥å¼è®¾å¤‡ç­‰ï¼‰ä¸Šè¿è¡Œã€‚ ç›®å‰åœ¨ JetBrains å†…éƒ¨ï¼Œæœ‰ä¸€ä¸ªéå¸¸æ£’çš„å›¢é˜Ÿæ­£åœ¨å¼€å±•è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬æœŸå¾…å¾ˆå¿«å°±ä¼šå‡ºç°æœ‰è¶£çš„ä¸œè¥¿ï¼Œä¸è¿‡å°šæœªè®¡åˆ’ä¸ºæ­¤ä¸“é—¨å‘å¸ƒä»»ä½•ç‰ˆæœ¬ã€‚ å®‰è£…è¯´æ˜ä¸ä»¥å¾€ä¸€æ ·ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨Kotlin çº¿ä¸Šç¼–è¾‘å™¨ try.kotlinlang.orgã€‚ Maven/Gradleï¼šä½¿ç”¨1.1.0ä½œä¸ºç¼–è¯‘å™¨å’Œæ ‡å‡†åº“çš„ç‰ˆæœ¬å·(æŸ¥çœ‹æ–‡æ¡£)ã€‚ IntelliJ IDEAï¼š2017.1 å·²åŒ…å« Kotlin 1.1ï¼›æ—§ç‰ˆæœ¬åˆ™éœ€è¦å®‰è£… Kotlin æ’ä»¶æˆ–æ›´æ–°åˆ° 1.1 ç‰ˆæœ¬ã€‚ Android Studioï¼šé€šè¿‡Plugin Managerå®‰è£…æˆ–æ›´æ–°æ’ä»¶ã€‚ Eclipseï¼šä½¿ç”¨Marketplace å®‰è£…æ’ä»¶ã€‚ å‘½ä»¤è¡Œç¼–è¯‘å™¨å¯ä»¥ä»Github å‘å¸ƒé¡µé¢ä¸‹è½½ã€‚ å…¼å®¹æ€§ï¼šKotlin 1.1 è¯­è¨€å’Œæ ‡å‡†åº“å‘åå…¼å®¹(modulo bugs) ï¼šå¦‚æœä½¿ç”¨ 1.0 ç‰ˆæœ¬ç¼–è¯‘è¿è¡Œï¼Œ1.1 ç‰ˆæœ¬ä»ç„¶å¯ä»¥è¿è¡Œã€‚ä¸ºäº†å¸®åŠ©å¤§å‹å›¢é˜Ÿæœ‰è§„å¾‹çš„æ›´æ–°ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘å™¨ä¸­æ–°å¢ç¦ç”¨æ–°åŠŸèƒ½çš„å¼€å…³ã€‚æŸ¥çœ‹è¸©å‘æ–‡æ¡£ã€‚ è¯·å°½æƒ…äº«å— Kotlinï¼ P.S: åœ¨Redditå’ŒHacker Newsä¸ŠåŠ å…¥è®¨è®ºå§ï¼","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"[è¯‘]Kotlin 1.1 å€™é€‰ç‰ˆæœ¬æ¥å•¦","date":"2017-02-17T05:37:00.000Z","path":"2017/02/17/Kotlin 1.1 Release Candidate is Here.html","text":"æˆªè‡³ä»Šå¤©ï¼ŒKotlin 1.1 ç»ˆäºåˆ°äº†å€™é€‰ç‰ˆæœ¬ï¼ˆRCï¼‰é˜¶æ®µã€‚è¿™æ„å‘³ç€å¤§éƒ¨åˆ†å¼€å‘å·¥ä½œéƒ½å·²ç»å®Œæˆï¼Œæˆ‘ä»¬å¯¹æ­¤ç»“æœæ„Ÿåˆ°æ»¡æ„ï¼Œå¾ˆå¿«å°±ä¼šå‘å¸ƒ Kotlin 1.1 æ­£å¼ç‰ˆã€‚æˆ‘ä»¬å·²ç»åœ¨å†…éƒ¨å¯¹æ­¤ç‰ˆæœ¬è¿›è¡Œäº†å¤§é‡æµ‹è¯•ï¼Œä½†ç°å®ä¸–ç•Œæ€»æ˜¯æ¯”ä»»ä½•æµ‹è¯•ç¯å¢ƒæ›´åŠ å¤šæ ·åŒ–ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‚¨çš„å¸®åŠ©ã€‚è¯·å°è¯•è¿™ä¸ªç‰ˆæœ¬ï¼Œè®©æˆ‘ä»¬çŸ¥é“æ‚¨çš„ä½“éªŒï¼ å€™é€‰ç‰ˆæœ¬ä¸­å”¯ä¸€çš„æ–°åŠŸèƒ½æ˜¯ takeUnless å‡½æ•°ï¼Œå®ƒå¯¹åº” 1.1 ä¹‹å‰æ·»åŠ çš„ takeIfï¼Œä½†åˆ¤æ–­æ¡ä»¶ç›¸åã€‚è‡³äºé”™è¯¯ä¿®å¤åˆ™æœ‰å¾ˆå¤šï¼Œå®Œæ•´æ¸…å•è¯·æŸ¥çœ‹æ›´æ–°æ—¥å¿—ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä¿®å¤äº†å‡ ä¸ª IDE ä¸­çš„æ€§èƒ½é—®é¢˜ï¼ŒåŒ…æ‹¬é•¿æœŸå­˜åœ¨å’Œæœ€è¿‘å›å½’æ‰å‡ºç°çš„ã€‚ è¿ç§»è¯´æ˜å°±åƒæˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œé¢„å‘å¸ƒç‰ˆæœ¬ç”Ÿæˆçš„æ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶ä¸èƒ½åœ¨å½“å‰çš„ç¼–è¯‘å™¨ä¸‹ä½¿ç”¨ï¼šæ‚¨ç°åœ¨éœ€è¦é‡æ–°ç¼–è¯‘ç”± 1.1-M0x å’Œ Beta ç¼–è¯‘çš„æ‰€æœ‰å†…å®¹ã€‚å½“ç„¶ï¼Œä» 1.0.x å¼€å§‹çš„æ‰€æœ‰ä»£ç éƒ½ä¸éœ€è¦é‡æ–°ç¼–è¯‘ã€‚ åœ¨è¿™ä¹‹å‰ï¼Œæ‚¨å¯ä»¥ä» Java 6 å¼€å§‹ï¼Œä»¥ä»»ä½•ç‰ˆæœ¬çš„ Java è¿è¡Œ Kotlin ç¼–è¯‘å™¨ï¼Œä½†è¿™ä»ç¬¬ä¸€ä¸ª 1.1.x æ›´æ–°å¼€å§‹æœ‰å˜åŒ–ï¼Œç¼–è¯‘å™¨å°†ä»…åœ¨ Java 8 æˆ– 9 ä¸‹è¿è¡Œã€‚ä¸ºæ‚¨å‡†å¤‡è¿ç§»ï¼Œç¼–è¯‘å™¨ç°åœ¨ä¼šåœ¨ Java 6 æˆ– 7 ä¸‹è¿è¡Œæ—¶å‘å‡ºè­¦å‘Šã€‚è¯·æ³¨æ„ï¼Œè¿™ä»…å½±å“æ„å»ºç¯å¢ƒï¼›ç¼–è¯‘ä»£ç é»˜è®¤æƒ…å†µä¸‹ä»ç„¶ä¸ Java 6 å…¼å®¹ï¼Œæˆ‘ä»¬æ²¡æœ‰è®¡åˆ’åˆ é™¤å¯¹å®ƒçš„æ”¯æŒã€‚ ç°åœ¨ä¸æ¨èä½¿ç”¨ .javaClass æ‰©å±•å±æ€§ã€‚ä½œä¸ºæ›¿ä»£ï¼Œè¯·ä½¿ç”¨ ::class.javaã€‚IDE æä¾›äº†ä¸€ä¸ª quickfix æ¥æ›´æ–°å†™æ³•ï¼Œå•ç‹¬çš„ä¿®æ”¹æˆ–è€…æ›´æ–°æ•´ä¸ªé¡¹ç›®ã€‚ ä¸ºäº†å‡å° JavaScript æ ‡å‡†åº“çš„å¤§å°ï¼Œæˆ‘ä»¬å·²ç»å°† kotlin.dom å’Œ kotlin.dom.build åŒ…ä¸­çš„å¤§é‡è¾…åŠ©å‡½æ•°æ³¨è§£ä¸ºä¸æ¨èä½¿ç”¨äº†ï¼Œç„¶ååœ¨å°†æ¥çš„æ›´æ–°ä¸­åˆ é™¤å®ƒä»¬ã€‚ å¦‚ä½•å°é²œåœ¨ Maven/Gradle ä¸­ï¼š å°† http://dl.bintray.com/kotlin/kotlin-eap-1.1 æ·»åŠ ä¸ºæ„å»ºè„šæœ¬å’Œé¡¹ç›®çš„ä»“åº“ï¼›ä½¿ç”¨ 1.1.0-rc-91 ä½œä¸ºç¼–è¯‘å™¨å’Œæ ‡å‡†åº“çš„ç‰ˆæœ¬å·ã€‚ åœ¨ IntelliJ IDEA ä¸­ï¼š ç‚¹å‡»èœå• Tools â†’ Kotlin â†’ Configure Kotlin Plugin Updatesï¼Œç„¶ååœ¨ Update channel çš„ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹© â€œEarly Access Preview 1.1â€ï¼Œæ¥ç€ç‚¹å‡» Check for updatesã€‚ åœ¨ Eclipse ä¸­ï¼š ä»ä»¥ä¸‹æ›´æ–°ç«™ç‚¹å®‰è£…æ’ä»¶https://dl.bintray.com/jetbrains/kotlin/eclipse-plugin/0.8.0 The command-line compiler å¯ä»¥ä» Github å‘å¸ƒé¡µé¢ä¸‹è½½ã€‚æœ€åï¼Œè®©æˆ‘ä»¬å¼€å¯ Kotlin ä¹‹æ—…å§ï¼try.kotlinlang.orgã€‚","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"Kotlin 1.1 Beta 2 å‘å¸ƒ~","date":"2017-02-06T00:14:15.000Z","path":"2017/02/06/Kotlin 1.1 Beta 2 å‘å¸ƒ~.html","text":"1 åç¨‹æ”¹åŒ…åé£æ³¢è¯´çœŸçš„ï¼Œçœ‹åˆ°è¿™ä¸ªæ ‡é¢˜çš„æ—¶å€™æˆ‘è¿˜æŒºå…´å¥‹ï¼Œç¦» release åˆè¿‘äº†ä¸€æ­¥ã€‚ä¸è¿‡ï¼Œçœ‹äº†è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘å°±è§‰å¾—ä¹Ÿæ˜¯é†‰é†‰çš„ã€‚å‘ç”Ÿäº†å•¥å‘¢ï¼Ÿ åŸæ¥ï¼Œåç¨‹ç›¸å…³çš„ä¾èµ–ç»Ÿç»Ÿè¢«æ ‡è®°ä¸º experimental äº†ï¼Œä»¥å‰å«ï¼š 1package kotlin.coroutines ç°åœ¨å‘¢ï¼Ÿ 1package kotlin.coroutines.experimental è¿™æ„å‘³ç€å•¥ï¼Ÿæ„å‘³ç€æˆ‘ä»¬åœ¨è¿™æ¬¡æ›´æ–°ä¹‹åï¼Œè¿˜å¾—æŠŠåŸæ¥çš„åç¨‹ä»£ç çš„åŒ…é‡æ–°å¯¼å…¥ä¸€éï¼Œå¦å¤–ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨åç¨‹ï¼Œé‚£ä¹ˆä½ è¿˜éœ€è¦åœ¨é…ç½®å½“ä¸­å‘¢å¯ç”¨å®ƒï¼Œä¾‹å¦‚ gradle é…ç½®éœ€è¦åŠ å…¥ï¼š 12345kotlin &#123; experimental &#123; coroutines 'enable' &#125;&#125; ä½ åœ¨å‡çº§æ‰€æœ‰çš„ä¾èµ–çš„æ—¶å€™ï¼Œç¡®ä¿å®ƒæ˜¯å…¼å®¹ 1.1.0-beta-38 çš„ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œä¸ç„¶ç­‰ç€æŠ¥é”™å§ï¼ è¯è¯´ï¼Œä¸ºå•¥è¦è¿™ä¹ˆæå‘¢ï¼ŸæŒ‰ç…§å®˜æ–¹çš„è¯´æ³•å°±æ˜¯ï¼Œåç¨‹è¿™ä¸ªç‰¹æ€§ç›®å‰å·²ç»å®ç°çš„éå¸¸ä¸é”™äº†ï¼Œå†…ç½® API éå¸¸å°‘ï¼Œçµæ´»æ‰©å±•æ€§ä¹Ÿå¼ºï¼Œä¸è¿‡ä»–ä»¬è§‰å¾—è¿™ä¸ªä¸œè¥¿è¿˜æœ‰å¾ˆå¤§çš„æ½œåŠ›ï¼Œä¹Ÿä¸èƒ½å°±è¿™æ ·ä½œä¸ºæœ€ç»ˆç‰ˆæœ¬ç»™å¤§å®¶æ”¾å‡ºæ¥ï¼Œè€Œä½œä¸ºå®éªŒç‰¹æ€§äº¤ç»™å¤§å®¶ä½¿ç”¨å‘¢ï¼Œæ›´å¤šåœ°è¿˜æ˜¯å¸Œæœ›å¤§å®¶èƒ½æææ„è§å•¥çš„ã€‚å—¯ï¼Œè¯´å®åœ¨çš„ï¼Œåç¨‹è¿™ä¸ªç‰¹æ€§çœŸä¸æ˜¯ä¸ªå°ç‰¹æ€§ã€‚ 2 å…¼å®¹ 1.0è¯è¯´ï¼Œ1.1 çš„ç¼–è¯‘å™¨ç»ˆäºå£°ç§°å…¼å®¹ 1.0 çš„æºç äº†ï¼Œè¿™è¡¨æ˜æˆ‘ä»¬å†ä¹Ÿä¸ç”¨æä¸¤ä¸ª IntelliJ åˆ†åˆ«è£… 1.0 ç¨³å®šç‰ˆçš„æ’ä»¶å’Œ 1.1 Beta ç‰ˆçš„æ’ä»¶äº†ã€‚ æ˜¯çš„ï¼Œå°±ç®—ä½ ä¸ç”¨ 1.1 çš„ç‰¹æ€§ï¼Œä½ è£… 1.1 çš„æ’ä»¶ï¼Œç”¨ 1.1 çš„ç¼–è¯‘å™¨ï¼Œå†™ 1.0 çš„ä»£ç æ¯«æ— å‹åŠ›ï¼ï¼ ä»€ä¹ˆï¼Ÿä½ é—®æˆ‘è¯•äº†æ²¡ï¼Ÿå½“ç„¶ï¼Œæˆ‘ä¸€ç›´ç”¨æœ€æ–°çš„æ’ä»¶ï¼ŒæŠ˜è…¾åœ°æŒºè‹¦çš„ T Tï¼ŒåŠè¯¸å›è¿˜æ˜¯è£…ç¨³å®šç‰ˆå§ï¼ŒåƒèƒèŸ¹è¦åšå¥½å¿ƒç†å‡†å¤‡~ï¼ 3 å°ç»“æµè§ˆäº†ä¸€ä¸‹ 1.1Beta 2 çš„ä¸»è¦ç‰¹æ€§ï¼Œå…¶å®å°±æ˜¯æ”¹æ”¹åŒ…åï¼Œä¿®å‡ ä¸ªå° Bugï¼Œå¤§çš„æ”¹åŠ¨åŸºæœ¬æ²¡æœ‰äº†ã€‚å¦‚æœå¤§å®¶æƒ³è¦å°½æ—©ä¸Šæ‰‹ 1.1 çš„ç‰¹æ€§ï¼Œé‚£ä¹ˆå°±ä»ç°åœ¨å¼€å§‹å§~","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"Kotlin 1.0.6","date":"2017-01-02T08:22:57.000Z","path":"2017/01/02/Kotlin 1.0.6.html","text":"æˆ‘æŠŠæ‰€æœ‰æ–‡ç« å’Œè§†é¢‘éƒ½æ”¾åˆ°äº† Github ä¸Š ï¼Œå¦‚æœä½ å–œæ¬¢ï¼Œè¯·ç»™ä¸ª Starï¼Œè°¢è°¢~ åœ¨ä¸Šå‘¨äºŒï¼ŒKotlin 1.0.6 å‘å¸ƒå•¦ï¼è¿™æ¬¡æ›´æ–°ä¸»è¦æ˜¯å·¥å…·æ›´æ–°å’Œbugä¿®å¤ã€‚æœ¬æ–‡çš„å†…å®¹ä¸»è¦æ¥è‡ªå®˜æ–¹åšå®¢ã€‚ IDE æ’ä»¶çš„æ›´æ–° try-finally è½¬æ¢ä¸º use() é€šå¸¸æˆ‘ä»¬åœ¨è¿›è¡Œ IO æ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›å¼‚å¸¸å½±å“æˆ‘ä»¬ç¨‹åºçš„æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹å¼‚å¸¸è¿›è¡Œæ•è·ï¼Œä½†æ•è·çš„è¯æˆ‘ä»¬ä¹Ÿæ²¡æœ‰å¿…è¦å¤„ç†ï¼Œæ‰€ä»¥å†™ä¸‹æ¥çš„å°±æ˜¯ä¸‹é¢çš„å½¢å¼ï¼š 12345try&#123; ... do something with \"reader\" ...&#125;finally&#123; reader.close()&#125; ä½†è¿™æ ·å†™èµ·æ¥æ˜¯ä¸æ˜¯éå¸¸çš„ä¸æµç•…ï¼Ÿå¦‚æœç”¨ use() çš„è¯ï¼Œç®€ç›´ä¸€æ°”å‘µæˆï¼š 123reader.use&#123; reader -&gt; ... do something with \"reader\" ...&#125; æ‰€ä»¥ï¼Œè¿™æ¬¡æ›´æ–° Kotlin çš„æ’ä»¶ä¸ºæˆ‘ä»¬å¸¦æ¥äº†è¿™æ ·çš„è‡ªåŠ¨è½¬æ¢åŠŸèƒ½ï¼š è¡¥å…¨å…·åå‚æ•° é€šå¸¸æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œå‡½æ•°å…¥å‚éƒ½ä¼šæŒ‰ç…§é¡ºåºä¸€ä¸ªä¸€ä¸ªä¼ å…¥ï¼Œä¸è¿‡éšç€ä»£ç é‡çš„å¢åŠ ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå‚æ•°è¾ƒå¤šçš„å‡½æ•°ï¼Œä¸€é•¿ä¸²çš„ä»£ç çœ‹ä¸Šå»ä¼šè®©æˆ‘ä»¬æ„Ÿåˆ°éå¸¸çš„å¤´ç–¼ã€‚æ‰€ä»¥ï¼Œè¿™æ¬¡æ›´æ–° Kotlin è¿˜ä¸ºæˆ‘ä»¬å¸¦æ¥äº†è‡ªåŠ¨è¡¥å…¨å…·åå‚æ•°çš„åŠŸèƒ½ã€‚ åˆ é™¤ç©ºæ„é€ æ–¹æ³•çš„å£°æ˜ åˆå¹¶å£°æ˜å’Œèµ‹å€¼ inline å‡½æ•°çš„é—®é¢˜ä¿®å¤å’Œè°ƒè¯•å·¥å…·çš„ä¼˜åŒ– æç¤ºã€KDoc å’Œ Quick Doc ç›¸å…³çš„è¾ƒå¤šé—®é¢˜çš„ä¿®å¤ Android ç›¸å…³æ›´æ–° æ”¯æŒ Android Studio 2.3 beta 1 å’Œ Android Gradle Plugin 2.3.0-alpha3åŠæ›´æ–°çš„ç‰ˆæœ¬ å¢åŠ  â€œCreate XML resourceâ€ çš„æç¤º Android Extensions support è¿™ä¸ªåŠŸèƒ½å¯ä»¥è®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„å¼•ç”¨ XML å¸ƒå±€çš„ Viewï¼Œä¸è¿‡è¿™éœ€è¦æˆ‘ä»¬ä¸»åŠ¨å¯ç”¨ â€˜kotlin-android-extensionsâ€™ æ‰è¡Œã€‚åœ¨è¿‡å»ï¼Œå³ä½¿ä¸å¯ç”¨è¿™ä¸ªæ’ä»¶ï¼ŒIDE ä¹Ÿä¼šå…è®¸æˆ‘ä»¬ç›´æ¥å¼•ç”¨ XML å¸ƒå±€çš„ Viewï¼Œä½†è¿™å¹¶ä¸èƒ½æ­£å¸¸ç¼–è¯‘ï¼Œæ‰€ä»¥è¿™æ¬¡æ›´æ–°ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ï¼šåªæœ‰å¯ç”¨äº†è¿™ä¸ªæ’ä»¶ï¼ŒIDE æ‰ä¼šå…è®¸æˆ‘ä»¬å¼•ç”¨å¯¹åº”çš„ Viewã€‚ Android Lint ç›¸å…³çš„é—®é¢˜ä¿®å¤ã€‚ å¢åŠ  Suppress Lint æç¤ºã€‚ Kapt ä¼˜åŒ–å°½ç®¡è¿˜ä¸èƒ½å®Œå…¨æ”¯æŒå¢é‡ç¼–è¯‘ï¼Œç›¸æ¯” 1.0.4ï¼Œè¿™æ¬¡æ›´æ–°è¾ƒå¤§çš„æå‡äº† Kapt çš„æ€§èƒ½ã€‚å¦‚æœéœ€è¦å¯ç”¨ Kaptï¼Œè¯·åœ¨ gradle å½“ä¸­å¯åŠ¨å®ƒï¼šplugin: 'kotlin-kapt'```123456789101112131415161718192021222324252627282930313233## All-open æ’ä»¶æˆ‘ä»¬çŸ¥é“ Kotlin çš„æ‰€æœ‰ç±»åŠå…¶æˆå‘˜é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯ final çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ æƒ³è¦ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œå°±è¦ä¸æ–­å¾—å†™å„ç§ openã€‚åˆšå¼€å§‹çœ‹åˆ°è¿™ä¸€ç‰¹æ€§çš„æ—¶å€™ï¼Œè§‰å¾—å¾ˆèµï¼Œå®ƒå¯¹åŸ¹å…»è‰¯å¥½çš„ç¼–ç æ„è¯†éå¸¸æœ‰å¸®åŠ©ï¼Œä¸è¿‡å®ƒä¹Ÿåœ¨æŸäº›æƒ…å†µä¸‹ç»™æˆ‘ä»¬å¸¦æ¥éº»çƒ¦ï¼Œæ¯”å¦‚åœ¨ä¸€äº›å¤§é‡ä¾èµ–ç»§æ‰¿å’Œè¦†å†™çš„ Java æ¡†æ¶çš„ä½¿ç”¨ä¸­ã€‚è¿™ä¸€æ¬¡ Kotlin æä¾›äº†ä¸€ä¸ªå¦¥åçš„åŠæ³•ï¼Œä¸»è¦æŸä¸ªç±»è¢«æŸä¸€ä¸ªç‰¹å®šæ³¨è§£æ ‡æ³¨ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±é»˜è®¤æ‰€æœ‰æˆå‘˜é€šé€š openï¼Œçœå¾—ä¸€ä¸ªä¸€ä¸ªå†™äº†ã€‚æœ‰å…³ allopen çš„è®¨è®ºï¼Œå¤§å®¶å¯ä»¥å‚è€ƒè¿™é‡Œ [KEEP](https://github.com/Kotlin/KEEP/pull/40)ã€‚é‚£ä¹ˆ allopen å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ```groovybuildscript &#123; dependencies &#123; classpath &quot;org.jetbrains.kotlin:kotlin-allopen:$kotlin_version&quot; &#125;&#125;apply plugin: &quot;kotlin-allopen&quot;allOpen &#123; annotation(&quot;com.your.Annotation&quot;)&#125;buildscript &#123; dependencies &#123; classpath &quot;org.jetbrains.kotlin:kotlin-allopen:$kotlin_version&quot; &#125;&#125;apply plugin: &quot;kotlin-allopen&quot;allOpen &#123; annotation(&quot;com.your.Annotation&quot;)&#125; é‚£ä¹ˆæ‰€æœ‰è¢« com.your.Annotation è¿™ä¸ªæ³¨è§£æ ‡æ³¨çš„ç±»æˆå‘˜éƒ½ä¼šé»˜è®¤ openã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜å¯ä»¥ä½œä¸ºå…ƒæ³¨è§£ä½¿ç”¨ï¼š 12345@com.your.Annotationannotation class MyFrameworkAnnotation@MyFrameworkAnnotationclass MyClass // will be all-open Kotlin è¿˜æä¾›äº† â€œkotlin-springâ€ æ’ä»¶ï¼Œå…¶ä¸­åŒ…å«äº† spring ç›¸å…³çš„æ‰€æœ‰æ³¨è§£ï¼Œè¿™æ ·å…å¾—æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªåœ¨ allopen çš„é…ç½®ä¸­å£°æ˜äº†ã€‚ No-arg æ’ä»¶å¦‚æœå¤§å®¶çœ‹è¿‡æˆ‘çš„è§†é¢‘ï¼Œä¸€å®šå¯¹æˆ‘ä¹‹å‰æåˆ°çš„â€œæ¯ä¸‰è§‚â€çš„å®ä¾‹åŒ–æœ‰å°è±¡å§ï¼Œé™„ä¸Šè§†é¢‘è¿æ¥ï¼š12 Jsonæ•°æ®å¼•å‘çš„è¡€æ¡ˆï¼Œå…¶ä¸­æˆ‘ä»¬æåˆ°å¯¹äºæ²¡æœ‰æ— å‚æ„é€ æ–¹æ³•çš„ Kotlin ç±»ï¼ŒGson ååºåˆ—åŒ–å®ƒä»¬çš„æ—¶å€™ï¼Œä¸çŸ¥é“å¦‚ä½•å®ä¾‹åŒ–å®ƒä»¬ï¼Œåªå¥½ç”¨åˆ°äº† è¿™ä¸ªç±»ã€‚å¬è¯´ Java 9 è¦ç§»é™¤è¿™ä¸ªç•¥æ˜¾é»‘ç§‘æŠ€çš„ç±»ï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼ŒGson æ˜¯ä¸æ˜¯ä¼šè¢«å‰Šå¼±å‘¢ï¼ŸJava çš„å¿ƒæˆ‘ä»¬è¿˜æ˜¯ä¸æ“äº†ï¼Œä» Kotlin 1.0.6 å¼€å§‹ï¼Œè¿™ä¸ªé—®é¢˜å°†å¾—åˆ°ä¸€ä¸ªæ¯”è¾ƒå¥½çš„è§£å†³ã€‚1234567891011121314```groovybuildscript &#123; dependencies &#123; classpath &quot;org.jetbrains.kotlin:kotlin-noarg:$kotlin_version&quot; &#125;&#125;// Or &quot;kotlin-jpa&quot; for the Java Persistence API supportapply plugin: &quot;kotlin-noarg&quot;noArg &#123; annotation(&quot;com.your.Annotation&quot;)&#125; ç±»ä¼¼äº allopen çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¦‚æœæŸä¸ªç±»éœ€è¦æ— å‚é»˜è®¤æ„é€ æ–¹æ³•ï¼Œä½ åªéœ€è¦ç”¨ä¸Šé¢å£°æ˜å¥½çš„æ³¨è§£ com.your.Annotation æ ‡æ³¨å³å¯ã€‚å½“ç„¶ï¼Œè¿™ä¸ªç”Ÿæˆçš„é»˜è®¤æ„é€ æ–¹æ³•åªèƒ½é€šè¿‡åå°„è°ƒç”¨ã€‚ å¦‚ä½•æ›´æ–°æˆ‘ä¸€ç›´è§‰å¾—è™½ç„¶æˆ‘ä»¬å‡ºç”Ÿå°±è¢«é€‰æ‹©äº† Hard æ¨¡å¼ï¼Œä½†æˆ‘ä»¬æ²¡å•¥æ„Ÿè§‰å•Šã€‚å¯æ˜¯æœ€è¿‘ä¸€ç›´è®¿é—®å›½å¤–çš„ç½‘ç«™ï¼Œæ„Ÿè§‰çœŸçš„å¥½å›°éš¾ï¼Œå®½å¸¦æ¢æˆäº†ç”µä¿¡ 100Mï¼Œä¸‹è½½ Kotlin çš„æ’ä»¶ä»ç„¶è·Ÿå°æ°´ç®¡ä¸€æ ·ï¼ŒçœŸä¹Ÿæ˜¯æ²¡è°äº†ã€‚ä¸ºäº†æ–¹ä¾¿å¤§å®¶æˆ‘æŠŠæˆ‘ä¸‹è½½çš„å‡ ä¸ªç‰ˆæœ¬çš„æ’ä»¶æ”¾åˆ°ç™¾åº¦ç½‘ç›˜ï¼Œä¾›å¤§å®¶ä½¿ç”¨ï¼Œè¯·å¤§å®¶ç‚¹å‡»é˜…è¯»åŸæ–‡è·å–ä¸‹è½½åœ°å€ã€‚ å°ç»“ç›®å‰ Kotlin 1.0.x çš„ç‰ˆæœ¬æ›´æ–°æ›´ä¾§é‡äºç¨³å®šæ€§å’Œæ˜“ç”¨æ€§ï¼Œå› æ­¤è¯­è¨€ä¸Šçš„ç‰¹æ€§åŸºæœ¬ä¸ä¼šæ›´æ–°ï¼Œä¸»è¦é›†ä¸­äº IDE æ’ä»¶å’Œç¼–è¯‘å™¨æ’ä»¶ã€‚å¦‚æœå¤§å®¶æœŸå¾…è¯­è¨€ç‰¹æ€§çš„æ›´æ–°ï¼Œé‚£æˆ‘ä»¬å°±å»å…³æ³¨ä¸€ä¸‹ 1.1 å§ï¼","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]},{"title":"[è¯‘]Kotlin 1.0 Beta 3 å‘å¸ƒå•¦!","date":"2015-12-07T07:45:00.000Z","path":"2015/12/07/Kotlin 1.0 Beta 3 is Out!.html","text":"æˆ‘ä»¬å¾ˆé«˜å…´å‘å¸ƒäº† Kotlin 1.0 Beta çš„å¦ä¸€ä¸ªæ›´æ–°ã€‚æˆ‘ä»¬æ­£åœ¨åŠªåŠ›å®Œå–„æ ‡å‡†åº“ï¼ŒæŠ›å¼ƒäº†è¿‡æ—¶å·²ä¹…çš„è®¾è®¡ç»“æ„ï¼ŒåŒæ—¶ä¿®å¤äº† bugsï¼Œæ”¹è¿›æ€§èƒ½å’Œä¸ºä¸‹ä¸€ä¸ªç‰ˆæœ¬ä½œå‡†å¤‡ã€‚å®Œæ•´çš„æ›´æ–°å†å²åœ¨ è¿™é‡Œ ã€‚ æœ€æ–°çš„ issue åœ¨ è¿™é‡Œ ã€‚ Library å˜æ›´æˆ‘ä»¬åŠªåŠ›åœ¨ 1.0 ç‰ˆæœ¬åˆ°æ¥ä¹‹å‰è®©æ ‡å‡†åº“å˜å¾—æ›´åŠ å®Œç¾ã€‚è¿™æ„å‘³ç€è¿›è¡Œä¸€äº›å°è¯•ï¼Œæ‰€ä»¥ä¼šæœ‰æ–°çš„éƒ¨åˆ†è¢«å¼ƒç”¨ï¼Œæœ‰æ–°çš„å‡½æ•°è¢«æ·»åŠ ã€‚æˆ‘ä»¬è®¡åˆ’åœ¨ 1.0 ç‰ˆæœ¬ï¼ˆæˆ– RCï¼‰ä¸­å¯¹æ ‡å‡†åº“è¿›è¡Œä¸€æ¬¡æœ€åçš„æ¸…ç†ï¼šåˆ é™¤æ‰€æœ‰å·²è¿‡æ—¶å’Œå…¶ä»–é—ç•™çš„ä¸œè¥¿ã€‚è¿™é‡Œæˆ‘ä»¬åªå…³å¿ƒä¸€ä¸ªéœ€è¦æ³¨æ„çš„å˜åŒ–ï¼šç°åœ¨contains()å’Œå…¶ä»–ç±»ä¼¼çš„æ‰©å±•æ–¹æ³•æ¥å—é›†åˆå…ƒç´ çš„çˆ¶ç±»å‹ã€‚ 1234567// strs: Collection&lt;String&gt;// ns: String?// cs: CharSequence// i: Intstrs.contains(ns) // accepted nowstrs.contains(cs) // accepted nowstr.contains(i) // ERROR (in fact, a deprecation warning, but will be an error soon) æˆ‘ä»¬å‘ç°ä»¥å‰å»ºè®®çš„containsRawæ–¹æ³•æ¯”è¾ƒä½æ•ˆï¼Œä½¿ç”¨contains()æ›´åŠ åˆé€‚ï¼ŒåŒæ—¶ä¿è¯äº†å…¼å®¹æ€§ã€‚è¯·æ³¨æ„ï¼Œé›†åˆæ¥å£æœ¬èº«æ˜¯å®Œæ•´çš„ï¼Œæ‰€æœ‰è¿™äº›éƒ½æ˜¯é€šè¿‡æ‰©å±•åŠŸèƒ½å®Œæˆçš„ã€‚è¯·ä½¿ç”¨Code Cleanupæ¥è¿ç§»ä»£ç ã€‚ è¯­è¨€å˜åŒ–ä¸€äº›éœ€è¦æ³¨æ„çš„è¯­è¨€å˜åŒ–ï¼Œå®Œæ•´åˆ—è¡¨åœ¨è¿™é‡Œ ã€‚ è®¸å¤šæˆ‘ä»¬ä»¥å‰ä¸æ¨èçš„å®ç°ç°åœ¨ä¼šæŠ¥é”™ã€‚è¯·ä½¿ç”¨Code Cleanupè¿›è¡Œè¿ç§»ã€‚ When è¡¨è¾¾å¼è¿™ç§ä»£ç å·²è¢«è¯æ˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šå¼ƒç”¨å®ƒï¼š 1234when &#123; foo.isValid(), foo.isReady() -&gt; process(foo) ...&#125; è®¸å¤šäººå€¾å‘äºè®¤ä¸ºæ¡ä»¶ foo.isValid(), foo.isReady() è¡¨ç¤º foo.isValid() == true and foo.isReady() == trueï¼Œè€Œå®é™…ä¸Šé€—å·æ˜¯æŒ‡ orã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼šåªéœ€ä½¿ç”¨ ||: 1234when &#123; foo.isValid() || foo.isReady() -&gt; process(foo) ...&#125; Code Cleanupä¼šè‡ªåŠ¨è¿ç§»ã€‚ æ³¨é‡Šä¸€ä¸ª bug å·²è¢«ä¿®å¤ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨æ³¨è§£çš„å‚æ•°ä¸­ä½¿ç”¨é»˜è®¤å€¼ï¼š 12345annotation class Entry(val value: String) annotation class Example( val entries: Array&lt;Entry&gt; = arrayOf(Entry(\"a\"), Entry(\"b\")) // OK now) æšä¸¾å€¼()æœ€è¿‘æˆ‘ä»¬å°†ä¼ ç»Ÿçš„ Java çš„Enum.values()æ›´æ”¹ä¸ºä¸€ä¸ªå±æ€§ï¼šEnum.valuesï¼Œä½†ç°åœ¨æˆ‘ä»¬å°†å›æ»šè¿™ä¸ªæ›´æ”¹ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªæ²¡æœ‰æ³¨æ„åˆ°çš„è§’è½ï¼šæšä¸¾ä¸­çš„å¸¸é‡å¯èƒ½è¢«å‘½åä¸ºvaluesï¼Œç„¶åä¾¿æ²¡æœ‰åŠæ³•è®¿é—®å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚æˆ‘ä»¬è€ƒè™‘äº†ä¸åŒçš„æ–¹æ¡ˆï¼Œæœ€åå†³å®šå°†valuesæ”¹å›å‡½æ•°æ˜¯æœ€å¹²å‡€çš„ã€‚æ‰€ä»¥ï¼Œç°åœ¨ä¸æ¨èä½¿ç”¨valueså±æ€§ï¼Œä¹Ÿä¸æ¨èä½¿ç”¨values()å‡½æ•°ã€‚ å¯è§æ€§å’Œä½œç”¨åŸŸæˆ‘ä»¬æ­£åœ¨æ¸…ç†å’Œä¿®æ­£å°é—®é¢˜çš„å¯è§æ€§å’Œä½œç”¨åŸŸ companion objects ä¸­å…è®¸ protected æˆå‘˜ å­ç±»è°ƒç”¨é @JvmStatic çš„ protected å¯¹è±¡å°†è¢«æ ‡è®°ä¸ºé”™è¯¯ï¼ˆä¸æ”¯æŒï¼‰ å¯¹äº open å±æ€§ï¼Œç§æœ‰ setters ç°åœ¨å·²è¢«æ ‡è®°ä¸ºè¿‡æ—¶ local sealed class å·²å¼ƒç”¨ï¼ˆä»ä¸å¯ç”¨ï¼‰ é‡å†™çš„ setter ä¸èƒ½é™ä½å¯è§æ€§ æšä¸¾ç±»ä¸­ä¸å†å…è®¸å­˜åœ¨å†…éƒ¨ç±» lambdas / object literals / local å‡½æ•°ä¸­ç¦æ­¢ä½¿ç”¨æœªåˆå§‹åŒ–çš„å˜é‡ Android æ‰©å±•æˆ‘ä»¬åˆå¹¶äº† IntelliJ IDEA çš„ä¸»è¦ Kotlin æ’ä»¶å’Œ Android çš„Kotlinæ‰©å±•æ’ä»¶ã€‚åè€…ç°åœ¨å·²ç»è¿‡æ—¶äº†ï¼Œå› ä¸ºå®ƒçš„åŠŸèƒ½å¯ä»¥ä» Kotlin æ’ä»¶è·å–ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æ·»åŠ äº†å¯¹ Android productFlavorsçš„æ”¯æŒï¼šç°åœ¨ï¼Œæ¥è‡ªä¸åŒ flavors çš„å±æ€§å¯ä»¥åœ¨ä¸åŒçš„åŒ…ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨build.gradleæ–‡ä»¶ä¸­å­˜åœ¨ä¸¤ç§ flavorsï¼š 12345678productFlavors &#123; free &#123; versionName \"1.0-free\" &#125; pro &#123; versionName \"1.0-pro\" &#125;&#125; ç°åœ¨ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥åœ¨main source setä¸­çš„å¸ƒå±€ä½¿ç”¨åˆæˆå±æ€§ï¼Œè¿˜å¯ä»¥åœ¨ flavor å¸ƒå±€ä½¿ç”¨åˆæˆå±æ€§ï¼š 1234567891011121314// Import synthetic properties for the `activity_free.xml` layout in the `free` flavorimport kotlinx.android.synthetic.free.activity_free.versionMarker class FreeActivity : AppCompatActivity() &#123; override fun onCreate(savedInstanceState: Bundle?) &#123; ... setContentView(R.layout.activity_free) ... versionMarker.text = \"Free version\" &#125;&#125; è¯·æ³¨æ„ï¼Œmain source setçš„æ‰€æœ‰å¸ƒå±€ç°åœ¨ä½äºkotlinx.android.synthetic.mainåŒ…ä¹‹ä¸‹ï¼Œæ—§çš„åŒ…å‘½åçº¦å®šå·²è¢«å¼ƒç”¨ã€‚ IDE ä¸­çš„æ–°åŠŸèƒ½ Android Extensions æ’ä»¶å·²è¢«åˆå¹¶åˆ° Kotlin æ’ä»¶ä¸­ï¼Œä¸å†éœ€è¦å•ç‹¬å®‰è£… åˆ›å»ºæ–°çš„ Gradle å·¥ç¨‹æ—¶ï¼Œæ·»åŠ äº† Kotlin çš„é€‰é¡¹ä»¥ä¾›é€‰æ‹©ï¼š è°ƒè¯•å™¨ï¼šstacktrace å¯¼èˆªåŠŸèƒ½ç°åœ¨æ”¯æŒè·Ÿè¸ªå†…è”å‡½æ•°çš„å †æ ˆå¸§ã€‚åŒæ—¶å¯¹å†…è”å‡½æ•°çš„æ­¥è¿›è°ƒè¯•åŠŸèƒ½è¿›è¡Œäº†ä¸€ç³»åˆ—çš„æ”¹è¿›ã€‚ æ·»åŠ äº†ä¸‰ä¸ªå¿«é€Ÿåˆå§‹åŒ–æ–°å±æ€§çš„Quick Fixesï¼š Introduce Variableï¼ˆCtrl + Alt + V / Cmd + Alt + Vï¼‰ç°åœ¨æ”¯æŒç»“æ„å£°æ˜(multi-declarations)ï¼š åŒæ—¶Introduce Variableè¿˜èƒ½ä½¿ç”¨äº lambda æˆ–åŒ¿åå‡½æ•°ä¸­ï¼š Beta 3 å¼€å§‹æ”¯æŒåœ¨å­—ç¬¦ä¸²æ¨¡æ¿ä¸­ä½¿ç”¨ Introduce Variable/Parameter/Property/Function æœ€åï¼Œæ·»åŠ äº†ä¸€ä¸ªå®éªŒåŠŸèƒ½ â€”â€” åœ¨ IDE ä¸­å¯¹ Kotlin è„šæœ¬æ–‡ä»¶ï¼ˆ.ktsï¼‰åšäº†åŸºæœ¬çš„æ”¯æŒ","tags":[{"name":"Kotlin","slug":"Kotlin","permalink":"https://github.com/itgoyo/tags/Kotlin/"}]}]